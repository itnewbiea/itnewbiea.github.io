<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>最全HSQL命令大全(Hive命令) - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="最全HSQL命令大全(Hive命令)" />
<meta property="og:description" content="第1章 算数运算 1.1 加法： &#43; 语法：A &#43; B
操作类型：所有数值类型
说明： 返回A与B相加的结果。结果的数值类型等于A的类型和B的类型的最小父类型（详见数据类型的继承关系）。比如，int &#43; int 一般结果为int类型，而 int &#43; double 一般结果为double类型
hive&gt; select 1 &#43; 9 from iteblog; 10 hive&gt; create table iteblog as select 1 &#43; 1.2 from iteblog; hive&gt; describe iteblog; double 1.2 减法： - 语法：A - B
操作类型：所有数值类型
说明： 返回A与B相减的结果。结果的数值类型等于A的类型和B的类型的最小父类型（详见数据类型的继承关系）。比如，int – int 一般结果为int类型，而 int – double 一般结果为double类型
hive&gt; select 10 – 5 from iteblog; 5 hive&gt; create table iteblog as select 5." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/7397806aa8d00934f06c1c5ece383267/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-23T09:08:50+08:00" />
<meta property="article:modified_time" content="2023-12-23T09:08:50+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">最全HSQL命令大全(Hive命令)</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="1__0"></a>第1章 算数运算</h2> 
<h3><a id="11___2"></a>1.1 加法： +</h3> 
<p>语法：A + B</p> 
<p>操作类型：所有数值类型</p> 
<p>说明： 返回A与B相加的结果。结果的数值类型等于A的类型和B的类型的最小父类型（详见数据类型的继承关系）。比如，int + int 一般结果为int类型，而 int + double 一般结果为double类型</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">9</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">10</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> iteblog <span class="token keyword">as</span> <span class="token keyword">select</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">1.2</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">describe</span> iteblog<span class="token punctuation">;</span>
 <span class="token keyword">double</span>
</code></pre> 
<h3><a id="12___16"></a>1.2 减法： -</h3> 
<p>语法：A - B</p> 
<p>操作类型：所有数值类型</p> 
<p>说明： 返回A与B相减的结果。结果的数值类型等于A的类型和B的类型的最小父类型（详见数据类型的继承关系）。比如，int – int 一般结果为int类型，而 int – double 一般结果为double类型</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token number">10</span> – <span class="token number">5</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">5</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> iteblog <span class="token keyword">as</span> <span class="token keyword">select</span> <span class="token number">5.6</span> – <span class="token number">4</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">describe</span> iteblog<span class="token punctuation">;</span>
<span class="token keyword">double</span>
</code></pre> 
<h3><a id="13___31"></a>1.3 乘法： *</h3> 
<p>语法：A * B</p> 
<p>操作类型：所有数值类型</p> 
<p>说明： 返回A与B相乘的结果。结果的数值类型等于A的类型和B的类型的最小父类型（详见数据类型的继承关系）。注意，如果A乘以B的结果超过默认结果类型的数值范围，则需要通过cast将结果转换成范围更大的数值类型</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token number">40</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">200</span>
</code></pre> 
<h3><a id="14___42"></a>1.4 除法： /</h3> 
<p>语法：A / B</p> 
<p>操作类型：所有数值类型</p> 
<p>说明： 返回A除以B的结果。结果的数值类型为double</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token number">40</span> <span class="token operator">/</span> <span class="token number">5</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">8.0</span>
</code></pre> 
<p>注意：hive中最高精度的数据类型是double,只精确到小数点后16位，在做除法运算的时候要特别注意</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span><span class="token keyword">select</span> ceil<span class="token punctuation">(</span><span class="token number">28.0</span><span class="token operator">/</span><span class="token number">6.999999999999999999999</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog <span class="token keyword">limit</span> <span class="token number">1</span><span class="token punctuation">;</span>
结果为<span class="token number">4</span>
hive<span class="token operator">&gt;</span><span class="token keyword">select</span> ceil<span class="token punctuation">(</span><span class="token number">28.0</span><span class="token operator">/</span><span class="token number">6.99999999999999</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog <span class="token keyword">limit</span> <span class="token number">1</span><span class="token punctuation">;</span>
结果为<span class="token number">5</span>
</code></pre> 
<h3><a id="15___60"></a>1.5 取余： %</h3> 
<p>语法：A % B</p> 
<p>操作类型：所有数值类型</p> 
<p>说明： 返回A除以B的余数。结果的数值类型等于A的类型和B的类型的最小父类型（详见数据类型的继承关系）。</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token number">41</span> <span class="token operator">%</span> <span class="token number">5</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">1</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token number">8.4</span> <span class="token operator">%</span> <span class="token number">4</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">0.40000000000000036</span>
</code></pre> 
<p>注意：精度在hive中是个很大的问题，类似这样的操作最好通过round指定精度</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token number">8.4</span> <span class="token operator">%</span> <span class="token number">4</span> <span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">0.4</span>
</code></pre> 
<h3><a id="16___78"></a>1.6 位与： &amp;</h3> 
<p>语法：A &amp; B</p> 
<p>操作类型：所有数值类型</p> 
<p>说明：返回A和B按位进行与操作的结果。结果的数值类型等于A的类型和B的类型的最小父类型（详见数据类型的继承关系）。</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token number">4</span> <span class="token operator">&amp;</span> <span class="token number">8</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span><span class="token number">0</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token number">6</span> <span class="token operator">&amp;</span> <span class="token number">4</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span><span class="token number">4</span>
</code></pre> 
<h3><a id="17___89"></a>1.7 位或： |</h3> 
<p>语法：A | B</p> 
<p>操作类型：所有数值类型</p> 
<p>说明： 返回A和B按位进行或操作的结果。结果的数值类型等于A的类型和B的类型的最小父类型（详见数据类型的继承关系）。</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token number">4</span> <span class="token operator">|</span> <span class="token number">8</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">12</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token number">6</span> <span class="token operator">|</span> <span class="token number">8</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">14</span>
</code></pre> 
<h3><a id="18___102"></a>1.8 位异或： ^</h3> 
<p>语法：A ^ B</p> 
<p>操作类型：所有数值类型</p> 
<p>说明： 返回A和B按位进行异或操作的结果。结果的数值类型等于A的类型和B的类型的最小父类型（详见数据类型的继承关系）。</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token number">4</span> <span class="token operator">^</span> <span class="token number">8</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">12</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token number">6</span> <span class="token operator">^</span> <span class="token number">4</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">2</span>
</code></pre> 
<h3><a id="19___115"></a>1.9 位取反： ~</h3> 
<p>语法：~A</p> 
<p>操作类型：所有数值类型</p> 
<p>说明： 返回A按位取反操作的结果。结果的数值类型等于A的类型。</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">~</span><span class="token number">6</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token operator">-</span><span class="token number">7</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">~</span><span class="token number">4</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token operator">-</span><span class="token number">5</span>
</code></pre> 
<h2><a id="2__128"></a>第2章 关系运算</h2> 
<h3><a id="21___130"></a>2.1 等值比较： =</h3> 
<p>语法：A=B</p> 
<p>操作类型：所有基本类型</p> 
<p>说明： 如果表达式A与表达式B相等，则为TRUE；否则为FALSE</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token number">1</span> <span class="token keyword">from</span> iteblog <span class="token keyword">where</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token number">1</span>
</code></pre> 
<h3><a id="22___141"></a>2.2 不等值比较： &lt;&gt;</h3> 
<p>语法： A &lt;&gt; B</p> 
<p>操作类型： 所有基本类型</p> 
<p>说明： 如果表达式A为NULL，或者表达式B为NULL，返回NULL；如果表达式A与表达式B不相等，则为TRUE；否则为FALSE</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token number">1</span> <span class="token keyword">from</span> iteblog <span class="token keyword">where</span> <span class="token number">1</span> <span class="token operator">&lt;&gt;</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token number">1</span>
</code></pre> 
<h3><a id="23___152"></a>2.3 小于比较： &lt;</h3> 
<p>语法： A &lt; B</p> 
<p>操作类型：所有基本类型</p> 
<p>说明： 如果表达式A为NULL，或者表达式B为NULL，返回NULL；如果表达式A小于表达式B，则为TRUE；否则为FALSE</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token number">1</span> <span class="token keyword">from</span> iteblog <span class="token keyword">where</span> <span class="token number">1</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token number">1</span>
</code></pre> 
<h3><a id="24___163"></a>2.4 小于等于比较： &lt;=</h3> 
<p>语法： A &lt;= B</p> 
<p>操作类型： 所有基本类型</p> 
<p>说明： 如果表达式A为NULL，或者表达式B为NULL，返回NULL；如果表达式A小于或者等于表达式B，则为TRUE；否则为FALSE</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token number">1</span> <span class="token keyword">from</span> iteblog <span class="token keyword">where</span> <span class="token number">1</span> <span class="token operator">&lt;</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token number">1</span>
</code></pre> 
<h3><a id="25___174"></a>2.5 大于比较： &gt;</h3> 
<p>语法： A &gt; B</p> 
<p>操作类型： 所有基本类型</p> 
<p>说明： 如果表达式A为NULL，或者表达式B为NULL，返回NULL；如果表达式A大于表达式B，则为TRUE；否则为FALSE</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token number">1</span> <span class="token keyword">from</span> iteblog <span class="token keyword">where</span> <span class="token number">2</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token number">1</span>
</code></pre> 
<h3><a id="26___185"></a>2.6 大于等于比较： &gt;=</h3> 
<p>语法： A &gt;= B</p> 
<p>操作类型： 所有基本类型</p> 
<p>说明： 如果表达式A为NULL，或者表达式B为NULL，返回NULL；如果表达式A大于或者等于表达式B，则为TRUE；否则为FALSE</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token number">1</span> <span class="token keyword">from</span> iteblog <span class="token keyword">where</span> <span class="token number">1</span> <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token number">1</span>
</code></pre> 
<p>注意：String的比较要注意(常用的时间比较可以先 to_date 之后再比较)</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
OK
<span class="token number">2011111209</span> <span class="token number">00</span>：<span class="token number">00</span>：<span class="token number">00</span>     <span class="token number">2011111209</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> a<span class="token operator">&lt;</span>b<span class="token punctuation">,</span> a<span class="token operator">&gt;</span>b<span class="token punctuation">,</span> a<span class="token operator">=</span>b <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">2011111209</span> <span class="token number">00</span>：<span class="token number">00</span>：<span class="token number">00</span>     <span class="token number">2011111209</span>      <span class="token boolean">false</span>   <span class="token boolean">true</span>    <span class="token boolean">false</span>
</code></pre> 
<h3><a id="27__IS_NULL_206"></a>2.7 空值判断： IS NULL</h3> 
<p>语法： A IS NULL</p> 
<p>操作类型： 所有类型</p> 
<p>说明： 如果表达式A的值为NULL，则为TRUE；否则为FALSE</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token number">1</span> <span class="token keyword">from</span> iteblog <span class="token keyword">where</span> <span class="token boolean">null</span> <span class="token operator">is</span> <span class="token boolean">null</span><span class="token punctuation">;</span>
<span class="token number">1</span>
</code></pre> 
<h3><a id="28__IS_NOT_NULL_219"></a>2.8 非空判断： IS NOT NULL</h3> 
<p>语法： A IS NOT NULL</p> 
<p>操作类型： 所有类型</p> 
<p>说明： 如果表达式A的值为NULL，则为FALSE；否则为TRUE</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token number">1</span> <span class="token keyword">from</span> iteblog <span class="token keyword">where</span> <span class="token number">1</span> <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">;</span>
<span class="token number">1</span>
</code></pre> 
<h3><a id="29_LIKE_LIKE_232"></a>2.9 LIKE比较： LIKE</h3> 
<p>语法： A LIKE B</p> 
<p>操作类型： strings</p> 
<p>说明： 如果字符串A或者字符串B为NULL，则返回NULL；如果字符串A符合表达式B 的正则语法，则为TRUE；否则为FALSE。B中字符”_”表示任意单个字符，而字符”%”表示任意数量的字符。</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token number">1</span> <span class="token keyword">from</span> iteblog <span class="token keyword">where</span> <span class="token string">'football'</span> <span class="token operator">like</span> <span class="token string">'foot%'</span><span class="token punctuation">;</span>
<span class="token number">1</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token number">1</span> <span class="token keyword">from</span> iteblog <span class="token keyword">where</span> <span class="token string">'football'</span> <span class="token operator">like</span> <span class="token string">'foot____'</span><span class="token punctuation">;</span>
<span class="token number">1</span>
<span class="token operator">&lt;</span>strong<span class="token operator">&gt;</span>注意：否定比较时候用<span class="token operator">NOT</span> A <span class="token operator">LIKE</span> B<span class="token operator">&lt;</span><span class="token operator">/</span>strong<span class="token operator">&gt;</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token number">1</span> <span class="token keyword">from</span> iteblog <span class="token keyword">where</span> <span class="token operator">NOT</span> <span class="token string">'football'</span> <span class="token operator">like</span> <span class="token string">'fff%'</span><span class="token punctuation">;</span>
<span class="token number">1</span>
</code></pre> 
<h3><a id="210_JAVALIKE_RLIKE_250"></a>2.10 JAVA的LIKE操作： RLIKE</h3> 
<p>语法： A RLIKE B</p> 
<p>操作类型： strings</p> 
<p>说明： 如果字符串A或者字符串B为NULL，则返回NULL；如果字符串A符合JAVA正则表达式B的正则语法，则为TRUE；否则为FALSE。</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token number">1</span> <span class="token keyword">from</span> iteblog <span class="token keyword">where</span> <span class="token string">'footbar’ rlike '</span><span class="token operator">^</span>f<span class="token punctuation">.</span><span class="token operator">*</span>r$’<span class="token punctuation">;</span>
<span class="token number">1</span>
注意：判断一个字符串是否全为数字：
hive<span class="token operator">&gt;</span><span class="token keyword">select</span> <span class="token number">1</span> <span class="token keyword">from</span> iteblog <span class="token keyword">where</span> <span class="token string">'123456'</span> <span class="token operator">rlike</span> <span class="token string">'^\\d+$'</span><span class="token punctuation">;</span>
<span class="token number">1</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token number">1</span> <span class="token keyword">from</span> iteblog <span class="token keyword">where</span> <span class="token string">'123456aa'</span> <span class="token operator">rlike</span> <span class="token string">'^\\d+$'</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="211_REGEXP_REGEXP_267"></a>2.11 REGEXP操作： REGEXP</h3> 
<p>语法： A REGEXP B</p> 
<p>操作类型： strings</p> 
<p>说明： 功能与RLIKE相同</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token number">1</span> <span class="token keyword">from</span> iteblog <span class="token keyword">where</span> <span class="token string">'footbar'</span> <span class="token operator">REGEXP</span> <span class="token string">'^f.*r$'</span><span class="token punctuation">;</span>
<span class="token number">1</span>
</code></pre> 
<h2><a id="3__280"></a>第3章 数值函数</h2> 
<h3><a id="31__round_282"></a>3.1 取整函数： round</h3> 
<p>语法： round(double a)</p> 
<p>返回值： BIGINT</p> 
<p>说明： 返回double类型的整数值部分 （遵循四舍五入）</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token number">3.1415926</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">3</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token number">3.5</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">4</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> iteblog <span class="token keyword">as</span> <span class="token keyword">select</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token number">9542.158</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">describe</span> iteblog<span class="token punctuation">;</span>
_c0     <span class="token keyword">bigint</span>
</code></pre> 
<h3><a id="32__round_300"></a>3.2 指定精度取整函数： round</h3> 
<p>语法： round(double a, int d)</p> 
<p>返回值： DOUBLE</p> 
<p>说明： 返回指定精度d的double类型</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token number">3.1415926</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">3.1416</span>
</code></pre> 
<h3><a id="33__floor_313"></a>3.3 向下取整函数： floor</h3> 
<p>语法： floor(double a)</p> 
<p>返回值： BIGINT</p> 
<p>说明： 返回等于或者小于该double变量的最大的整数</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> floor<span class="token punctuation">(</span><span class="token number">3.1415926</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">3</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> floor<span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">25</span>
</code></pre> 
<h3><a id="34__ceil_328"></a>3.4 向上取整函数： ceil</h3> 
<p>语法： ceil(double a)</p> 
<p>返回值： BIGINT</p> 
<p>说明： 返回等于或者大于该double变量的最小的整数</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> ceil<span class="token punctuation">(</span><span class="token number">3.1415926</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">4</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> ceil<span class="token punctuation">(</span><span class="token number">46</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">46</span>
</code></pre> 
<h3><a id="35__ceiling_343"></a>3.5 向上取整函数： ceiling</h3> 
<p>语法： ceiling(double a)</p> 
<p>返回值： BIGINT</p> 
<p>说明： 与ceil功能相同</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> ceiling<span class="token punctuation">(</span><span class="token number">3.1415926</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">4</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> ceiling<span class="token punctuation">(</span><span class="token number">46</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">46</span>
</code></pre> 
<h3><a id="36__rand_358"></a>3.6 取随机数函数： rand</h3> 
<p>语法： rand(),rand(int seed)</p> 
<p>返回值： double</p> 
<p>说明： 返回一个0到1范围内的随机数。如果指定种子seed，则会等到一个稳定的随机数序列</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> rand<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">0.5577432776034763</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> rand<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">0.6638336467363424</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> rand<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">0.7220096548596434</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> rand<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">0.7220096548596434</span>
</code></pre> 
<h3><a id="37__exp_377"></a>3.7 自然指数函数： exp</h3> 
<p>语法： exp(double a)</p> 
<p>返回值： double</p> 
<p>说明： 返回自然对数e的a次方</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> exp<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">7.38905609893065</span>
<span class="token operator">&lt;</span>strong<span class="token operator">&gt;</span>自然对数函数<span class="token operator">&lt;</span><span class="token operator">/</span>strong<span class="token operator">&gt;</span>： ln
<span class="token operator">&lt;</span>strong<span class="token operator">&gt;</span>语法<span class="token operator">&lt;</span><span class="token operator">/</span>strong<span class="token operator">&gt;</span>： ln<span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">)</span>
<span class="token operator">&lt;</span>strong<span class="token operator">&gt;</span>返回值<span class="token operator">&lt;</span><span class="token operator">/</span>strong<span class="token operator">&gt;</span>： <span class="token keyword">double</span>
<span class="token operator">&lt;</span>strong<span class="token operator">&gt;</span>说明<span class="token operator">&lt;</span><span class="token operator">/</span>strong<span class="token operator">&gt;</span>： 返回a的自然对数
<span class="token number">1</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> ln<span class="token punctuation">(</span><span class="token number">7.38905609893065</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">2.0</span>
</code></pre> 
<h3><a id="38_10_log10_397"></a>3.8 以10为底对数函数： log10</h3> 
<p>语法： log10(double a)</p> 
<p>返回值： double</p> 
<p>说明： 返回以10为底的a的对数</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> log10<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">2.0</span>
</code></pre> 
<h3><a id="39_2_log2_410"></a>3.9 以2为底对数函数： log2</h3> 
<p>语法： log2(double a)</p> 
<p>返回值： double</p> 
<p>说明： 返回以2为底的a的对数</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> log2<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">3.0</span>
</code></pre> 
<h3><a id="310__log_423"></a>3.10 对数函数： log</h3> 
<p>语法： log(double base, double a)</p> 
<p>返回值： double</p> 
<p>说明： 返回以base为底的a的对数</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> log<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">4.0</span>
</code></pre> 
<h3><a id="311__pow_436"></a>3.11 幂运算函数： pow</h3> 
<p>语法： pow(double a, double p)</p> 
<p>返回值： double</p> 
<p>说明： 返回a的p次幂</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> pow<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">16.0</span>
</code></pre> 
<h3><a id="312__power_449"></a>3.12 幂运算函数： power</h3> 
<p>语法： power(double a, double p)</p> 
<p>返回值： double</p> 
<p>说明： 返回a的p次幂,与pow功能相同</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> power<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">16.0</span>
</code></pre> 
<h3><a id="313__sqrt_462"></a>3.13 开平方函数： sqrt</h3> 
<p>语法： sqrt(double a)</p> 
<p>返回值： double</p> 
<p>说明： 返回a的平方根</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> sqrt<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">4.0</span>
</code></pre> 
<h3><a id="314__bin_475"></a>3.14 二进制函数： bin</h3> 
<p>语法： bin(BIGINT a)</p> 
<p>返回值： string</p> 
<p>说明： 返回a的二进制代码表示</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> bin<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">111</span>
</code></pre> 
<h3><a id="315__hex_488"></a>3.15 十六进制函数： hex</h3> 
<p>语法： hex(BIGINT a)</p> 
<p>返回值： string</p> 
<p>说明： 如果变量是int类型，那么返回a的十六进制表示；如果变量是string类型，则返回该字符串的十六进制表示</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> hex<span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">11</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> hex<span class="token punctuation">(</span>‘abc’<span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">616263</span>
</code></pre> 
<h3><a id="316__abs_503"></a>3.16 绝对值函数： abs</h3> 
<p>语法： abs(double a) abs(int a)</p> 
<p>返回值： double int</p> 
<p>说明： 返回数值a的绝对值</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> abs<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3.9</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">3.9</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> abs<span class="token punctuation">(</span><span class="token number">10.9</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">10.9</span>
</code></pre> 
<h3><a id="317__unhex_518"></a>3.17 反转十六进制函数： unhex</h3> 
<p>语法： unhex(string a)</p> 
<p>返回值： string</p> 
<p>说明： 返回该十六进制字符串所代码的字符串</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> unhex<span class="token punctuation">(</span>‘<span class="token number">616263</span>’<span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
abc
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> unhex<span class="token punctuation">(</span>‘<span class="token number">11</span>’<span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token operator">-</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> unhex<span class="token punctuation">(</span><span class="token number">616263</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
abc
</code></pre> 
<h3><a id="318__conv_535"></a>3.18 进制转换函数： conv</h3> 
<p>语法： conv(BIGINT num, int from_base, int to_base)</p> 
<p>返回值： string</p> 
<p>说明： 将数值num从from_base进制转化到to_base进制</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> conv<span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">11</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> conv<span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">10001</span>
</code></pre> 
<h3><a id="319__pmod_550"></a>3.19 正取余函数： pmod</h3> 
<p>语法： pmod(int a, int b),pmod(double a, double b)</p> 
<p>返回值： int double</p> 
<p>说明： 返回正的a除以b的余数</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> pmod<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">1</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> pmod<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">3</span>
</code></pre> 
<h3><a id="320__sin_565"></a>3.20 正弦函数： sin</h3> 
<p>语法： sin(double a)</p> 
<p>返回值： double</p> 
<p>说明： 返回a的正弦值</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> sin<span class="token punctuation">(</span><span class="token number">0.8</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">0.7173560908995228</span>
</code></pre> 
<h3><a id="321__asin_578"></a>3.21 反正弦函数： asin</h3> 
<p>语法： asin(double a)</p> 
<p>返回值： double</p> 
<p>说明： 返回a的反正弦值</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> asin<span class="token punctuation">(</span><span class="token number">0.7173560908995228</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">0.8</span>
</code></pre> 
<h3><a id="322__cos_591"></a>3.22 余弦函数： cos</h3> 
<p>语法： cos(double a)</p> 
<p>返回值： double</p> 
<p>说明： 返回a的余弦值</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> cos<span class="token punctuation">(</span><span class="token number">0.9</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">0.6216099682706644</span>
</code></pre> 
<h3><a id="323__acos_604"></a>3.23 反余弦函数： acos</h3> 
<p>语法： acos(double a)</p> 
<p>返回值： double</p> 
<p>说明： 返回a的反余弦值</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> acos<span class="token punctuation">(</span><span class="token number">0.6216099682706644</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">0.9</span>
</code></pre> 
<h3><a id="324_positive_positive_617"></a>3.24 positive函数： positive</h3> 
<p>语法： positive(int a), positive(double a)</p> 
<p>返回值： int double</p> 
<p>说明： 返回a</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> positive<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token operator">-</span><span class="token number">10</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> positive<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">12</span>
</code></pre> 
<h3><a id="325_negative_negative_632"></a>3.25 negative函数： negative</h3> 
<p>语法： negative(int a), negative(double a)</p> 
<p>返回值： int double</p> 
<p>说明： 返回-a</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> negative<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">5</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> negative<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token operator">-</span><span class="token number">8</span>
</code></pre> 
<h3><a id="326_ln_647"></a>3.26自然对数函数： ln</h3> 
<p>语法： ln(double a)</p> 
<p>返回值： double</p> 
<p>说明： 返回a的自然对数，a可为小数</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> ln<span class="token punctuation">(</span><span class="token number">7.38905609893065</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">2.0</span>
</code></pre> 
<h3><a id="327_tan_658"></a>3.27 正切函数：tan</h3> 
<p>语法： tan(double a)</p> 
<p>返回值： double</p> 
<p>说明： 返回a的正切值</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> tan<span class="token punctuation">(</span><span class="token number">0.8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">1.0296385570503641</span>
</code></pre> 
<h3><a id="328_atan_669"></a>3.28 反正切函数：atan</h3> 
<p>语法： atan(double a)</p> 
<p>返回值： double</p> 
<p>说明： 返回a的反正切值</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> atan<span class="token punctuation">(</span><span class="token number">1.0296385570503641</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">0.8</span>
</code></pre> 
<h3><a id="329_degrees_680"></a>3.29 弧度值转换角度值：degrees</h3> 
<p>语法： degrees(double a)</p> 
<p>返回值： double</p> 
<p>说明： 返回a的角度值</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> degrees<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">57.29577951308232</span>
</code></pre> 
<h3><a id="330_radians_691"></a>3.30 角度值转换成弧度值：radians</h3> 
<p>语法： radians(double a)</p> 
<p>返回值： double</p> 
<p>说明： 返回a的弧度值</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> radians<span class="token punctuation">(</span><span class="token number">57.29577951308232</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">1.0</span>
</code></pre> 
<h3><a id="331_sign_702"></a>3.31 判断正负函数：sign</h3> 
<p>语法： sign(double a)</p> 
<p>返回值： double</p> 
<p>说明： 如果a是正数则返回1.0，是负数则返回-1.0，否则返回0.0</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> sign<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">-</span><span class="token number">1.0</span>
</code></pre> 
<h3><a id="332_ee_713"></a>3.32 数学e函数：e</h3> 
<p>语法： e()</p> 
<p>返回值： double</p> 
<p>说明： 数学常数e</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> e<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">2.718281828459045</span>
</code></pre> 
<h3><a id="333_pipi_724"></a>3.33 数学pi函数：pi</h3> 
<p>语法： pi()</p> 
<p>返回值： double</p> 
<p>说明： 圆周率π</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> pi<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">3.141592653589793</span>
</code></pre> 
<h3><a id="334_factorial_735"></a>3.34 阶乘函数：factorial</h3> 
<p>语法： factorial(int a)</p> 
<p>返回值： bigint</p> 
<p>说明： 求a的阶乘</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> factorial<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">120</span>
</code></pre> 
<h3><a id="335_cbrt_746"></a>3.35 立方根函数：cbrt</h3> 
<p>语法： cbrt(double a)</p> 
<p>返回值： double</p> 
<p>说明： 求a的立方根</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> cbrt<span class="token punctuation">(</span><span class="token number">27</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">3</span>
</code></pre> 
<h3><a id="336_shiftleft_757"></a>3.36 左移函数：shiftleft</h3> 
<p>语法： shiftleft(BIGINT a, int b)</p> 
<p>返回值： int bigint</p> 
<p>说明： 按位左移</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> shiftleft<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">16</span>
</code></pre> 
<h3><a id="337_shiftright_768"></a>3.37 右移函数：shiftright</h3> 
<p>语法： shiftright(BIGINT a, int b)</p> 
<p>返回值： int bigint</p> 
<p>说明： 按位右移</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> shiftright<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">8</span>
</code></pre> 
<h3><a id="338_shiftrightunsigned_779"></a>3.38 无符号按位右移函数：shiftrightunsigned</h3> 
<p>语法： shiftrightunsigned(BIGINT a, int b)</p> 
<p>返回值： int bigint</p> 
<p>说明： 无符号按位右移（&lt;&lt;&lt;）</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> shiftrightunsigned<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token number">8</span>
</code></pre> 
<h3><a id="339_greatest_790"></a>3.39 求最大值函数：greatest</h3> 
<p>语法： greatest(T v1, T v2, …)</p> 
<p>返回值： T</p> 
<p>说明： 求最大值</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> greatest<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">3</span>
</code></pre> 
<h3><a id="340_least_801"></a>3.40 求最小值函数：least</h3> 
<p>语法： least(T v1, T v2, …)</p> 
<p>返回值： T</p> 
<p>说明： 求最小值</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> least<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">1</span>
</code></pre> 
<h3><a id="341_bround_812"></a>3.41 银行家舍入法函数：bround</h3> 
<p>语法： bround(double a)</p> 
<p>返回值： double</p> 
<p>说明： 银行家舍入法（1-4：舍，6-9：进，5-&gt;前位数是偶：舍，5-&gt;前位数是奇：进）</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> bround<span class="token punctuation">(</span><span class="token number">3.5</span><span class="token punctuation">)</span>
<span class="token number">3.0</span>
</code></pre> 
<h3><a id="342_bround_823"></a>3.42 银行家精确舍入法函数：bround</h3> 
<p>语法： bround(double a，int d)</p> 
<p>返回值： double</p> 
<p>说明： 银行家舍入法,保留d位小数</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> bround<span class="token punctuation">(</span><span class="token number">3.15</span>，<span class="token number">1</span><span class="token punctuation">)</span>
<span class="token number">3.1</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> bround<span class="token punctuation">(</span><span class="token number">3.25</span>，<span class="token number">1</span><span class="token punctuation">)</span>
<span class="token number">3.3</span>
</code></pre> 
<h2><a id="4__836"></a>第4章 日期函数</h2> 
<h3><a id="41_UNIX_from_unixtime_838"></a>4.1 UNIX时间戳转日期函数： from_unixtime</h3> 
<p>语法： from_unixtime(bigint unixtime[, string format])</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> from_utc_timestamp<span class="token punctuation">(</span><span class="token number">1677254551375</span><span class="token punctuation">,</span> <span class="token string">'Asia/Shanghai'</span><span class="token punctuation">)</span>
</code></pre> 
<p>返回值： string</p> 
<p>说明： 转化UNIX时间戳（从1970-01-01 00：00：00 UTC到指定时间的秒数）到当前时区的时间格式</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> from_unixtime<span class="token punctuation">(</span><span class="token number">1323308943</span><span class="token punctuation">,</span><span class="token string">'yyyyMMdd'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">20111208</span>
 <span class="token keyword">select</span> from_utc_timestamp<span class="token punctuation">(</span><span class="token number">1677254551375</span><span class="token punctuation">,</span> <span class="token string">'Asia/Shanghai'</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="41_UNIX_from_utc_timestamp_854"></a>4.1 UNIX时间戳转日期函数： from_utc_timestamp</h3> 
<p>select from_utc_timestamp(1677254551375, ‘Asia/Shanghai’)</p> 
<p>返回值： string</p> 
<p>说明： 转化UNIX时间戳（从1970-01-01 00：00：00 UTC到指定时间的秒数）到当前时区的时间格式</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> from_utc_timestamp<span class="token punctuation">(</span><span class="token number">1677254551375</span><span class="token punctuation">,</span> <span class="token string">'Asia/Shanghai'</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="42_UNIX_unix_timestamp_864"></a>4.2 获取当前UNIX时间戳函数： unix_timestamp</h3> 
<p>语法： unix_timestamp()</p> 
<p>返回值： bigint</p> 
<p>说明： 获得当前时区的UNIX时间戳</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> unix_timestamp<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">1323309615</span>
</code></pre> 
<h3><a id="43_UNIX_unix_timestamp_877"></a>4.3 日期转UNIX时间戳函数： unix_timestamp</h3> 
<p>语法： unix_timestamp(string date)</p> 
<p>返回值： bigint</p> 
<p>说明： 转换格式为"yyyy-MM-dd HH：mm：ss"的日期到UNIX时间戳。如果转化失败，则返回0。</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> unix_timestamp<span class="token punctuation">(</span><span class="token string">'2011-12-07 13：01：03'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">1323234063</span>
</code></pre> 
<h3><a id="44_UNIX_unix_timestamp_890"></a>4.4 指定格式日期转UNIX时间戳函数： unix_timestamp</h3> 
<p>语法： unix_timestamp(string date, string pattern)</p> 
<p>返回值： bigint</p> 
<p>说明： 转换pattern格式的日期到UNIX时间戳。如果转化失败，则返回0。</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> unix_timestamp<span class="token punctuation">(</span><span class="token string">'20111207 13：01：03'</span><span class="token punctuation">,</span><span class="token string">'yyyyMMdd HH：mm：ss'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">1323234063</span>
</code></pre> 
<h3><a id="45__to_date_903"></a>4.5 日期时间转日期函数： to_date</h3> 
<p>语法： to_date(string timestamp)</p> 
<p>返回值： string</p> 
<p>说明： 返回日期时间字段中的日期部分。</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> to_date<span class="token punctuation">(</span><span class="token string">'2011-12-08 10：03：01'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">2011</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">08</span>
</code></pre> 
<h3><a id="46__year_916"></a>4.6 日期转年函数： year</h3> 
<p>语法： year(string date)</p> 
<p>返回值： int</p> 
<p>说明： 返回日期中的年。</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">year</span><span class="token punctuation">(</span><span class="token string">'2011-12-08 10：03：01'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">2011</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">year</span><span class="token punctuation">(</span><span class="token string">'2012-12-08'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">2012</span>
</code></pre> 
<h3><a id="47__month_931"></a>4.7 日期转月函数： month</h3> 
<p>语法： month (string date)</p> 
<p>返回值： int</p> 
<p>说明： 返回日期中的月份。</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">month</span><span class="token punctuation">(</span><span class="token string">'2011-12-08 10：03：01'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">12</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">month</span><span class="token punctuation">(</span><span class="token string">'2011-08-08'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">8</span>
</code></pre> 
<h3><a id="48__day_946"></a>4.8 日期转天函数： day</h3> 
<p>语法： day (string date)</p> 
<p>返回值： int</p> 
<p>说明： 返回日期中的天。</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">day</span><span class="token punctuation">(</span><span class="token string">'2011-12-08 10：03：01'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">8</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">day</span><span class="token punctuation">(</span><span class="token string">'2011-12-24'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">24</span>
</code></pre> 
<h3><a id="49__hour_961"></a>4.9 日期转小时函数： hour</h3> 
<p>语法： hour (string date)</p> 
<p>返回值： int</p> 
<p>说明： 返回日期中的小时。</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">hour</span><span class="token punctuation">(</span><span class="token string">'2011-12-08 10：03：01'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">10</span>
</code></pre> 
<h3><a id="410__minute_974"></a>4.10 日期转分钟函数： minute</h3> 
<p>语法： minute (string date)</p> 
<p>返回值： int</p> 
<p>说明： 返回日期中的分钟。</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">minute</span><span class="token punctuation">(</span><span class="token string">'2011-12-08 10：03：01'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">3</span>
</code></pre> 
<h3><a id="411__second_987"></a>4.11 日期转秒函数： second</h3> 
<p>语法： second (string date)</p> 
<p>返回值： int</p> 
<p>说明： 返回日期中的秒。</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">second</span><span class="token punctuation">(</span><span class="token string">'2011-12-08 10：03：01'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">1</span>
</code></pre> 
<h3><a id="412__weekofyear_1000"></a>4.12 日期转周函数： weekofyear</h3> 
<p>语法： weekofyear (string date)</p> 
<p>返回值： int</p> 
<p>说明： 返回日期在当前的周数。</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> weekofyear<span class="token punctuation">(</span><span class="token string">'2011-12-08 10：03：01'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">49</span>
</code></pre> 
<h3><a id="413__datediff_1013"></a>4.13 日期比较函数： datediff</h3> 
<p>语法： datediff(string enddate, string startdate)</p> 
<p>返回值： int</p> 
<p>说明： 返回结束日期减去开始日期的天数。</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> datediff<span class="token punctuation">(</span><span class="token string">'2012-12-08'</span><span class="token punctuation">,</span><span class="token string">'2012-05-09'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">213</span>
</code></pre> 
<h3><a id="414__date_add_1026"></a>4.14 日期增加函数： date_add</h3> 
<p>语法： date_add(string startdate, int days)</p> 
<p>返回值： string</p> 
<p>说明： 返回开始日期startdate增加days天后的日期。</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> date_add<span class="token punctuation">(</span><span class="token string">'2012-12-08'</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">2012</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">18</span>
</code></pre> 
<h3><a id="415__date_sub_1039"></a>4.15 日期减少函数： date_sub</h3> 
<p>语法： date_sub (string startdate, int days)</p> 
<p>返回值： string</p> 
<p>说明： 返回开始日期startdate减少days天后的日期。</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> date_sub<span class="token punctuation">(</span><span class="token string">'2012-12-08'</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">2012</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">28</span>
</code></pre> 
<h3><a id="416__from_utc_timestamp_1050"></a>4.16 转化成指定的时区下时间戳函数： from_utc_timestamp</h3> 
<p>语法： from_utc_timestamp(timestamp, string timezone)</p> 
<p>返回值： timestamp</p> 
<p>说明： 如果给定的时间戳并非UTC，则将其转化成指定的时区下时间戳</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> from_utc_timestamp<span class="token punctuation">(</span>‘<span class="token number">1970</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">08</span>：<span class="token number">00</span>：<span class="token number">00</span>’<span class="token punctuation">,</span>‘PST’<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">1970</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>：<span class="token number">00</span>：<span class="token number">00</span>
</code></pre> 
<h3><a id="417_UTC_to_utc_timestamp_1061"></a>4.17 转化成UTC下的时间戳函数： to_utc_timestamp</h3> 
<p>语法： to_utc_timestamp(timestamp, string timezone)</p> 
<p>返回值： timestamp</p> 
<p>说明： 如果给定的时间戳指定的时区下时间戳，则将其转化成UTC下的时间戳。</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> to_utc_timestamp<span class="token punctuation">(</span>‘<span class="token number">1970</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>：<span class="token number">00</span>：<span class="token number">00</span>’<span class="token punctuation">,</span>‘PST’<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">1970</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">08</span>：<span class="token number">00</span>：<span class="token number">00</span>
</code></pre> 
<h3><a id="418_current_date_1072"></a>4.18 当前时间日期函数：current_date</h3> 
<p>语法： current_date()</p> 
<p>返回值： date</p> 
<p>说明： 返回当前时间日期</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">current_date</span><span class="token punctuation">;</span>
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span>
</code></pre> 
<h3><a id="419_current_timestamp_1083"></a>4.19 当前时间日期函数：current_timestamp</h3> 
<p>语法： current_timestamp()</p> 
<p>返回值： timestamp</p> 
<p>说明： 返回当前时间戳</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">current_timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span> <span class="token number">22</span>：<span class="token number">52</span>：<span class="token number">11.309</span>
</code></pre> 
<h3><a id="420_add_months_1094"></a>4.20 月份增加函数：add_months</h3> 
<p>语法： add_months(string start_date, int num_months)</p> 
<p>返回值： string</p> 
<p>说明： 返回当前时间下再增加num_months个月的日期</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> add_months<span class="token punctuation">(</span>‘<span class="token number">1996</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">21</span>’<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">1997</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">21</span>
</code></pre> 
<h3><a id="421_last_day_1105"></a>4.21 最后一天的日期函数：last_day</h3> 
<p>语法： last_day(string date)</p> 
<p>返回值： string</p> 
<p>说明： 返回这个月的最后一天的日期，忽略时分秒部分（HH：mm：ss）</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> last_day<span class="token punctuation">(</span><span class="token keyword">current_date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">31</span>
</code></pre> 
<h3><a id="422_Xnext_day_1116"></a>4.22 下一个星期X所对应的日期函数：next_day</h3> 
<p>语法： next_day(string start_date, string day_of_week)</p> 
<p>返回值： string</p> 
<p>说明： 返回当前时间的下一个星期X所对应的日期 如：next_day(‘2015-01-14’, ‘TU’) = 2015-01-20 以2015-01-14为开始时间，其下一个星期二所对应的日期为2015-01-20</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> next_day<span class="token punctuation">(</span><span class="token keyword">current_date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>‘su’<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">19</span>
</code></pre> 
<h3><a id="423_trunc_1127"></a>4.23 时间的最开始年份或月份函数：trunc</h3> 
<p>语法： trunc(string date, string format)</p> 
<p>返回值： string</p> 
<p>说明： 返回时间的最开始年份或月份 如trunc(“2016-06-26”,“MM”)=2016-06-01 trunc(“2016-06-26”,“YY”)=2016-01-01 注意所支持的格式为MONTH/MON/MM, YEAR/YYYY/YY</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> trunc<span class="token punctuation">(</span><span class="token keyword">current_date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>‘MM’<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">01</span>
</code></pre> 
<h3><a id="424_months_between_1138"></a>4.24 相差的月份函数：months_between</h3> 
<p>语法： months_between(date1, date2)</p> 
<p>返回值： double</p> 
<p>说明： 返回date1与date2之间相差的月份，如date1&gt;date2，则返回正，如果date1&lt;date2,则返回负，否则返回0.0 如：months_between(‘1997-02-28 10：30：00’, ‘1996-10-30’) = 3.94959677 1997-02-28 10：30：00与1996-10-30相差3.94959677个月</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> months_between<span class="token punctuation">(</span><span class="token keyword">current_date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>‘<span class="token number">2020</span><span class="token operator">-</span><span class="token number">5</span><span class="token operator">-</span><span class="token number">13</span>’<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">2.0</span>
</code></pre> 
<h3><a id="425_date_format_1149"></a>4.25 指定格式返回时间函数：date_format</h3> 
<p>语法： date_format(date/timestamp/string ts, string fmt)</p> 
<p>返回值： string</p> 
<p>说明： 按指定格式返回时间date 如：date_format(“2016-06-22”,“MM-dd”)=06-22</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> date_format<span class="token punctuation">(</span><span class="token keyword">current_date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>‘MM<span class="token punctuation">.</span>dd’<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">07.13</span>
</code></pre> 
<h3><a id="426_dayofweek_1160"></a>4.26 当前星期函数：dayofweek</h3> 
<p>语法： dayofweek(date)</p> 
<p>返回值： int</p> 
<p>说明： 返回日期那天的周几</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> dayofweek<span class="token punctuation">(</span><span class="token keyword">current_date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">2</span>
</code></pre> 
<h3><a id="427_quarter_1171"></a>4.27 季节函数：quarter</h3> 
<p>语法： quarter(date/timestamp/string)</p> 
<p>返回值： int</p> 
<p>说明： 返回当前时间属性哪个季度 如quarter(‘2015-04-08’) = 2</p> 
<h2><a id="5__1179"></a>第5章 条件函数</h2> 
<h3><a id="51_If_if_1181"></a>5.1 If函数： if</h3> 
<p>语法： if(boolean testCondition, T valueTrue, T valueFalseOrNull)</p> 
<p>返回值： T</p> 
<p>说明： 当条件testCondition为TRUE时，返回valueTrue；否则返回valueFalseOrNull（valueTrue，valueFalseOrNull为泛型）</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">100</span>
</code></pre> 
<h3><a id="52__nvl_1192"></a>5.2 空查找函数： nvl</h3> 
<p>语法： nvl(T value, T default_value)</p> 
<p>返回值： T</p> 
<p>说明： 如果value值为NULL就返回default_value,否则返回value</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> nvl<span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">5</span>
</code></pre> 
<h3><a id="53__COALESCE_1203"></a>5.3 非空查找函数： COALESCE</h3> 
<p>语法： COALESCE(T v1, T v2,…)</p> 
<p>返回值： T</p> 
<p>说明： 返回参数中的第一个非空值；如果所有值都为NULL，那么返回NULL</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">COALESCE</span> <span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token number">44</span><span class="token punctuation">,</span><span class="token number">55</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">44</span>
</code></pre> 
<h3><a id="54_CASE_1214"></a>5.4 条件判断函数：CASE</h3> 
<p>语法： CASE a WHEN b THEN c [WHEN d THEN e] * [ELSE f] END</p> 
<p>返回值： T</p> 
<p>说明： 如果a等于b，那么返回c；如果a等于d，那么返回e；否则返回f</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">CASE</span> <span class="token number">4</span> <span class="token keyword">WHEN</span> <span class="token number">5</span> <span class="token keyword">THEN</span> <span class="token number">5</span> <span class="token keyword">WHEN</span> <span class="token number">4</span> <span class="token keyword">THEN</span> <span class="token number">4</span> <span class="token keyword">ELSE</span> <span class="token number">3</span> <span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token number">4</span>
</code></pre> 
<h3><a id="55_CASE_1225"></a>5.5 条件判断函数：CASE</h3> 
<p>语法： CASE WHEN a THEN b [WHEN c THEN d]* [ELSE e] END</p> 
<p>返回值： T</p> 
<p>说明： 如果a为TRUE,则返回b；如果c为TRUE，则返回d；否则返回e</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token number">5</span><span class="token operator">&gt;</span><span class="token number">0</span> <span class="token keyword">THEN</span> <span class="token number">5</span> <span class="token keyword">WHEN</span> <span class="token number">4</span><span class="token operator">&gt;</span><span class="token number">0</span> <span class="token keyword">THEN</span> <span class="token number">4</span> <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token number">5</span>
</code></pre> 
<h3><a id="56_isnull_1236"></a>5.6 空值判断函数：isnull</h3> 
<p>语法： isnull( a )</p> 
<p>返回值： boolean</p> 
<p>说明： 如果a为null就返回true，否则返回false</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> isnull<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token boolean">false</span>
</code></pre> 
<h3><a id="57_isnotnull_1247"></a>5.7 非空值判断函数：isnotnull</h3> 
<p>语法： isnotnull ( a )</p> 
<p>返回值： boolean</p> 
<p>说明： 如果a为非null就返回true，否则返回false</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> isnotnull<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token boolean">true</span>
</code></pre> 
<h2><a id="6__1258"></a>第6章 字符串函数</h2> 
<h3><a id="61_length_1260"></a>6.1 字符串长度函数：length</h3> 
<p>语法： length(string A)</p> 
<p>返回值： int</p> 
<p>说明：返回字符串A的长度</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> length<span class="token punctuation">(</span><span class="token string">'abcedfg'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">7</span>
</code></pre> 
<h3><a id="62_reverse_1273"></a>6.2 字符串反转函数：reverse</h3> 
<p>语法： reverse(string A)</p> 
<p>返回值： string</p> 
<p>说明：返回字符串A的反转结果</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> reverse<span class="token punctuation">(</span>abcedfg’<span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
gfdecba
</code></pre> 
<h3><a id="63_concat_1286"></a>6.3 字符串连接函数：concat</h3> 
<p>语法： concat(string A, string B…)</p> 
<p>返回值： string</p> 
<p>说明：返回输入字符串连接后的结果，支持任意个输入字符串</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> concat<span class="token punctuation">(</span>‘abc’<span class="token punctuation">,</span><span class="token string">'def’,'</span>gh’<span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
abcdefgh
</code></pre> 
<h3><a id="64_concat_ws_1299"></a>6.4 带分隔符字符串连接函数：concat_ws</h3> 
<p>语法： concat_ws(string SEP, string A, string B…)</p> 
<p>返回值： string</p> 
<p>说明：返回输入字符串连接后的结果，SEP表示各个字符串间的分隔符</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> concat_ws<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span><span class="token string">'abc'</span><span class="token punctuation">,</span><span class="token string">'def'</span><span class="token punctuation">,</span><span class="token string">'gh'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
abc<span class="token punctuation">,</span>def<span class="token punctuation">,</span>gh
</code></pre> 
<h3><a id="65_substrsubstring_1312"></a>6.5 字符串截取函数：substr,substring</h3> 
<p>语法： substr(string A, int start),substring(string A, int start)</p> 
<p>返回值： string</p> 
<p>说明：返回字符串A从start位置到结尾的字符串</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> substr<span class="token punctuation">(</span><span class="token string">'abcde'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
cde
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> substring<span class="token punctuation">(</span><span class="token string">'abcde'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
cde
hive<span class="token operator">&gt;</span>  <span class="token keyword">select</span> substr<span class="token punctuation">(</span><span class="token string">'abcde'</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>  （和ORACLE相同）
e
</code></pre> 
<h3><a id="66_substrsubstring_1329"></a>6.6 字符串截取函数：substr,substring</h3> 
<p>语法： substr(string A, int start, int len),substring(string A, int start, int len)</p> 
<p>返回值： string</p> 
<p>说明：返回字符串A从start位置开始，长度为len的字符串</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> substr<span class="token punctuation">(</span><span class="token string">'abcde'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
cd
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> substring<span class="token punctuation">(</span><span class="token string">'abcde'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
cd
hive<span class="token operator">&gt;</span><span class="token keyword">select</span> substring<span class="token punctuation">(</span><span class="token string">'abcde'</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
de
</code></pre> 
<h3><a id="67_upperucase_1346"></a>6.7 字符串转大写函数：upper,ucase</h3> 
<p>语法： upper(string A) ucase(string A)</p> 
<p>返回值： string</p> 
<p>说明：返回字符串A的大写格式</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> upper<span class="token punctuation">(</span><span class="token string">'abSEd'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
ABSED
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">ucase</span><span class="token punctuation">(</span><span class="token string">'abSEd'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
ABSED
</code></pre> 
<h3><a id="68_lowerlcase_1361"></a>6.8 字符串转小写函数：lower,lcase</h3> 
<p>语法： lower(string A) lcase(string A)</p> 
<p>返回值： string</p> 
<p>说明：返回字符串A的小写格式</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> lower<span class="token punctuation">(</span><span class="token string">'abSEd'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
absed
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token function">lcase</span><span class="token punctuation">(</span><span class="token string">'abSEd'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
absed
</code></pre> 
<h3><a id="69_trim_1376"></a>6.9 去空格函数：trim</h3> 
<p>语法： trim(string A)</p> 
<p>返回值： string</p> 
<p>说明：去除字符串两边的空格</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> trim<span class="token punctuation">(</span><span class="token string">' abc '</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
abc
</code></pre> 
<h3><a id="610_ltrim_1389"></a>6.10 左边去空格函数：ltrim</h3> 
<p>语法： ltrim(string A)</p> 
<p>返回值： string</p> 
<p>说明：去除字符串左边的空格</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> ltrim<span class="token punctuation">(</span><span class="token string">' abc '</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
abc
</code></pre> 
<h3><a id="611_rtrim_1402"></a>6.11 右边去空格函数：rtrim</h3> 
<p>语法： rtrim(string A)</p> 
<p>返回值： string</p> 
<p>说明：去除字符串右边的空格</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> rtrim<span class="token punctuation">(</span><span class="token string">' abc '</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
abc
</code></pre> 
<h3><a id="612_regexp_replace_1415"></a>6.12 正则表达式替换函数：regexp_replace</h3> 
<p>语法： regexp_replace(string A, string B, string C)</p> 
<p>返回值： string</p> 
<p>说明：将字符串A中的符合java正则表达式B的部分替换为C。注意，在有些情况下要使用转义字符,类似oracle中的regexp_replace函数。</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> regexp_replace<span class="token punctuation">(</span><span class="token string">'foobar'</span><span class="token punctuation">,</span> <span class="token string">'oo|ar'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
fb
</code></pre> 
<h3><a id="613_regexp_extract_1428"></a>6.13 正则表达式解析函数：regexp_extract</h3> 
<p>语法： regexp_extract(string subject, string pattern, int index)</p> 
<p>返回值： string</p> 
<p>说明：将字符串subject按照pattern正则表达式的规则拆分，返回index指定的字符。</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> regexp_extract<span class="token punctuation">(</span><span class="token string">'foothebar'</span><span class="token punctuation">,</span> <span class="token string">'foo(.*?)(bar)'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
the
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> regexp_extract<span class="token punctuation">(</span><span class="token string">'foothebar'</span><span class="token punctuation">,</span> <span class="token string">'foo(.*?)(bar)'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
bar
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> regexp_extract<span class="token punctuation">(</span><span class="token string">'foothebar'</span><span class="token punctuation">,</span> <span class="token string">'foo(.*?)(bar)'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
foothebar
strong<span class="token operator">&gt;</span>注意，在有些情况下要使用转义字符，下面的等号要用双竖线转义，这是java正则表达式的规则。
<span class="token keyword">select</span> data_field<span class="token punctuation">,</span>
  regexp_extract<span class="token punctuation">(</span>data_field<span class="token punctuation">,</span><span class="token string">'.*?bgStart\\=([^&amp;]+)'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> aaa<span class="token punctuation">,</span>
  regexp_extract<span class="token punctuation">(</span>data_field<span class="token punctuation">,</span><span class="token string">'.*?contentLoaded_headStart\\=([^&amp;]+)'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> bbb<span class="token punctuation">,</span>
  regexp_extract<span class="token punctuation">(</span>data_field<span class="token punctuation">,</span><span class="token string">'.*?AppLoad2Req\\=([^&amp;]+)'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> ccc
  <span class="token keyword">from</span> pt_nginx_loginlog_st
  <span class="token keyword">where</span> pt <span class="token operator">=</span> <span class="token string">'2012-03-26'</span> <span class="token keyword">limit</span> <span class="token number">2</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="614_URLparse_url_1452"></a>6.14 URL解析函数：parse_url</h3> 
<p>语法： parse_url(string urlString, string partToExtract [, string keyToExtract])</p> 
<p>返回值： string</p> 
<p>说明：返回URL中指定的部分。partToExtract的有效值为：HOST, PATH, QUERY, REF, PROTOCOL, AUTHORITY, FILE, and USERINFO.</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> parse_url<span class="token punctuation">(</span><span class="token string">'https：//www.iteblog.com/path1/p.php?k1=v1&amp;k2=v2#Ref1'</span><span class="token punctuation">,</span> <span class="token string">'HOST'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
facebook<span class="token punctuation">.</span>com
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> parse_url<span class="token punctuation">(</span><span class="token string">'https：//www.iteblog.com/path1/p.php?k1=v1&amp;k2=v2#Ref1'</span><span class="token punctuation">,</span> <span class="token string">'QUERY'</span><span class="token punctuation">,</span> <span class="token string">'k1'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
v1
</code></pre> 
<h3><a id="615_jsonget_json_object_1467"></a>6.15 json解析函数：get_json_object</h3> 
<p>语法： get_json_object(string json_string, string path)</p> 
<p>返回值： string</p> 
<p>说明：解析json的字符串json_string,返回path指定的内容。如果输入的json字符串无效，那么返回NULL。</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span>  get_json_object<span class="token punctuation">(</span><span class="token string">'{"store"：
&gt;   {"fruit"：\[{"weight"：8,"type"："apple"},{"weight"：9,"type"："pear"}],
&gt;    "bicycle"：{"price"：19.95,"color"："red"}
&gt;   },
&gt;  "email"："amy@only_for_json_udf_test.net",
&gt;  "owner"："amy"
&gt; }
&gt; '</span><span class="token punctuation">,</span><span class="token string">'$.owner'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
amy
</code></pre> 
<h3><a id="616_space_1487"></a>6.16 空格字符串函数：space</h3> 
<p>语法： space(int n)</p> 
<p>返回值： string</p> 
<p>说明：返回长度为n的字符串</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> space<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> length<span class="token punctuation">(</span>space<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">10</span>
</code></pre> 
<h3><a id="617_repeat_1501"></a>6.17 重复字符串函数：repeat</h3> 
<p>语法： repeat(string str, int n)</p> 
<p>返回值： string</p> 
<p>说明：返回重复n次后的str字符串</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">repeat</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
abcabcabcabcabc
</code></pre> 
<h3><a id="618_asciiascii_1514"></a>6.18 首字符ascii函数：ascii</h3> 
<p>语法： ascii(string str)</p> 
<p>返回值： int</p> 
<p>说明：返回字符串str第一个字符的ascii码</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> ascii<span class="token punctuation">(</span><span class="token string">'abcde'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">97</span>
</code></pre> 
<h3><a id="619_lpad_1527"></a>6.19 左补足函数：lpad</h3> 
<p>语法： lpad(string str, int len, string pad)</p> 
<p>返回值： string</p> 
<p>说明：将str进行用pad进行左补足到len位</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> lpad<span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">'td'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
tdtdtdtabc
注意：与GP，ORACLE不同，pad 不能默认
</code></pre> 
<h3><a id="620_rpad_1541"></a>6.20 右补足函数：rpad</h3> 
<p>语法： rpad(string str, int len, string pad)</p> 
<p>返回值： string</p> 
<p>说明：将str进行用pad进行右补足到len位</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> rpad<span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">'td'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
abctdtdtdt
</code></pre> 
<h3><a id="621__split_1554"></a>6.21 分割字符串函数： split</h3> 
<p>语法： split(string str, string pat)</p> 
<p>返回值： array</p> 
<p>说明： 按照pat字符串分割str，会返回分割后的字符串数组</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> split<span class="token punctuation">(</span><span class="token string">'abtcdtef'</span><span class="token punctuation">,</span><span class="token string">'t'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token string">"ab"</span><span class="token punctuation">,</span><span class="token string">"cd"</span><span class="token punctuation">,</span><span class="token string">"ef"</span><span class="token punctuation">]</span>
</code></pre> 
<h3><a id="622__find_in_set_1567"></a>6.22 集合查找函数： find_in_set</h3> 
<p>语法： find_in_set(string str, string strList)</p> 
<p>返回值： int</p> 
<p>说明： 返回str在strlist第一次出现的位置，strlist是用逗号分割的字符串。如果没有找该str字符，则返回0</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> find_in_set<span class="token punctuation">(</span><span class="token string">'ab'</span><span class="token punctuation">,</span><span class="token string">'ef,ab,de'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">2</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> find_in_set<span class="token punctuation">(</span><span class="token string">'at'</span><span class="token punctuation">,</span><span class="token string">'ef,ab,de'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">0</span>
</code></pre> 
<h3><a id="623_64base64_1580"></a>6.23 转换成64位的字符串：base64</h3> 
<p>语法： base64(binary bin)</p> 
<p>返回值： string</p> 
<p>说明：将二进制bin转换成64位的字符串</p> 
<h3><a id="624_context_ngrams_1588"></a>6.24 字符串连接函数：context_ngrams</h3> 
<p>语法：context_ngrams(array, array, int K, int pf)</p> 
<p>返回值： array&lt;struct&lt;string,double&gt;&gt;</p> 
<p>说明：与ngram类似，但context_ngram()允许你预算指定上下文(数组)来去查找子序列，具体看StatisticsAndDataMining(这里的解释更易懂)</p> 
<h3><a id="625_Xformat_number_1596"></a>6.25 将数值X转换成"#,###,###.##"格式字符串：format_number</h3> 
<p>语法： format_number(number x, int d)</p> 
<p>返回值： string</p> 
<p>说明：将数值X转换成"#,###,###.##"格式字符串，并保留d位小数，如果d为0，将进行四舍五入且不保留小数</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> format_number<span class="token punctuation">(</span><span class="token number">123345.65545</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">123</span><span class="token punctuation">,</span><span class="token number">345.66</span>
</code></pre> 
<h3><a id="626_bindecode_1607"></a>6.26 指定的字符集将二进制值bin解码成字符串：decode</h3> 
<p>语法： decode(binary bin, string charset)</p> 
<p>返回值： string</p> 
<p>说明：使用指定的字符集charset将二进制值bin解码成字符串，支持的字符集有：‘US-ASCII’, ‘ISO-8859-1’, ‘UTF-8’, ‘UTF-16BE’, ‘UTF-16LE’, ‘UTF-16’，如果任意输入参数为NULL都将返回NULL</p> 
<h3><a id="627_charsetencode_1615"></a>6.27 指定的字符集charset将字符串编码成二进制值：encode</h3> 
<p>语法： encode(string src, string charset)</p> 
<p>返回值： binary</p> 
<p>说明：使用指定的字符集charset将字符串编码成二进制值，支持的字符集有：‘US-ASCII’, ‘ISO-8859-1’, ‘UTF-8’, ‘UTF-16BE’, ‘UTF-16LE’, ‘UTF-16’，如果任一输入参数为NULL都将返回NULL</p> 
<h3><a id="628_str_in_file_1623"></a>6.28 文件数据与字符串str匹配： in_file</h3> 
<p>语法： in_file(string str, string filename)</p> 
<p>返回值： boolean</p> 
<p>说明：如果文件名为filename的文件中有一行数据与字符串str匹配成功就返回true</p> 
<h3><a id="629_strsubstrinstr_1631"></a>6.29 查找字符串str中子字符串substr出现的位置：instr</h3> 
<p>语法： instr(string str, string substr)</p> 
<p>返回值： int</p> 
<p>说明：查找字符串str中子字符串substr出现的位置，如果查找失败将返回0，如果任一参数为Null将返回null，注意位置为从1开始的</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> instr<span class="token punctuation">(</span>‘dvfgefggdgaa’<span class="token punctuation">,</span>‘aa’<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">11</span>
</code></pre> 
<h3><a id="630_locate_1642"></a>6.30 第一次出现的位置：locate</h3> 
<p>语法： locate(string substr, string str[, int pos])</p> 
<p>返回值： int</p> 
<p>说明：查找字符串str中的pos位置后字符串substr第一次出现的位置</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> locate<span class="token punctuation">(</span>‘aa’<span class="token punctuation">,</span>‘aabbedfaad’<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">8</span>
</code></pre> 
<h3><a id="631_TOP_Kngrams_1653"></a>6.31 返回出现次数TOP K的的子序列：ngrams</h3> 
<p>语法： ngrams(array, int N, int K, int pf)</p> 
<p>返回值： array&lt;struct&lt;string,double&gt;&gt;</p> 
<p>说明：返回出现次数TOP K的的子序列,n表示子序列的长度，具体看StatisticsAndDataMining (这里的解释更易懂)</p> 
<h3><a id="632_printfprintf_1661"></a>6.32 printf风格格式输出字符串：printf</h3> 
<p>语法：printf(String format, Obj… args)</p> 
<p>返回值： string</p> 
<p>说明：按照printf风格格式输出字符串</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> printf<span class="token punctuation">(</span>‘abfhg’<span class="token punctuation">)</span><span class="token punctuation">;</span>
Abfhg
</code></pre> 
<h3><a id="633_strsentences_1672"></a>6.33 字符串str将被转换成单词数组：sentences</h3> 
<p>语法： sentences(string str, string lang, string locale)</p> 
<p>返回值： array</p> 
<p>说明：字符串str将被转换成单词数组，如：sentences(‘Hello there! How are you?’) =( (“Hello”, “there”), (“How”, “are”, “you”) )</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> sentences<span class="token punctuation">(</span>‘Hello there<span class="token operator">!</span> How are you?’<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>“Hello”<span class="token punctuation">,</span>“there”<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>“How”<span class="token punctuation">,</span>“are”<span class="token punctuation">,</span>“you”<span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre> 
<h3><a id="634_reverse_1683"></a>6.34 字符串反转函数：reverse</h3> 
<p>语法：reverse(string A)</p> 
<p>返回值： string</p> 
<p>说明：返回字符串A的反转结果</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> reverse<span class="token punctuation">(</span>‘abc’<span class="token punctuation">)</span><span class="token punctuation">;</span>
cba
</code></pre> 
<h3><a id="635_strMap_split_1694"></a>6.35 字符串str按照指定分隔符转换成Map： split</h3> 
<p>语法：str_to_map(text[, delimiter1, delimiter2])</p> 
<p>返回值： map&lt;string,string&gt;</p> 
<p>说明：将字符串str按照指定分隔符转换成Map，第一个参数是需要转换字符串，第二个参数是键值对之间的分隔符，默认为逗号;第三个参数是键值之间的分隔符，默认为"="</p> 
<h3><a id="636_countsubstring_index_1702"></a>6.36 截取第count分隔符之前的字符串：substring_index</h3> 
<p>语法： substring_index(string A, string delim, int count)</p> 
<p>返回值： string</p> 
<p>说明：截取第count分隔符之前的字符串，如count为正则从左边开始截取，如果为负则从右边开始截取</p> 
<h3><a id="637_tosubstring_index_1710"></a>6.37 字符串替换成to中的字符串：substring_index</h3> 
<p>语法： translate(string|char|varchar input, string|char|varchar from, string|char|varchar to)</p> 
<p>返回值： string</p> 
<p>说明：将input出现在from中的字符串替换成to中的字符串 如：translate(“MOBIN”,“BIN”,“M”)=“MOM”</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> translate<span class="token punctuation">(</span>“MOBIN”<span class="token punctuation">,</span>“BIN”<span class="token punctuation">,</span>“M”<span class="token punctuation">)</span><span class="token punctuation">;</span>
MOM
</code></pre> 
<h3><a id="638_initcap_1721"></a>6.38 首字母大写函数：initcap</h3> 
<p>语法：initcap(string A)</p> 
<p>返回值： string</p> 
<p>说明：将字符串A转换第一个字母大写其余字母的字符串</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> initcap<span class="token punctuation">(</span>‘abcd def’<span class="token punctuation">)</span><span class="token punctuation">;</span>
Abcd Def
</code></pre> 
<h3><a id="639__levenshtein_1732"></a>6.39 两个字符串之间的差异大小： levenshtein</h3> 
<p>语法： levenshtein(string A, string B)</p> 
<p>返回值： int</p> 
<p>说明：计算两个字符串之间的差异大小 如：levenshtein(‘kitten’, ‘sitting’) = 3</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> levenshtein<span class="token punctuation">(</span>‘kitten’<span class="token punctuation">,</span> ‘sitting’<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">3</span>
</code></pre> 
<h3><a id="640_soundexsoundex_1743"></a>6.40 字符串转换成soundex字符串：soundex</h3> 
<p>语法： soundex(string A)</p> 
<p>返回值： string</p> 
<p>说明： 将普通字符串转换成soundex字符串</p> 
<h2><a id="7__1751"></a>第7章 聚合函数</h2> 
<h3><a id="71__count_1753"></a>7.1 个数统计函数： count</h3> 
<p>语法： count(*), count(expr), count(DISTINCT expr[, expr…])</p> 
<p>返回值： bigint</p> 
<p>说明： count(*)统计检索出的行的个数，包括NULL值的行；count(expr)返回指定字段的非空值的个数；count(DISTINCTexpr[, expr_.])统计提供非NULL且去重后的expr表达式值的行数</p> 
<h3><a id="72__sum_1761"></a>7.2 总和统计函数： sum</h3> 
<p>语法：sum(col), sum(DISTINCT col)</p> 
<p>返回值： double</p> 
<p>说明：sum(col)统计结果集中col的相加的结果；sum(DISTINCT col)统计结果中col不同值相加的结果</p> 
<h3><a id="73__avg_1769"></a>7.3 平均值统计函数： avg</h3> 
<p>语法：avg(col), avg(DISTINCT col)</p> 
<p>返回值： double</p> 
<p>说明：avg(col)统计结果集中col的平均值；avg(DISTINCT col)统计结果中col不同值相加的平均值</p> 
<h3><a id="74__min_1777"></a>7.4 最小值统计函数： min*</h3> 
<p>语法：min(col)</p> 
<p>返回值： double</p> 
<p>说明：统计结果集中col字段的最小值</p> 
<h3><a id="75__max_1785"></a>7.5 最大值统计函数： max</h3> 
<p>语法：max(col)</p> 
<p>返回值： double</p> 
<p>说明：统计结果集中col字段的最大值</p> 
<h3><a id="76_var_pop_1793"></a>7.6 非空集合总体变量函数：var_pop</h3> 
<p>语法： variance(col), var_pop(col)</p> 
<p>返回值： double</p> 
<p>说明：统计结果集中col非空集合的总体变量（忽略null），（求指定列数值的方差）</p> 
<h3><a id="77_var_samp_1801"></a>7.7 非空集合样本变量函数：var_samp</h3> 
<p>语法： var_samp (col)</p> 
<p>返回值： double</p> 
<p>说明：统计结果集中col非空集合的样本变量（忽略null）（求指定列数值的样本方差）</p> 
<h3><a id="78_stddev_pop_1809"></a>7.8 总体标准偏离函数：stddev_pop</h3> 
<p>语法：stddev_pop(col)</p> 
<p>返回值： double</p> 
<p>说明：该函数计算总体标准偏离，并返回总体变量的平方根，其返回值与VAR_POP函数的平方根相同（求指定列数值的标准偏差）</p> 
<h3><a id="79_stddev_samp_1817"></a>7.9 样本标准偏离函数：stddev_samp</h3> 
<p>语法： stddev_samp (col)</p> 
<p>返回值： double</p> 
<p>说明：该函数计算样本标准偏离，（求指定列数值的样本标准偏差）</p> 
<h3><a id="710_covar_pop_1825"></a>7.10 协方差函数：covar_pop</h3> 
<p>语法： covar_pop(col1, col2)</p> 
<p>返回值： double</p> 
<p>说明：求指定列数值的协方差</p> 
<h3><a id="711_covar_samp_1833"></a>7.11 样本协方差函数：covar_samp</h3> 
<p>语法： covar_samp(col1, col2)</p> 
<p>返回值： double</p> 
<p>说明：求指定列数值的样本协方差</p> 
<h3><a id="712_corr_1841"></a>7.12 相关系数函数：corr</h3> 
<p>语法：corr(col1, col2)</p> 
<p>返回值： double</p> 
<p>说明：返回两列数值的相关系数</p> 
<h3><a id="713_percentile_1849"></a>7.13 中位数函数：percentile</h3> 
<p>语法： percentile(BIGINT col, p)</p> 
<p>返回值： double</p> 
<p>说明：求准确的第pth个百分位数，p必须介于0和1之间，但是col字段目前只支持整数，不支持浮点数类型</p> 
<h3><a id="714_percentile_1857"></a>7.14 中位数函数：percentile</h3> 
<p>语法： percentile(BIGINT col, array(p1 [, p2]…))</p> 
<p>返回值： array</p> 
<p>说明：功能和上述类似，之后后面可以输入多个百分位数，返回类型也为array，其中为对应的百分位数</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> percentile<span class="token punctuation">(</span>score<span class="token punctuation">,</span><span class="token operator">&lt;</span><span class="token number">0.2</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> lxw_dual；取<span class="token number">0.2</span>，<span class="token number">0.4</span>位置的数据
<span class="token number">1</span>
</code></pre> 
<h3><a id="715_percentile_approx_1868"></a>7.15 近似中位数函数：percentile_approx</h3> 
<p>语法：percentile_approx(DOUBLE col, p [, B])</p> 
<p>返回值： double</p> 
<p>说明：求近似的第pth个百分位数，p必须介于0和1之间，返回类型为double，但是col字段支持浮点类型。参数B控制内存消耗的近似精度，B越大，结果的准确度越高。默认为10,000。当col字段中的distinct值的个数小于B时，结果为准确的百分位数</p> 
<h3><a id="716_percentile_approx_1876"></a>7.16 近似中位数函数：percentile_approx</h3> 
<p>语法： percentile_approx(DOUBLE col, array(p1 [, p2]…) [, B])</p> 
<p>返回值： array</p> 
<p>说明：功能和上述类似，之后后面可以输入多个百分位数，返回类型也为array，其中为对应的百分位数</p> 
<h3><a id="717_histogram_numeric_1884"></a>7.17 直方图：histogram_numeric</h3> 
<p>语法： histogram_numeric(col, b)</p> 
<p>返回值： array&lt;struct {‘x’,‘y’}&gt;</p> 
<p>说明：以b为基准计算col的直方图信息</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> histogram_numeric<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span>{“x”：<span class="token number">100.0</span><span class="token punctuation">,</span>“y”：<span class="token number">1.0</span>}<span class="token punctuation">]</span>
</code></pre> 
<h3><a id="718_collect_listcollect_set_1895"></a>7.18 高级聚合：collect_list/collect_set</h3> 
<p>1）collect_list 收集并形成list集合，结果不去重</p> 
<p>语法：collect_list(col)</p> 
<p>返回值：array</p> 
<p>说明：将某分组内该字段的所有值收集成为一个数组，结果不去重</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span>
<span class="token keyword">select</span>
sex<span class="token punctuation">,</span>
collect_list<span class="token punctuation">(</span>job<span class="token punctuation">)</span>
<span class="token keyword">from</span>
employee
<span class="token keyword">group</span> <span class="token keyword">by</span>
sex
结果：
女 <span class="token punctuation">[</span><span class="token string">"行政"</span><span class="token punctuation">,</span><span class="token string">"研发"</span><span class="token punctuation">,</span><span class="token string">"行政"</span><span class="token punctuation">,</span><span class="token string">"前台"</span><span class="token punctuation">]</span>
男 <span class="token punctuation">[</span><span class="token string">"销售"</span><span class="token punctuation">,</span><span class="token string">"研发"</span><span class="token punctuation">,</span><span class="token string">"销售"</span><span class="token punctuation">,</span><span class="token string">"前台"</span><span class="token punctuation">]</span>
</code></pre> 
<p>2）collect_set 收集并形成set集合，结果去重</p> 
<p>语法：collect_set(col)</p> 
<p>返回值：array</p> 
<p>说明：将某分组内该字段的所有值收集成为一个数组，结果去重</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span>
<span class="token keyword">select</span>
sex<span class="token punctuation">,</span>
collect_set<span class="token punctuation">(</span>job<span class="token punctuation">)</span>
<span class="token keyword">from</span>
employee
<span class="token keyword">group</span> <span class="token keyword">by</span>
sex
结果：
女 <span class="token punctuation">[</span><span class="token string">"行政"</span><span class="token punctuation">,</span><span class="token string">"研发"</span><span class="token punctuation">,</span><span class="token string">"前台"</span><span class="token punctuation">]</span>
男 <span class="token punctuation">[</span><span class="token string">"销售"</span><span class="token punctuation">,</span><span class="token string">"研发"</span><span class="token punctuation">,</span><span class="token string">"前台"</span><span class="token punctuation">]</span>
</code></pre> 
<h2><a id="8__1937"></a>第8章 表生成函数</h2> 
<h3><a id="81_explode_1939"></a>8.1 explode</h3> 
<p>语法： explode(array a)</p> 
<p>返回值： Array Type</p> 
<p>说明：对于a中的每个元素，将生成一行且包含该元素</p> 
<h3><a id="82_explode_1947"></a>8.2 explode</h3> 
<p>语法： explode(ARRAY)</p> 
<p>返回值：N rows</p> 
<p>说明：每行对应数组中的一个元素</p> 
<h3><a id="83_explode_1955"></a>8.3 explode</h3> 
<p>语法： explode(MAP)</p> 
<p>返回值：N rows</p> 
<p>说明：每行对应每个map键-值，其中一个字段是map的键，另一个字段是map的值</p> 
<h3><a id="84_posexplode_1963"></a>8.4 posexplode</h3> 
<p>语法： posexplode(ARRAY)</p> 
<p>返回值：N rows</p> 
<p>说明：与explode类似，不同的是还返回各元素在数组中的位置</p> 
<h3><a id="85_posexplode_1971"></a>8.5 posexplode</h3> 
<p>语法： stack(INT n, v_1, v_2, …, v_k)</p> 
<p>返回值：N rows</p> 
<p>说明：把M列转换成N行，每行有M/N个字段，其中n必须是个常数</p> 
<h3><a id="86_posexplode_1979"></a>8.6 posexplode</h3> 
<p>语法： json_tuple(jsonStr, k1, k2, …)</p> 
<p>返回值： tuple</p> 
<p>说明：从一个JSON字符串中获取多个键并作为一个元组返回，与get_json_object不同的是此函数能一次获取多个键值</p> 
<h3><a id="87_parse_url_tuple_1987"></a>8.7 parse_url_tuple</h3> 
<p>语法： parse_url_tuple(url, p1, p2, …)</p> 
<p>返回值： tuple</p> 
<p>说明：返回从URL中抽取指定N部分的内容，参数url是URL字符串，而参数p1,p2,…是要抽取的部分，这个参数包含HOST, PATH, QUERY, REF, PROTOCOL, AUTHORITY, FILE, USERINFO, QUERY：</p> 
<h3><a id="88_parse_url_tuple_1995"></a>8.8 parse_url_tuple</h3> 
<p>语法： inline(ARRAY&lt;STRUCT[,STRUCT]&gt;)</p> 
<p>返回值： tuple</p> 
<p>说明：将结构体数组提取出来并插入到表中</p> 
<h3><a id="89__2003"></a>8.9 示例</h3> 
<p><strong>一进多出（一行进入，多行输出）。</strong></p> 
<ol><li>explode 将数组或者map展开</li></ol> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> explode<span class="token punctuation">(</span>array<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'d'</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
结果：
a
b
d
c
</code></pre> 
<ol start="2"><li>json_tuple 取出json字符串中属性的值</li></ol> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span>
<span class="token keyword">select</span> json_tuple<span class="token punctuation">(</span><span class="token string">'{"name":"王二狗","sex":"男","age":"25"}'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token string">'sex'</span><span class="token punctuation">,</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
结果：
王二狗 男 <span class="token number">25</span>
</code></pre> 
<h2><a id="9__2023"></a>第9章 复合类型构建操作</h2> 
<h3><a id="91_Map_map_2025"></a>9.1 Map类型构建： map</h3> 
<p>语法： map (key1, value1, key2, value2, …)</p> 
<p>说明：根据输入的key和value对构建map类型</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">Create</span> <span class="token keyword">table</span> iteblog <span class="token keyword">as</span> <span class="token keyword">select</span> map<span class="token punctuation">(</span><span class="token string">'100'</span><span class="token punctuation">,</span><span class="token string">'tom'</span><span class="token punctuation">,</span><span class="token string">'200'</span><span class="token punctuation">,</span><span class="token string">'mary'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> t <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">describe</span> iteblog<span class="token punctuation">;</span>
t       map<span class="token operator">&lt;</span>string <span class="token punctuation">,</span>string<span class="token operator">&gt;</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> t <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
{<!-- --><span class="token string">"100"</span>：<span class="token string">"tom"</span><span class="token punctuation">,</span><span class="token string">"200"</span>：<span class="token string">"mary"</span>}
</code></pre> 
<h3><a id="92_Struct_struct_2039"></a>9.2 Struct类型构建： struct</h3> 
<p>语法： struct(val1, val2, val3, …)</p> 
<p>说明：根据输入的参数构建结构体struct类型</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> iteblog <span class="token keyword">as</span> <span class="token keyword">select</span> struct<span class="token punctuation">(</span><span class="token string">'tom'</span><span class="token punctuation">,</span><span class="token string">'mary'</span><span class="token punctuation">,</span><span class="token string">'tim'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> t <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">describe</span> iteblog<span class="token punctuation">;</span>
t       struct<span class="token operator">&lt;</span>col1：string <span class="token punctuation">,</span>col2：string<span class="token punctuation">,</span>col3：string<span class="token operator">&gt;</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> t <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
{<!-- --><span class="token string">"col1"</span>：<span class="token string">"tom"</span><span class="token punctuation">,</span><span class="token string">"col2"</span>：<span class="token string">"mary"</span><span class="token punctuation">,</span><span class="token string">"col3"</span>：<span class="token string">"tim"</span>}
</code></pre> 
<h3><a id="93_array_array_2053"></a>9.3 array类型构建： array</h3> 
<p>语法： array(val1, val2, …)</p> 
<p>说明：根据输入的参数构建数组array类型</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> iteblog <span class="token keyword">as</span> <span class="token keyword">select</span> array<span class="token punctuation">(</span><span class="token string">"tom"</span><span class="token punctuation">,</span><span class="token string">"mary"</span><span class="token punctuation">,</span><span class="token string">"tim"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> t <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">describe</span> iteblog<span class="token punctuation">;</span>
t       array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> t <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token string">"tom"</span><span class="token punctuation">,</span><span class="token string">"mary"</span><span class="token punctuation">,</span><span class="token string">"tim"</span><span class="token punctuation">]</span>
</code></pre> 
<h2><a id="10__2068"></a>第10章 复杂类型访问操作</h2> 
<h3><a id="101_array_An_2070"></a>10.1 array类型访问： A[n]</h3> 
<p>语法： A[n]</p> 
<p>操作类型： A为array类型，n为int类型</p> 
<p>说明：返回数组A中的第n个变量值。数组的起始下标为0。比如，A是个值为[‘foo’, ‘bar’]的数组类型，那么A[0]将返回’foo’,而A[1]将返回’bar’</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> iteblog <span class="token keyword">as</span> <span class="token keyword">select</span> array<span class="token punctuation">(</span><span class="token string">"tom"</span><span class="token punctuation">,</span><span class="token string">"mary"</span><span class="token punctuation">,</span><span class="token string">"tim"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> t <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>t<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
tom     mary    tim
</code></pre> 
<h3><a id="102_map_Mkey_2084"></a>10.2 map类型访问： M[key]</h3> 
<p>语法： M[key]</p> 
<p>操作类型： M为map类型，key为map中的key值</p> 
<p>说明：返回map类型M中，key值为指定值的value值。比如，M是值为{‘f’ -&gt; ‘foo’, ‘b’ -&gt; ‘bar’, ‘all’ -&gt; ‘foobar’}的map类型，那么M[‘all’]将会返回’foobar’</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> t<span class="token punctuation">[</span><span class="token string">'200'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>t<span class="token punctuation">[</span><span class="token string">'100'</span><span class="token punctuation">]</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
mary    tom
</code></pre> 
<h3><a id="103_struct_Sx_2097"></a>10.3 struct类型访问： S.x</h3> 
<p>语法： S.x</p> 
<p>操作类型： S为struct类型</p> 
<p>说明：返回结构体S中的x字段。比如，对于结构体struct foobar {int foo, int bar}，foobar.foo返回结构体中的foo字段</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> iteblog <span class="token keyword">as</span> <span class="token keyword">select</span> struct<span class="token punctuation">(</span><span class="token string">'tom'</span><span class="token punctuation">,</span><span class="token string">'mary'</span><span class="token punctuation">,</span><span class="token string">'tim'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> t <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">describe</span> iteblog<span class="token punctuation">;</span>
t       struct<span class="token operator">&lt;</span>col1：string <span class="token punctuation">,</span>col2：string<span class="token punctuation">,</span>col3：string<span class="token operator">&gt;</span>
hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> t<span class="token punctuation">.</span>col1<span class="token punctuation">,</span>t<span class="token punctuation">.</span>col3 <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
tom     tim
</code></pre> 
<h2><a id="11__2113"></a>第11章 复杂类型长度统计函数</h2> 
<h3><a id="111_Map_sizeMapk_V_2115"></a>11.1 Map类型长度函数： size(Map&lt;k .V&gt;)</h3> 
<p>语法： size(Map&lt;k .V&gt;)</p> 
<p>返回值： int</p> 
<p>说明： 返回map类型的长度</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> size<span class="token punctuation">(</span>map<span class="token punctuation">(</span><span class="token string">'100'</span><span class="token punctuation">,</span><span class="token string">'tom'</span><span class="token punctuation">,</span><span class="token string">'101'</span><span class="token punctuation">,</span><span class="token string">'mary'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">2</span>
</code></pre> 
<h3><a id="112_array_sizeArrayT_2128"></a>11.2 array类型长度函数： size(Array)</h3> 
<p>语法： size(Array)</p> 
<p>返回值： int</p> 
<p>说明： 返回array类型的长度</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> size<span class="token punctuation">(</span>array<span class="token punctuation">(</span><span class="token string">'100'</span><span class="token punctuation">,</span><span class="token string">'101'</span><span class="token punctuation">,</span><span class="token string">'102'</span><span class="token punctuation">,</span><span class="token string">'103'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">4</span>
</code></pre> 
<h3><a id="113__2141"></a>11.3 类型转换函数</h3> 
<p><strong>1）转换成二进制： binary</strong></p> 
<p>语法： binary(string|binary)</p> 
<p>返回值： binary</p> 
<p>说明： 将输入的值转换成二进制</p> 
<p><strong>2）类型转换函数： cast</strong></p> 
<p>语法： cast(expr as )</p> 
<p>返回值： Expected “=” to follow “type”</p> 
<p>说明： 返回转换后的数据类型</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> cast<span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">as</span> <span class="token keyword">bigint</span><span class="token punctuation">)</span> <span class="token keyword">from</span> iteblog<span class="token punctuation">;</span>
<span class="token number">1</span>
</code></pre> 
<h2><a id="12__2164"></a>第12章 窗口函数</h2> 
<p>基本语法：函数 + over( [partition by …] [order by …] [窗口子句] )</p> 
<ul><li>over表示开窗，默认窗口大小会包含所有数据。</li><li>partition by表示根据字段再划分一个细窗口，相同字段进入同一个细窗口里面，每个窗口之间相互独立，窗口子句对于每个细窗口独立生效。</li><li>order by表示窗口内按什么排序，如果只有over表示直接最大窗口排序；如果有partition by每个细窗口单独排序。</li><li>窗口子句，可以进一步限定范围</li></ul> 
<p>(rows | range) between (unbounded | [num]) preceding and ([num] preceding | current row | (unbounded | [num]) following</p> 
<p>(rows | range) between current row and (current row | (unbounded | [num]) following)</p> 
<p>(rows | range) between [num] following and (unbounded | [num]) following</p> 
<p>rows between unbounded preceding and unbounded following</p> 
<p>行的范围为上无边界到下无边界（第一行到最后一行）。<br> 注：窗口函数是一行一行执行的。</p> 
<ol><li>窗口函数<br> lag(col,n,default_val)：往前第n行数据。<br> lead(col,n, default_val)：往后第n行数据。<br> first_value (col,true/false)：当前窗口下的第一个值，第二个参数为true，跳过空值。<br> last_value (col,true/false)：当前窗口下的最后一个值，第二个参数为true，跳过空值。</li><li>聚合函数<br> max：最大值。<br> min：最小值。<br> sum：求和。<br> avg：平均值。<br> count：计数。</li><li>排名分析函数<br> rank：排名相同时会重复总数不会减少。<br> dense_rank：排名相同时会重复总数会减少。<br> row_number：行号。<br> ntile：分组并给上组号。</li></ol> 
<h3><a id="121_lag_2201"></a>12.1 偏移量函数：lag</h3> 
<p>语法：lag(col,n,default_val)</p> 
<p>返回值：字段类型</p> 
<p>说明：往前第n行数据。</p> 
<h3><a id="122_lead_2209"></a>12.2 偏移量函数：lead</h3> 
<p>语法：lead(col,n, default_val)</p> 
<p>返回值：字段类型</p> 
<p>说明：往后第n行数据。</p> 
<h3><a id="123_first_value_2217"></a>12.3 窗口分析函数：first_value</h3> 
<p>语法：first_value (col,true/false)</p> 
<p>返回值：字段类型</p> 
<p>说明：当前窗口下的第一个值，第二个参数为true，跳过空值。</p> 
<h3><a id="124_last_value_2225"></a>12.4 窗口分析函数：last_value</h3> 
<p>语法：last_value (col,true/false)</p> 
<p>返回值：字段类型</p> 
<p>说明：当前窗口下的最后一个值，第二个参数为true，跳过空值。</p> 
<h3><a id="125_rank_2233"></a>12.5 跳跃排序函数：rank</h3> 
<p>语法：rank() over(……)</p> 
<p>返回值：int</p> 
<p>说明：排名相同时会重复，总数不会减少（12225……）。</p> 
<h3><a id="126_dense_rank_2241"></a>12.6 不跳跃排序函数：dense_rank</h3> 
<p>语法：dense_rank() over(……)</p> 
<p>返回值：int</p> 
<p>说明：排名相同时会重复，总数会减少（12223……）。</p> 
<h3><a id="127_row_number_2249"></a>12.7 顺序唯一的排序函数：row_number</h3> 
<p>语法：row_number() over(……)</p> 
<p>返回值：int</p> 
<p>说明：行号（1234567……）。</p> 
<h3><a id="128_lead_2257"></a>12.8 分组函数：lead</h3> 
<p>语法：ntile() over(……)</p> 
<p>返回值：int</p> 
<p>说明：分组并给上组号。</p> 
<h3><a id="129__2264"></a>12.9 窗口函数案例演示</h3> 
<h4><a id="1291__2265"></a>12.9.1 数据导入</h4> 
<ol><li>在/opt/module/hive/datas/路径上，创建文件business.txt，并导入数据</li></ol> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>hadoop@hadoop102 datas<span class="token punctuation">]</span>$ <span class="token function">vi</span> business.txt
小元,2022-01-01,10
小海,2022-01-02,15
小元,2022-02-03,23
小海,2022-01-04,29
小元,2022-01-05,46
小元,2022-04-06,42
小海,2022-01-07,50
小元,2022-01-08,50
小辉,2022-04-08,62
小辉,2022-04-09,62
小猛,2022-05-10,12
小辉,2022-04-11,75
小猛,2022-06-12,80
小辉,2022-04-13,94
</code></pre> 
<ol start="2"><li>创建Hive表并导入数据</li></ol> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> business<span class="token punctuation">(</span>
    name string<span class="token punctuation">,</span>        <span class="token comment">-- 顾客</span>
    orderdate string<span class="token punctuation">,</span>  <span class="token comment">-- 下单日期</span>
    cost <span class="token keyword">int</span>             <span class="token comment">-- 购买金额</span>
<span class="token punctuation">)</span> 
<span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">','</span><span class="token punctuation">;</span>
<span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> inpath <span class="token string">"/opt/module/hive/datas/business.txt"</span> 
<span class="token keyword">into</span> <span class="token keyword">table</span> business<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="1291__2296"></a>12.9.1 案例演示</h4> 
<ol><li>购买过的总人次并保留所有信息</li></ol> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span>
<span class="token keyword">select</span> 
name<span class="token punctuation">,</span>
orderdate<span class="token punctuation">,</span>
cost<span class="token punctuation">,</span>
<span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">rows</span> <span class="token operator">between</span> <span class="token keyword">unbounded</span> <span class="token keyword">preceding</span> <span class="token operator">and</span>  <span class="token keyword">unbounded</span> <span class="token keyword">following</span><span class="token punctuation">)</span> cn
<span class="token keyword">from</span> 
business<span class="token punctuation">;</span>
结果：
name   orderdate     cost cn
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>	<span class="token number">94</span>	 <span class="token number">14</span>
小猛	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">12</span>	<span class="token number">80</span>	 <span class="token number">14</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">11</span>	<span class="token number">75</span>	 <span class="token number">14</span>
小猛	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">10</span>	<span class="token number">12</span>	 <span class="token number">14</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">09</span>	<span class="token number">62</span>	 <span class="token number">14</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">08</span>	<span class="token number">62</span>	 <span class="token number">14</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span>	<span class="token number">50</span>	 <span class="token number">14</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span>	<span class="token number">50</span>	 <span class="token number">14</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">06</span>	<span class="token number">42</span>	 <span class="token number">14</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>	<span class="token number">46</span>	 <span class="token number">14</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>	<span class="token number">29</span>	 <span class="token number">14</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">03</span>	<span class="token number">23</span>	 <span class="token number">14</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>	<span class="token number">15</span>	 <span class="token number">14</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>	<span class="token number">10</span>	 <span class="token number">14</span>
</code></pre> 
<ol start="2"><li>购买过的累加人次并保留所有信息</li></ol> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span>
<span class="token keyword">select</span> 
name<span class="token punctuation">,</span>
orderdate<span class="token punctuation">,</span>
cost<span class="token punctuation">,</span>
<span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">rows</span> <span class="token operator">between</span> <span class="token keyword">unbounded</span> <span class="token keyword">preceding</span> <span class="token operator">and</span>  <span class="token keyword">current</span> <span class="token keyword">row</span><span class="token punctuation">)</span>cn
<span class="token keyword">from</span> 
business<span class="token punctuation">;</span>
结果：
name   orderdate     cost cn
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>	<span class="token number">94</span>	 <span class="token number">1</span>
小猛	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">12</span>	<span class="token number">80</span>	 <span class="token number">2</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">11</span>	<span class="token number">75</span>	 <span class="token number">3</span>
小猛	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">10</span>	<span class="token number">12</span>	 <span class="token number">4</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">09</span>	<span class="token number">62</span>	 <span class="token number">5</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">08</span>	<span class="token number">62</span>	 <span class="token number">6</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span>	<span class="token number">50</span>	 <span class="token number">7</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span>	<span class="token number">50</span>	 <span class="token number">8</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">06</span>	<span class="token number">42</span>	 <span class="token number">9</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>	<span class="token number">46</span>	 <span class="token number">10</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>	<span class="token number">29</span>	 <span class="token number">11</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">03</span>	<span class="token number">23</span>	 <span class="token number">12</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>	<span class="token number">15</span>	 <span class="token number">13</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>	<span class="token number">10</span>	 <span class="token number">14</span>
</code></pre> 
<ol start="3"><li>购买过的总人数</li></ol> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span>
<span class="token keyword">select</span>
  name<span class="token punctuation">,</span>
  <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">rows</span> <span class="token operator">between</span> <span class="token keyword">unbounded</span> <span class="token keyword">preceding</span> <span class="token operator">and</span> <span class="token keyword">unbounded</span> <span class="token keyword">following</span><span class="token punctuation">)</span>cn
<span class="token keyword">from</span>
  business
<span class="token keyword">group</span> <span class="token keyword">by</span>
  name<span class="token punctuation">;</span>
结果：
name  cn
小辉	<span class="token number">4</span>
小猛	<span class="token number">4</span>
小海	<span class="token number">4</span>
小元	<span class="token number">4</span>
</code></pre> 
<p>注：窗口函数的执行次序是在group by之后。<br> 4) 购买过的累加人数</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span>
<span class="token keyword">select</span>
  name<span class="token punctuation">,</span>
  <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">rows</span> <span class="token operator">between</span> <span class="token keyword">unbounded</span> <span class="token keyword">preceding</span> <span class="token operator">and</span> <span class="token keyword">current</span> <span class="token keyword">row</span><span class="token punctuation">)</span>
<span class="token keyword">from</span>
  business
<span class="token keyword">group</span> <span class="token keyword">by</span>
  name<span class="token punctuation">;</span>
结果：
name  cn
小辉	<span class="token number">1</span>
小猛	<span class="token number">2</span>
小海	<span class="token number">3</span>
小元	<span class="token number">4</span>
</code></pre> 
<ol start="5"><li>2022年4月份购买过的顾客及总人数<br> （1）写法1</li></ol> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span>
<span class="token keyword">select</span> 
    name<span class="token punctuation">,</span>
    <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">over</span> <span class="token punctuation">(</span><span class="token keyword">rows</span> <span class="token operator">between</span> <span class="token keyword">unbounded</span> <span class="token keyword">preceding</span> <span class="token operator">and</span> <span class="token keyword">unbounded</span> <span class="token keyword">following</span><span class="token punctuation">)</span> cn
<span class="token keyword">from</span> 
business 
<span class="token keyword">where</span> 
substring<span class="token punctuation">(</span>orderdate<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">'2022-04'</span> 
<span class="token keyword">group</span> <span class="token keyword">by</span> 
name<span class="token punctuation">;</span>
结果：
name  cn
小辉	<span class="token number">2</span>
小元	<span class="token number">2</span>
</code></pre> 
<p>（2）写法2</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span>
<span class="token keyword">select</span> 
    name<span class="token punctuation">,</span>
    <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">over</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> cn
<span class="token keyword">from</span> 
business 
<span class="token keyword">where</span> 
substring<span class="token punctuation">(</span>orderdate<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">'2022-04'</span> 
<span class="token keyword">group</span> <span class="token keyword">by</span> 
name<span class="token punctuation">;</span>
结果：
name  cn
小辉	<span class="token number">2</span>
小元	<span class="token number">2</span>
</code></pre> 
<p><strong>能发现窗口子句加与不加结果是一致，原因是窗口子句有默认值。</strong><br> When ORDER BY is specified with missing WINDOW clause, the WINDOW specification defaults to RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW.<br> 当有order by 但是缺少窗口子句时，范围是上无边界到当前行。<br> When both ORDER BY and WINDOW clauses are missing, the WINDOW specification defaults to ROW BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING.<br> 当order by和窗口子句都缺少时，范围，上无边界到下无边界。<br> 思考题：如果不用窗口函数的情况下，怎么得到以下结果？</p> 
<pre><code class="prism language-sql"><span class="token keyword">date</span>      name_list        cn
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span>	<span class="token punctuation">[</span><span class="token string">"小元"</span><span class="token punctuation">,</span><span class="token string">"小海"</span><span class="token punctuation">]</span>	<span class="token number">2</span>
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">02</span>	<span class="token punctuation">[</span><span class="token string">"小元"</span><span class="token punctuation">]</span>	        <span class="token number">1</span>
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span>	<span class="token punctuation">[</span><span class="token string">"小元"</span><span class="token punctuation">,</span><span class="token string">"小辉"</span><span class="token punctuation">]</span>	<span class="token number">2</span>
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">05</span>	<span class="token punctuation">[</span><span class="token string">"小猛"</span><span class="token punctuation">]</span>	        <span class="token number">1</span>
<span class="token number">2022</span><span class="token operator">-</span><span class="token number">06</span>    <span class="token punctuation">[</span><span class="token string">"小猛"</span><span class="token punctuation">]</span>	        <span class="token number">1</span>
</code></pre> 
<ol start="6"><li>查询顾客的购买明细及月购买总额</li></ol> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span>
<span class="token keyword">select</span>
  name<span class="token punctuation">,</span>
  orderdate<span class="token punctuation">,</span>
  cost<span class="token punctuation">,</span>
  <span class="token function">sum</span><span class="token punctuation">(</span>cost<span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span> <span class="token keyword">month</span><span class="token punctuation">(</span>orderdate<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> 
business
结果：
name   orderdate    cost sum
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>	<span class="token number">10</span>	 <span class="token number">200</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span>	<span class="token number">50</span>	 <span class="token number">200</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span>	<span class="token number">50</span>	 <span class="token number">200</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>	<span class="token number">46</span>	 <span class="token number">200</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>	<span class="token number">29</span>	 <span class="token number">200</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>	<span class="token number">15</span>	 <span class="token number">200</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">03</span>	<span class="token number">23</span>	 <span class="token number">23</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>	<span class="token number">94</span>	 <span class="token number">335</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">06</span>	<span class="token number">42</span>	 <span class="token number">335</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">11</span>	<span class="token number">75</span>	 <span class="token number">335</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">09</span>	<span class="token number">62</span>	 <span class="token number">335</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">08</span>	<span class="token number">62</span>	 <span class="token number">335</span>
小猛	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">10</span>	<span class="token number">12</span>	 <span class="token number">12</span>
小猛	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">12</span>	<span class="token number">80</span>	 <span class="token number">80</span>
</code></pre> 
<ol start="7"><li>查询每个顾客的购买明细及购买总额</li></ol> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span>
<span class="token keyword">select</span>
  name<span class="token punctuation">,</span>
  orderdate<span class="token punctuation">,</span>
  cost<span class="token punctuation">,</span>
  <span class="token function">sum</span><span class="token punctuation">(</span>cost<span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span> name<span class="token punctuation">)</span>
<span class="token keyword">from</span> 
business
结果：
name   orderdate    cost sum
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span>	<span class="token number">50</span>	 <span class="token number">171</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">03</span>	<span class="token number">23</span>	 <span class="token number">171</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>	<span class="token number">46</span>	 <span class="token number">171</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">06</span>	<span class="token number">42</span>	 <span class="token number">171</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>	<span class="token number">10</span>	 <span class="token number">171</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span>	<span class="token number">50</span>	 <span class="token number">94</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>	<span class="token number">29</span>	 <span class="token number">94</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>	<span class="token number">15</span>	 <span class="token number">94</span>
小猛	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">10</span>	<span class="token number">12</span>	 <span class="token number">92</span>
小猛	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">12</span>	<span class="token number">80</span>	 <span class="token number">92</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">11</span>	<span class="token number">75</span>	 <span class="token number">293</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>	<span class="token number">94</span>	 <span class="token number">293</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">08</span>	<span class="token number">62</span>	 <span class="token number">293</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">09</span>	<span class="token number">62</span>	 <span class="token number">293</span>
</code></pre> 
<ol start="8"><li>查询每个顾客每个月的购买明细及购买总额</li></ol> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span>
<span class="token keyword">select</span>
  name<span class="token punctuation">,</span>
  orderdate<span class="token punctuation">,</span>
  cost<span class="token punctuation">,</span>
  <span class="token function">sum</span><span class="token punctuation">(</span>cost<span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span> name<span class="token punctuation">,</span><span class="token keyword">month</span><span class="token punctuation">(</span>orderdate<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> 
business
结果：
name   orderdate    cost sum
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span>	<span class="token number">50</span>	 <span class="token number">106</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>	<span class="token number">46</span>	 <span class="token number">106</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>	<span class="token number">10</span>	 <span class="token number">106</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">03</span>	<span class="token number">23</span>	 <span class="token number">23</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">06</span>	<span class="token number">42</span>	 <span class="token number">42</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span>	<span class="token number">50</span>	 <span class="token number">94</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>	<span class="token number">29</span>	 <span class="token number">94</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>	<span class="token number">15</span>	 <span class="token number">94</span>
小猛	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">10</span>	<span class="token number">12</span>	 <span class="token number">12</span>
小猛	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">12</span>	<span class="token number">80</span>	 <span class="token number">80</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">11</span>	<span class="token number">75</span>	 <span class="token number">293</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>	<span class="token number">94</span>	 <span class="token number">293</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">08</span>	<span class="token number">62</span>	 <span class="token number">293</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">09</span>	<span class="token number">62</span>	 <span class="token number">293</span>
</code></pre> 
<ol start="9"><li>按照日期将cost累加并保留明细</li></ol> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span>
<span class="token keyword">select</span>
  name<span class="token punctuation">,</span>
  orderdate<span class="token punctuation">,</span>
  cost<span class="token punctuation">,</span>
  <span class="token function">sum</span><span class="token punctuation">(</span>cost<span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> orderdate<span class="token punctuation">)</span>
<span class="token keyword">from</span> 
business
结果：
name   orderdate    cost sum
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>	<span class="token number">10</span>	 <span class="token number">10</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>	<span class="token number">15</span>	 <span class="token number">25</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>	<span class="token number">29</span>	 <span class="token number">54</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>	<span class="token number">46</span>	 <span class="token number">100</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span>	<span class="token number">50</span>	 <span class="token number">150</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span>	<span class="token number">50</span>	 <span class="token number">200</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">03</span>	<span class="token number">23</span>	 <span class="token number">223</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">06</span>	<span class="token number">42</span>	 <span class="token number">265</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">08</span>	<span class="token number">62</span>	 <span class="token number">327</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">09</span>	<span class="token number">62</span>	 <span class="token number">389</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">11</span>	<span class="token number">75</span>	 <span class="token number">464</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>	<span class="token number">94</span>	 <span class="token number">558</span>
小猛	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">10</span>	<span class="token number">12</span>	 <span class="token number">570</span>
小猛	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">12</span>	<span class="token number">80</span>	 <span class="token number">650</span>
</code></pre> 
<ol start="10"><li>按照日期将每个顾客cost累加并保留明细</li></ol> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span>
<span class="token keyword">select</span>
  name<span class="token punctuation">,</span>
  orderdate<span class="token punctuation">,</span>
  cost<span class="token punctuation">,</span>
  <span class="token function">sum</span><span class="token punctuation">(</span>cost<span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span> name <span class="token keyword">order</span> <span class="token keyword">by</span> orderdate<span class="token punctuation">)</span>
<span class="token keyword">from</span> 
business
结果：
name   orderdate    cost sum
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>	<span class="token number">10</span>	 <span class="token number">10</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>	<span class="token number">46</span>	 <span class="token number">56</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span>	<span class="token number">50</span>	 <span class="token number">106</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">03</span>	<span class="token number">23</span>	 <span class="token number">129</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">06</span>	<span class="token number">42</span>	 <span class="token number">171</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>	<span class="token number">15</span>	 <span class="token number">15</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>	<span class="token number">29</span>	 <span class="token number">44</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span>	<span class="token number">50</span>	 <span class="token number">94</span>
小猛	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">10</span>	<span class="token number">12</span>	 <span class="token number">12</span>
小猛	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">12</span>	<span class="token number">80</span>	 <span class="token number">92</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">08</span>	<span class="token number">62</span>	 <span class="token number">62</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">09</span>	<span class="token number">62</span>	 <span class="token number">124</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">11</span>	<span class="token number">75</span>	 <span class="token number">199</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>	<span class="token number">94</span>	 <span class="token number">293</span>
</code></pre> 
<ol start="11"><li>求出每个顾客上一次和当前一次消费的和并保留明细</li></ol> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span>
<span class="token keyword">select</span>
  name<span class="token punctuation">,</span>
  orderdate<span class="token punctuation">,</span>
  cost<span class="token punctuation">,</span>
  <span class="token function">sum</span><span class="token punctuation">(</span>cost<span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span> name <span class="token keyword">order</span> <span class="token keyword">by</span> orderdate <span class="token keyword">rows</span> <span class="token operator">between</span> <span class="token number">1</span> <span class="token keyword">preceding</span> <span class="token operator">and</span> <span class="token keyword">current</span> <span class="token keyword">row</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> 
business
结果：
name   orderdate    cost sum
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>	<span class="token number">10</span>	 <span class="token number">10</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>	<span class="token number">46</span>	 <span class="token number">56</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span>	<span class="token number">50</span>	 <span class="token number">96</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">03</span>	<span class="token number">23</span>	 <span class="token number">73</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">06</span>	<span class="token number">42</span>	 <span class="token number">65</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>	<span class="token number">15</span>	 <span class="token number">15</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>	<span class="token number">29</span>	 <span class="token number">44</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span>	<span class="token number">50</span>	 <span class="token number">79</span>
小猛	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">10</span>	<span class="token number">12</span>	 <span class="token number">12</span>
小猛	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">12</span>	<span class="token number">80</span>	 <span class="token number">92</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">08</span>	<span class="token number">62</span>	 <span class="token number">62</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">09</span>	<span class="token number">62</span>	 <span class="token number">124</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">11</span>	<span class="token number">75</span>	 <span class="token number">137</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>	<span class="token number">94</span>	 <span class="token number">169</span>
</code></pre> 
<p>思考题<br> （1）求出每个顾客当前一次和下一次消费的和，并保留明细<br> （2）求出每个顾客上一次到下一次消费的和，并保留明细<br> （3）求出每个顾客上一次和下一次消费的和，并保留明细<br> 12) 查询每个顾客购买明细以及上次的购买时间和下次购买时间</p> 
<pre><code>hive&gt;
select
  name,
  orderdate,
  cost,
  lag(orderdate,1,'0000-00-00')over(partition by name order by orderdate) prev_time,
  lead(orderdate,1,'9999-99-99')over(partition by name order by orderdate) next_time
from 
business
结果：
name   orderdate    cost prev_time     next_time
小元	2022-01-01	10	0000-00-00	2022-01-05
小元	2022-01-05	46	2022-01-01	2022-01-08
小元	2022-01-08	50	2022-01-05	2022-02-03
小元	2022-02-03	23	2022-01-08	2022-04-06
小元	2022-04-06	42	2022-02-03	9999-99-99
小海	2022-01-02	15	0000-00-00	2022-01-04
小海	2022-01-04	29	2022-01-02	2022-01-07
小海	2022-01-07	50	2022-01-04	9999-99-99
小猛	2022-05-10	12	0000-00-00	2022-06-12
小猛	2022-06-12	80	2022-05-10	9999-99-99
小辉	2022-04-08	62	0000-00-00	2022-04-09
小辉	2022-04-09	62	2022-04-08	2022-04-11
小辉	2022-04-11	75	2022-04-09	2022-04-13
小辉	2022-04-13	94	2022-04-11	9999-99-99
</code></pre> 
<p>注：并不是所有函数都需要写窗口子句。<br> rank dense_rank ntile row_number lag lead 这些函数不支持窗口子句。<br> 13) 查询顾客每个月第一次的购买时间 和 每个月的最后一次购买时间</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span>
<span class="token keyword">select</span>
   name<span class="token punctuation">,</span>
   orderdate<span class="token punctuation">,</span>
   cost<span class="token punctuation">,</span>
   first_value<span class="token punctuation">(</span>orderdate<span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span> name<span class="token punctuation">,</span><span class="token keyword">month</span><span class="token punctuation">(</span>orderdate<span class="token punctuation">)</span> <span class="token keyword">order</span> <span class="token keyword">by</span> orderdate <span class="token keyword">rows</span> <span class="token operator">between</span> <span class="token keyword">UNBOUNDED</span> <span class="token keyword">PRECEDING</span> <span class="token operator">and</span> <span class="token keyword">UNBOUNDED</span> <span class="token keyword">following</span><span class="token punctuation">)</span> first_value<span class="token punctuation">,</span>
   last_value<span class="token punctuation">(</span>orderdate<span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span> name<span class="token punctuation">,</span><span class="token keyword">month</span><span class="token punctuation">(</span>orderdate<span class="token punctuation">)</span> <span class="token keyword">order</span> <span class="token keyword">by</span> orderdate <span class="token keyword">rows</span> <span class="token operator">between</span> <span class="token keyword">UNBOUNDED</span> <span class="token keyword">PRECEDING</span> <span class="token operator">and</span> <span class="token keyword">UNBOUNDED</span> <span class="token keyword">following</span><span class="token punctuation">)</span> last_value
<span class="token keyword">from</span>
   business
结果：
name   orderdate    cost first_value  last_value
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>	<span class="token number">10</span>	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>	<span class="token number">46</span>	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span>	<span class="token number">50</span>	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">03</span>	<span class="token number">23</span>	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">03</span>	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">03</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">06</span>	<span class="token number">42</span>	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">06</span>	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">06</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>	<span class="token number">15</span>	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>	<span class="token number">29</span>	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span>	<span class="token number">50</span>	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span>
小猛	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">10</span>	<span class="token number">12</span>	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">10</span>	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">10</span>
小猛	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">12</span>	<span class="token number">80</span>	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">12</span>	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">12</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">08</span>	<span class="token number">62</span>	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">08</span>	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">09</span>	<span class="token number">62</span>	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">08</span>	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">11</span>	<span class="token number">75</span>	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">08</span>	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>	<span class="token number">94</span>	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">08</span>	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>
</code></pre> 
<ol start="14"><li>查询前20%时间的订单信息</li></ol> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span>
<span class="token comment">-- 将数据分为5组</span>
<span class="token keyword">select</span>
  name<span class="token punctuation">,</span>
  orderdate<span class="token punctuation">,</span>
  cost<span class="token punctuation">,</span>
  ntile<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> orderdate<span class="token punctuation">)</span> n_g
<span class="token keyword">from</span> 
  business  t1

<span class="token comment">-- 拿到5组中的第一组</span>
<span class="token keyword">select</span>
 <span class="token operator">*</span>
<span class="token keyword">from</span> <span class="token punctuation">(</span>
    <span class="token keyword">select</span>
     name<span class="token punctuation">,</span>
     orderdate<span class="token punctuation">,</span>
     cost<span class="token punctuation">,</span>
     ntile<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> orderdate<span class="token punctuation">)</span> n_g
    <span class="token keyword">from</span> 
     business 
<span class="token punctuation">)</span>t1
<span class="token keyword">where</span> t1<span class="token punctuation">.</span>n_g<span class="token operator">=</span><span class="token number">1</span> 
结果：
name   orderdate cost n_g
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>	<span class="token number">10</span>    <span class="token number">1</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>	<span class="token number">15</span>	  <span class="token number">1</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>	<span class="token number">29</span>	  <span class="token number">1</span>
</code></pre> 
<ol start="15"><li>按照花费的金额进行排名</li></ol> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span>
<span class="token keyword">select</span>
  name<span class="token punctuation">,</span>
  orderdate<span class="token punctuation">,</span>
  cost<span class="token punctuation">,</span>
  rank<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> cost <span class="token keyword">desc</span><span class="token punctuation">)</span> rk<span class="token punctuation">,</span>
  dense_rank<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> cost <span class="token keyword">desc</span><span class="token punctuation">)</span> drk<span class="token punctuation">,</span>
  row_number<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> cost <span class="token keyword">desc</span><span class="token punctuation">)</span> drk
<span class="token keyword">from</span>
  business
结果：
name   orderdate    cost rk drk rrk
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>	<span class="token number">94</span>	 <span class="token number">1</span>	 <span class="token number">1</span>	  <span class="token number">1</span>
小猛	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">12</span>	<span class="token number">80</span>	 <span class="token number">2</span>	 <span class="token number">2</span>	  <span class="token number">2</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">11</span>	<span class="token number">75</span>	 <span class="token number">3</span>	 <span class="token number">3</span>	  <span class="token number">3</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">08</span>	<span class="token number">62</span>	 <span class="token number">4</span>	 <span class="token number">4</span>	  <span class="token number">4</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">09</span>	<span class="token number">62</span>	 <span class="token number">4</span>	 <span class="token number">4</span>	  <span class="token number">5</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span>	<span class="token number">50</span>	 <span class="token number">6</span>	 <span class="token number">5</span>	  <span class="token number">6</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span>	<span class="token number">50</span>	 <span class="token number">6</span>	 <span class="token number">5</span>	  <span class="token number">7</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>	<span class="token number">46</span>	 <span class="token number">8</span>	 <span class="token number">6</span>	  <span class="token number">8</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">06</span>	<span class="token number">42</span>	 <span class="token number">9</span>	 <span class="token number">7</span>	  <span class="token number">9</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>	<span class="token number">29</span>	 <span class="token number">10</span>	 <span class="token number">8</span>	  <span class="token number">10</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">03</span>	<span class="token number">23</span>	 <span class="token number">11</span>	 <span class="token number">9</span>	  <span class="token number">11</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>	<span class="token number">15</span>	 <span class="token number">12</span>	 <span class="token number">10</span>	  <span class="token number">12</span>
小猛	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">10</span>	<span class="token number">12</span>	 <span class="token number">13</span>	 <span class="token number">11</span>	  <span class="token number">13</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>	<span class="token number">10</span>	 <span class="token number">14</span>	 <span class="token number">12</span>	  <span class="token number">14</span>
</code></pre> 
<blockquote> 
 <p>注：排名分析函数中不需要写参数，会将排好序数据进行标号。</p> 
</blockquote> 
<ol start="16"><li>按照每个顾客花费的金额进行排名</li></ol> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span>
<span class="token keyword">select</span>
  name<span class="token punctuation">,</span>
  orderdate<span class="token punctuation">,</span>
  cost<span class="token punctuation">,</span>
  rank<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span> name <span class="token keyword">order</span> <span class="token keyword">by</span> cost <span class="token keyword">desc</span><span class="token punctuation">)</span> rk<span class="token punctuation">,</span>
  dense_rank<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span> name <span class="token keyword">order</span> <span class="token keyword">by</span> cost <span class="token keyword">desc</span><span class="token punctuation">)</span> drk<span class="token punctuation">,</span>
  row_number<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span> name <span class="token keyword">order</span> <span class="token keyword">by</span> cost <span class="token keyword">desc</span><span class="token punctuation">)</span> drk
<span class="token keyword">from</span>
  business
结果：
name   orderdate    cost rk drk rrk
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span>	<span class="token number">50</span>	 <span class="token number">1</span>	 <span class="token number">1</span>	  <span class="token number">1</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>	<span class="token number">46</span>	 <span class="token number">2</span>	 <span class="token number">2</span>	  <span class="token number">2</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">06</span>	<span class="token number">42</span>	 <span class="token number">3</span>	 <span class="token number">3</span>	  <span class="token number">3</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">03</span>	<span class="token number">23</span>	 <span class="token number">4</span>	 <span class="token number">4</span>	  <span class="token number">4</span>
小元	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>	<span class="token number">10</span>	 <span class="token number">5</span>	 <span class="token number">5</span>	  <span class="token number">5</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span>	<span class="token number">50</span>	 <span class="token number">1</span>	 <span class="token number">1</span>	  <span class="token number">1</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>	<span class="token number">29</span>	 <span class="token number">2</span>	 <span class="token number">2</span>	  <span class="token number">2</span>
小海	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>	<span class="token number">15</span>	 <span class="token number">3</span>	 <span class="token number">3</span>	  <span class="token number">3</span>
小猛	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">12</span>	<span class="token number">80</span>	 <span class="token number">1</span>	 <span class="token number">1</span>	  <span class="token number">1</span>
小猛	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">10</span>	<span class="token number">12</span>	 <span class="token number">2</span>	 <span class="token number">2</span>	  <span class="token number">2</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">13</span>	<span class="token number">94</span>	 <span class="token number">1</span>	 <span class="token number">1</span>	  <span class="token number">1</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">11</span>	<span class="token number">75</span>	 <span class="token number">2</span>	 <span class="token number">2</span>	  <span class="token number">2</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">08</span>	<span class="token number">62</span>	 <span class="token number">3</span>	 <span class="token number">3</span>	  <span class="token number">3</span>
小辉	<span class="token number">2022</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">09</span>	<span class="token number">62</span>	 <span class="token number">3</span>	 <span class="token number">3</span>	  <span class="token number">4</span>
</code></pre> 
<h2><a id="13__2749"></a>第13章 高级聚合函数</h2> 
<h3><a id="131_collect_list_2750"></a>13.1 collect_list</h3> 
<p>collect_list 收集并形成list集合，结果不去重</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span>
<span class="token keyword">select</span> 
  sex<span class="token punctuation">,</span>
  collect_list<span class="token punctuation">(</span>job<span class="token punctuation">)</span>
<span class="token keyword">from</span>
  employee
<span class="token keyword">group</span> <span class="token keyword">by</span> 
  sex
</code></pre> 
<p>结果：</p> 
<pre><code class="prism language-sql">女	<span class="token punctuation">[</span><span class="token string">"行政"</span><span class="token punctuation">,</span><span class="token string">"研发"</span><span class="token punctuation">,</span><span class="token string">"行政"</span><span class="token punctuation">,</span><span class="token string">"前台"</span><span class="token punctuation">]</span>
男	<span class="token punctuation">[</span><span class="token string">"销售"</span><span class="token punctuation">,</span><span class="token string">"研发"</span><span class="token punctuation">,</span><span class="token string">"销售"</span><span class="token punctuation">,</span><span class="token string">"前台"</span><span class="token punctuation">]</span>
</code></pre> 
<h3><a id="132_collect_set_2767"></a>13.2 collect_set</h3> 
<p>collect_set 收集并形成set集合，结果去重</p> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span>
<span class="token keyword">select</span> 
  sex<span class="token punctuation">,</span>
  collect_set<span class="token punctuation">(</span>job<span class="token punctuation">)</span>
<span class="token keyword">from</span>
  employee
<span class="token keyword">group</span> <span class="token keyword">by</span> 
  sex
结果：
女	<span class="token punctuation">[</span><span class="token string">"行政"</span><span class="token punctuation">,</span><span class="token string">"研发"</span><span class="token punctuation">,</span><span class="token string">"前台"</span><span class="token punctuation">]</span>
男	<span class="token punctuation">[</span><span class="token string">"销售"</span><span class="token punctuation">,</span><span class="token string">"研发"</span><span class="token punctuation">,</span><span class="token string">"前台"</span><span class="token punctuation">]</span>
</code></pre> 
<h3><a id="133__2782"></a>13.3 炸裂函数</h3> 
<ol><li>一进多出（一行进入，多行输出）。<br> explode 将数组或者map展开</li></ol> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span> <span class="token keyword">select</span> explode<span class="token punctuation">(</span>array<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'d'</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
结果：
a
b
d
c 
</code></pre> 
<pre><code class="prism language-sql"><span class="token comment">-- 炸裂与侧写结合</span>
<span class="token comment">-- 用法：lateral view udtf（expression） tableAlias AS columnAlias</span>
<span class="token comment">-- 解释：lateral view用于和split，explode等UDTF一起使用，它能够将一行数据拆成多行数据，在此基础上可以对拆分后的数据进行聚合。</span>
<span class="token comment">-- lateral view首先为原始表的每行调用UDTF，UDTF会把一行拆分成一行或者多行，lateral view再把结果组合，产生一个支持别名表的虚拟表。</span>
hive<span class="token operator">&gt;</span>
<span class="token keyword">select</span> 
    movie<span class="token punctuation">,</span>
    category_name 
<span class="token keyword">from</span> movie_info 
lateral <span class="token keyword">view</span>
explode<span class="token punctuation">(</span>split<span class="token punctuation">(</span>category<span class="token punctuation">,</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span> movie_info_tmp <span class="token keyword">AS</span> category_name<span class="token punctuation">;</span>
</code></pre> 
<ol start="2"><li>json_tuple 取出json字符串中属性的值</li></ol> 
<pre><code class="prism language-sql">hive<span class="token operator">&gt;</span>
<span class="token keyword">select</span> json_tuple<span class="token punctuation">(</span><span class="token string">'{"name":"王二狗","sex":"男","age":"25"}'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token string">'sex'</span><span class="token punctuation">,</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
结果：
王二狗	男	<span class="token number">25</span>
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3e7c806a64f903a96f52369157c70cca/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Ubuntu18.04安装多个pcl、opencv3.4</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ca9d1832ef716afd80d7d041139afb1d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Hadoop集成对象存储和HDFS磁盘文件存储</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>