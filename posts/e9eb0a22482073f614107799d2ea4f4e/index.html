<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【KVM-6】KVM/QEMU软件栈 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【KVM-6】KVM/QEMU软件栈" />
<meta property="og:description" content="前言 大家好，我是秋意零。
👿 简介
🏠 个人主页： 秋意零🔥 账号：全平台同名， 秋意零 账号创作者、 云社区 创建者🧑 个人介绍：在校期间参与众多云计算相关比赛，如：🌟 “省赛”、“国赛”，并斩获多项奖项荣誉证书🎉 目前状况：24 届毕业生，拿到一家私有云（IAAS）公司 offer，目前已在实习💕欢迎大家：欢迎大家一起学习云计算，走向年薪 30 万💕推广：CSDN 主页左侧，是个人扣扣群推广。方便大家技术交流、技术博客互助。 一、内核模块 KVM内核模块是Linux内核的一部分，由于KVM的存在让Linux本身就变成了一个Hypervisor，可以原生地支持虚拟化功能。
目前，KVM支持多种处理器平台，它支持最常见的以Intel和AMD为代表的x86和x86 64平台，也支持PowerPC、S/390、ARM等非x86架构的平台。
KVM模块是KVM虚拟化的核心模块，KVM的主要功能是初始化CPU硬件，打开虚拟化模式，然后将虚拟客户机运行在该模式下，并对虚拟客户机的运行提供一定的支持。它在内核中由两部分组成：
一个是与处理器架构无关，用 lsmod 命令可以查看叫作 kvm 模块；处理器架构相关部分，在Inter平台上就是 kvm_intel 这个内核模块。 二、QEMU用户态设备模拟 QEMU介绍 QEMU是一个开源的虚拟机软件，而不是KVM虚拟机软件的一部分。
QEMU虚拟机是一个纯软件的实现，通过二进制翻译来实现虚拟化客户机中的CPU指令模拟，所以性能比较低。但是优点是跨平台，QEMU支持在Linux、Windows、MacOS等多种操作系统上运行。
除了二进制翻译的方式，QEMU也能与基于硬件虚拟化的Xen、KVM结合，为它们提供客户机的设备模拟。通过与KVM的结合，让虚拟化的性能提升非常高。
最早期的KVM开发者们为了简化软件架构和代码重用，根据KVM特性在QEMU的基础上进行了修改（当然这部分修改已经合并回QEMU的主干代码，故现在的QEMU已原生支持KVM虚拟化特性）。
工作过程 虚拟机运行期间，QEMU会通过KVM模块提供的系统调用进入内核，由KVM模块负责将虚拟机置于处理器的特殊模式下运行。遇到虚拟机进行I/O操作时，KVM模块会从上次的系统调用出口处返回QEMU，由QEMU来负责解析和模拟这些设备。
从QEMU角度来看，也可以说QEMU使用了KVM模块的虚拟化功能，为自己的虚拟机提供硬件虚拟化的加速，从而极大地提高了虚拟机的性能。
除此之外，虚拟机的配置和创建，虚拟机运行依赖的虚拟设备，虚拟机运行时的用户操作环境和交互，以及一些针对虚拟机的特殊技术(如: 动态迁移)，都是由QEMU自己实现的。
QEMU除了提供完全模拟的设备 (如: e1000网卡、IDE磁盘等)以外，还支持virtio协议的设备模拟。
virtio是一个沟通客户机前端设备与宿主机上设备后端模拟的比较高性能的协议，在前端客户机中需要安装相应的virtio-blk、virtio.scsi、virtio-net等驱动，而QEMU就实现了virtio的虚拟化后端。
虚拟化后端：是指在宿主机上实现 virtio 协议的一方，也就是 QEMU。它负责实现 virtio 协议，并且与客户机中的 virtio 驱动程序协同工作，从而实现在客户机和宿主机之间的高效通信。virtio 后端也可以由其他虚拟化工具（如 Xen、KVM 等）来实现，但 QEMU 是最常见的 virtio 后端实现之一。
总结 QEMU既是一个功能完整的虚拟机监控器，也在QEMU/KVM的软件栈中承担设备模拟的工作。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/e9eb0a22482073f614107799d2ea4f4e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-13T23:10:09+08:00" />
<meta property="article:modified_time" content="2023-11-13T23:10:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【KVM-6】KVM/QEMU软件栈</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 id="l0Ye9">前言</h2> 
<p id="u1e3cbb23"><strong>大家好，我是秋意零。</strong></p> 
<p id="u106f486c"><strong>👿 简介</strong></p> 
<ul><li id="uca0218a1">🏠 <strong>个人主页</strong>： <a href="https://blog.csdn.net/qq_48450494?spm=1000.2115.3001.5343" title="秋意零">秋意零</a></li><li id="u0e517cff">🔥 <strong>账号</strong>：全平台同名， <a href="https://blog.csdn.net/qq_48450494?spm=1000.2115.3001.5343" title="秋意零">秋意零</a> 账号创作者、 <a href="https://bbs.csdn.net/forums/CloudLog" title="云社区">云社区</a> 创建者</li><li id="u0930b6e9">🧑 <strong>个人介绍</strong>：在校期间参与众多云计算相关比赛，如：🌟 <strong>“省赛”、“国赛”</strong>，并斩获多项奖项荣誉证书</li><li id="u935ba6b4">🎉 <strong>目前状况</strong>：24 届毕业生，拿到一家私有云（IAAS）公司 offer，目前已在实习</li><li id="u5fb6d938">💕<strong>欢迎大家</strong>：欢迎大家一起学习云计算，走向年薪 30 万</li><li id="uda6920fb">💕<strong>推广</strong>：CSDN <strong>主页左侧，是个人扣扣群推广</strong>。方便大家<strong>技术交流、技术博客互助</strong>。</li></ul> 
<h2 id="Ma0sP">一、内核模块</h2> 
<p id="u93a83984">KVM内核模块是Linux内核的一部分，由于KVM的存在让Linux本身就变成了一个Hypervisor，可以原生地支持虚拟化功能。</p> 
<p id="u4288522f">目前，KVM支持多种处理器平台，它支持最常见的以Intel和AMD为代表的x86和x86 64平台，也支持PowerPC、S/390、ARM等非x86架构的平台。</p> 
<p id="u142131e8">KVM模块是KVM虚拟化的核心模块，<strong>KVM的主要功能是初始化CPU硬件，打开虚拟化模式，然后将虚拟客户机运行在该模式下，并对虚拟客户机的运行提供一定的支持</strong>。它在内核中由两部分组成：</p> 
<ul><li id="u5431f8c6">一个是与处理器架构无关，用 lsmod 命令可以查看叫作 kvm 模块；</li><li id="u1755a277">处理器架构相关部分，在Inter平台上就是 kvm_intel 这个内核模块。</li></ul> 
<h2 id="O9Ul2">二、QEMU用户态设备模拟</h2> 
<h3 id="sd4s8">QEMU介绍</h3> 
<p id="u894625fa">QEMU是一个开源的虚拟机软件，而不是KVM虚拟机软件的一部分。</p> 
<p id="uefbe36c4">QEMU虚拟机是一个纯软件的实现，通过二进制翻译来实现虚拟化客户机中的CPU指令模拟，所以性能比较低。但是优点是跨平台，QEMU支持在Linux、Windows、MacOS等多种操作系统上运行。</p> 
<p id="u5a7c9257">除了二进制翻译的方式，QEMU也能与基于硬件虚拟化的Xen、KVM结合，为它们提供客户机的设备模拟。通过与KVM的结合，让虚拟化的性能提升非常高。</p> 
<blockquote> 
 <p id="ufc967302">最早期的KVM开发者们为了简化软件架构和代码重用，根据KVM特性在QEMU的基础上进行了修改（当然这部分修改已经合并回QEMU的主干代码，故现<strong>在的QEMU已原生支持KVM虚拟化特性</strong>）。</p> 
</blockquote> 
<h3 id="XysqU">工作过程</h3> 
<p id="ua22d6397"><strong>虚拟机运行期间，QEMU会通过KVM模块提供的系统调用进入内核</strong>，由KVM模块负责将虚拟机置于处理器的特殊模式下运行。<strong>遇到虚拟机进行I/O操作时</strong>，KVM模块会从上次的系统调用出口处返回QEMU，由QEMU来负责解析和模拟这些设备。</p> 
<blockquote> 
 <p id="ub3866ac5">从QEMU角度来看，也可以说QEMU使用了KVM模块的虚拟化功能，为自己的虚拟机提供硬件虚拟化的加速，从而极大地提高了虚拟机的性能。</p> 
 <p></p> 
 <p>除此之外，虚拟机的配置和创建，虚拟机运行依赖的虚拟设备，虚拟机运行时的用户操作环境和交互，以及一些针对虚拟机的特殊技术(如: 动态迁移)，都是由QEMU自己实现的。</p> 
</blockquote> 
<p id="uec42188a">QEMU除了提供完全模拟的设备 (如: e1000网卡、IDE磁盘等)以外，还支持virtio协议的设备模拟。</p> 
<p id="u2f017afc"><strong>virtio是一个沟通客户机前端设备与宿主机上设备后端模拟的比较高性能的协议</strong>，在前端客户机中需要安装相应的virtio-blk、virtio.scsi、virtio-net等驱动，而QEMU就实现了virtio的虚拟化后端。</p> 
<blockquote> 
 <p id="u97d034e6"><strong>虚拟化后端：</strong>是指在宿主机上实现 virtio 协议的一方，也就是 QEMU。它负责实现 virtio 协议，并且与客户机中的 virtio 驱动程序协同工作，从而实现在客户机和宿主机之间的高效通信。virtio 后端也可以由其他虚拟化工具（如 Xen、KVM 等）来实现，但 QEMU 是最常见的 virtio 后端实现之一。</p> 
</blockquote> 
<p id="u1a3f8649"></p> 
<h2 id="gNM0h">总结</h2> 
<p id="u5cb6b1b2">QEMU既是一个功能完整的虚拟机监控器，也在QEMU/KVM的软件栈中承担设备模拟的工作。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ac56f3dc8adb9637d4b901ae5dd6337e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数字电路基础知识系列（六）之LC滤波器的基础知识</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1b55345afb04747cb53f2ba9adf0fd75/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【KVM-7】KVM管理工具</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>