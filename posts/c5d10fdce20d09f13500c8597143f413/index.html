<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ARM体系架构—ARMv7-A处理器模式及寄存器 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ARM体系架构—ARMv7-A处理器模式及寄存器" />
<meta property="og:description" content="一、ARMv7-A处理器模式 ARMv7架构支持安全扩展，如果使能了安全扩展，ARMv7-A架构分为安全模式（Secure State）和非安全模式（Non-secure State）两个世界。
在非安全模式下，存在三种运行特权PL0,PL1和PL2（privilege level）。
If the Virtualization Extensions are implemented there is a privilege model different to that of previous architectures. In Non-secure state there can be three privilege levels, PL0, PL1 and PL2.
特权等级描述PL0PL0运行在用户模式（User），用于运行应用程序。该模式程序受限访问系统资源。对应Linux用户态。PL1PL1运行非用户模式和Hyp模式外的所有模式。Linux内核运行在PL1。包含了ARMv6架构中的System,SVC,FIQ,IRQ,UNDEF及Abort模式。此外，安全模式中的Montior也运行在PL1等级，管理安全模式和非安全模式的切换。PL2PL2用于虚拟化。虚拟化超级管理程序(Hypervisor)运行在PL2。 二、ARMv7-A通用寄存器 ARMv7-A架构提供了16个32位通用寄存器（R0-R15）和一个程序状态寄存器CPSR（Current Program Status Register），在异常模式下，可以访问SPSR（Saved Program Status Register），在异常模式下，SPSR用于保存当前CPSR寄存器值。其中R0-R14可以用于普通数据存储，R15是程序计数器PC（program counter）。
以上寄存器可能因运行模式不同而对应不同的物理存储位置，上图中蓝色区域即如此，它们使用不同的物理存储，通常只有在进程以特定模式执行时才可访问。
R0-R7在任何模式下都对应相同的物理存储，称之为未分组寄存器；R8-R14根据模式不同对应不同的物理存储，称之为分组寄存器；R13（SP）在User和Sys模式下对应相同的物理存储，FIQ,IRQ,ABT,SVC,UND,MON,HYP模式分别对应不同的物理存储。R13在ARM架构中用于SP堆栈指针（stack pointer）。MON模式用于管理安全与非安全模式，HYP模式用于管理虚拟操作系统（GuestOS）。R14（LR）在User,Sys和HYP模式下对应相同的物理存储，FIQ,IRQ,ABT,SVC,UND,MON模式分别对应不同的物理存储。R14在ARM架构中用于LR链接寄存器，在每种模式下，R14用于保存子程序返回地址。执行BL指令时，R14用于备份R15寄存器的值。R15（PC）保存当前程序执行的地址。在所有模式下，R15（PC）共享相同的物理存储。在ARM状态下，[1:0]为0，[31:2]用于保存PC。在Thumb状态下，[0]为0，[31:1]用于保存PC。CPSR是程序状态寄存器，保存条件标志位，中断禁止位，当前处理器模式等控制和状态位。每种异常模式下还存在SPSR，保存进入异常模式前的CPSR寄存器值，用于异常处理完成后恢复CPSR的状态。User和Sys不属于异常模式，没有CPSR寄存器，在User模式下，受限的CPSR寄存器称谓APSR（ Application Program Status Register）。ARMv7-A中CPSR寄存器的信息如下图所示。
各Field代表含义如下：
Field作用NALU返回运算结果是否为负数ZALU返回运算结果是否为0CALU运算是否发生进位VALU运算是否发生溢出Qcumulative saturationJARM是否处于 Jazelle 状态E控制load/store字节序Adisables asynchronous aborts，User模式不能操作I使能/去使能IRQ，User模式不能操作F使能/去使能FIQ，User模式不能操作TARM和Thumb状态标志位GE用于某些SIMD（Single Instruction, Multiple Data）指令M[4:0]处理器模式：FIQ,IRQ,ABT,SVC,UND,MON,HYP。User模式不能操作 三、ARMv7-A协处理器CP15寄存器 ARMv7-A架构保护系统控制协处理器CP15，主要用于处理存储系统相关的功能。CP15只能在特权模式下访问。CP15提供了16个32位主寄存器，命名为c0-c15。c0-c15寄存器可能对应多个不同的物理寄存器。
registerphysical register描述c0MIDR主ID寄存器，用于记录厂商版本信息MPIDRMultiprocessor Affinity Registerc1SCTLR系统控制寄存器ACTLR辅助控制寄存器CPACR协处理器访问控制寄存器，控制访问除了CP14和CP15的协处理器SCR安全配置寄存器c2 c3TTBR0一级转换页表基址寄存器0TTBR1一级转换页表基址寄存器1TTBCR页表转换控制寄存器c5 c6DFSR数据异常（Data Fault）状态寄存器IFSR指令异常（Instruction Fault）状态寄存器DFAR数据异常（Data Fault）地址寄存器IFAR指令异常（Instruction Fault）地址寄存器c7 predictorcache及分支预测barrier数据及指令屏障c8TLBTLB操作c9performance monitors性能监视器c12 VBAR非安全模式异常基址寄存器MVBAR安全模式异常基址寄存器c13 ASID上下文ID寄存器，软件线程ID寄存器c15CBAR配置基址寄存器，用于GIC（Generic Interrupt Controller）和定时器类型外设 协处理器CP15寄存器访问包括读和写操作。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/c5d10fdce20d09f13500c8597143f413/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-07-12T22:43:14+08:00" />
<meta property="article:modified_time" content="2020-07-12T22:43:14+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ARM体系架构—ARMv7-A处理器模式及寄存器</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="ARMv7A_1"></a>一、ARMv7-A处理器模式</h2> 
<p><img src="https://images2.imgbox.com/b6/ba/6HJuF5AW_o.png" alt="在这里插入图片描述"></p> 
<p>ARMv7架构支持安全扩展，如果使能了安全扩展，ARMv7-A架构分为安全模式（Secure State）和非安全模式（Non-secure State）两个世界。<br> 在非安全模式下，存在三种运行特权PL0,PL1和PL2（privilege level）。</p> 
<blockquote> 
 <p>If the Virtualization Extensions are implemented there is a privilege model different to that of previous architectures. In Non-secure state there can be three privilege levels, PL0, PL1 and PL2.</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/2e/d7/duR6Y3DY_o.png" alt="在这里插入图片描述"></p> 
<table><thead><tr><th>特权等级</th><th>描述</th></tr></thead><tbody><tr><td>PL0</td><td>PL0运行在用户模式（User），用于运行应用程序。该模式程序受限访问系统资源。对应Linux用户态。</td></tr><tr><td>PL1</td><td>PL1运行非用户模式和Hyp模式外的所有模式。Linux内核运行在PL1。包含了ARMv6架构中的System,SVC,FIQ,IRQ,UNDEF及Abort模式。此外，安全模式中的Montior也运行在PL1等级，管理安全模式和非安全模式的切换。</td></tr><tr><td>PL2</td><td>PL2用于虚拟化。虚拟化超级管理程序(Hypervisor)运行在PL2。</td></tr></tbody></table> 
<h2><a id="ARMv7A_17"></a>二、ARMv7-A通用寄存器</h2> 
<p>ARMv7-A架构提供了16个32位通用寄存器（R0-R15）和一个程序状态寄存器CPSR（<em>Current Program Status Register</em>），在异常模式下，可以访问SPSR（<em>Saved Program Status Register</em>），在异常模式下，SPSR用于保存当前CPSR寄存器值。其中R0-R14可以用于普通数据存储，R15是程序计数器PC（<em>program counter</em>）。<br> <img src="https://images2.imgbox.com/f4/46/8IJTChhc_o.png" alt="在这里插入图片描述"><br> 以上寄存器可能因运行模式不同而对应不同的物理存储位置，上图中蓝色区域即如此，它们使用不同的物理存储，通常只有在进程以特定模式执行时才可访问。</p> 
<ul><li>R0-R7在任何模式下都对应相同的物理存储，称之为未分组寄存器；</li><li>R8-R14根据模式不同对应不同的物理存储，称之为分组寄存器；</li><li>R13（SP）在User和Sys模式下对应相同的物理存储，FIQ,IRQ,ABT,SVC,UND,MON,HYP模式分别对应不同的物理存储。R13在ARM架构中用于SP堆栈指针（<em>stack pointer</em>）。MON模式用于管理安全与非安全模式，HYP模式用于管理虚拟操作系统（GuestOS）。</li><li>R14（LR）在User,Sys和HYP模式下对应相同的物理存储，FIQ,IRQ,ABT,SVC,UND,MON模式分别对应不同的物理存储。R14在ARM架构中用于LR链接寄存器，在每种模式下，R14用于保存子程序返回地址。执行BL指令时，R14用于备份R15寄存器的值。</li><li>R15（PC）保存当前程序执行的地址。在所有模式下，R15（PC）共享相同的物理存储。在ARM状态下，[1:0]为0，[31:2]用于保存PC。在Thumb状态下，[0]为0，[31:1]用于保存PC。</li><li>CPSR是程序状态寄存器，保存条件标志位，中断禁止位，当前处理器模式等控制和状态位。每种异常模式下还存在SPSR，保存进入异常模式前的CPSR寄存器值，用于异常处理完成后恢复CPSR的状态。User和Sys不属于异常模式，没有CPSR寄存器，在User模式下，受限的CPSR寄存器称谓APSR（ <em>Application Program Status Register</em>）。ARMv7-A中CPSR寄存器的信息如下图所示。<br> <img src="https://images2.imgbox.com/c4/2f/A3xE9pNH_o.png" alt="CPSR bits"></li></ul> 
<p>各Field代表含义如下：</p> 
<table><thead><tr><th>Field</th><th>作用</th></tr></thead><tbody><tr><td>N</td><td>ALU返回运算结果是否为负数</td></tr><tr><td>Z</td><td>ALU返回运算结果是否为0</td></tr><tr><td>C</td><td>ALU运算是否发生进位</td></tr><tr><td>V</td><td>ALU运算是否发生溢出</td></tr><tr><td>Q</td><td>cumulative saturation</td></tr><tr><td>J</td><td>ARM是否处于 Jazelle 状态</td></tr><tr><td>E</td><td>控制load/store字节序</td></tr><tr><td>A</td><td>disables asynchronous aborts，User模式不能操作</td></tr><tr><td>I</td><td>使能/去使能IRQ，User模式不能操作</td></tr><tr><td>F</td><td>使能/去使能FIQ，User模式不能操作</td></tr><tr><td>T</td><td>ARM和Thumb状态标志位</td></tr><tr><td>GE</td><td>用于某些SIMD（<em>Single Instruction, Multiple Data</em>）指令</td></tr><tr><td>M[4:0]</td><td>处理器模式：FIQ,IRQ,ABT,SVC,UND,MON,HYP。User模式不能操作</td></tr></tbody></table> 
<h2><a id="ARMv7ACP15_47"></a>三、ARMv7-A协处理器CP15寄存器</h2> 
<p>ARMv7-A架构保护系统控制协处理器CP15，主要用于处理存储系统相关的功能。CP15只能在特权模式下访问。CP15提供了16个32位主寄存器，命名为c0-c15。c0-c15寄存器可能对应多个不同的物理寄存器。</p> 
<table><tbody><tr><th>register</th><th>physical register</th><th>描述</th></tr><tr><td rowspan="2">c0</td><td>MIDR</td><td>主ID寄存器，用于记录厂商版本信息</td></tr><tr><td>MPIDR</td><td>Multiprocessor Affinity Register</td></tr><tr><td rowspan="4">c1</td><td>SCTLR</td><td>系统控制寄存器</td></tr><tr><td>ACTLR</td><td>辅助控制寄存器</td></tr><tr><td>CPACR</td><td>协处理器访问控制寄存器，控制访问除了CP14和CP15的协处理器</td></tr><tr><td>SCR</td><td>安全配置寄存器</td></tr><tr><td rowspan="3">c2 c3</td><td>TTBR0</td><td>一级转换页表基址寄存器0</td></tr><tr><td>TTBR1</td><td>一级转换页表基址寄存器1</td></tr><tr><td>TTBCR</td><td>页表转换控制寄存器</td></tr><tr><td rowspan="4">c5 c6</td><td>DFSR</td><td>数据异常（Data Fault）状态寄存器</td></tr><tr><td>IFSR</td><td>指令异常（Instruction Fault）状态寄存器</td></tr><tr><td>DFAR</td><td>数据异常（Data Fault）地址寄存器</td></tr><tr><td>IFAR</td><td>指令异常（Instruction Fault）地址寄存器</td></tr><tr><td rowspan="2">c7</td><td> predictor</td><td>cache及分支预测</td></tr><tr><td>barrier</td><td>数据及指令屏障</td></tr><tr><td>c8</td><td>TLB</td><td>TLB操作</td></tr><tr><td>c9</td><td>performance monitors</td><td>性能监视器</td></tr><tr><td rowspan="2">c12</td><td> VBAR</td><td>非安全模式异常基址寄存器</td></tr><tr><td>MVBAR</td><td>安全模式异常基址寄存器</td></tr><tr><td>c13</td><td> ASID</td><td>上下文ID寄存器，软件线程ID寄存器</td></tr><tr><td>c15</td><td>CBAR</td><td>配置基址寄存器，用于GIC（Generic Interrupt Controller）和定时器类型外设</td></tr></tbody></table> 
<p>协处理器CP15寄存器访问包括读和写操作。</p> 
<ul><li>读操作即将CP15内的寄存器CRn的值读到通用寄存器Rt中，使用指令语法MRC, Op1, Rt, CRn, CRm, Op2；</li><li>写操作即将通用寄存器Rt的值写入CP15内的寄存器CRn中，使用指令语法MCR, Op1, Rt, CRn, CRm, Op2；<br> <img src="https://images2.imgbox.com/00/0f/74Fpsd2g_o.png" alt="在这里插入图片描述"></li><li>MRC：将CP15寄存器值读到ARM通用寄存器；</li><li>MCR：将ARM通用寄存器值写到CP15寄存器；</li><li>Op1 ：协处理行为操作码；</li><li>Rt ：ARM通用寄存器，不能是R15(PC)；</li><li>CRn：协处理器CP15寄存器c0-c15；</li><li>CRm：附加目标寄存器，不需要附加信息，则设置为c0；</li><li>Op2 ：区分同一编号不同的物理寄存器，例如分别访问c0中的MIDR和MPIDR，Op2值分别为0和1。默认情况下设置为0；</li></ul> 
<p>示例：<br> 将CP15寄存器c0的MIDR寄存器读到R1中。</p> 
<pre><code class="prism language-c">MRC p15<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> R1<span class="token punctuation">,</span> c0<span class="token punctuation">,</span> c0<span class="token punctuation">,</span> <span class="token number">0</span>
</code></pre> 
<h2><a id="CP15SCTLR_170"></a>四、系统控制寄存器CP15.SCTLR</h2> 
<p>系统控制寄存器SCTLR（System Control Register ）用于控制内存，系统功能以及提供状态信息。</p> 
<p><img src="https://images2.imgbox.com/82/e8/PFe6g2Nd_o.png" alt="System Control Register bits"></p> 
<table><thead><tr><th>Field</th><th>作用</th></tr></thead><tbody><tr><td>TE</td><td>Thumb异常使能</td></tr><tr><td>NMFI</td><td>不可屏蔽FIQ</td></tr><tr><td>EE</td><td>异常字节序</td></tr><tr><td>U</td><td>对齐模使用标志</td></tr><tr><td>FI</td><td>FIQ配置使能</td></tr><tr><td>V</td><td>选择异常向量表基址</td></tr><tr><td>I</td><td>指令cache使能位</td></tr><tr><td>Z</td><td>分支预测使能位</td></tr><tr><td>C</td><td>cache使能位</td></tr><tr><td>A</td><td>对齐检测使能位</td></tr><tr><td>M</td><td>MMU使能位</td></tr></tbody></table> 
<p>示例：<br> 初始化CP15:SCTLR，使能Cache，指令Cache及分支预测功能。<br> <img src="https://images2.imgbox.com/a4/c3/HCRsFp2B_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b858cdaf633cc5d6f6773a9e5b9fbc75/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">手动下载依赖使用 pip 安装 wxPython</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/405ce49627a7e23cc13f3a11a0834bf7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">创建一个 C&#43;&#43; 控制台应用程序项目</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>