<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>R语言数据预处理——离散化（分箱） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="R语言数据预处理——离散化（分箱）" />
<meta property="og:description" content="R语言数据预处理——离散化（分箱） 一、项目环境 开发工具：RStudioR：3.5.2相关包：infotheo，discretization，smbinning，dplyr，sqldf 二、导入数据 # 这里我们使用的是鸢尾花数据集（iris） data(iris) head(iris) Sepal.LengthSepal.WidthPetal.LengthPetal.WidthSpecies15.13.51.40.2setosa24.93.01.40.2setosa34.73.21.30.2setosa44.63.11.50.2setosa55.03.61.40.2setosa65.43.91.70.4setosa 相关数据解释：
Sepal.Length：萼片长度
Sepal.Width：萼片宽度
Petal.Length：花瓣长度
Petal.Width：花瓣宽度
Species：鸢尾花品种
三、 数据划分 library(dplyr) library(sqldf) # 为数据集增加序号列（id） iris$id &lt;- c(1:nrow(iris)) # 将鸢尾花数据集中70%的数据划分为训练集 iris_train &lt;- sample_frac(iris, 0.7, replace = TRUE) # 使用sql语句将剩下的30%花费为测试集 iris_test &lt;- sqldf(&#34; select * from iris where id not in ( select id from iris_train ) &#34;) # 去除序号列（id） iris_train &lt;- iris_train[,-6] iris_test &lt;- iris_test[,-6] 【注】：这里使用到sqldf包的函数sqldf函数来时间在R语言中使用SQL语句
四、 无监督分箱 常见的几种无监督分箱方法
等宽分箱法等频分箱法kmeans分箱法 1、 分箱前准备法 # 导入无监督分箱包——infotheo library(infotheo) # 分成几个区域 nbins &lt;- 3 2、 等宽分箱法 ### 等宽分箱的原理非常简单，就是按照相同的间距将数据分成相应的等分 # 将连续型数据分成三份，并以1、2、3赋值 equal_width &lt;- discretize(iris_train$Sepal." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/4d9475f3234bcd593818f66a8f502b57/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-31T15:01:50+08:00" />
<meta property="article:modified_time" content="2023-05-31T15:01:50+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">R语言数据预处理——离散化（分箱）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="R_0"></a>R语言数据预处理——离散化（分箱）</h2> 
<h3><a id="_3"></a>一、项目环境</h3> 
<ul><li>开发工具：RStudio</li><li>R：3.5.2</li><li>相关包：infotheo，discretization，smbinning，dplyr，sqldf</li></ul> 
<h3><a id="_11"></a>二、导入数据</h3> 
<pre><code class="prism language-ruby"><span class="token comment"># 这里我们使用的是鸢尾花数据集（iris）</span>
data<span class="token punctuation">(</span>iris<span class="token punctuation">)</span>
head<span class="token punctuation">(</span>iris<span class="token punctuation">)</span>
</code></pre> 
<table><thead><tr><th></th><th>Sepal.Length</th><th>Sepal.Width</th><th>Petal.Length</th><th>Petal.Width</th><th>Species</th></tr></thead><tbody><tr><td>1</td><td>5.1</td><td>3.5</td><td>1.4</td><td>0.2</td><td>setosa</td></tr><tr><td>2</td><td>4.9</td><td>3.0</td><td>1.4</td><td>0.2</td><td>setosa</td></tr><tr><td>3</td><td>4.7</td><td>3.2</td><td>1.3</td><td>0.2</td><td>setosa</td></tr><tr><td>4</td><td>4.6</td><td>3.1</td><td>1.5</td><td>0.2</td><td>setosa</td></tr><tr><td>5</td><td>5.0</td><td>3.6</td><td>1.4</td><td>0.2</td><td>setosa</td></tr><tr><td>6</td><td>5.4</td><td>3.9</td><td>1.7</td><td>0.4</td><td>setosa</td></tr></tbody></table> 
<p>相关数据解释：</p> 
<ul><li> <p><strong>Sepal.Length</strong>：萼片长度</p> </li><li> <p><strong>Sepal.Width</strong>：萼片宽度</p> </li><li> <p><strong>Petal.Length</strong>：花瓣长度</p> </li><li> <p><strong>Petal.Width</strong>：花瓣宽度</p> </li><li> <p><strong>Species</strong>：鸢尾花品种</p> </li></ul> 
<h3><a id="__41"></a>三、 数据划分</h3> 
<pre><code class="prism language-ruby">library<span class="token punctuation">(</span>dplyr<span class="token punctuation">)</span>
library<span class="token punctuation">(</span>sqldf<span class="token punctuation">)</span>

<span class="token comment"># 为数据集增加序号列（id）</span>
iris<span class="token variable">$id</span> <span class="token operator">&lt;</span><span class="token operator">-</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token symbol">:nrow</span><span class="token punctuation">(</span>iris<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 将鸢尾花数据集中70%的数据划分为训练集</span>
iris_train <span class="token operator">&lt;</span><span class="token operator">-</span> sample_frac<span class="token punctuation">(</span>iris<span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> replace <span class="token operator">=</span> <span class="token constant">TRUE</span><span class="token punctuation">)</span>

<span class="token comment"># 使用sql语句将剩下的30%花费为测试集</span>
iris_test <span class="token operator">&lt;</span><span class="token operator">-</span> sqldf<span class="token punctuation">(</span>"
               select <span class="token operator">*</span>
               from iris
               where id <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token punctuation">(</span>
               select id
               from iris_train
               <span class="token punctuation">)</span>
               "<span class="token punctuation">)</span>

<span class="token comment"># 去除序号列（id）</span>
iris_train <span class="token operator">&lt;</span><span class="token operator">-</span> iris_train<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">]</span>
iris_test <span class="token operator">&lt;</span><span class="token operator">-</span> iris_test<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">]</span>
</code></pre> 
<blockquote> 
 <p>【注】：这里使用到sqldf包的函数<strong>sqldf</strong>函数来时间在R语言中使用SQL语句</p> 
</blockquote> 
<h3><a id="__72"></a>四、 无监督分箱</h3> 
<p>常见的几种无监督分箱方法</p> 
<ul><li>等宽分箱法</li><li>等频分箱法</li><li>kmeans分箱法</li></ul> 
<h4><a id="1__80"></a>1、 分箱前准备法</h4> 
<pre><code class="prism language-ruby"><span class="token comment"># 导入无监督分箱包——infotheo</span>
library<span class="token punctuation">(</span>infotheo<span class="token punctuation">)</span>

<span class="token comment"># 分成几个区域</span>
nbins <span class="token operator">&lt;</span><span class="token operator">-</span> <span class="token number">3</span> 

</code></pre> 
<h4><a id="2__91"></a>2、 等宽分箱法</h4> 
<pre><code class="prism language-ruby"><span class="token comment">### 等宽分箱的原理非常简单，就是按照相同的间距将数据分成相应的等分</span>

<span class="token comment"># 将连续型数据分成三份，并以1、2、3赋值</span>
equal_width <span class="token operator">&lt;</span><span class="token operator">-</span> discretize<span class="token punctuation">(</span>iris_train<span class="token variable">$Sepal</span><span class="token punctuation">.</span>Width<span class="token punctuation">,</span><span class="token string-literal"><span class="token string">"equalwidth"</span></span><span class="token punctuation">,</span>nbins<span class="token punctuation">)</span>

<span class="token comment">### 查看分箱情况</span>

<span class="token comment"># 查看各分类数量</span>
table<span class="token punctuation">(</span>equal_width<span class="token punctuation">)</span>

<span class="token comment"># 用颜色表明是等宽分箱</span>
plot<span class="token punctuation">(</span>iris_train<span class="token variable">$Sepal</span><span class="token punctuation">.</span>Width<span class="token punctuation">,</span> col <span class="token operator">=</span> equal_width<span class="token variable">$X</span><span class="token punctuation">)</span>


<span class="token comment">### 保存每个等分切割点的值（阙值）</span>

<span class="token comment"># 计算各个分类相应的切割点</span>
width <span class="token operator">&lt;</span><span class="token operator">-</span> <span class="token punctuation">(</span>max<span class="token punctuation">(</span>iris_train<span class="token variable">$Sepal</span><span class="token punctuation">.</span>Width<span class="token punctuation">)</span><span class="token operator">-</span>min<span class="token punctuation">(</span>iris_train<span class="token variable">$Sepal</span><span class="token punctuation">.</span>Width<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span>nbins

<span class="token comment"># 保存阙值</span>
depreciation <span class="token operator">&lt;</span><span class="token operator">-</span> width <span class="token operator">*</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token symbol">:nbins</span><span class="token punctuation">)</span> <span class="token operator">+</span> min<span class="token punctuation">(</span>iris_train<span class="token variable">$Sepal</span><span class="token punctuation">.</span>Width<span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>&gt; # 查看各分类数量<br> &gt; table(equal_width)<br> equal_width<br> 1 2 3<br> 23 59 23<br> &gt;<br> &gt; # 用颜色表明是等宽分箱<br> &gt; plot(iris_train<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          S 
         
        
          e 
         
        
          p 
         
        
          a 
         
        
          l 
         
        
          . 
         
        
          W 
         
        
          i 
         
        
          d 
         
        
          t 
         
        
          h 
         
        
          , 
         
        
          c 
         
        
          o 
         
        
          l 
         
        
          = 
         
        
          e 
         
        
          q 
         
        
          u 
         
        
          a 
         
         
         
           l 
          
         
           w 
          
         
        
          i 
         
        
          d 
         
        
          t 
         
        
          h 
         
        
       
         Sepal.Width, col = equal_width 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0576em;">S</span><span class="mord mathnormal">e</span><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord">.</span><span class="mord mathnormal">Wi</span><span class="mord mathnormal">d</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.0359em;">q</span><span class="mord mathnormal">u</span><span class="mord mathnormal">a</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.0197em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0269em;">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span></span></span></span></span>X)<br> &gt;</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/91/ea/UqudMW4c_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="3__127"></a>3、 等频分箱</h4> 
<pre><code class="prism language-ruby"><span class="token comment">### 等频分箱是将数据均匀的分成相应的等分（数量不一定是完全相同的）</span>

<span class="token comment"># 将连续型数据分成三份，并以1、2、3赋值</span>
equal_freq <span class="token operator">&lt;</span><span class="token operator">-</span> discretize<span class="token punctuation">(</span>iris_train<span class="token variable">$Sepal</span><span class="token punctuation">.</span>Width<span class="token punctuation">,</span><span class="token string-literal"><span class="token string">"equalfreq"</span></span><span class="token punctuation">,</span>nbins<span class="token punctuation">)</span>

<span class="token comment">### 查看分箱情况</span>

<span class="token comment"># 查看各分类数量</span>
table<span class="token punctuation">(</span>equal_width<span class="token punctuation">)</span>

<span class="token comment"># 用颜色表明是等频分箱</span>
plot<span class="token punctuation">(</span>iris_train<span class="token variable">$Sepal</span><span class="token punctuation">.</span>Width<span class="token punctuation">,</span> col <span class="token operator">=</span> equal_freq<span class="token variable">$X</span><span class="token punctuation">)</span>


<span class="token comment">### 保存每个等分切割点的值（阙值）</span>

data <span class="token operator">&lt;</span><span class="token operator">-</span> iris_train<span class="token variable">$Sepal</span><span class="token punctuation">.</span>Width<span class="token punctuation">[</span>order<span class="token punctuation">(</span>iris_train<span class="token variable">$Sepal</span><span class="token punctuation">.</span>Width<span class="token punctuation">)</span><span class="token punctuation">]</span>

depreciation <span class="token operator">&lt;</span><span class="token operator">-</span> as<span class="token punctuation">.</span>data<span class="token punctuation">.</span>frame<span class="token punctuation">(</span>table<span class="token punctuation">(</span>equal_freq<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token variable">$Freq</span>
</code></pre> 
<blockquote> 
 <p>&gt; # 查看各分类数量<br> &gt; table(equal_freq)<br> equal_width<br> 1 2 3<br> 43 32 30<br> &gt;<br> &gt; # 用颜色表明是等频分箱<br> &gt; plot(iris_train<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          S 
         
        
          e 
         
        
          p 
         
        
          a 
         
        
          l 
         
        
          . 
         
        
          W 
         
        
          i 
         
        
          d 
         
        
          t 
         
        
          h 
         
        
          , 
         
        
          c 
         
        
          o 
         
        
          l 
         
        
          = 
         
        
          e 
         
        
          q 
         
        
          u 
         
        
          a 
         
         
         
           l 
          
         
           f 
          
         
        
          r 
         
        
          e 
         
        
          q 
         
        
       
         Sepal.Width, col = equal_freq 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0576em;">S</span><span class="mord mathnormal">e</span><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord">.</span><span class="mord mathnormal">Wi</span><span class="mord mathnormal">d</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.9805em; vertical-align: -0.2861em;"></span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.0359em;">q</span><span class="mord mathnormal">u</span><span class="mord mathnormal">a</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: -0.0197em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.1076em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span><span class="mord mathnormal">re</span><span class="mord mathnormal" style="margin-right: 0.0359em;">q</span></span></span></span></span>X)<br> &gt;</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/31/cc/D7iSfLqA_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="4kmeans_162"></a>4、kmeans分箱法</h4> 
<pre><code class="prism language-ruby"><span class="token comment"># kmeans分箱法，先给定中心数，将观察点利用欧式距离计算与中心点的距离进行归类，再重新计算中心点，直到中心点# 不再发生变化，以归类的结果做为分箱的结果。</span>


<span class="token comment"># 将连续型数据分成三份，并以1、2、3赋值</span>
k_means <span class="token operator">&lt;</span><span class="token operator">-</span> kmeans<span class="token punctuation">(</span>iris_train<span class="token variable">$Sepal</span><span class="token punctuation">.</span>Width<span class="token punctuation">,</span> nbins<span class="token punctuation">)</span>

<span class="token comment"># 查看各分类数量</span>
table<span class="token punctuation">(</span>k_means<span class="token variable">$cluster</span><span class="token punctuation">)</span>

<span class="token comment"># 查看实际分箱状况</span>
k_means<span class="token variable">$cluster</span>

<span class="token comment"># 保存阙值</span>
<span class="token comment"># rev() 的作用是倒置数据框</span>
<span class="token comment"># 统一从左往右，从大到小</span>
depreciation <span class="token operator">&lt;</span><span class="token operator">-</span> rev<span class="token punctuation">(</span>k_means<span class="token variable">$centers</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>&gt; # 查看各分类数量<br> &gt; table(k_means<span class="katex--inline">KaTeX parse error: Expected 'EOF', got '#' at position 36: … 26 36 43 \&gt; #̲ 查看实际分箱状况 \&gt; k_…</span>cluster<br> [1] 3 2 2 2 3 1 3 3 2 2 3 3 3 2 3 1 1 1 3 1 3 3 1 2 2 1 2 3 3 3 1 1 1 1 3 3 1 2 2<br> [40] 3 3 3 3 3 2 2 2 3 3 2 3 2 2 1 2 1 2 1 1 2 3 3 3 2 3 2 3 1 3 3 1 1 1 2 3 3 2 3<br> [79] 3 2 2 2 2 1 3 2 2 3 2 3 2 2 1 3 3 3 3 2 1 1 1 1 2 3 2</p> 
</blockquote> 
<h3><a id="__195"></a>五、 有监督分箱</h3> 
<p>discretization提供了几个主要的离散化的工具函数：</p> 
<ul><li> <p><strong>chiM</strong>，ChiM算法进行离散化</p> </li><li> <p><strong>chi2</strong>, Chi2算法进行离散化</p> </li><li> <p><strong>mdlp</strong>，最小描述长度原理(MDLP)进行离散化</p> </li><li> <p><strong>modChi2</strong>，改进的Chi2方法离散数值属性</p> </li><li> <p><strong>disc.Topdown</strong>，自上而下的离散化</p> </li><li> <p><strong>extendChi2</strong>，扩展Chi2算法离散数值属性</p> </li></ul> 
<p>smbinning提供的工具函数：</p> 
<ul><li><strong>smbinning</strong> ，基于构造条件推断树ctree的监督式分箱</li></ul> 
<h4><a id="1chiM_219"></a>1、chiM算法进行离散化</h4> 
<pre><code class="prism language-ruby"><span class="token comment">### 有监督的数据离散化</span>
library<span class="token punctuation">(</span>discretization<span class="token punctuation">)</span><span class="token comment"># 有监督分箱</span>

<span class="token comment"># 使用ChiMerge算法基于卡方检验进行自下而上的合并</span>
chi1 <span class="token operator">&lt;</span><span class="token operator">-</span> chiM<span class="token punctuation">(</span>iris_train<span class="token punctuation">,</span> alpha <span class="token operator">=</span> <span class="token number">0.05</span><span class="token punctuation">)</span> <span class="token comment"># alpha 为显著性指标</span>

apply<span class="token punctuation">(</span>chi1<span class="token variable">$Disc</span><span class="token punctuation">.</span>data<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>table<span class="token punctuation">)</span>

<span class="token comment"># 保存阙值</span>
depreciation <span class="token operator">&lt;</span><span class="token operator">-</span> chi1<span class="token variable">$cutp</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>


<span class="token comment">## 其他有监督分享算法</span>
<span class="token comment"># chi2 &lt;- chi2(iris,alp=0.5,del=0.05) # chi2()算法</span>
<span class="token comment"># chi3 &lt;- modChi2(iris,alp=0.5)       # modChi2()算法</span>
<span class="token comment"># chi4 &lt;- extendChi2(iris,alp = 0.5)  # extendChi2()算法</span>
<span class="token comment"># m1 &lt;- mdlp(iris)                    # 使用熵准则将最小描述长度作为停止规则来离散化</span>
<span class="token comment"># d1 &lt;- disc.Topdown(iris,method=1)   # 该功能实现了三种自上而下的离散化算法（CAIM，CACC，Ameva）</span>

</code></pre> 
<blockquote> 
 <p>&gt; apply(chi1$Disc.data,2,table)<br> &gt; $Sepal.Length</p> 
 <p>1 2 3 4<br> 28 14 54 9</p> 
 <p>$Sepal.Width</p> 
 <p>1 2 3<br> 50 32 23</p> 
 <p>$Petal.Length</p> 
 <p>1 2 3 4<br> 23 45 4 33</p> 
 <p>$Petal.Width</p> 
 <p>1 2 3<br> 23 51 31</p> 
 <p>$Species</p> 
 <p>setosa versicolor virginica<br> 23 47 35</p> 
</blockquote> 
<h4><a id="2ctree_269"></a>2、基于构造条件推断树ctree的监督式分箱</h4> 
<pre><code class="prism language-ruby"><span class="token comment"># 分箱前数据准备</span>
library<span class="token punctuation">(</span>smbinning<span class="token punctuation">)</span> 

<span class="token comment"># 查看测试用例</span>
head<span class="token punctuation">(</span>smbsimdf1<span class="token punctuation">)</span>

</code></pre> 
<table><thead><tr><th>fgood</th><th>cbs1</th><th>cbs2</th><th>cbinq</th><th>cbline</th><th>cbterm</th><th>cblineut</th><th>cbtob</th><th>cbdpd</th><th>cbnew</th><th>pmt</th><th>tob</th><th>dpd</th><th>dep</th><th>dc</th><th>od</th><th>home</th><th>inc</th><th>dd</th><th>online</th><th>rnd</th><th>period</th></tr></thead><tbody><tr><td>1</td><td>60.11</td><td>NA</td><td>02</td><td>2</td><td>00</td><td>47.51361</td><td>5</td><td>No</td><td>No</td><td>M</td><td>2</td><td>00No</td><td>10481.40</td><td>20</td><td>01</td><td>No</td><td>W06</td><td>00</td><td>Yes</td><td>0.46641029</td><td>2018-03-31</td></tr><tr><td>1</td><td>45.62</td><td>66.72</td><td>02</td><td>2</td><td>02</td><td>52.36222</td><td>4</td><td>No</td><td>No</td><td>A</td><td>1</td><td>02Hi</td><td>10182.43</td><td>17</td><td>01</td><td>No</td><td>W10</td><td>00</td><td>Yes</td><td>0.91980286</td><td>2018-05-31</td></tr><tr><td>1</td><td>30.86</td><td>66.94</td><td>02</td><td>2</td><td>00</td><td>35.89640</td><td>5</td><td>No</td><td>Yes</td><td>M</td><td>2</td><td>02Hi</td><td>9645.37</td><td>23</td><td>00</td><td>No</td><td>W05</td><td>00</td><td>Yes</td><td>0.33804009</td><td>2018-07-31</td></tr><tr><td>1</td><td>62.38</td><td>49.12</td><td>02</td><td>3</td><td>01</td><td>41.93578</td><td>6</td><td>No</td><td>No</td><td>P</td><td>4</td><td>00No</td><td>13702.76</td><td>31</td><td>01</td><td>No</td><td></td><td>00</td><td>Yes</td><td>0.76475600</td><td>2017-12-31</td></tr><tr><td>1</td><td>54.36</td><td>41.22</td><td>00</td><td>1</td><td>00</td><td>44.23662</td><td>5</td><td>No</td><td>No</td><td>P</td><td>4</td><td>00No</td><td>18720.09</td><td>26</td><td>02</td><td>Yes</td><td>W08</td><td>01</td><td>Yes</td><td>0.58563795</td><td>2018-02-28</td></tr><tr><td>1</td><td>68.78</td><td>50.80</td><td>00</td><td>0</td><td>00</td><td>43.59248</td><td>7</td><td>Yes</td><td>Yes</td><td>A</td><td>4</td><td>01Lo</td><td>10217.07</td><td>31</td><td>00</td><td>No</td><td>W09</td><td>00</td><td>Yes</td><td>0.05756396</td><td>2018-03-31</td></tr></tbody></table> 
<blockquote> 
 <p>【注】：这里之所以不适用鸢尾花数据集的原因在于，这个函数的使用条件较为苛刻。首先它<font color="red"><strong>不允许数据集的列名中含有 “.”</strong> </font>,比如 鸢尾花数据集中的“Sepal.Width”就不可以。其次它要求<font color="red"><strong>用于学习的列必须是二分类，且数据类型必须是numeric，二分类的值也必须是（0， 1）</strong> </font>。也是因为这些原因，为了方便在这里使用包中自带的数据集。</p> 
</blockquote> 
<hr> 
<pre><code class="prism language-ruby"><span class="token comment"># 使用smbinning函数进行分箱，df 为原始数据，y表示目标标签，x表示需要分箱的标签</span>
result <span class="token operator">&lt;</span><span class="token operator">-</span> smbinning<span class="token punctuation">(</span>df <span class="token operator">=</span> smbsimdf1<span class="token punctuation">,</span>y <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"fgood"</span></span><span class="token punctuation">,</span>x <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"cbs1"</span></span><span class="token punctuation">)</span> 


<span class="token comment"># 查看分箱结果的分布情况，不良率和证据权重</span>
par<span class="token punctuation">(</span>mfrow<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
boxplot<span class="token punctuation">(</span>smbsimdf1<span class="token variable">$cbs1</span><span class="token operator">~</span>smbsimdf1<span class="token variable">$fgood</span><span class="token punctuation">,</span>horizontal<span class="token operator">=</span><span class="token constant">T</span><span class="token punctuation">,</span> frame<span class="token operator">=</span><span class="token constant">F</span><span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token string-literal"><span class="token string">"lightgray"</span></span><span class="token punctuation">,</span>main<span class="token operator">=</span><span class="token string-literal"><span class="token string">"Distribution"</span></span><span class="token punctuation">)</span>
smbinning<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>result<span class="token punctuation">,</span>option<span class="token operator">=</span><span class="token string-literal"><span class="token string">"dist"</span></span><span class="token punctuation">)</span>
smbinning<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>result<span class="token punctuation">,</span>option<span class="token operator">=</span><span class="token string-literal"><span class="token string">"badrate"</span></span><span class="token punctuation">)</span>
smbinning<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>result<span class="token punctuation">,</span>option<span class="token operator">=</span><span class="token string-literal"><span class="token string">"WoE"</span></span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="httpsimgblogcsdnimgcn20190714163154611pngxossprocessimagewatermarktype_ZmFuZ3poZW5naGVpdGkshadow_10text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI2ODY3OTY3size_16color_FFFFFFt_70_305"></a><img src="https://images2.imgbox.com/bb/9d/CTuqn5JR_o.png" alt="在这里插入图片描述"></h3> 
<pre><code class="prism language-ruby">result<span class="token variable">$ivtable</span> <span class="token comment"># 相关重要信息</span>
result<span class="token variable">$ctree</span> <span class="token comment"># 决策树</span>
result<span class="token variable">$cuts</span> <span class="token comment"># 阙值</span>
smbinning<span class="token punctuation">.</span>sql<span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token comment"># 输出相应的sql语句</span>
</code></pre> 
<blockquote> 
 <p>&gt; result<span class="katex--inline">KaTeX parse error: Expected 'EOF', got '#' at position 9: ivtable #̲ 相关重要信息 …</span>ctree # 决策树</p> 
 <p>Model formula:<br> fgood ~ cbs1</p> 
 <p>Fitted party:<br> [1] root<br> | [2] cbs1 &lt;= 51.77<br> | | [3] cbs1 &lt;= 36.44: 0.559 (n = 245, err = 60.4)<br> | | [4] cbs1 &gt; 36.44: 0.741 (n = 829, err = 159.2)<br> | [5] cbs1 &gt; 51.77<br> | | [6] cbs1 &lt;= 59.5: 0.838 (n = 520, err = 70.4)<br> | | [7] cbs1 &gt; 59.5: 0.935 (n = 650, err = 39.3)</p> 
 <p>Number of inner nodes: 3<br> Number of terminal nodes: 4<br> &gt; result$cuts # 阙值<br> [1] 36.4400 51.7701 59.5000<br> &gt; smbinning.sql(result) # 输出相应的sql语句<br> alter table ‘TableName’ add ‘NewCharName’<br> go<br> update ‘TableName’ set ‘NewCharName’<br> case<br> when cbs1 &lt;= 36.44 then ‘01: cbs1 &lt;= 36.44’<br> when cbs1 &lt;= 51.7701 then ‘02: cbs1 &lt;= 51.7701’<br> when cbs1 &lt;= 59.5 then ‘03: cbs1 &lt;= 59.5’<br> when cbs1 &gt; 59.5 then ‘04: cbs1 &gt; 59.5’<br> when cbs1 Is Null then ‘05: cbs1 Is Null’<br> else ‘99: Error’ end<br> &gt;</p> 
</blockquote> 
<hr> 
<pre><code class="prism language-ruby"><span class="token comment"># 使用训练好的函数对数据进行分箱（训练集和测试集都需要）</span>
smbsimdf1 <span class="token operator">&lt;</span><span class="token operator">-</span> smbinning<span class="token punctuation">.</span>gen<span class="token punctuation">(</span>smbsimdf1<span class="token punctuation">,</span> result<span class="token punctuation">,</span> chrname <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"gcbs1"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 查看分箱情况</span>
table<span class="token punctuation">(</span>smbsimdf1<span class="token variable">$gcbs1</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>&gt; table(smbsimdf1$gcbs1)</p> 
 <p>00 Miss 01 &lt;= 36.44 02 &lt;= 51.7701 03 &lt;= 59.5 04 &gt; 59.5<br> 256 245 829 520 650</p> 
</blockquote> 
<blockquote> 
 <p>【注】：除此之外也可以用smbinning.sql(result) 生成的sql语句，配合sqldf包进行数据分箱操作。</p> 
</blockquote> 
<h3><a id="__382"></a>六、 使用阙值对测试集进行分箱操作</h3> 
<p>​ 上述方法中，除了最后一种方法，我们都没有将训练好的函数用于测试集。但是在实际的分析，我们让数据离散化最主要的目的更多的是为了降低机器学习的负担。因此我们除了需要对训练集进行分箱操作之外，将同样的分箱方法作用与测试集。那么下面我们就将使用之前得到的阙值，对测试集进行分享操作。</p> 
<pre><code class="prism language-ruby"><span class="token comment">### 对测试集进行分箱操作</span>


<span class="token comment"># 使用之前保存的阙值</span>
<span class="token comment"># 这里之所以要前后加上Inf，是为了让它的范围能够向正负无穷延伸</span>
<span class="token comment"># (-Inf, a],[b, Inf)</span>
break1<span class="token operator">&lt;</span><span class="token operator">-</span>c<span class="token punctuation">(</span><span class="token operator">-</span>Inf<span class="token punctuation">,</span>depreciation<span class="token punctuation">,</span>Inf<span class="token punctuation">)</span>


labels <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"差"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"中"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"良"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"优"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 第一个值是数据</span>
<span class="token comment"># 第一个值是分箱的区间</span>
<span class="token comment"># 第三个值是替换成的数</span>
<span class="token comment"># ordered_result表示被替换成的数是否有前后顺序</span>
iris_test<span class="token variable">$Sepal</span><span class="token punctuation">.</span>Width <span class="token operator">&lt;</span><span class="token operator">-</span> cut<span class="token punctuation">(</span>iris_test<span class="token variable">$Sepal</span><span class="token punctuation">.</span>Width<span class="token punctuation">,</span>break1<span class="token punctuation">,</span>labels<span class="token punctuation">,</span>ordered_result <span class="token operator">=</span> <span class="token constant">T</span><span class="token punctuation">)</span>
iris_test<span class="token variable">$Sepal</span><span class="token punctuation">.</span>Width
</code></pre> 
<blockquote> 
 <p>&gt; iris_test$Sepal.Width<br> [1] 良 优 优 优 优 优 良 良 优 优 优 优 优 优 优 良 优 优 优 优 优 优 优 优 优 中<br> [27] 优 优 良 优 优 优 良 良 差 良 差 良 优 良 差 良 良 良 良 良 优 良 良 中 良 良<br> [53] 优 良 良 良 优 良 优 良 良 良 良 良 优 良 良 良 优 优 良 优 良 良<br> Levels: 差 &lt; 中 &lt; 良 &lt; 优</p> 
</blockquote> 
<h3><a id="__411"></a>七、 结语</h3> 
<p>​ 本文更多的是从实际操作的角度进行说明，之间涉及到的很多算法的原理没有进行过多的说明。有兴趣的可以查看本文主要参考的两篇文章，或者自行搜索学习。</p> 
<p>​ 主要参考：https://blog.csdn.net/kMD8d5R/article/details/84351546，https://mp.weixin.qq.com/s/_E6QjFfJb8Dm5qI5lMNeaA</p> 
<hr> 
<p>很长一段时间没有在csdn中写文章了，事实上后面自己学习过程中的大部分文档都是在语雀中完成的，基本都是自己写自己看。后续文章都会分享到自己的个人博客上，感兴趣的话可以关注一下。<a href="https://chenshaolang.gitee.io/personal-blog/" rel="nofollow">个人博客地址</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3a44437ffde8e341bc80b0ef3019cf42/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">R语言中的管道操作——magrittr包</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/be6fc9d5c4983aee2ace75272e86e02c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MoMent时间工具类（JS）的基本使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>