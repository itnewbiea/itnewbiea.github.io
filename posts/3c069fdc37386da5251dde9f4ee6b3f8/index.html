<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>记录ChatGLM接入微信公众号的过程，及错误总结（未解决） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="记录ChatGLM接入微信公众号的过程，及错误总结（未解决）" />
<meta property="og:description" content="一，起因 本人本来的意思是去搭建一个Chatgbt和微信公众号的一个个人聊天工具，但是由于需要租用海外服务器，以及海外服务器是否能够去满足GBT大模型的训练，因此如果想要省点钱，来进行搭建，就得换个法子，就跟着师哥了解了ChatGLM
二，过程 2.1 ChatGLM的部署 在了解了师哥的AI部署之后，我跟着b站的up主Joker大金宝，的视频教程，利用阿里云的免费机器学习的平台，可以给到大模型训练的GPU，刚开始还有使用三个月的名额
在阿里云上部署chatGLM-6B_哔哩哔哩_bilibili
网址就放在这了，金宝老师讲的很好，部署很简单。
主要记录一下出现的问题 2.1.1 免费使用 看评论有的人好像收费了，因此我们要是使用阿里云的机器学习平台，要点击这个免费使用
选择好使用的产品之后，点击试用再去平台去创建实例，就不用交钱了
2.1.2 部署出现错误 我的错误点就在于选择的镜像错误
一定要选择python39的，我好像选择了python36，当时出现了这样的问题
ERROR: Could not find a version that satisfies the requirement transformers==4.27.1 (from versions: 0.1, 2.0.0, 2.1.0, 2.1.1, 2.2.0, 2.2.1, 2.2.2, 2.3.0, 2.4.0, 2.4.1, 2.5.0, 2.5.1, 2.6.0, 2.7.0, 2.8.0, 2.9.0, 2.9.1, 2.10.0, 2.11.0, 3.0.0, 3.0.1, 3.0.2, 3.1.0, 3.2.0, 3.3.0, 3.3.1, 3.4.0, 3.5.0, 3.5.1, 4.0.0rc1, 4.0.0, 4.0.1, 4.1.0, 4.1.1, 4.2.0, 4.2.1, 4.2.2, 4.3.0rc1, 4.3.0, 4." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/3c069fdc37386da5251dde9f4ee6b3f8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-07T13:56:41+08:00" />
<meta property="article:modified_time" content="2023-08-07T13:56:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">记录ChatGLM接入微信公众号的过程，及错误总结（未解决）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>一，起因</h2> 
<p>本人本来的意思是去搭建一个Chatgbt和微信公众号的一个个人聊天工具，但是由于需要租用海外服务器，以及海外服务器是否能够去满足GBT大模型的训练，因此如果想要省点钱，来进行搭建，就得换个法子，就跟着师哥了解了ChatGLM</p> 
<h2>二，过程</h2> 
<h3>2.1 ChatGLM的部署</h3> 
<p>在了解了师哥的AI部署之后，我跟着b站的up主Joker大金宝，的视频教程，利用阿里云的免费机器学习的平台，可以给到大模型训练的GPU，刚开始还有使用三个月的名额</p> 
<p><a href="https://www.bilibili.com/video/BV1K14y1m7Hu/?spm_id_from=333.1007.top_right_bar_window_history.content.click" rel="nofollow" title="在阿里云上部署chatGLM-6B_哔哩哔哩_bilibili">在阿里云上部署chatGLM-6B_哔哩哔哩_bilibili</a></p> 
<p>网址就放在这了，金宝老师讲的很好，部署很简单。</p> 
<h4>主要记录一下出现的问题</h4> 
<h5>2.1.1 免费使用</h5> 
<p>看评论有的人好像收费了，因此我们要是使用阿里云的机器学习平台，要点击这个免费使用</p> 
<p><img alt="" height="677" src="https://images2.imgbox.com/98/15/ydcuSiB3_o.png" width="1200"></p> 
<p> 选择好使用的产品之后，点击试用再去平台去创建实例，就不用交钱了</p> 
<p><img alt="" height="699" src="https://images2.imgbox.com/52/23/mwt7zwas_o.png" width="1200"></p> 
<h5> 2.1.2 部署出现错误</h5> 
<p>我的错误点就在于选择的镜像错误</p> 
<p><img alt="" height="542" src="https://images2.imgbox.com/5e/99/56GEvSDE_o.png" width="1076"></p> 
<p> 一定要选择python39的，我好像选择了python36，当时出现了这样的问题</p> 
<p>ERROR: Could not find a version that satisfies the requirement transformers==4.27.1 (from versions: 0.1, 2.0.0, 2.1.0, 2.1.1, 2.2.0, 2.2.1, 2.2.2, 2.3.0, 2.4.0, 2.4.1, 2.5.0, 2.5.1, 2.6.0, 2.7.0, 2.8.0, 2.9.0, 2.9.1, 2.10.0, 2.11.0, 3.0.0, 3.0.1, 3.0.2, 3.1.0, 3.2.0, 3.3.0, 3.3.1, 3.4.0, 3.5.0, 3.5.1, 4.0.0rc1, 4.0.0, 4.0.1, 4.1.0, 4.1.1, 4.2.0, 4.2.1, 4.2.2, 4.3.0rc1, 4.3.0, 4.3.1, 4.3.2, 4.3.3, 4.4.0, 4.4.1, 4.4.2, 4.5.0, 4.5.1, 4.6.0, 4.6.1, 4.7.0, 4.8.0, 4.8.1, 4.8.2, 4.9.0, 4.9.1, 4.9.2, 4.10.0, 4.10.1, 4.10.2, 4.10.3, 4.11.0, 4.11.1, 4.11.2, 4.11.3, 4.12.0, 4.12.1, 4.12.2, 4.12.3, 4.12.4, 4.12.5, 4.13.0, 4.14.0, 4.14.1, 4.15.0, 4.16.0, 4.16.1, 4.16.2, 4.17.0, 4.18.0)<br> ERROR: No matching distribution found for transformers==4.27.1</p> 
<p>这个就是选择版本的问题，transformers==4.27.1只支持3.7以上的版本，所以出现这个问题也要尤为注意</p> 
<p>剩下就是部署成功啦，还挺简单的，似乎没啥毛病</p> 
<h3>2.2 接入微信公众号</h3> 
<p>因为之前从未接触过公众号的开发，所以第一时间就是去bing上去搜搜，看看有没有现成的，一搜还搜到了，有个老哥写了现成的</p> 
<p><a href="https://github.com/pli2014/chatGLM-wechat" title="pli2014/chatGLM-wechat: 【技术篇】个人微信公众号对接chatGLM-6B (github.com)">pli2014/chatGLM-wechat: 【技术篇】个人微信公众号对接chatGLM-6B (github.com)</a></p> 
<p>老哥写的代码很好啊，就是乍一看啊，看不懂·</p> 
<p>但是肯定可以确定的是需要自己去创建一个微信公众号，订阅号就可以，微信公众号的创建也没啥问题，建立好之后自然要去捣鼓捣鼓一下这个代码，了解里面的一些参数</p> 
<p>然后将里面的APPID，APPSECRET的值进行修改，改一token的值，这些参数换成自己的，这些也就是代码的一个基础配置，并且学习代码是通过Flask应用机器人，来进行回复和微信token的验证的。</p> 
<h4>接入问题</h4> 
<h5>2.2.1网络问题</h5> 
<p>一开始我是用这个运行web_demo.py的生成的网页进行，微信公众号基本配置的验证的，发现毫无意义，之后还是调试GitHub给的代码，让这个Flask应用运行起来，监听发出的端口，获取信息才能处理</p> 
<p><strong>这也出现了第一个问题，阿里云的免费试用平台是内网，如果微信想要通过URL来发送验证信息，则必须要公网访问，但是平台并没有公网IP</strong></p> 
<p><strong>因此解决的第一个问题是公网IP问题</strong></p> 
<h5>解决办法</h5> 
<p>我想到我之前在大学期间，利用frp，搭建校园网到服务器网的连接，实现利用微软的远程控制平台来实现，平板对笔记本的远程控制，达到内网穿透效果</p> 
<h5>目的利用frp来实现内网穿透。</h5> 
<p>再在免费试用里面领取ECS的云服务器，来获取这个公网IP</p> 
<h6>问题1 安全组的开放端口</h6> 
<p>在搭建过程中出现了，frp服务开启了，但是客户端接入不进去，frp的仪表盘打不开的情况。主要的一个问题就是，端口的开放</p> 
<p>ECS和我之前在大学使用的轻量化的页面不一样，在配置安全网的时候，自己明明已经打开了这个端口，却仍旧连接不上的问题</p> 
<p>安全网的配置，可以去C一下怎么配置的，我的主要问题就是这个</p> 
<p><img alt="" height="516" src="https://images2.imgbox.com/62/f3/cu8FSHRJ_o.png" width="1200"></p> 
<p> 大家主要关注一下相关实例，我自己去配置了配置一，但是我自己服务器的实例没加入进去，全打开也没用</p> 
<p>第二个问题就是这网络好像有区域的，在配置的时候注意一下，C过之后配置应该问题不大</p> 
<h6>问题2 frp的连接</h6> 
<p>既然端口一开发，Frp连接成功，我应该可以通过有公网IP的服务器，将信息传递到内网的机器学习平台，连接成功之后，我们就需要在Flask的app中去配置，让这个app去在那个端口上面等着信息发来，接受才对吧。</p> 
<p>之后我们就应该按照公众号的提示</p> 
<p><img alt="" height="736" src="https://images2.imgbox.com/e9/18/uwKkCbIT_o.png" width="1171"></p> 
<p> 公众号只支持 80 端口和 443 端口，实际上这里有个大坑，感兴趣读一读</p> 
<p>我肯定想让他们用默认端口的7000，去来回通信，所以我开放80端口，并将80端口的信息转接到7000端口，通过frp传递到客户端的7000端口，让我的Flask的app在7000端口监听，获取验证信息就可，这里其实关于这个Flask的应用配置，还得看看这个视频，去理解每个连接参数的意思</p> 
<p><a href="https://www.bilibili.com/video/BV1zb411m7uS/?p=63&amp;spm_id_from=333.880.my_history.page.click" rel="nofollow" title="05_接入微信公众号服务器开发_哔哩哔哩_bilibili">05_接入微信公众号服务器开发_哔哩哔哩_bilibili</a></p> 
<p>这个链接就会有详细了解，参数意义</p> 
<p><img alt="" height="293" src="https://images2.imgbox.com/04/d2/zPYbtDPj_o.png" width="1003"></p> 
<p> 这样得到应用在所有IP地址中监听6000号端口，获取信息，这里为啥是6000，先别急，我先接着说，我完成了上面的操作了之后，成功的解决了URL超时的问题</p> 
<p>但是问题变成了token验证失败</p> 
<p>紧接着出现我想到第二个问题</p> 
<h6>问题3 frp连接的属性</h6> 
<p>我根据<a href="https://zhuanlan.zhihu.com/p/337939762" rel="nofollow" title="FRP内网穿透实践教程 - 知乎 (zhihu.com)">FRP内网穿透实践教程 - 知乎 (zhihu.com)</a>的教程，实现的win10的smb连接，而微信公众号发送的是http的get请求而非smb，或者TCP连接，因此我认为是我的连接类型问题</p> 
<p>因此我改变了客户端的连接属性</p> 
<p><img alt="" height="149" src="https://images2.imgbox.com/e9/2c/DMNJiQFE_o.png" width="540"></p> 
<p> 改变了服务端的建立一个vhost_http_port的一个连接</p> 
<p><img alt="" height="424" src="https://images2.imgbox.com/92/c0/cZU3fC5u_o.png" width="543"></p> 
<p> 我通过了解实际上frp是通过vhost_http_port来将信息传递到local_port的因此，localport和app的port相同即可，所以都设置了6000</p> 
<h6> 问题4 域名</h6> 
<p>但是根据上面的图片，图片上面有域名，也就是我建立http的连接，必须要有自己的域名，接着去阿里云注册一个域名</p> 
<p>注册域名没什么问题。也很便宜，建立完域名我只需要去将我的这个域名解析到我这个，公网服务器IP地址就可以完成这样http的连接</p> 
<p>当我完成http连接之后，仍旧token验证失败</p> 
<h2>三 问题的猜测</h2> 
<h6>问题1 我之前将80端口的信息转到7000端口这个操作是否还在，是否影响到我后面的操作</h6> 
<h6>问题2 我服务器接受到这个验证，并return的时候能不能传递回来，对于微信验证的完整流程frp是否能昨晚，是否需要nignx的转发</h6> 
<h6>问题3 我的客户端是否有防火墙</h6> 
<h6>问题4 这个问题比较难受就是我这个域名是否备案，很明显没有备案，所以这个先做着</h6> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/67d8bc4d61ff98d2b9c82fd6ea1b7f76/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Windows Sever 2016的安装与网络配置</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b77ec9a1a37df354da99abe6b41f7609/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">关于docker 在ubuntu16.04 上的安装</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>