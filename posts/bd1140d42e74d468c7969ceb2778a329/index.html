<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【PHP】TP5 使用模型一对一关联查询，条件筛选及字段过滤 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【PHP】TP5 使用模型一对一关联查询，条件筛选及字段过滤" />
<meta property="og:description" content="目录
方法一：使用Eloquent ORM的with关联查询
方法二：使用JOIN进行查询
方法一：使用Eloquent ORM的with关联查询 在 ThinkPHP5 中，可以使用模型关联和条件查询来实现一对一关联查询。以下是一个示例：
假设有两个表，一个是 users 表，一个是 profiles 表。users 表中有一个 profile_id 字段，用于关联 profiles 表中的 id 字段。
首先，在 User 模型中定义一个 profile 方法，用于关联 Profile 模型：
// User.php public function profile() { return $this-&gt;hasOne(&#39;Profile&#39;, &#39;id&#39;, &#39;profile_id&#39;); } 然后，在控制器中使用模型关联查询，并添加条件：
// UserController.php public function index() { // 查询 users 表中的所有记录 $users = User::with([&#39;profile&#39; =&gt; function($query) { $query-&gt;where(&#39;address&#39;, &#39;like&#39;, &#39;%北京%&#39;); $query-&gt;field(&#39;profile_id,title&#39;); }]) -&gt;where(&#39;status&#39;, &#39;=&#39;, 1) -&gt;field(&#39;id,nickname&#39;) -&gt;select(); // 输出查询结果 foreach ($users as $user) { if ($user-&gt;profile) { echo $user-&gt;name ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/bd1140d42e74d468c7969ceb2778a329/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-05T17:30:37+08:00" />
<meta property="article:modified_time" content="2024-01-05T17:30:37+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【PHP】TP5 使用模型一对一关联查询，条件筛选及字段过滤</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="-toc" style="margin-left:80px;"></p> 
<p id="%E6%96%B9%E6%B3%95%E4%B8%80%EF%BC%9A%E4%BD%BF%E7%94%A8Eloquent%20ORM%E7%9A%84with%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2-toc" style="margin-left:80px;"><a href="#%E6%96%B9%E6%B3%95%E4%B8%80%EF%BC%9A%E4%BD%BF%E7%94%A8Eloquent%20ORM%E7%9A%84with%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2" rel="nofollow">方法一：使用Eloquent ORM的with关联查询</a></p> 
<p id="%E6%96%B9%E6%B3%95%E4%BA%8C%EF%BC%9A%E4%BD%BF%E7%94%A8JOIN%E8%BF%9B%E8%A1%8C%E6%9F%A5%E8%AF%A2-toc" style="margin-left:80px;"><a href="#%E6%96%B9%E6%B3%95%E4%BA%8C%EF%BC%9A%E4%BD%BF%E7%94%A8JOIN%E8%BF%9B%E8%A1%8C%E6%9F%A5%E8%AF%A2" rel="nofollow">方法二：使用JOIN进行查询</a></p> 
<hr id="hr-toc"> 
<h4>方法一：使用Eloquent ORM的with关联查询</h4> 
<hr> 
<p>在 ThinkPHP5 中，可以使用模型关联和条件查询来实现一对一关联查询。以下是一个示例：</p> 
<p>假设有两个表，一个是 <code>users</code> 表，一个是 <code>profiles</code> 表。<code>users</code> 表中有一个 <code>profile_id</code> 字段，用于关联 <code>profiles</code> 表中的 <code>id</code> 字段。</p> 
<p>首先，在 <code>User</code> 模型中定义一个 <code>profile</code> 方法，用于关联 <code>Profile</code> 模型：</p> 
<pre><code class="language-php">// User.php
public function profile()
{
    return $this-&gt;hasOne('Profile', 'id', 'profile_id');
}</code></pre> 
<p>然后，在控制器中使用模型关联查询，并添加条件：</p> 
<pre><code class="language-php">// UserController.php
public function index()
{
    // 查询 users 表中的所有记录
    $users = User::with(['profile' =&gt; function($query) {
        $query-&gt;where('address', 'like', '%北京%');
        $query-&gt;field('profile_id,title');
    }])
        -&gt;where('status', '=', 1)
        -&gt;field('id,nickname')
        -&gt;select();

    // 输出查询结果
    foreach ($users as $user) {
        if ($user-&gt;profile) {
            echo $user-&gt;name . ': ' . $user-&gt;profile-&gt;address . '
';
        } else {
            echo $user-&gt;name . ': 无法查询到地址
';
        }
    }
}</code></pre> 
<p>在上面的示例中，使用 <code>with</code> 方法加载 <code>profile</code> 关联模型，并使用闭包函数添加查询条件。在闭包函数中，使用 <code>$query-&gt;where()</code> 方法添加查询条件。最后，使用 <code>select</code> 方法执行查询，并遍历查询结果。注意，在输出查询结果时，使用了条件判断来检查关联模型是否存在。如果不存在，则输出 "无法查询到地址"。</p> 
<ul><li> <p>优点：</p> 
  <ul><li>更符合面向对象编程思想，易于理解和维护。</li><li>通过预加载（<code>with()</code>）实现一对多关系的数据获取，避免了N+1问题，提高查询效率。</li><li>查询语句相对清晰，逻辑更加直观。</li></ul></li><li> <p>缺点：</p> 
  <ul><li>如果表数据量非常大或者关联层次较深，可能会造成性能下降。</li><li>对于复杂的联合查询和自定义查询条件，可能不如原生SQL灵活。</li></ul></li></ul> 
<h4 id="%E6%96%B9%E6%B3%95%E4%BA%8C%EF%BC%9A%E4%BD%BF%E7%94%A8JOIN%E8%BF%9B%E8%A1%8C%E6%9F%A5%E8%AF%A2">方法二：使用JOIN进行查询</h4> 
<hr> 
<pre><code class="language-php">$list = User::alias('u')
-&gt;join('profilet p','u.id= p.uid')
-&gt;where('u.id', $id)
−&gt;where('p.address','like',"%$address%")
-&gt;field('u.id,u.nickname,p.uid,p.address')
-&gt;order('id desc')
-&gt;select();</code></pre> 
<ul><li> <p>优点：</p> 
  <ul><li>在处理大量数据时，如果JOIN条件恰当，通常可以得到更好的查询性能。</li><li>可以更灵活地编写复杂的联接查询。</li></ul></li><li> <p>缺点：</p> 
  <ul><li>查询语句相对复杂，可读性和维护性可能较差。</li><li>需要手动处理N+1问题，如果后续需要对关联表进行进一步操作，可能需要额外的数据库查询。</li></ul></li></ul> 
<p>总结： 如果你的项目主要依赖Eloquent ORM，并且关注代码结构清晰、易于维护，同时数据量不是特别庞大，建议优先考虑方法一。反之，如果数据量较大，关联查询较为复杂，且对性能要求较高，可以尝试使用方法二进行JOIN查询优化。但最终选择哪种方式，还需要根据你的具体业务场景和数据库设计来决定。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cffc232a9f909a7c86d7fb62bfa439ad/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java集合-LinkedList</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9e05748333d417209c8661ab68113399/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">安装阿里云CLI之配置阿里云凭证信息</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>