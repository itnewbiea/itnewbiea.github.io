<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vue3封装table组件 element Plus - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vue3封装table组件 element Plus" />
<meta property="og:description" content="&lt;template&gt; &lt;div class=&#34;scTable&#34; ref=&#34;scTableMain&#34; :style=&#34;{ height: theight }&#34; v-loading=&#34;loading&#34;&gt; &lt;div :class=&#34;!hideDo ? &#39;scTable-table&#39; : &#39;scTable-table-noPag&#39;&#34;&gt; &lt;el-table v-bind=&#34;$attrs&#34; :data=&#34;tableData&#34; :row-key=&#34;rowKey&#34; :key=&#34;toggleIndex&#34; ref=&#34;scTable&#34; height=&#34;100%&#34; @sort-change=&#34;sortChange&#34; @filter-change=&#34;filterChange&#34; &gt; &lt;slot&gt;&lt;/slot&gt; &lt;template v-for=&#34;(item, index) in userColumn&#34; :key=&#34;index&#34;&gt; &lt;el-table-column v-if=&#34;!item.hide&#34; :column-key=&#34;item.prop&#34; :label=&#34;item.label&#34; :prop=&#34;item.prop&#34; :width=&#34;item.width&#34; :sortable=&#34;item.sortable&#34; :fixed=&#34;item.fixed&#34; :filters=&#34;item.filters&#34; :filter-method=&#34;remoteFilter || !item.filters ? null : filterHandler&#34; &gt; &lt;template #default=&#34;scope&#34;&gt; &lt;slot :name=&#34;item.prop&#34; v-bind=&#34;scope&#34;&gt; {{ scope.row[item.prop] }} &lt;/slot&gt; &lt;/template&gt; &lt;/el-table-column&gt; &lt;/template&gt; &lt;el-table-column min-width=&#34;1&#34;&gt;&lt;/el-table-column&gt; &lt;template #empty&gt; &lt;el-empty :description=&#34;emptyText&#34; :image-size=&#34;80&#34;&gt;&lt;/el-empty&gt; &lt;/template&gt; &lt;/el-table&gt; &lt;/div&gt; &lt;div class=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/b13c4027424635a5e7a88086dcca3284/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-22T16:51:49+08:00" />
<meta property="article:modified_time" content="2022-03-22T16:51:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vue3封装table组件 element Plus</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <pre><code>&lt;template&gt;
  &lt;div class="scTable" ref="scTableMain" :style="{ height: theight }" v-loading="loading"&gt;
    &lt;div :class="!hideDo ? 'scTable-table' : 'scTable-table-noPag'"&gt;
      &lt;el-table
        v-bind="$attrs"
        :data="tableData"
        :row-key="rowKey"
        :key="toggleIndex"
        ref="scTable"
        height="100%"
        @sort-change="sortChange"
        @filter-change="filterChange"
      &gt;
        &lt;slot&gt;&lt;/slot&gt;
        &lt;template v-for="(item, index) in userColumn" :key="index"&gt;
          &lt;el-table-column
            v-if="!item.hide"
            :column-key="item.prop"
            :label="item.label"
            :prop="item.prop"
            :width="item.width"
            :sortable="item.sortable"
            :fixed="item.fixed"
            :filters="item.filters"
            :filter-method="remoteFilter || !item.filters ? null : filterHandler"
          &gt;
            &lt;template #default="scope"&gt;
              &lt;slot :name="item.prop" v-bind="scope"&gt;
                {<!-- -->{ scope.row[item.prop] }}
              &lt;/slot&gt;
            &lt;/template&gt;
          &lt;/el-table-column&gt;
        &lt;/template&gt;
        &lt;el-table-column min-width="1"&gt;&lt;/el-table-column&gt;
        &lt;template #empty&gt;
          &lt;el-empty :description="emptyText" :image-size="80"&gt;&lt;/el-empty&gt;
        &lt;/template&gt;
      &lt;/el-table&gt;
    &lt;/div&gt;
    &lt;div class="scTable-page" v-if="!hidePagination &amp;&amp; !hideDo"&gt;
      &lt;div class="scTable-pagination"&gt;
        &lt;el-pagination
          v-if="!hidePagination"
          background
          :small="true"
          :layout="paginationLayout"
          :total="total"
          :page-size="pageSize"
          :pager-count="pagerCount"
          v-model:currentPage="currentPage"
          @current-change="paginationChange"
        &gt;&lt;/el-pagination&gt;
      &lt;/div&gt;
      &lt;div class="scTable-do" v-if="!hiderefresh"&gt;
        &lt;el-button
          @click="refresh"
          icon="el-icon-refresh"
          circle
          style="margin-left: 15px"
        &gt;&lt;/el-button&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import { reactive, watch, onMounted, ref, toRefs, getCurrentInstance, computed } from 'vue'
import config from '@/config/table'

export default {
  name: 'scTable',
  props: {
    tableName: { type: String, default: '' },
    apiObj: { type: Object, default: () =&gt; {} },
    params: { type: Object, default: () =&gt; ({}) },
    data: { type: Object, default: () =&gt; {} },
    height: { type: [String, Number], default: '100%' },
    rowKey: { type: String, default: '' },
    column: { type: Object, default: () =&gt; {} },
    hideDo: { type: Boolean, default: false }, // 是否显示分页
    pagerCount: { type: Number, default: 7 }, // 是否显示分页
    hiderefresh: { type: Boolean, default: false }, // 是否显示刷新
    remoteSort: { type: Boolean, default: false },
    remoteFilter: { type: Boolean, default: false },
    hidePagination: { type: Boolean, default: false },
    paginationLayout: { type: String, default: 'total, prev, pager, next, jumper' }
  },

  setup(props) {
    const { proxy } = getCurrentInstance()
    const scTable = ref(null)
    const scTableMain = ref(null)
    const state = reactive({
      emptyText: '暂无数据',
      toggleIndex: 0,
      tableData: [],
      pageSize: config.pageSize,
      total: 0,
      currentPage: 1,
      prop: null,
      order: null,
      loading: false,
      tableHeight: '100%',
      tableParams: props.params,
      userColumn: []
    })
    // 计算高度
    const theight = computed(() =&gt; {
      return Number(props.height) ? `${Number(props.height)}px` : props.height
    })
    // 监听响应式对象
    watch(
      () =&gt; [props.data, props.apiObj],
      ([newdataValue, newapiObjValue], [olddataValue, oldapiObjValue]) =&gt; {
        // 判断是不是newdataValue发生的变化
        if (olddataValue !== newdataValue) {
          if (props.data != undefined) {
            state.tableData = props.data
            state.total = state.tableData.length
          }
        }
        // 判断是不是oldapiObjValue发生的变化
        if (oldapiObjValue !== newapiObjValue) {
          state.tableParams = props.params
          refresh()
        }
      }
    )
    onMounted(() =&gt; {
      state.userColumn = props.column

      // 判断是否静态数据
      if (props.apiObj) {
        getData()
      } else if (props.data) {
        state.tableData = props.data
        state.total = state.tableData.length
      }
    })

    // 获取数据
    const getData = async () =&gt; {
      state.loading = true

      const reqData = {
        [config.request.page]: state.currentPage,
        [config.request.pageSize]: state.pageSize
      }
      if (props.hidePagination) {
        delete reqData[config.request.page]
        delete reqData[config.request.pageSize]
      }
      Object.assign(reqData, state.tableParams)
      try {
        var res = await props.apiObj.get(reqData)
      } catch (error) {
        console.log(error)
        state.loading = false
        state.emptyText = error.statusText
        return false
      }
      if (res.code != 200) {
        state.loading = false
        state.emptyText = res.msg
      } else {
        state.emptyText = '暂无数据'
        if (res.data) {
          state.tableData = res.data.list
          state.total = res.data.total
        } else {
          state.tableData = []
          state.total = 0
        }
        state.loading = false
      }
      scTable.value.$el.querySelector('.el-table__body-wrapper').scrollTop = 0
    }
    // 分页点击
    const paginationChange = () =&gt; {
      getData()
    }
    // 刷新数据
    const refresh = () =&gt; {
      scTable.value.clearSelection()
      getData()
    }
    // 更新数据 合并上一次params
    const upData = (params, page = 1) =&gt; {
      state.currentPage = page
      scTable.value.clearSelection()
      Object.assign(state.tableParams, params || {})
      getData()
    }
    // 清空数据data
    const clearData = () =&gt; {
      state.tableData = []
    }
    // 重载数据 替换params
    const reload = (params, page = 1) =&gt; {
      state.currentPage = page
      state.tableParams = params || {}
      scTable.value.clearSelection()
      scTable.value.clearSort()
      scTable.value.clearFilter()
      getData()
    }
    // 排序事件
    const sortChange = (obj) =&gt; {
      if (!props.remoteSort) {
        return false
      }
      if (obj.column &amp;&amp; obj.prop) {
        state.prop = obj.prop
        state.order = obj.order
      } else {
        state.prop = null
        state.order = null
      }
      getData()
    }
    // 本地过滤
    const filterHandler = (value, row, column) =&gt; {
      const property = column.property
      return row[property] === value
    }
    // 过滤事件
    const filterChange = (filters) =&gt; {
      if (!props.remoteFilter) {
        return false
      }
      Object.keys(filters).forEach((key) =&gt; {
        filters[key] = filters[key].join(',')
      })
      upData(filters)
    }
    // 原生方法转发
    const clearSelection = () =&gt; {
      scTable.value.clearSelection()
    }
    const toggleRowSelection = (row, selected) =&gt; {
      scTable.value.toggleRowSelection(row, selected)
    }
    const toggleAllSelection = () =&gt; {
      scTable.value.toggleAllSelection()
    }
    const toggleRowExpansion = (row, expanded) =&gt; {
      scTable.value.toggleRowExpansion(row, expanded)
    }
    const setCurrentRow = (row) =&gt; {
      scTable.value.setCurrentRow(row)
    }
    const clearSort = () =&gt; {
      scTable.value.clearSort()
    }
    const clearFilter = (columnKey) =&gt; {
      scTable.value.clearFilter(columnKey)
    }
    const doLayout = () =&gt; {
      scTable.value.doLayout()
    }
    const sort = (prop, order) =&gt; {
      scTable.value.sort(prop, order)
    }
    return {
      ...toRefs(state),
      scTable,
      scTableMain,
      getData,
      paginationChange,
      refresh,
      upData,
      reload,
      sortChange,
      filterHandler,
      filterChange,
      clearSelection,
      toggleRowSelection,
      toggleAllSelection,
      toggleRowExpansion,
      setCurrentRow,
      clearSort,
      clearFilter,
      doLayout,
      sort,
      clearData,
      theight
    }
  }
}
&lt;/script&gt;

&lt;style scoped&gt;
.scTable {
}
.scTable-table {
  height: calc(100% - 50px);
}
.scTable-table-noPag {
  height: 100%;
}
.scTable-page {
  height: 50px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 15px;
}
.scTable-do {
  white-space: nowrap;
}
&lt;/style&gt;
</code></pre> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ab98d859e2f07f112b4ba1e0cbcab8db/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">趋势线公式公式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/92bebfa7e856a815ea82b325959b1308/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">浪漫星空python</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>