<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>​利用Azure Migrate完成华为云虚拟机迁移至Azure步骤 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="​利用Azure Migrate完成华为云虚拟机迁移至Azure步骤" />
<meta property="og:description" content="项目背景 因某某企业内部需求，需将华为云上的Linux机器迁移至Azure。
架构如下： 先决条件 在进行试验之前，请确保满足这些先决条件 在其他云上所需要迁移的虚拟机和安装Azure Migrate设备的虚拟机必须在同一网段，保证相互通信，相互将使用内网传输。以托管复制设备。 此实例必须正在运行 Windows Server 2012 R2 或 Windows Server 2016。 查看设备的硬件、软件和网络要求VM 在端口 HTTPS 443（控制通道业务流程）和 TCP 9443（数据传输）上与复制设备进行入站通信，从而管理复制和传输复制数据。 然后，复制设备会通过端口 HTTPS 443 出站来协调复制数据并将该数据发送到 Azure。 若要配置这些规则，请编辑安全组入站/出站规则，在其中加入相应的端口和源 IP 信息 要求
详细信息
设备
需要一台服务器来运行 Azure Migrate 设备。 服务器应拥有：
- 已安装 Windows Server 2016。
（目前只有 Windows Server 2016 支持设备部署。）
- 16 GB RAM，8 个 vCPU，约 80 GB 磁盘存储
- 静态或动态 IP 地址，可直接访问或通过代理访问 Internet。
- 从设备到所需 URL的出站 Internet 连接。
Windows 服务器" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/e5e8a4b08096440544a23b594fb19dab/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-31T14:43:38+08:00" />
<meta property="article:modified_time" content="2022-08-31T14:43:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">​利用Azure Migrate完成华为云虚拟机迁移至Azure步骤</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>项目背景</h3> 
<p>因某某企业内部需求，需将华为云上的Linux机器迁移至Azure。</p> 
<p></p> 
<p>架构如下： </p> 
<p><img alt="" height="506" src="https://images2.imgbox.com/0e/45/jFi10Ju3_o.png" width="1200"></p> 
<p> </p> 
<h3>先决条件</h3> 
<h4>在进行试验之前，请确保满足这些先决条件</h4> 
<ul><li>在其他云上所需要迁移的虚拟机和安装Azure Migrate设备的虚拟机必须在同一网段，保证相互通信，相互将使用内网传输。</li><li>以托管复制设备。 此实例必须正在运行 Windows Server 2012 R2 或 Windows Server 2016。 查看设备的硬件、软件和网络要求</li><li>VM 在端口 HTTPS 443（控制通道业务流程）和 TCP 9443（数据传输）上与复制设备进行入站通信，从而管理复制和传输复制数据。 然后，复制设备会通过端口 HTTPS 443 出站来协调复制数据并将该数据发送到 Azure。 若要配置这些规则，请编辑安全组入站/出站规则，在其中加入相应的端口和源 IP 信息</li></ul> 
<table><tbody><tr><td> <p>要求</p> </td><td> <p>详细信息</p> </td></tr><tr><td> <p>设备</p> </td><td> <p>需要一台服务器来运行 Azure Migrate 设备。 服务器应拥有：</p> <p>- 已安装 Windows Server 2016。</p> <p>（目前只有 Windows Server 2016 支持设备部署。）</p> <p>- 16 GB RAM，8 个 vCPU，约 80 GB 磁盘存储</p> <p>- 静态或动态 IP 地址，可直接访问或通过代理访问 Internet。</p> <p>- 从设备到所需 <a href="https://docs.microsoft.com/zh-cn/azure/migrate/migrate-appliance#url-access" rel="nofollow" title="URL">URL</a>的出站 Internet 连接。</p> </td></tr><tr><td> <p>Windows 服务器</p> </td><td> <p>允许在 WinRM 端口 5985 (HTTP) 上进行入站连接，以便发现 Windows 服务器。</p> </td></tr><tr><td> <p>Linux 服务器</p> </td><td> <p>允许在端口 22 (TCP) 上进行入站连接，以便发现 Linux 服务器。</p> </td></tr></tbody></table> 
<h3>一、创建实验环境</h3> 
<p>1、在华为云上面创建一台本地需迁移的虚拟机服务器</p> 
<p><img alt="" height="631" src="https://images2.imgbox.com/70/f1/2aGo9Peo_o.png" width="1200"></p> 
<p></p> 
<p> 2、于是测试我们先给需要迁移的机器先安装一些服务（以便后期检测）搭建Apache服务、再搭建一台数据库存放一些数据</p> 
<p></p> 
<p><img alt="" height="747" src="https://images2.imgbox.com/04/d8/XiewwaGk_o.png" width="479"></p> 
<p> <img alt="" height="405" src="https://images2.imgbox.com/90/06/JGrP5qo5_o.png" width="672"><img alt="" height="223" src="https://images2.imgbox.com/d0/74/l33M1VNY_o.png" width="831"> 3、在华为云上再创建一台镜像为Windows 2016 数据中心 英文版的虚拟机，需要作为与Azure虚拟机进行迁移的数据传输（中转迁移服务器）</p> 
<p><img alt="" height="810" src="https://images2.imgbox.com/b4/69/DiDcXUi5_o.png" width="1200">4、通过远程链接“中转迁移服务器”<img alt="" height="368" src="https://images2.imgbox.com/0f/0f/cvCBoCjv_o.png" width="604"></p> 
<p></p> 
<h3>二、在中转迁移服务器中安装移动服务代理</h3> 
<p>  登录Azure的portal，找到Azure Migrate服务，先创建项目<img alt="" height="900" src="https://images2.imgbox.com/d4/bd/L0J8jTDd_o.png" width="1164"></p> 
<h4>步骤一</h4> 
<blockquote> 
 <p>在评估工具中，</p> 
 <p>1.是否已虚拟化你的计算机中首先 选择物理或其他（AWS、GCP、Xen等）</p> 
 <p>2.选择目标区域（根据个人）</p> 
 <p>3.创建资源—下一步</p> 
 <p>4.为设备命名-&gt;生成项目密钥（用于后续导入到代理移动软件中）</p> 
 <p>5.在生成项目密钥后，下载包含 PowerShell 脚本的 zip 文件(.zip)——安装在中转迁移服务器（用于后续忘记密码时运行此脚本）</p> 
</blockquote> 
<p> <img alt="" height="251" src="https://images2.imgbox.com/da/59/wNsulzbU_o.png" width="554"><img alt="" height="685" src="https://images2.imgbox.com/75/64/DjCIxOlu_o.png" width="1200"></p> 
<p></p> 
<h4>步骤二</h4> 
<blockquote> 
 <p>在迁移工具中</p> 
 <p>1.下载安装复制设备软件（用于代理迁移数据的软件）</p> 
 <p>2.下载注册密钥文件（后续安装复制设备软件中需要导入）</p> 
 <p></p> 
</blockquote> 
<h3><img alt="" height="702" src="https://images2.imgbox.com/ef/11/i3dGPZqS_o.png" width="1110"></h3> 
<h3>三、在中转迁移服务器中做迁移准备工作</h3> 
<h4>步骤一</h4> 
<p></p> 
<p>将所需要的文件通过xftp或其他软件导入至 中转服务器（Windows Server 2016 - 16 GB RAM，8 个 vCPU，约 80 GB 磁盘存储）</p> 
<p><img alt="" height="531" src="https://images2.imgbox.com/f0/08/TPzud5nB_o.png" width="448"></p> 
<p></p> 
<h4>步骤二</h4> 
<p>​我们先安装复制设备软件</p> 
<p>1、<img alt="" height="684" src="https://images2.imgbox.com/46/27/RtDCMzzV_o.png" width="1106"></p> 
<p>在“准备工作”下选择“安装配置服务器和进程服务器”，然后选择“下一步”。</p> 
<p>在“第三方软件许可证”中选择“我接受第三方许可协议”，然后选择“下一步”。</p> 
<p></p> 
<p> 2、</p> 
<p><img alt="" height="688" src="https://images2.imgbox.com/01/9e/ZadWtoBR_o.png" width="1100"></p> 
<p>在“注册”中选择“浏览”，然后转到保管库注册密钥文件所在的位置。 选择“下一步”。</p> 
<p></p> 
<p>3、 </p> 
<p><img alt="" height="685" src="https://images2.imgbox.com/8a/a3/rpNa1noh_o.png" width="1095"></p> 
<p>在“Internet 设置”中选择“在不使用代理服务器的情况下连接到 Azure Site Recovery”，然后选择“下一步”。 </p> 
<p></p> 
<p>4、</p> 
<p><img alt="" height="684" src="https://images2.imgbox.com/dc/19/LPlPHy3X_o.png" width="1098"></p> 
<p><img alt="" height="681" src="https://images2.imgbox.com/23/18/TMYRbAvE_o.png" width="1100"></p> 
<p> “先决条件检查”页运行多个项的检查。 完成后，选择“下一步”。</p> 
<p></p> 
<p>6、</p> 
<p><img alt="" height="686" src="https://images2.imgbox.com/69/88/PQ8PtjQi_o.png" width="1103"></p> 
<p>在“环境详细信息”中选择“否”。 无需保护 VM。 然后，选择“下一步”。 </p> 
<p></p> 
<p>7、</p> 
<p><img alt="" height="680" src="https://images2.imgbox.com/6e/52/20uQ29Q5_o.png" width="1103"></p> 
<p> 在“安装位置”中选择“下一步”，接受默认值。</p> 
<p></p> 
<p>8、</p> 
<p> <img alt="" height="688" src="https://images2.imgbox.com/9b/c2/uKRe7Rsd_o.png" width="1101"></p> 
<p> 在“网络选择”中选择“下一步”，接受默认值。</p> 
<p></p> 
<p>9、</p> 
<p><img alt="" height="683" src="https://images2.imgbox.com/40/02/JXYxu4sT_o.png" width="1104"></p> 
<p>在“摘要”中选择“安装” 。 </p> 
<p></p> 
<p>10、</p> 
<p><img alt="" height="684" src="https://images2.imgbox.com/6b/ad/CIy73ApY_o.png" width="1100">“安装进度”显示有关安装过程的信息。 完成后，选择“完成”。 此时会出现一个显示重启消息的窗口。 选择“确定” 。</p> 
<p></p> 
<p>11、</p> 
<p> <img alt="" height="600" src="https://images2.imgbox.com/62/6c/0EdeiKcs_o.png" width="761"></p> 
<p> 接下来会出现一个窗口，显示有关配置服务器连接通行短语的消息。 将通行短语复制到剪贴板，并将它保存在源 VM 上的临时文本文件中。 在<span style="color:#fe2c24;">稍后的移动服务安装过程中，需要用到此通行短语</span>。</p> 
<p><img alt="" height="591" src="https://images2.imgbox.com/ab/a2/wbprzCvW_o.png" width="748">安装完成后，设备配置向导将自动启动（也可使用在设备的桌面上创建的 cspsconfigtool 快捷方式手动启动该向导）。 在本教程中，我们将在要复制的源 VM 上手动安装移动服务，因此请在此步骤中创建一个虚拟帐户，然后继续。</p> 
<p></p> 
<p>12、</p> 
<p><img alt="" height="137" src="https://images2.imgbox.com/4e/69/BqfxJEBj_o.png" width="708">设备已安装并重启后，在“发现计算机”中的“选择配置服务器”内选择新设备，然后单击“完成注册”。 “完成注册”步骤会执行最终的几个任务来准备复制设备。</p> 
<p></p> 
<h4>步骤三</h4> 
<blockquote> 
 <h4>安装移动服务</h4> 
 <p>必须在要迁移的源 VM 上安装移动服务代理。 复制设备上已提供代理安装程序。 请找到适当的安装程序，并在要迁移的每台计算机上安装该代理。 请按如下所述执行此操作：</p> 
 <ol><li>登录到复制设备。</li><li>代理安装：复制机器导航到 %ProgramData%\ASR\home\svsystems\pushinstallsvc\repository 找到适用于源 VM 操作系统和版本的安装程序复制到要迁移的源VM中</li></ol> 
 <p>——我们实验用到的是Microsoft-ASR_UA_9.50.0.0_RHEL7-64_GA_30Jul2022_Release.tar.gz ——</p> 
 <ol><li>请确保具有在安装复制设备时创建且已保存的通行短语文本文件</li></ol> 
 <p>：在迁移机器中自己创建一个文件将通行短语密码写入进去.</p> 
 <p>密码忘了就在复制复制机器上使用：如果忘记保存通行短语，可通过此步骤复制设备上查看通行短语。 在命令行中，运行脚本命令 C:\ProgramData\ASR\home\svsystems\bin\genpassphrase.exe -v 查看当前的通行短语。现在，将该通行短语复制到剪贴板，并将其保存在源 VM 上的临时文本文件中。</p> 
 <p><img alt="" height="500" src="https://images2.imgbox.com/60/4f/leh6K8ns_o.png" width="898"></p> 
 <p></p> 
</blockquote> 
<h4> Linux  VM 安装代理指南</h4> 
<ol><li>将安装程序 tarball 的内容提取到 需迁移 VM 上的本地文件夹（例如 /tmp/MobSvcInstaller），如下所示： <pre><code>mkdir /tmp/MobSvcInstaller
tar -C /tmp/MobSvcInstaller -xvf &lt;Installer tarball&gt;
cd /tmp/MobSvcInstaller</code></pre> </li><li>解压安装我们传过去适用于源 VM 操作系统和版本的安装程序脚本： <pre><code>./install -r MS -q #安装代理</code></pre> </li><li>将代理注册到复制设备： <pre><code>/usr/local/ASR/Vx/bin/UnifiedAgentConfigurator.sh -i &lt;replication appliance IP address&gt; -P &lt;Passphrase File Path&gt; 
#向复制机器注册代理 </code></pre> <p></p> </li></ol> 
<p>流程图： </p> 
<p><img alt="" height="293" src="https://images2.imgbox.com/cf/a6/KXgwrx6B_o.png" width="821">传适用于源 VM 操作系统和版本的安装程序安装包</p> 
<p></p> 
<p><img alt="" height="95" src="https://images2.imgbox.com/96/8b/VppI9qJH_o.png" width="683">接收到文件</p> 
<p></p> 
<p><img alt="" height="364" src="https://images2.imgbox.com/81/fd/Nn144N4Y_o.png" width="1031">解压安装包安装代理软件</p> 
<p></p> 
<p><img alt="" height="227" src="https://images2.imgbox.com/e5/4b/sQAF6SE1_o.png" width="1145"></p> 
<p><img alt="" height="282" src="https://images2.imgbox.com/79/af/Iw1euWP6_o.png" width="1200"></p> 
<p> 向复制机器注册代理<span style="color:#fe2c24;">（圈红框的返回值：0为注册成功-其余都是不成功)</span></p> 
<p></p> 
<h4>四、复制Linux机器并验证数据是否完整</h4> 
<p>为  VM 启用复制</p> 
<p>1、首先发现我们的机器</p> 
<p><img alt="" height="564" src="https://images2.imgbox.com/21/ac/0mU2bE9E_o.png" width="1006"></p> 
<p></p> 
<p>2、复制发现的机器 </p> 
<p><img alt="" height="765" src="https://images2.imgbox.com/7a/d7/uLbs7snV_o.png" width="788"></p> 
<p></p> 
<p>3、配置相关信息</p> 
<p><img alt="" height="398" src="https://images2.imgbox.com/62/30/7P7FDdYT_o.png" width="715"><img alt="" height="727" src="https://images2.imgbox.com/b8/fa/FYtRbagl_o.png" width="1085"><img alt="" height="617" src="https://images2.imgbox.com/ce/a4/DeOxQWs5_o.png" width="788"></p> 
<p></p> 
<p><img alt="" height="463" src="https://images2.imgbox.com/fb/21/UAIWUKcu_o.png" width="1200"></p> 
<p></p> 
<p> 4、等待同步<img alt="" height="775" src="https://images2.imgbox.com/c3/53/SDRqbpAX_o.png" width="1200"></p> 
<p> 同步信息完成<img alt="" height="592" src="https://images2.imgbox.com/35/50/uAEBYdXf_o.png" width="1200"></p> 
<p></p> 
<p>5、开始迁移                                          </p> 
<p><img alt="" height="386" src="https://images2.imgbox.com/fd/7b/ek9vRaS7_o.png" width="823"></p> 
<p><img alt="" height="449" src="https://images2.imgbox.com/09/5e/4q5BcMKA_o.png" width="1200"><img alt="" height="456" src="https://images2.imgbox.com/be/0c/wPKzNSIO_o.png" width="1200"></p> 
<p></p> 
<p>6、迁移完成</p> 
<p><img alt="" height="402" src="https://images2.imgbox.com/7f/45/yRkhBhQy_o.png" width="1200"></p> 
<p></p> 
<p>7、验证迁移机器数据是否完整 </p> 
<p><img alt="" height="566" src="https://images2.imgbox.com/04/d6/eorCA7gg_o.png" width="960"></p> 
<p><img alt="" height="669" src="https://images2.imgbox.com/3f/31/OgPS3oZA_o.png" width="1200"></p> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8f5bfbdb1a1209a9d66ef565e1dcda7f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">《算法导论》学习（四）---- 矩阵乘法的Strassen（斯特拉森）算法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2c782ae0b337843139c5f75b8a412d7a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">centos7 二进制安装MySQL8（精简版）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>