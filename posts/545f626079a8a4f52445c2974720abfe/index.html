<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【C&#43;&#43;】模板进阶 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【C&#43;&#43;】模板进阶" />
<meta property="og:description" content="目录 1.非类型模板参数2.模板的特化2.1概念2.2 函数模板特化2.3 类模板特化2.3.1 全特化2.3.2 偏特化2.3.3 应用 3.模板分离编译4.模板总结 1.非类型模板参数 模板参数可分为类型形参和非类型形参
类型形参：出现在模板参数列表中，跟在class或者typename之类的参数类型名称。
非类型形参：就是用一个常量作为类(函数)模板的一个参数，在类(函数)模板中可将该参数当成常量来使用。
C&#43;&#43;中的array就是利用非类型模板参数来实现的，类似于C语言中的静态数组。array会对越界访问进行检查，比静态数组更严格。
template&lt;class T, size_t N = 10&gt; class Array { public: T&amp; operator[](size_t index) { return _array[index]; } const T&amp; operator[](size_t index)const { return _array[index]; } size_t size()const { return _size; } bool empty()const { return 0 == _size; } private: T _array[N]; size_t _size; }; 2.模板的特化 2.1概念 通常情况下，使用模板可以实现一些与类型无关的代码，但对于一些特殊类型的可能会得到一些错误的结果，需要特殊处理，比如：实现了一个专门用来进行小于比较的函数模板。
template&lt;class T&gt; bool Less(T left, T right) { return left &lt; right; } int main() { cout &lt;&lt; Less(1, 2) &lt;&lt; endl; // 可以比较，结果正确 Date d1(2022, 7, 7); Date d2(2022, 7, 8); cout &lt;&lt; Less(d1, d2) &lt;&lt; endl; // 可以比较，结果正确 Date* p1 = &amp;d1; Date* p2 = &amp;d2; cout &lt;&lt; Less(p1, p2) &lt;&lt; endl; // 可以比较，结果错误 return 0; } 可以看到，Less绝对多数情况下都可以正常比较，但是在特殊场景下就得到错误的结果。上述示例中，p1指向的d1显然小于p2指向的d2对象，但是Less内部并没有比较p1和p2指向的对象内容，而比较的是p1和p2指" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/545f626079a8a4f52445c2974720abfe/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-30T14:48:29+08:00" />
<meta property="article:modified_time" content="2023-06-30T14:48:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【C&#43;&#43;】模板进阶</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#1_1" rel="nofollow">1.非类型模板参数</a></li><li><a href="#2_33" rel="nofollow">2.模板的特化</a></li><li><ul><li><a href="#21_34" rel="nofollow">2.1概念</a></li><li><a href="#22__61" rel="nofollow">2.2 函数模板特化</a></li><li><a href="#23__91" rel="nofollow">2.3 类模板特化</a></li><li><ul><li><a href="#231__92" rel="nofollow">2.3.1 全特化</a></li><li><a href="#232__122" rel="nofollow">2.3.2 偏特化</a></li><li><a href="#233__195" rel="nofollow">2.3.3 应用</a></li></ul> 
  </li></ul> 
  </li><li><a href="#3_242" rel="nofollow">3.模板分离编译</a></li><li><a href="#4_280" rel="nofollow">4.模板总结</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1_1"></a>1.非类型模板参数</h2> 
<p>模板参数可分为类型形参和非类型形参<br> 类型形参：出现在模板参数列表中，跟在class或者typename之类的参数类型名称。<br> 非类型形参：就是用一个常量作为类(函数)模板的一个参数，在类(函数)模板中可将该参数当成常量来使用。<br> C++中的array就是利用非类型模板参数来实现的，类似于C语言中的静态数组。array会对越界访问进行检查，比静态数组更严格。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> size_t N <span class="token operator">=</span> <span class="token number">10</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">Array</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	T<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>size_t index<span class="token punctuation">)</span> 
	<span class="token punctuation">{<!-- --></span> 
		<span class="token keyword">return</span> _array<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span> 
	<span class="token punctuation">}</span>
	<span class="token keyword">const</span> T<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>size_t index<span class="token punctuation">)</span><span class="token keyword">const</span> 
	<span class="token punctuation">{<!-- --></span> 
		<span class="token keyword">return</span> _array<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span> 
	<span class="token punctuation">}</span>
	size_t <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span> 
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> _size<span class="token punctuation">;</span> 
	<span class="token punctuation">}</span>
	<span class="token keyword">bool</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span> 
	<span class="token punctuation">{<!-- --></span> 
		<span class="token keyword">return</span> <span class="token number">0</span> <span class="token operator">==</span> _size<span class="token punctuation">;</span> 
	<span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	T _array<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>
	size_t _size<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="2_33"></a>2.模板的特化</h2> 
<h3><a id="21_34"></a>2.1概念</h3> 
<p>通常情况下，使用模板可以实现一些与类型无关的代码，但对于一些特殊类型的可能会得到一些错误的结果，需要特殊处理，比如：实现了一个专门用来进行小于比较的函数模板。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">bool</span> <span class="token function">Less</span><span class="token punctuation">(</span>T left<span class="token punctuation">,</span> T right<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> left <span class="token operator">&lt;</span> right<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token function">Less</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token comment">// 可以比较，结果正确</span>

	Date <span class="token function">d1</span><span class="token punctuation">(</span><span class="token number">2022</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Date <span class="token function">d2</span><span class="token punctuation">(</span><span class="token number">2022</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token function">Less</span><span class="token punctuation">(</span>d1<span class="token punctuation">,</span> d2<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token comment">// 可以比较，结果正确</span>

	Date<span class="token operator">*</span> p1 <span class="token operator">=</span> <span class="token operator">&amp;</span>d1<span class="token punctuation">;</span>
	Date<span class="token operator">*</span> p2 <span class="token operator">=</span> <span class="token operator">&amp;</span>d2<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token function">Less</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token comment">// 可以比较，结果错误</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>可以看到，Less绝对多数情况下都可以正常比较，但是在特殊场景下就得到错误的结果。上述示例中，p1指向的d1显然小于p2指向的d2对象，但是Less内部并没有比较p1和p2指向的对象内容，而比较的是p1和p2指<br> 针的地址，这就无法达到预期而错误。<br> 此时，就需要对模板进行特化。即：在原模板类的基础上，针对特殊类型所进行特殊化的实现方式。模板特化中分为函数模板特化与类模板特化。</p> 
<h3><a id="22__61"></a>2.2 函数模板特化</h3> 
<p>函数模板的特化步骤：</p> 
<ol><li>必须要先有一个基础的函数模板</li><li>关键字template后面接一对空的尖括号&lt;&gt;</li><li>函数名后跟一对尖括号，尖括号中指定需要特化的类型</li><li>函数形参表: 必须要和模板函数的基础参数类型完全相同，如果不同编译器可能会报一些奇怪的错误。</li></ol> 
<pre><code class="prism language-cpp"><span class="token comment">// 函数模板 -- 参数匹配</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">bool</span> <span class="token function">Less</span><span class="token punctuation">(</span>T left<span class="token punctuation">,</span> T right<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">return</span> left <span class="token operator">&lt;</span> right<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 对Less函数模板进行特化</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span>
<span class="token keyword">bool</span> <span class="token generic-function"><span class="token function">Less</span><span class="token generic class-name"><span class="token operator">&lt;</span>Date<span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>Date<span class="token operator">*</span> left<span class="token punctuation">,</span> Date<span class="token operator">*</span> right<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token operator">*</span>left <span class="token operator">&lt;</span> <span class="token operator">*</span>right<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>不过一般情况下如果函数模板遇到不能处理或者处理有误的类型，为了实现简单通常都是将该函数直接给出。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">bool</span> <span class="token function">Less</span><span class="token punctuation">(</span>Date<span class="token operator">*</span> left<span class="token punctuation">,</span> Date<span class="token operator">*</span> right<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token operator">*</span>left <span class="token operator">&lt;</span> <span class="token operator">*</span>right<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>该种实现简单明了，代码的可读性高，容易书写，因为对于一些参数类型复杂的函数模板，特化时特别给出，因此函数模板不建议特化。</p> 
<h3><a id="23__91"></a>2.3 类模板特化</h3> 
<h4><a id="231__92"></a>2.3.1 全特化</h4> 
<p>全特化即是将模板参数列表中所有的参数都确定化。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T1</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">T2</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">Data</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">Data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Data&lt;T1, T2&gt;"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	T1 _d1<span class="token punctuation">;</span>
	T2 _d2<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 全特化</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">Data</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">&gt;</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">Data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Data&lt;int, char&gt;"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">int</span> _d1<span class="token punctuation">;</span>
	<span class="token keyword">char</span> _d2<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TestVector</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	Data<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;</span> d1<span class="token punctuation">;</span>
	Data<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">&gt;</span> d2<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="232__122"></a>2.3.2 偏特化</h4> 
<p>部分特化：将模板参数类表中的一部分参数特化。</p> 
<pre><code class="prism language-cpp"><span class="token comment">// 将第二个参数特化为int</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T1</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">Data</span><span class="token operator">&lt;</span>T1<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">Data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"Data&lt;T1, int&gt;"</span> <span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	T1 _d1<span class="token punctuation">;</span>
	<span class="token keyword">int</span> _d2<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>参数更进一步的限制：偏特化并不仅仅是指特化部分参数，而是针对模板参数更进一步的条件限制所设计出来的一个特化版本。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T1</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">T2</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">Data</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">Data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Data&lt;T1, T2&gt;"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	T1 _d1<span class="token punctuation">;</span>
	T2 _d2<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 将第二个参数特化为int</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T1</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">Data</span><span class="token operator">&lt;</span>T1<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">Data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Data&lt;T1, int&gt;"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	T1 _d1<span class="token punctuation">;</span>
	<span class="token keyword">int</span> _d2<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//两个参数偏特化为指针类型</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T1</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">T2</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">Data</span> <span class="token operator">&lt;</span>T1<span class="token operator">*</span><span class="token punctuation">,</span> T2<span class="token operator">*</span><span class="token operator">&gt;</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">Data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Data&lt;T1*, T2*&gt;"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	T1 _d1<span class="token punctuation">;</span>
	T2 _d2<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//两个参数偏特化为引用类型</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T1</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">T2</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">Data</span> <span class="token operator">&lt;</span>T1<span class="token operator">&amp;</span><span class="token punctuation">,</span> T2<span class="token operator">&amp;</span><span class="token operator">&gt;</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">Data</span><span class="token punctuation">(</span><span class="token keyword">const</span> T1<span class="token operator">&amp;</span> d1<span class="token punctuation">,</span> <span class="token keyword">const</span> T2<span class="token operator">&amp;</span> d2<span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">_d1</span><span class="token punctuation">(</span>d1<span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_d2</span><span class="token punctuation">(</span>d2<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Data&lt;T1&amp;, T2&amp;&gt;"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">const</span> T1<span class="token operator">&amp;</span> _d1<span class="token punctuation">;</span>
	<span class="token keyword">const</span> T2<span class="token operator">&amp;</span> _d2<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	Data<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;</span> d1<span class="token punctuation">;</span> <span class="token comment">// 调用特化的int版本</span>
	Data<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">&gt;</span> d2<span class="token punctuation">;</span> <span class="token comment">// 调用基础的模板</span>
	<span class="token comment">// 编译器会优先调用现成的模板，实在没有编译器才会自己推演实例化。</span>
	Data<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">*</span><span class="token operator">&gt;</span> d3<span class="token punctuation">;</span> <span class="token comment">// 调用特化的指针版本</span>
	Data<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&amp;</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&amp;</span><span class="token operator">&gt;</span> <span class="token function">d4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用特化的指针版本</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="233__195"></a>2.3.3 应用</h4> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">Less</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> x<span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">&amp;</span> y<span class="token punctuation">)</span> <span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> x <span class="token operator">&lt;</span> y<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	Date <span class="token function">d1</span><span class="token punctuation">(</span><span class="token number">2022</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Date <span class="token function">d2</span><span class="token punctuation">(</span><span class="token number">2022</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Date <span class="token function">d3</span><span class="token punctuation">(</span><span class="token number">2022</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	vector<span class="token operator">&lt;</span>Date<span class="token operator">&gt;</span> v1<span class="token punctuation">;</span>
	v1<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>d1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	v1<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>d2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	v1<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>d3<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 可以直接排序，结果是日期升序</span>
	<span class="token function">sort</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v1<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">Less</span><span class="token generic class-name"><span class="token operator">&lt;</span>Date<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	vector<span class="token operator">&lt;</span>Date<span class="token operator">*</span><span class="token operator">&gt;</span> v2<span class="token punctuation">;</span>
	v2<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>d1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	v2<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>d2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	v2<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>d3<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 可以直接排序，结果错误日期还不是升序，而v2中放的地址是升序</span>
	<span class="token comment">// 此处需要在排序过程中，让sort比较v2中存放地址指向的日期对象</span>
	<span class="token comment">// 但是走Less模板，sort在排序时实际比较的是v2中指针的地址，因此无法达到预期</span>
	<span class="token function">sort</span><span class="token punctuation">(</span>v2<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v2<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">Less</span><span class="token generic class-name"><span class="token operator">&lt;</span>Date<span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>sort最终按照Less模板中方式比较，所以只会比较指针，而不是比较指针指<br> 向空间中内容，此时可以使用类版本特化来处理上述问题：</p> 
<pre><code class="prism language-cpp"><span class="token comment">// 对Less类模板按照指针方式特化</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">Less</span><span class="token operator">&lt;</span>Date<span class="token operator">*</span><span class="token operator">&gt;</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Date<span class="token operator">*</span> x<span class="token punctuation">,</span> Date<span class="token operator">*</span> y<span class="token punctuation">)</span> <span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token operator">*</span>x <span class="token operator">&lt;</span> <span class="token operator">*</span>y<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="3_242"></a>3.模板分离编译</h2> 
<p>分离编译：一个程序（项目）由若干个源文件共同实现，而每个源文件单独编译生成目标文件，最后将所有目标文件链接起来形成单一的可执行文件的过程称为分离编译模式。</p> 
<pre><code class="prism language-cpp"><span class="token comment">// a.h</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
T <span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> left<span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">&amp;</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// a.cpp</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
T <span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> left<span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">&amp;</span> right<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> left <span class="token operator">+</span> right<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// main.cpp</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"a.h"</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/05/3b/Sqhgqwc4_o.png" alt="在这里插入图片描述"><br> 会发生链接错误。<img src="https://images2.imgbox.com/3f/b3/oZ6svu3o_o.png" alt="在这里插入图片描述"><br> 解决方法：</p> 
<ol><li>将声明和定义放到一个文件 “xxx.hpp” 里面或者xxx.h其实也是可以的。一般喜欢用.hpp文件，代表这个文件专门用来放类模板的声明和定义。推荐使用这种。</li><li>模板定义的位置显式实例化。这种方法不实用，不推荐使用。</li></ol> 
<pre><code class="prism language-cpp"><span class="token comment">//a.cpp</span>
<span class="token comment">// 显式实例化</span>
<span class="token keyword">template</span>
<span class="token keyword">int</span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> left<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">template</span> 
<span class="token keyword">double</span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">double</span><span class="token operator">&amp;</span> left<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">double</span><span class="token operator">&amp;</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="4_280"></a>4.模板总结</h2> 
<p>【优点】</p> 
<ol><li>模板复用了代码，节省资源，更快的迭代开发，C++的标准模板库(STL)因此而产生</li><li>增强了代码的灵活性</li></ol> 
<p>【缺陷】</p> 
<ol><li>模板会导致代码膨胀问题，也会导致编译时间变长</li><li>出现模板编译错误时，错误信息非常凌乱，不易定位错误</li></ol> 
<p>总的来说，模板利大于弊，是C++中很好的一个特性。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1a88425d0e695f1da0ac966bf32f0296/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">4.原子操作类：AtomicLong、LongAdderLong、Accumulator</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8115a4067b94802d53ab8bebaad23b64/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">线程同步器：CountDownLatch、CyclicBarrier、Semaphore</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>