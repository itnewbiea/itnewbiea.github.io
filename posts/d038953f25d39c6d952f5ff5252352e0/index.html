<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>谈谈中兴捧月大赛决赛以及总结 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="谈谈中兴捧月大赛决赛以及总结" />
<meta property="og:description" content="前言 四月份，在师兄的推荐下，报名参加了中兴捧月大赛。一开始只是为了混一个面笔试的资格（因为提交有效成绩即可免笔试），然后为了找一个简单的赛道，注册了几个号看了两三个赛道的题目。发现自己每个都不熟悉，然后就选了一个看起来比较小众的赛道（图灵派，音视频编解码），可能竞争压力会小一点（报一点侥幸）。
初赛 初赛因为就是为了混免笔试，因此就调库（不调库也没办法，我也不会，也没时间天天搞这个，毕竟还有科研任务）。
具体的初赛内容可以看前几篇文章。
https://blog.csdn.net/qq_37207042/article/details/116209375
复赛 这个赛道的复赛好像特别简单（其他赛道好像还有题），复赛就是面试，郭老师远程面试我们，然后基本没有问技术层面的，就问了一下思路。然后做了一些自我介绍，其实我就是念了一下简历，另外问了一些项目经验之类的以及就业意向。因为毕竟不是本专业学这个的，技术深度还是不够，只能问一些浅层的思路。本以为复赛混个奖品就可以了，意外的是，公布决赛名单时候竟然找到了我的牛客ID。
决赛 听说决赛还有参与奖品，而且还包差旅食宿（还有这种好事，当然要去）。然后领我意外的是，中兴对待比赛还挺认真的，赛务组安排的都很好，吃住等生活事务都安排的明明白白。
第一天去先是入住，然后等晚上发布赛题，发布完赛题会住处就开始开发了。
第二天，第三天都是开发，第三天下午5点提交，提交完开始做PPT，第四天答辩，第四天下午终极答辩（前六名），晚上颁奖典礼。
开发开始比较累的，我每天差不多都搞到晚上1点，搞了两天。吃住都在中兴自己的酒店，酒店还行吧，吃饭就酒店自助。
赛题 扯了那么多，毕竟这是个技术博客，还是谈一谈技术。
决赛（图灵派）赛题 图灵派主要涉及的就是音视频编解码，涉及一些深度学习方法。
决赛题目是VR视频编码算法的问题
背景 在VR领域中，对于传输带宽要求极高，需要对于视频进行进一步的压缩，
以降低传输带宽的需求，给用户更好的使用体验，业内常用 tile 编码方案进行传输。
问题1：tile权重预测 根据相关研究表明，对于 360°视频，大约有超过 30%的内容未被参与测试的人观看。因此，通过 tile 编码，可以对于不重要内容进行低权重编码，对于观看频率较高的采用高权重编码。
上图展示了一个全景图像中，用户关注的重点位置和图像。
在 tile 编码时，根据 saliency 的预测权重结果进行西能优化，有线高质量编码更容易被观看的 tile，对不容易被观看的区域视权重情况进行低质量快速编码。 从而完成对编码服务器的性能优化，降低服务成本。 根据附件中所提供的 40 个参与用户对于 40 个视频的头动数据集，对于 tile 编码算法进行设计和训练。
评分标准 在测试的 8 个视频中（赛程过程不提供），对于视频数据进行 tile 编码，对于所预测的权重结果和实际的头动数据集进行相关性计算。最后输出一个 txt 文 本文件，输出分为两列，分别为各个 tile 的观看命中次数和该 tile 对应的权重， 示例如所给压缩包中的 txt 文件。运行压缩包中 pcc.py 计算相关性，获取最终的 相关性评分。同时，对于本问题的解题思路，输出相关文档进行阐述。
问题2：tile编码方案优化 对于单个 tile 的编码方案进行优化。 在第一题全景 tile 编码的基础上，相同的视频内容，不同的编码方案（q、s、t）对主观感知质量的影响较大。不同的视频内容呈现出的规律有一定的差异。 可参考：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/d038953f25d39c6d952f5ff5252352e0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-30T20:54:18+08:00" />
<meta property="article:modified_time" content="2021-06-30T20:54:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">谈谈中兴捧月大赛决赛以及总结</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>前言</h2> 
<p>四月份，在师兄的推荐下，报名参加了中兴捧月大赛。一开始只是为了混一个面笔试的资格（因为提交有效成绩即可免笔试），然后为了找一个简单的赛道，注册了几个号看了两三个赛道的题目。发现自己每个都不熟悉，然后就选了一个看起来比较小众的赛道（图灵派，音视频编解码），可能竞争压力会小一点（报一点侥幸）。</p> 
<h2><a id="_3"></a>初赛</h2> 
<p>初赛因为就是为了混免笔试，因此就调库（不调库也没办法，我也不会，也没时间天天搞这个，毕竟还有科研任务）。<br> 具体的初赛内容可以看前几篇文章。<br> <a href="https://blog.csdn.net/qq_37207042/article/details/116209375">https://blog.csdn.net/qq_37207042/article/details/116209375</a></p> 
<h2><a id="_8"></a>复赛</h2> 
<p>这个赛道的复赛好像特别简单（其他赛道好像还有题），复赛就是面试，郭老师远程面试我们，然后基本没有问技术层面的，就问了一下思路。然后做了一些自我介绍，其实我就是念了一下简历，另外问了一些项目经验之类的以及就业意向。因为毕竟不是本专业学这个的，技术深度还是不够，只能问一些浅层的思路。本以为复赛混个奖品就可以了，意外的是，公布决赛名单时候竟然找到了我的牛客ID。</p> 
<h2><a id="_11"></a>决赛</h2> 
<p>听说决赛还有参与奖品，而且还包差旅食宿（还有这种好事，当然要去）。然后领我意外的是，中兴对待比赛还挺认真的，赛务组安排的都很好，吃住等生活事务都安排的明明白白。<br> <img src="https://images2.imgbox.com/f7/e5/wWKhUchU_o.png" alt="在这里插入图片描述"><br> 第一天去先是入住，然后等晚上发布赛题，发布完赛题会住处就开始开发了。<br> 第二天，第三天都是开发，第三天下午5点提交，提交完开始做PPT，第四天答辩，第四天下午终极答辩（前六名），晚上颁奖典礼。<br> 开发开始比较累的，我每天差不多都搞到晚上1点，搞了两天。吃住都在中兴自己的酒店，酒店还行吧，吃饭就酒店自助。</p> 
<h2><a id="_19"></a>赛题</h2> 
<p>扯了那么多，毕竟这是个技术博客，还是谈一谈技术。</p> 
<h3><a id="_22"></a>决赛（图灵派）赛题</h3> 
<p>图灵派主要涉及的就是音视频编解码，涉及一些深度学习方法。<br> 决赛题目是VR视频编码算法的问题</p> 
<h4><a id="_25"></a>背景</h4> 
<p>在VR领域中，对于传输带宽要求极高，需要对于视频进行进一步的压缩，<br> 以降低传输带宽的需求，给用户更好的使用体验，业内常用 tile 编码方案进行传输。</p> 
<h4><a id="1tile_28"></a>问题1：tile权重预测</h4> 
<p>根据相关研究表明，对于 360°视频，大约有超过 30%的内容未被参与测试的人观看。因此，通过 tile 编码，可以对于不重要内容进行低权重编码，对于观看频率较高的采用高权重编码。<br> <img src="https://images2.imgbox.com/74/5b/o98K20i1_o.png" alt="在这里插入图片描述"><br> 上图展示了一个全景图像中，用户关注的重点位置和图像。<br> 在 tile 编码时，根据 saliency 的预测权重结果进行西能优化，有线高质量编码更容易被观看的 tile，对不容易被观看的区域视权重情况进行低质量快速编码。 从而完成对编码服务器的性能优化，降低服务成本。 根据附件中所提供的 40 个参与用户对于 40 个视频的头动数据集，对于 tile 编码算法进行设计和训练。</p> 
<h4><a id="_33"></a>评分标准</h4> 
<p>在测试的 8 个视频中（赛程过程不提供），对于视频数据进行 tile 编码，对于所预测的权重结果和实际的头动数据集进行相关性计算。最后输出一个 txt 文 本文件，输出分为两列，分别为各个 tile 的观看命中次数和该 tile 对应的权重， 示例如所给压缩包中的 txt 文件。运行压缩包中 pcc.py 计算相关性，获取最终的 相关性评分。同时，对于本问题的解题思路，输出相关文档进行阐述。<br> <img src="https://images2.imgbox.com/bc/9a/xlTlSDcX_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2tile_36"></a>问题2：tile编码方案优化</h4> 
<p>对于单个 tile 的编码方案进行优化。 在第一题全景 tile 编码的基础上，相同的视频内容，不同的编码方案（q、s、t）对主观感知质量的影响较大。不同的视频内容呈现出的规律有一定的差异。 可参考：<br> <a href="https://github.com/NJUVISION/QSTAR">https://github.com/NJUVISION/QSTAR </a><br> <a href="https://vision.nju.edu.cn/20/86/c29466a467078/page.htm" rel="nofollow">https://vision.nju.edu.cn/20/86/c29466a467078/page.htm</a><br> 请给出在给定码率下的最佳编码策略。</p> 
<h4><a id="_41"></a>评分标准</h4> 
<p>针对测试的 8 个视频，以及第一题解出的 tile 数据，输出最佳编码方案。与理论最佳编码方案匹配的给分。同时，对于本问题的解题思路，输出相关文档进行阐述。</p> 
<h2><a id="_45"></a>赛题思路</h2> 
<p>由于赛方给配备了一台服务器，虽然算力不高，但还是比我的小笔记本强的，所以首先就是配置服务器，服务器配置为ubuntu18.04 + cuda 11.0.2/Driver 450.80.02/CUDNN 8.0.4</p> 
<p>由于之前没有用过linux系统和服务器，所以用的都是比较简单的操作：<br> 主要操作在window PowerShell上完成，使用ssh指令完成连接，例如：<code>ssh root@47.98.183.224</code>。<br> 输入密码，由于linux键入后是不显示的，所以不要担心没输进去。<br> 进入服务器后，左侧的提示符会变为<code>root@xxxx：</code>。<br> 另外比较简单的几个操作是必要的：<br> <code>ls</code> :显示文件夹内容<br> <code>cd xxx</code>：到xxx文件<br> <code>cd ..</code> ：回退到上一级文件夹<br> <code>vim xxx</code>：编辑xxx，进入编辑模式后需要按<code>i</code>进入insert编辑模式，按ESC退出模式，输入<code>：wq</code>保存退出<br> <code>python xxx.py</code> ：执行python文件<br> unzip xxx.zip ：解压xxx文件<br> 至于工具的安装和python的安装就不啰嗦了，大多都是<code>pip install xxx</code>以及<code>apt install xxx</code>这些操作。<br> <img src="https://images2.imgbox.com/24/57/KQcH2i8o_o.png" alt="在这里插入图片描述"><br> 另外重要的就是主机与服务器的文件交互，这个交互需要在cmd命令提示薄。<br> 下面是从服务器下载weg.txt文件<br> <img src="https://images2.imgbox.com/17/a5/ufmEtZ2o_o.png" alt="在这里插入图片描述"><br> 下面是从主机上传test.txt文件<br> <img src="https://images2.imgbox.com/d0/92/QKPe3T1o_o.png" alt="在这里插入图片描述"><br> 主要是用了scp指令。</p> 
<p>这些只是下酒菜，下面到正题，赛题应该如何解决。<br> 为了尽可能容易理解并且少看文字，着重用图解释问题。<br> <img src="https://images2.imgbox.com/86/9e/Jsxa02Mu_o.png" alt="在这里插入图片描述"><br> 在球体中相同的角度对应的弧长相同，因此在坐标转换时根据经纬度等比例转换<br> <img src="https://images2.imgbox.com/82/d2/dBObMESu_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/67/0c/YR8V7XQD_o.png" alt="在这里插入图片描述"><br> 由于用户关注的tile通常是关注图像中的人物或者物体、抑或是图像信息较多的部分（图像细节较多），因此考虑使用擅长图像感知的卷积神经网络进行训练建立</p> 
<p>使用卷积神经网络实现对图像每块tile的权值预测，模型的输入为图像、输出为tile权重。<br> 由于资源与时间限制，该卷积神经网络模型使用使用4层卷积层，两层映射层。<br> 利用头动数据集与划分好的tile可以建立每一帧图像的tile权重（命中为1，未命中为0）<br> <img src="https://images2.imgbox.com/be/7a/1We6WOiD_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/65/75/BeYxl3J1_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d9/37/MUse8wO2_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a3/78/Vu2RCvID_o.png" alt="在这里插入图片描述"><br> 还有不明白的可以看下面文字补充解释：</p> 
<h4><a id="1tile_86"></a>问题1：tile权重预测</h4> 
<p>已知40个VR视频与40个参与用户观看40个视频的头动数据(头动数据给出的是用户观看的VR视频的经纬度)。目的是要根据已知的数据建立算法模型，以达到预测参与用户对视频的不同位置块的关注程度，也就是tile权重。</p> 
<p>根据已知数据可以抽象一个简单的数学模型，输入设计为视频中的每一帧图像，输出为tile权重。由于用户关注的tile通常是关注图像中的人物或者物体、抑或是图像信息较多的部分（图像细节较多），因此考虑使用擅长图像感知的卷积神经网络进行训练建立（进一步可以考虑前后帧图像之间的关系，加入循环神经网络的元素，结合实现序列上的轨迹与视频内容以达到更好的预测）。</p> 
<p>明确数学模型后，需要得到模型的输入与输出数据用于神经网络的训练。首先，对头动数据集进行坐标转换，将头动数据集的经纬度转换为图像中的坐标位置。由于头动数据的经纬度所表示的为球面的位置，球面高纬度的纬线周长小，低纬度的纬线周长大，因此根据经纬度对其进行等比例变换到平面坐标。其次，需要明确图像中的tile划分，由于VR视频本质是一个球形的图像形式，因此将其转化为平面图像后，其高纬度部分的图像也就是平面图像的上下两侧存在拉伸，拉伸会导致用户在VR图像中所关注的部分在平面图像下会变大。因此，将平面图像上下两侧的tile划分为较大的块，中部划分为较小的块。其中，上下部分与中部划分的线为60°纬度线，因为当纬度为60°时，纬线周长等于赤道线周长的一半，也就是 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         c 
        
       
         o 
        
       
         s 
        
       
         ( 
        
       
         6 
        
        
        
          0 
         
        
          ∘ 
         
        
       
         ) 
        
       
      
        cos(60^{\circ}) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mopen">(</span><span class="mord">6</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.674115em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∘</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>。</p> 
<p>确定tile区块划分后，根据头动数据可以计算每一帧图像中用户所关注的tile位置，由此建立深度学习的Label集（用户关注的tile位置标签为1，其余区域为0）。</p> 
<p>确定模型的输入输出后，建立卷积神经网络，（由于训练时间与资源限制，使用较为简便的卷积模型）。</p> 
<p>由于图像数据较大，服务器的存储容量不足，将图像的分辨率调整为480*240，每次读取一个视频的图像数据进行训练，头动数据与图像帧的长短不一致的以起始数据为基准对齐进行截取训练。训练完成后的神经网络可以针对视频中的每一帧图像输出tile权重，若输出权重总和不为1，按比例调整到总和为1。</p> 
<p>采用神经网络对每个视频中图像的tile权重预测求均值，得到每个tile块的权重；将坐标转换后的头动数据与划分的tile比对，得出每个tile的统计命中次数，写入最后输出的txt。</p> 
<p>使用pcc.py求取根据头动数据得到的tile命中次数与深度学习算法给出的tile权重预测两个统计变量之间的皮尔逊相关系数，得出机器预测与用户观看之间的相关度作为评价指标。</p> 
<h4><a id="2tile_102"></a>问题2：tile编码方案优化</h4> 
<p>目前针对基于视点的全景视频的视频质量评价机制主要是基于SP、QP、TR等代表空间、时间、量化幅度、分辨率等的参数。建立这些参数与主观观看平均评分(MOS)之间的关系，形成客观视频评分模型。</p> 
<p>为了达到在给定码率下尽可能的提供视频质量，可以依据tile的权重调整上述几中影响视频评分的参数。<br> <img src="https://images2.imgbox.com/28/d2/vesMWswA_o.png" alt="在这里插入图片描述"><br> 上述评分模型中，设计三个参数，时间（t,帧速率）、空间（s,分辨率）、量化（q,量化质量）。若上述三个参数增加则视频的码率相应的增加，若其减小，则视频评分质量将下降。</p> 
<p>依据评价模型对编码方案进行优化需要在上述参数与cost funtion也就是评价模型的值Q之间做trade-off。</p> 
<p>假设量化值为q、帧速率为t、分辨率为s，码率为b，假定以下数学模型：<br> <img src="https://images2.imgbox.com/4c/36/26ec9yIN_o.png" alt="在这里插入图片描述"><br> 其中， <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         f 
        
       
      
        f 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span></span></span></span></span>为已知常数。<br> 根据Q质量模型转化为寻优问题。</p> 
<p>根据南京大学视觉实验室文章的描述，求取多个tile的视频质量时，直接对其进行加权求和即可得到最终的视频质量 。由此可以有以下式子：<br> <img src="https://images2.imgbox.com/b9/38/JYlHmPHZ_o.png" alt="在这里插入图片描述"><br> 根据第一问得到的权值的预测 ，结合上式，可以建立视频全局的质量评价模型与参数之间的关系，进而在码率约束条件下，可以利用拉格朗日乘数法求取多元函数极值，得到参数值。</p> 
<p>另外，当tile划分的块较小时，可以更精确的定位到用户所关注的区域，但是当tile过小时，一个tile将无法覆盖用户的关注的视觉区域。<br> 一般而言人眼的观察范围为180°，当观看视频时，关注的区域往往小于60°的范围，当视频分辨率为4k时，用户关注的区域大小大致为680x680。考虑到若tile的大小划分为680x680时，若用户关注的范围在tile边缘时，提高邻近的tile画面质量将造成码率资源浪费。应将680x680的块划分为4等分，甚至16等分，并且在进行基于视点的视频编码时，提高视点关注的tile以及邻近tile的画面质量。</p> 
<h4><a id="_123"></a>代码</h4> 
<p>还是贴几行代码吧，只贴小部分仅供参考。<br> 写的比较乱，将就着看吧。</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
Created on Fri Jun 25 23:56:01 2021

@author: MYM
"""</span>
<span class="token triple-quoted-string string">'''将头动数据的经纬度转换为平面图像的坐标系，平面图像的大小通过读取图片得到。'''</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np 
<span class="token keyword">import</span> os
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>image <span class="token keyword">as</span> mpimg



<span class="token keyword">for</span> person <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">41</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    folder_name <span class="token operator">=</span> r<span class="token string">"H:\tuning\head-tracking\Subject_"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>
    <span class="token keyword">for</span> file_name <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>folder_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># print(file_name)</span>
        img_path <span class="token operator">=</span> r<span class="token string">"H:\tuning\48Sequences"</span> <span class="token operator">+</span> <span class="token string">"\\"</span> <span class="token operator">+</span> file_name<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">+</span> r<span class="token string">"\0.jpg"</span>
        img <span class="token operator">=</span> mpimg<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>img_path<span class="token punctuation">)</span>
        
        length <span class="token operator">=</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        highth <span class="token operator">=</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        data <span class="token operator">=</span> np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span>folder_name <span class="token operator">+</span> <span class="token string">'\\'</span> <span class="token operator">+</span> file_name<span class="token punctuation">)</span>
        data_num <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>  <span class="token comment"># 数据数目</span>
        
        high <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>data_num<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment"># 初始化列表</span>
        leng <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>data_num<span class="token punctuation">)</span><span class="token punctuation">]</span>
        
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>data_num<span class="token punctuation">)</span><span class="token punctuation">:</span>
            high<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">90</span> <span class="token operator">-</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">90</span><span class="token punctuation">)</span> <span class="token operator">*</span> highth <span class="token operator">/</span> <span class="token number">2</span> 
            leng<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">180</span> <span class="token operator">+</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">)</span> <span class="token operator">*</span> length <span class="token operator">/</span><span class="token number">2</span>
        
        
        new_folder_name <span class="token operator">=</span> <span class="token string">"new_Subject_"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>
        new_file_name <span class="token operator">=</span> <span class="token string">"new_"</span> <span class="token operator">+</span> file_name
        
        isExists<span class="token operator">=</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>new_folder_name<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token operator">not</span> isExists<span class="token punctuation">:</span>
            os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>new_folder_name<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"文件夹已存在"</span><span class="token punctuation">)</span>
        
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>new_folder_name <span class="token operator">+</span> <span class="token string">'\\'</span> <span class="token operator">+</span> new_file_name<span class="token punctuation">,</span><span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>data_num<span class="token punctuation">)</span><span class="token punctuation">:</span>
                f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>high<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>
                f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>leng<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">from</span> tensorflow<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers <span class="token keyword">import</span> Conv2D<span class="token punctuation">,</span>MaxPooling2D<span class="token punctuation">,</span>Dense<span class="token punctuation">,</span>Flatten<span class="token punctuation">,</span>Activation
<span class="token keyword">from</span> tensorflow<span class="token punctuation">.</span>keras <span class="token keyword">import</span> Input 
<span class="token keyword">from</span> tensorflow<span class="token punctuation">.</span>keras <span class="token keyword">import</span> Model
<span class="token keyword">import</span> os
<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
 <span class="token triple-quoted-string string">'''建立并训练卷积神经网络（改自vgg16）'''</span>
<span class="token keyword">def</span> <span class="token function">conv2d_1</span><span class="token punctuation">(</span>input_tensor<span class="token punctuation">,</span>filters<span class="token punctuation">,</span>kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    x<span class="token operator">=</span>Conv2D<span class="token punctuation">(</span>filters<span class="token punctuation">,</span>kernel_size<span class="token punctuation">,</span>padding<span class="token operator">=</span><span class="token string">'same'</span><span class="token punctuation">,</span>activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>input_tensor<span class="token punctuation">)</span>
    x<span class="token operator">=</span>Conv2D<span class="token punctuation">(</span>filters<span class="token punctuation">,</span>kernel_size<span class="token punctuation">,</span>padding<span class="token operator">=</span><span class="token string">'same'</span><span class="token punctuation">,</span>activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    x<span class="token operator">=</span>MaxPooling2D<span class="token punctuation">(</span>strides<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token keyword">return</span> x
<span class="token keyword">def</span> <span class="token function">conv2d_2</span><span class="token punctuation">(</span>input_tensor<span class="token punctuation">,</span>filters<span class="token punctuation">,</span>kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    x<span class="token operator">=</span>Conv2D<span class="token punctuation">(</span>filters<span class="token punctuation">,</span>kernel_size<span class="token punctuation">,</span>padding<span class="token operator">=</span><span class="token string">'same'</span><span class="token punctuation">,</span>activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>input_tensor<span class="token punctuation">)</span>
    x<span class="token operator">=</span>Conv2D<span class="token punctuation">(</span>filters<span class="token punctuation">,</span>kernel_size<span class="token punctuation">,</span>padding<span class="token operator">=</span><span class="token string">'same'</span><span class="token punctuation">,</span>activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    x<span class="token operator">=</span>MaxPooling2D<span class="token punctuation">(</span>strides<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token keyword">return</span> x
<span class="token keyword">def</span> <span class="token function">vgg16</span><span class="token punctuation">(</span>filters<span class="token punctuation">,</span>input_tensor<span class="token punctuation">)</span><span class="token punctuation">:</span>
    filter1<span class="token punctuation">,</span>filter2<span class="token punctuation">,</span>filter3<span class="token punctuation">,</span>filter4<span class="token operator">=</span>filters
    x<span class="token operator">=</span>conv2d_1<span class="token punctuation">(</span>input_tensor<span class="token punctuation">,</span>filter1<span class="token punctuation">)</span>
    x<span class="token operator">=</span>conv2d_2<span class="token punctuation">(</span>x<span class="token punctuation">,</span>filter4<span class="token punctuation">)</span>
    <span class="token keyword">return</span> x
inputs<span class="token operator">=</span>Input<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">240</span><span class="token punctuation">,</span><span class="token number">480</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
x<span class="token operator">=</span>vgg16<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">,</span><span class="token number">64</span><span class="token punctuation">,</span><span class="token number">64</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>inputs<span class="token punctuation">)</span>
x<span class="token operator">=</span>Flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
x<span class="token operator">=</span>Dense<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span>activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
x<span class="token operator">=</span>Dense<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
outputs<span class="token operator">=</span>Activation<span class="token punctuation">(</span><span class="token string">'softmax'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
model<span class="token operator">=</span>Model<span class="token punctuation">(</span>inputs<span class="token punctuation">,</span>outputs<span class="token punctuation">)</span>
model<span class="token punctuation">.</span>summary<span class="token punctuation">(</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>
    optimizer<span class="token operator">=</span><span class="token string">"rmsprop"</span><span class="token punctuation">,</span>
    loss<span class="token operator">=</span><span class="token string">'CategoricalCrossentropy'</span><span class="token punctuation">,</span>
    metrics<span class="token operator">=</span><span class="token string">'mse'</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token comment"># 读取数据</span>
<span class="token triple-quoted-string string">'''训练网络'''</span>
folder_name <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">"./48Sequences"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> name_f <span class="token keyword">in</span> folder_name <span class="token punctuation">:</span> 
    file_name <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">"./48Sequences/"</span> <span class="token operator">+</span> name_f<span class="token punctuation">)</span>
    img_num <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>file_name<span class="token punctuation">)</span>
    img_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>img_num<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 读取图片</span>
        img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">"./48Sequences/"</span> <span class="token operator">+</span> name_f <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".jpg"</span><span class="token punctuation">)</span>
        img_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
    img_data <span class="token operator">=</span> np<span class="token punctuation">.</span>stack<span class="token punctuation">(</span>img_list<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">del</span> img_list
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">41</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        label_path <span class="token operator">=</span> <span class="token string">"./label/"</span>
        label <span class="token operator">=</span> np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span>label_path <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"_"</span> <span class="token operator">+</span> name_f <span class="token operator">+</span> <span class="token string">".txt"</span><span class="token punctuation">)</span>
        cut_num <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>img_num<span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">)</span>
        model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>img_data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span>cut_num<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span>label<span class="token punctuation">[</span><span class="token punctuation">:</span>cut_num<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span>epochs <span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'my_model.h5'</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">'''预测步骤，并写入tile预测权重，对每张图片预测的权重取均值，每张图片32的权重，因为32个tile'''</span>
ans_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>       
<span class="token keyword">for</span> name_f <span class="token keyword">in</span> folder_name <span class="token punctuation">:</span> 
    file_name <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">"./48Sequences/"</span> <span class="token operator">+</span> name_f<span class="token punctuation">)</span>
    img_num <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>file_name<span class="token punctuation">)</span>
    img_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>img_num<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 读取图片</span>
        img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">"./48Sequences/"</span> <span class="token operator">+</span> name_f <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".jpg"</span><span class="token punctuation">)</span>
        img_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
    img_data <span class="token operator">=</span> np<span class="token punctuation">.</span>stack<span class="token punctuation">(</span>img_list<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>      
    <span class="token keyword">del</span> img_list        
    ans <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>img_data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    ans_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>ans<span class="token punctuation">)</span>
ans_data <span class="token operator">=</span> np<span class="token punctuation">.</span>concatenate<span class="token punctuation">(</span>ans_list<span class="token punctuation">,</span>axis <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">del</span> ans_list
total_num <span class="token operator">=</span> ans_data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
weg_sum <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>ans_data<span class="token punctuation">,</span>axis <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
weg <span class="token operator">=</span> weg_sum<span class="token operator">/</span>total_num
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"weg.txt"</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> weg<span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
    
</code></pre> 
<h2><a id="_259"></a>参考文献</h2> 
<p>[1]基于深度学习的视频编解码技术研究_邓宣<br> [2]全景视频处理与呈现架构和关键技术研究_罗莹<br> [3]3D_HEVC帧内编码优化算法研究_任海<br> [4]基于用户观看行为预测的全景视频高效编码与传输_戴震宇<br> [5]全景视频的质量评估研究_闵楠<br> [6]基于超高分辨率全景视频的VR系统研究_陈志杰</p> 
<h2><a id="_266"></a>结语</h2> 
<p>大概思路就是这样，结束当天身体不舒服，没认真听得奖大佬的思路，不过后来听同学说好像也差不多，没有什么更特别的东西。</p> 
<p>最后，本人由于不是视频编解码方向，只是突击了几天，如有描述不当或者错误，请大家指正，谢谢。</p> 
<p>以上内容纯属原创，如有转载，请注明。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/03dada37899aad4b46d27a5d904cf6fa/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">P问题、NP问题、NPC问题、NPH问题详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/97fa2e2944d0cb100b609e2f39fca497/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">＜img＞ 的 title 和 alt 有什么区别？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>