<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android 底部按钮被软键盘顶起问题解决 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android 底部按钮被软键盘顶起问题解决" />
<meta property="og:description" content="我们目前的项目是采用单 Activity 多 Fragment 的架构模式， AndroidManifest.xml 内 MainActivity 的配置如下所示。
&lt;activity android:name=&#34;.MainActivity&#34; android:exported=&#34;true&#34; android:windowSoftInputMode=&#34;stateHidden|adjustResize&#34;&gt; &lt;intent-filter&gt; &lt;action android:name=&#34;android.intent.action.MAIN&#34; /&gt; &lt;category android:name=&#34;android.intent.category.LAUNCHER&#34; /&gt; &lt;/intent-filter&gt; &lt;/activity&gt; stateHidden
状态隐藏，如果我们设置了这个属性，键盘状态就一定是隐藏的，不管上个界面是什么状态，也不管当前界面有没有输入的需求，就是不显示软键盘。adjustResize
调整大小状态，这个属性表示 Activity 的主窗口总是会被调整大小来保证软键盘的显示空间。如果界面中有可滑动控件，显示效果跟 adjustUnspecified 显示效果一样；如果界面中没有可滑动控件，软键盘可能会盖住一些控件(布局的位置不会发生变化，可能获取了焦点的控件被软键盘盖住)。
一般来说，我们的布局分为两种
底部按钮被滚动布局包裹底部按钮不被滚动布局包裹 第一种布局是不会出现软键盘把底部按钮顶起的情况，首先软键盘的打开实际上是一个 Dialog，而我们在配置文件内的 adjustResize 属性是在页面的根布局 decorView 的子 view 也就是一个线性布局内通过设置 paddingBottom = 软键盘高度，这样其实相当于把整个滚动布局的高度减少了，所以底部的按钮也只是变为需要滚动才能看到。
第二种情况通常为一个继续按钮始终处于页面的底部，中间的内容可以滚动，当根布局的内边距等于软键盘高度时，底部按钮就看起来像是被顶起。
从大的方向来说可以通过修改 windowSoftInputMode 来设置布局对软键盘的处理方式，当然也可以通过监听软键盘，这种修改的细粒度更小。 1、监听软键盘的打开收起
const val SOFT_KEY_BOARD_MIN_HEIGHT = 100 fun Fragment.registerFragment(bottomView: View){ view?.registerView(bottomView) } fun Activity.registerActivity(bottomView: View){ window?.decorView?.findViewById&lt;View&gt;(android.R.id.content)?.registerView(bottomView) } fun View.registerView(bottomView: View){ var keyboardVisible = false viewTreeObserver." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/cfe0a5338b8e1f1cda04fcf54fbc778e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-05T22:28:16+08:00" />
<meta property="article:modified_time" content="2021-12-05T22:28:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android 底部按钮被软键盘顶起问题解决</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <article class="_2rhmJa" style="font-size: 16px;"> 
 <p>我们目前的项目是采用单 Activity 多 Fragment 的架构模式， AndroidManifest.xml 内 MainActivity 的配置如下所示。</p> 
 <pre class="has"><code>&lt;activity
            android:name=".MainActivity"
            android:exported="true"
            android:windowSoftInputMode="stateHidden|adjustResize"&gt;
            &lt;intent-filter&gt;
                &lt;action android:name="android.intent.action.MAIN" /&gt;

                &lt;category android:name="android.intent.category.LAUNCHER" /&gt;
            &lt;/intent-filter&gt;
 &lt;/activity&gt;</code></pre> 
 <p><strong>stateHidden</strong><br> 状态隐藏，如果我们设置了这个属性，键盘状态就一定是隐藏的，不管上个界面是什么状态，也不管当前界面有没有输入的需求，就是不显示软键盘。<strong>adjustResize</strong><br> 调整大小状态，这个属性表示 Activity 的主窗口总是会被调整大小来保证软键盘的显示空间。如果界面中有可滑动控件，显示效果跟 adjustUnspecified 显示效果一样；如果界面中没有可滑动控件，软键盘可能会盖住一些控件(布局的位置不会发生变化，可能获取了焦点的控件被软键盘盖住)。<br> 一般来说，我们的布局分为两种</p> 
 <ol><li>底部按钮被滚动布局包裹</li><li>底部按钮不被滚动布局包裹</li></ol> 
 <p>第一种布局是不会出现软键盘把底部按钮顶起的情况，首先软键盘的打开实际上是一个 Dialog，而我们在配置文件内的 <strong>adjustResize</strong> 属性是在页面的根布局 decorView 的子 view 也就是一个线性布局内通过设置 paddingBottom = 软键盘高度，这样其实相当于把整个滚动布局的高度减少了，所以底部的按钮也只是变为需要滚动才能看到。<br> 第二种情况通常为一个继续按钮始终处于页面的底部，中间的内容可以滚动，当根布局的内边距等于软键盘高度时，底部按钮就看起来像是被顶起。</p> 
 <div class="image-package"> 
  <div class="image-container"> 
   <div class="image-view" style="text-align: center;"> 
    <img src="https://images2.imgbox.com/c8/81/EAX7E2ZP_o.png" style="outline: none;"> 
   </div> 
  </div> 
 </div> 
 <br> 从大的方向来说可以通过修改 windowSoftInputMode 来设置布局对软键盘的处理方式，当然也可以通过监听软键盘，这种修改的细粒度更小。 
 <p><strong>1、监听软键盘的打开收起</strong></p> 
 <pre class="has"><code>const val SOFT_KEY_BOARD_MIN_HEIGHT = 100

fun Fragment.registerFragment(bottomView: View){
    view?.registerView(bottomView)
}

fun Activity.registerActivity(bottomView: View){
    window?.decorView?.findViewById&lt;View&gt;(android.R.id.content)?.registerView(bottomView)
}

fun View.registerView(bottomView: View){
    var keyboardVisible = false
    viewTreeObserver.addOnGlobalLayoutListener {
        val r = Rect()
        getWindowVisibleDisplayFrame(r)
        val heightDiff: Int = rootView.height - r.bottom
        if(heightDiff &gt; SOFT_KEY_BOARD_MIN_HEIGHT){
            if(!keyboardVisible){
                keyboardVisible = true
                bottomView.isClickable = false
                bottomView.visibility = View.INVISIBLE
            }
        }else{
            if(keyboardVisible){
                keyboardVisible = false
                bottomView.isClickable = false
                bottomView.visibility = View.VISIBLE
            }
        }
    }
}</code></pre> 
 <p><strong>2、修改 windowSoftInputMode</strong><strong>adjustPan</strong><br> 如果设置了这个属性，当软键盘弹出的时候，系统会通过布局的移动，来保证用户要进行输入的输入框在用户的视线范围内。如果界面没有可滑动控件，显示效果和 <strong>adjustUnspecified</strong> 效果一样；如果界面有可滑动控件，在软键盘显示的时候，可能会有一些内容显示不出来。</p> 
 <pre class="has"><code>abstract class BaseFragment: Fragment() {

    private var keyboardType: Int = 0

    override fun onCreateView(
        inflater: LayoutInflater,
        container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View? {
        return LayoutInflater.from(context).inflate(getContentViewRes(), container, false)
    }

    override fun onResume() {
        super.onResume()
        arguments?.let {
            keyboardType = it.getInt("keyboardType",  0)
            if(keyboardType == 2){
                getBottomView()?.run {
                    registerFragment(this)
                }
            }else {
                onKeyboardSetting(keyboardType)
            }
        }
        initData()
        initView()
    }

    abstract fun getBottomView(): View?

    override fun onHiddenChanged(hidden: Boolean) {
        super.onHiddenChanged(hidden)
          if(!hidden){
                onKeyboardSetting(keyboardType)
            }else{
                onKeyboardSetting(0)
            }
    }

    override fun onDestroy() {
        super.onDestroy()
         onKeyboardSetting(0)
    }

    abstract fun initData()

    abstract fun initView()

    abstract fun getContentViewRes(): Int

}

fun Fragment.onKeyboardSetting(keyboardType: Int){
    if (keyboardType == 0){
        activity?.window?.setSoftInputMode(WindowManager.LayoutParams.SOFT_INPUT_STATE_HIDDEN or WindowManager.LayoutParams.SOFT_INPUT_ADJUST_RESIZE)
    }else{
        activity?.window?.setSoftInputMode(WindowManager.LayoutParams.SOFT_INPUT_ADJUST_PAN)
    }
}</code></pre> 
 <p>资料借鉴<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fblog.csdn.net%2Fqiutiandepaomo%2Farticle%2Fdetails%2F84028558" rel="nofollow noopener noreferrer" target="_blank">Android中Activity的android:windowSoftInputMode属性</a></p> 
</article>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cd060b802d9739d0a46f2ae340429be8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Golang sort包排序（详细全集）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c67d00be2c1e97a2f0c41666f8767c94/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【深度学习】Layer Normalization</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>