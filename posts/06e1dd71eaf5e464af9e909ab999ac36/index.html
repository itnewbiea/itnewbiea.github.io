<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Oracle计算环比浅谈 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Oracle计算环比浅谈" />
<meta property="og:description" content="转自：微点阅读 https://www.weidianyuedu.com
环比就是今年第n月与第n-1月或第n&#43;1月比；同比就是今年第n月与去年第n月比。
建测试表，假设是个销售数量表：
create table t (dt date,cnt number);
随便插入些测试数据，最后表的内容如下：
DT CNT
---------- ----------
2012-02-09 15
2012-02-21 2
2012-03-23 1
2012-03-23 5
2012-04-23 2
2012-05-12 20
2012-07-01 20
2012-07-21 20
显示环比，如果某个月没有销售，就有点儿麻烦。
先想个办法，显示本年度的1至12月，有个很有技巧的技术来实现：
SQL&gt; set pagesize 20
SQL&gt; with m as (select &#34;2012-&#34;||lpad(rownum,2,&#34;0&#34;) v from dual connect by level&lt;=12)　select * from m;
V
---------
2012-01
2012-02
2012-03
2012-04
2012-05
2012-06
2012-07
2012-08
2012-09
2012-10
2012-11
2012-12
接下来就容易了，两个表外连，使用lag统计函数就可以了。
with m as (select &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/06e1dd71eaf5e464af9e909ab999ac36/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-22T12:40:10+08:00" />
<meta property="article:modified_time" content="2023-01-22T12:40:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Oracle计算环比浅谈</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="kdocs-document"> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:592px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:70.77703%;height:0;"> 
    <img src="https://images2.imgbox.com/0b/13/yI4RNeA1_o.jpg" style="margin-left:;display:block;width:592px;margin-top:-70.77703%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <p style="text-align:null;">转自：<a class="kdocs-link" style="color:#0A6CFF;" href="https://www.weidianyuedu.com/" rel="nofollow noopener noreferrer" target="_blank">微点阅读</a> <a class="kdocs-link" style="color:#0A6CFF;" href="https://www.weidianyuedu.com/" rel="nofollow noopener noreferrer" target="_blank">https://www.weidianyuedu.com</a></p> 
 <p style="text-align:null;"></p> 
 <p style="text-align:null;">环比就是今年第n月与第n-1月或第n+1月比；同比就是今年第n月与去年第n月比。</p> 
 <p style="text-align:null;">建测试表，假设是个销售数量表：</p> 
 <p style="text-align:null;">create table t (dt date,cnt number);</p> 
 <p style="text-align:null;">随便插入些测试数据，最后表的内容如下：</p> 
 <p style="text-align:null;">DT CNT</p> 
 <p style="text-align:null;">---------- ----------</p> 
 <p style="text-align:null;">2012-02-09 15</p> 
 <p style="text-align:null;">2012-02-21 2</p> 
 <p style="text-align:null;">2012-03-23 1</p> 
 <p style="text-align:null;">2012-03-23 5</p> 
 <p style="text-align:null;">2012-04-23 2</p> 
 <p style="text-align:null;">2012-05-12 20</p> 
 <p style="text-align:null;">2012-07-01 20</p> 
 <p style="text-align:null;">2012-07-21 20</p> 
 <p style="text-align:null;">显示环比，如果某个月没有销售，就有点儿麻烦。</p> 
 <p style="text-align:null;">先想个办法，显示本年度的1至12月，有个很有技巧的技术来实现：</p> 
 <p style="text-align:null;">SQL&gt; set pagesize 20</p> 
 <p style="text-align:null;">SQL&gt; with m as (select "2012-"||<a class="kdocs-link" style="color:#0A6CFF;" href="https://so.csdn.net/so/search?q=lpad&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">lpad</a>(rownum,2,"0") v from dual connect by level&lt;=12)　select * from m;</p> 
 <p style="text-align:null;">V</p> 
 <p style="text-align:null;">---------</p> 
 <p style="text-align:null;">2012-01</p> 
 <p style="text-align:null;">2012-02</p> 
 <p style="text-align:null;">2012-03</p> 
 <p style="text-align:null;">2012-04</p> 
 <p style="text-align:null;">2012-05</p> 
 <p style="text-align:null;">2012-06</p> 
 <p style="text-align:null;">2012-07</p> 
 <p style="text-align:null;">2012-08</p> 
 <p style="text-align:null;">2012-09</p> 
 <p style="text-align:null;">2012-10</p> 
 <p style="text-align:null;">2012-11</p> 
 <p style="text-align:null;">2012-12</p> 
 <p style="text-align:null;">接下来就容易了，两个表外连，使用lag统计函数就可以了。</p> 
 <p style="text-align:null;">with m as (select "2012-"||lpad(<a class="kdocs-link" style="color:#0A6CFF;" href="https://so.csdn.net/so/search?q=rownum&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">rownum</a>,2,"0") v from dual connect by level&lt;=12)</p> 
 <p style="text-align:null;">select m.v "月份",nvl(sum(t.cnt),0) "销售数量",</p> 
 <p style="text-align:null;">lag(nvl(sum(t.cnt),0),1) over (order by m.v) "上月销量数量",</p> 
 <p style="text-align:null;">nvl(sum(t.cnt),0)-lag(nvl(sum(t.cnt),0),1) over (order by m.v) "环比增加量",</p> 
 <p style="text-align:null;">round((case when nvl(sum(t.cnt),0)=0 then null else (nvl(sum(t.cnt),0)-lag(nvl(sum(t.cnt),0),1) over (order by m.v))/nvl(sum(t.cnt),0) end)*100,1) "环比增加比例(%)"</p> 
 <p style="text-align:null;">from m left outer join t</p> 
 <p style="text-align:null;">on m.v=to_char(t.dt,"yyyy-mm") group by m.v order by 1</p> 
 <p style="text-align:null;">月份 销售数量 上月销量数量 环比增加量 环比增加比例(%)</p> 
 <p style="text-align:null;">--------- ---------- ------------ ---------- ---------------</p> 
 <p style="text-align:null;">2012-01 0</p> 
 <p style="text-align:null;">2012-02 17 0 17 100</p> 
 <p style="text-align:null;">2012-03 6 17 -11 -183.3</p> 
 <p style="text-align:null;">2012-04 2 6 -4 -200</p> 
 <p style="text-align:null;">2012-05 20 2 18 90</p> 
 <p style="text-align:null;">2012-06 0 20 -20</p> 
 <p style="text-align:null;">2012-07 40 0 40 100</p> 
 <p style="text-align:null;">2012-08 0 40 -40</p> 
 <p style="text-align:null;">2012-09 0 0 0</p> 
 <p style="text-align:null;">2012-10 0 0 0</p> 
 <p style="text-align:null;">2012-11 0 0 0</p> 
 <p style="text-align:null;">2012-12 0 0 0</p> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/989b7af1d803d917326e03e456fbb467/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">最简单的python爬取网页小说</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1eaea6cdf68691a9bfd447cd01229c89/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">3.1 卷积神经网络的应用领域|卷积的作用|卷积特征值的计算方法|得到特征图表示|步长与卷积核大小对结果的影响|边缘填充方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>