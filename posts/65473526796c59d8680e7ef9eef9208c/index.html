<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【NiosII训练】第五篇、FPGA驱动DHT11 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【NiosII训练】第五篇、FPGA驱动DHT11" />
<meta property="og:description" content="目录 第一部分、前言
1、闲话
第二部分、题目要求
1、图片
2、文字描述
3、dht11知识
第三部分、工程代码
1、软核的搭建
2、顶层文件的代码
3、Ecplise代码
第四部分、总结
1、效果演示
2、感想
3、完整工程
第一部分、前言 1、闲话 还是一样，这个设计也是我们《SOPC技术及应用》课程结束的期末作业。我自己的是老师题库里的第题、驱动AD9854这个模块，题目要求在第一篇已经说到了，想回去看的铁子们可以回去看。
这一题是我室友的，报酬是给我买一杯奶茶（结果没给，我亏大发了😭😭😭），效果如下：
第二部分、题目要求 1、图片 2、文字描述 使用FPGA调通DHT11温湿度传感器，并能够将温度和湿度实时显示在lcd上，系统需要使用ucosii操作系统。
3、dht11知识 关于DHT11的知识，你到CSDN搜一下，出来一大把，有些博主很详细的讲述了这个模块的工作原理，我这里就不做详述了。
第三部分、工程代码 1、软核的搭建 2、顶层文件的代码 module AC620_GHRD( input wire clk, // clk.clk input wire reset_n, // reset.reset_n output wire lcd_rst, // lcd_rst.export output wire lcd_rd_n, // lcd_rd.export output wire lcd_bl, // lcd_bl.export output wire lcd_wr_n, // lcd_wr.export output wire lcd_rs, // lcd_rs.export output wire lcd_cs_n, // lcd_cs." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/65473526796c59d8680e7ef9eef9208c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-16T09:00:02+08:00" />
<meta property="article:modified_time" content="2020-12-16T09:00:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【NiosII训练】第五篇、FPGA驱动DHT11</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3 id="main-toc"><strong>目录</strong></h3> 
<p id="%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%E3%80%81%E5%89%8D%E8%A8%80-toc" style="margin-left:40px;"><a href="#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%E3%80%81%E5%89%8D%E8%A8%80" rel="nofollow">第一部分、前言</a></p> 
<p id="1%E3%80%81%E9%97%B2%E8%AF%9D-toc" style="margin-left:80px;"><a href="#1%E3%80%81%E9%97%B2%E8%AF%9D" rel="nofollow">1、闲话</a></p> 
<p id="%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E3%80%81%E9%A2%98%E7%9B%AE%E8%A6%81%E6%B1%82-toc" style="margin-left:40px;"><a href="#%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E3%80%81%E9%A2%98%E7%9B%AE%E8%A6%81%E6%B1%82" rel="nofollow">第二部分、题目要求</a></p> 
<p id="1%E3%80%81%E5%9B%BE%E7%89%87-toc" style="margin-left:80px;"><a href="#1%E3%80%81%E5%9B%BE%E7%89%87" rel="nofollow">1、图片</a></p> 
<p id="2%E3%80%81%E6%96%87%E5%AD%97-toc" style="margin-left:80px;"><a href="#2%E3%80%81%E6%96%87%E5%AD%97" rel="nofollow">2、文字描述</a></p> 
<p id="3%E3%80%81dht11%E7%9F%A5%E8%AF%86-toc" style="margin-left:80px;"><a href="#3%E3%80%81dht11%E7%9F%A5%E8%AF%86" rel="nofollow">3、dht11知识</a></p> 
<p id="%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86%E3%80%81%E5%B7%A5%E7%A8%8B%E4%BB%A3%E7%A0%81-toc" style="margin-left:40px;"><a href="#%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86%E3%80%81%E5%B7%A5%E7%A8%8B%E4%BB%A3%E7%A0%81" rel="nofollow">第三部分、工程代码</a></p> 
<p id="1%E3%80%81%E8%BD%AF%E6%A0%B8%E7%9A%84%E6%90%AD%E5%BB%BA-toc" style="margin-left:80px;"><a href="#1%E3%80%81%E8%BD%AF%E6%A0%B8%E7%9A%84%E6%90%AD%E5%BB%BA" rel="nofollow">1、软核的搭建</a></p> 
<p id="%C2%A02%E3%80%81%E9%A1%B6%E5%B1%82%E6%96%87%E4%BB%B6%E7%9A%84%E4%BB%A3%E7%A0%81-toc" style="margin-left:80px;"><a href="#%C2%A02%E3%80%81%E9%A1%B6%E5%B1%82%E6%96%87%E4%BB%B6%E7%9A%84%E4%BB%A3%E7%A0%81" rel="nofollow"> 2、顶层文件的代码</a></p> 
<p id="%C2%A03%E3%80%81Ecplise%E4%BB%A3%E7%A0%81-toc" style="margin-left:80px;"><a href="#%C2%A03%E3%80%81Ecplise%E4%BB%A3%E7%A0%81" rel="nofollow"> 3、Ecplise代码</a></p> 
<p id="%C2%A0%E7%AC%AC%E5%9B%9B%E9%83%A8%E5%88%86%E3%80%81%E6%80%BB%E7%BB%93-toc" style="margin-left:40px;"><a href="#%C2%A0%E7%AC%AC%E5%9B%9B%E9%83%A8%E5%88%86%E3%80%81%E6%80%BB%E7%BB%93" rel="nofollow"> 第四部分、总结</a></p> 
<p id="1%E3%80%81%E6%95%88%E6%9E%9C%E6%BC%94%E7%A4%BA-toc" style="margin-left:80px;"><a href="#1%E3%80%81%E6%95%88%E6%9E%9C%E6%BC%94%E7%A4%BA" rel="nofollow">1、效果演示</a></p> 
<p id="2%E3%80%81%E6%84%9F%E6%83%B3-toc" style="margin-left:80px;"><a href="#2%E3%80%81%E6%84%9F%E6%83%B3" rel="nofollow">2、感想</a></p> 
<p id="3%E3%80%81%E5%AE%8C%E6%95%B4%E5%B7%A5%E7%A8%8B-toc" style="margin-left:80px;"><a href="#3%E3%80%81%E5%AE%8C%E6%95%B4%E5%B7%A5%E7%A8%8B" rel="nofollow">3、完整工程</a></p> 
<hr id="hr-toc"> 
<h3 id="%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%E3%80%81%E5%89%8D%E8%A8%80">第一部分、前言</h3> 
<h4 id="1%E3%80%81%E9%97%B2%E8%AF%9D">1、闲话</h4> 
<p style="text-indent:33px;">还是一样，这个设计也是我们<strong>《SOPC技术及应用》</strong>课程结束的期末作业。我自己的是老师题库里的第题、驱动AD9854这个模块，题目要求在第一篇已经说到了，想回去看的铁子们可以回去看。</p> 
<p style="text-indent:33px;">这一题是我室友的，报酬是给我买一杯奶茶（结果没给，我亏大发了😭😭😭），效果如下：</p> 
<p style="text-align:center;"><img alt="" height="787" src="https://images2.imgbox.com/62/bb/5CgRhP2X_o.jpg" width="590"></p> 
<h3 id="%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E3%80%81%E9%A2%98%E7%9B%AE%E8%A6%81%E6%B1%82">第二部分、题目要求</h3> 
<h4 id="1%E3%80%81%E5%9B%BE%E7%89%87">1、图片</h4> 
<p style="text-align:center;"><img alt="" height="133" src="https://images2.imgbox.com/1e/98/hGVNCugi_o.png" width="935"></p> 
<h4>2、文字描述</h4> 
<p style="text-indent:33px;">使用FPGA调通DHT11温湿度传感器，并能够将温度和湿度实时显示在lcd上，系统需要使用ucosii操作系统。</p> 
<h4 id="3%E3%80%81dht11%E7%9F%A5%E8%AF%86">3、dht11知识</h4> 
<p style="text-indent:33px;">关于<strong>DHT11的知识</strong>，你到CSDN搜一下，<strong>出来一大把</strong>，<strong>有些博主很详细的讲述了这个模块的工作原理</strong>，我这里就不做详述了。</p> 
<h3 id="%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86%E3%80%81%E5%B7%A5%E7%A8%8B%E4%BB%A3%E7%A0%81">第三部分、工程代码</h3> 
<h4 id="1%E3%80%81%E8%BD%AF%E6%A0%B8%E7%9A%84%E6%90%AD%E5%BB%BA">1、软核的搭建</h4> 
<p style="text-align:center;"><img alt="" height="729" src="https://images2.imgbox.com/02/0b/qUJvnSWv_o.png" width="1200"></p> 
<h4 id="%C2%A02%E3%80%81%E9%A1%B6%E5%B1%82%E6%96%87%E4%BB%B6%E7%9A%84%E4%BB%A3%E7%A0%81"> 2、顶层文件的代码</h4> 
<pre><code class="language-php">module AC620_GHRD(
	input  wire        clk,                           //                        clk.clk
	input  wire        reset_n,                     //                      reset.reset_n
	output wire        lcd_rst,                    //                    lcd_rst.export
	output wire        lcd_rd_n,                     //                     lcd_rd.export
	output wire        lcd_bl,                     //                     lcd_bl.export
	output wire        lcd_wr_n,                     //                     lcd_wr.export
	output wire        lcd_rs,                     //                     lcd_rs.export
	output wire        lcd_cs_n,                     //                     lcd_cs.export
	inout  wire [15:0] lcd_data,                     //                     lcd_db.export
	output wire        sdram_clk,                     //                  sdram_clk.clk
	output wire [11:0] sdram_addr,                        //                      sdram.addr
	output wire [1:0]  sdram_ba,                          //                           .ba
	output wire        sdram_cas_n,                       //                           .cas_n
	output wire        sdram_cke,                         //                           .cke
	output wire        sdram_cs_n,                        //                           .cs_n
	inout  wire [15:0] sdram_dq,                          //                           .dq
	output wire [1:0]  sdram_dqm,                         //                           .dqm
	output wire        sdram_ras_n,                       //                           .ras_n
	output wire        sdram_we_n,                         //                           .we_n
	input  wire        uart_0_rxd,                        //                     uart_0.rxd
	output wire        uart_0_txd,                        //                           .txd
	output wire        epcs_dclk,                         //                       epcs.dclk
	output wire        epcs_sce,                          //                           .sce
	output wire        epcs_sdo,                          //                           .sdo
	input  wire        epcs_data0,                         //                           .data0

	//对PIO端口进行定义
	inout  wire        dht11,
   output wire [3:0]  led

);

    mysystem u0 (
		.clk_clk                           (clk),                           //                        clk.clk
		.reset_reset_n                     (reset_n),                     //                      reset.reset_n
      .uart_0_rxd                        (uart_0_rxd),                        //                     uart_0.rxd
      .uart_0_txd                        (uart_0_txd),                        //                           .txd
      .epcs_dclk                         (epcs_dclk),                         //                       epcs.dclk
      .epcs_sce                          (epcs_sce),                          //                           .sce
      .epcs_sdo                          (epcs_sdo),                          //                           .sdo
      .epcs_data0                        (epcs_data0),                        //
		.lcd_rst_export                    (lcd_rst),                    //                    lcd_rst.export
		.lcd_bl_export                     (lcd_bl),                     //                     lcd_bl.export
		.lcd_wr_n                          (lcd_wr_n),                          //                        lcd.wr_n
		.lcd_rd_n                          (lcd_rd_n),                          //                           .rd_n
		.lcd_data                          (lcd_data),                          //                           .data
		.lcd_rs                            (lcd_rs),                            //                           .rs
		.lcd_cs_n                          (lcd_cs_n),                           //  
		.sdram_clk_clk                     (sdram_clk),                     //                  sdram_clk.clk
		.altpll_0_phasedone_conduit_export (), // altpll_0_phasedone_conduit.export
		.altpll_0_locked_conduit_export    (),    //    altpll_0_locked_conduit.export
		.altpll_0_areset_conduit_export    (),    //    altpll_0_areset_conduit.export
		.sdram_addr                        (sdram_addr),                        //                      sdram.addr
		.sdram_ba                          (sdram_ba),                          //                           .ba
		.sdram_cas_n                       (sdram_cas_n),                       //                           .cas_n
		.sdram_cke                         (sdram_cke),                         //                           .cke
		.sdram_cs_n                        (sdram_cs_n),                        //                           .cs_n
		.sdram_dq                          (sdram_dq),                          //                           .dq
		.sdram_dqm                         (sdram_dqm),                         //                           .dqm
		.sdram_ras_n                       (sdram_ras_n),                       //                           .ras_n
		.sdram_we_n                        (sdram_we_n),                        //                           .we_n
	   
		//添加的PIO端口
		.dht11_export                      (dht11),   //     dht11.export
      .led_export                        (led)      //       led.export
	
	);

endmodule</code></pre> 
<h4 id="%C2%A03%E3%80%81Ecplise%E4%BB%A3%E7%A0%81"> 3、Ecplise代码</h4> 
<p><strong>dht11.c代码</strong></p> 
<pre><code class="language-cpp">#include "dht11.h"
//复位DHT11
void DHT11_Rst(void)
{
	IOWR_ALTERA_AVALON_PIO_DIRECTION(DHT11_BASE, 1);//方向为输出
	IOWR_ALTERA_AVALON_PIO_DATA(DHT11_BASE, 1);
	usleep(25);//初始25us为高电平

//	DHT11_IO_OUT(); 	//SET OUTPUT
//    DHT11_DQ_OUT=0; 	//拉低DQ
//    delay_ms(20);    	//拉低至少18ms
	IOWR_ALTERA_AVALON_PIO_DATA(DHT11_BASE, 0);
	usleep(18000);

//    DHT11_DQ_OUT=1; 	//DQ=1
//	delay_us(30);     	//主机拉高20~40us
	IOWR_ALTERA_AVALON_PIO_DATA(DHT11_BASE, 1);
	usleep(30);
}
//等待DHT11的回应
//返回1:未检测到DHT11的存在
//返回0:存在
alt_u8 DHT11_Check(void)
{
	alt_u8 retry=0;
	IOWR_ALTERA_AVALON_PIO_DIRECTION(DHT11_BASE, 0);//方向为输入
    while (IORD_ALTERA_AVALON_PIO_DATA(DHT11_BASE)&amp;&amp;retry&lt;100)//DHT11会拉低40~80us
	{
		retry++;
		usleep(1);
	};
	if(retry&gt;=100)return 1;
	else retry=0;
    while (!IORD_ALTERA_AVALON_PIO_DATA(DHT11_BASE)&amp;&amp;retry&lt;100)//DHT11拉低后会再次拉高40~80us
	{
		retry++;
		usleep(1);
	};
	if(retry&gt;=100)return 1;
	return 0;
}

//从DHT11读取一个位
//返回值：1/0
alt_u8 DHT11_Read_Bit(void)
{
	alt_u8 retry=0;
	IOWR_ALTERA_AVALON_PIO_DIRECTION(DHT11_BASE, 0);//方向为输入
	while(IORD_ALTERA_AVALON_PIO_DATA(DHT11_BASE)&amp;&amp;retry&lt;100)//等待变为低电平
	{
		retry++;
//		delay_us(1);
		usleep(1);
	}
	retry=0;
	while(!IORD_ALTERA_AVALON_PIO_DATA(DHT11_BASE)&amp;&amp;retry&lt;100)//等待变高电平
	{
		retry++;
//		delay_us(1);
		usleep(1);
	}
//	delay_us(40);//等待40us
	usleep(40);
	if(IORD_ALTERA_AVALON_PIO_DATA(DHT11_BASE))return 1;
	else return 0;
}

//从DHT11读取一个字节
//返回值：读到的数据
alt_u8 DHT11_Read_Byte(void)
{
	alt_u8 i,dat;
    dat=0;
	for (i=0;i&lt;8;i++)
	{
   		dat&lt;&lt;=1;
	    dat|=DHT11_Read_Bit();
    }
    return dat;
}

//从DHT11读取一次数据
//temp:温度值(范围:0~50°)
//humi:湿度值(范围:20%~90%)
//返回值：0,正常;1,读取失败
alt_u8 DHT11_Read_Data(alt_u8 *temp,alt_u8 *humi)
{
	alt_u8 buf[5];
	alt_u8 i;
	DHT11_Rst();
	if(DHT11_Check()==0)
		{
			for(i=0;i&lt;5;i++)//读取40位数据
			{
				buf[i]=DHT11_Read_Byte();
			}
			if((buf[0]+buf[1]+buf[2]+buf[3])==buf[4])
			{
				*humi=buf[0];
				*temp=buf[2];
			}
		}else return 1;
		return 0;
}

//初始化DHT11的IO口 DQ 同时检测DHT11的存在
//返回1:不存在
//返回0:存在
alt_u8 DHT11_Init(void)
{
	DHT11_Rst();  //复位DHT11
	return DHT11_Check();//等待DHT11的回应
}</code></pre> 
<p><strong> dht11.h代码</strong></p> 
<pre><code class="language-cpp">#ifndef DHT11_H_
#define DHT11_H_

#include "stdlib.h"
#include "stdint.h"
#include "system.h"
#include "alt_types.h"
#include &lt;stdio.h&gt;  //printf的头文件
#include "io.h"   //函数类型
#include "altera_avalon_pio_regs.h"
#include "unistd.h"		//延时函数的头文件

//复位DHT11
void DHT11_Rst(void);
alt_u8 DHT11_Read_Data(alt_u8 *temp,alt_u8 *humi);
alt_u8 DHT11_Read_Byte(void);
alt_u8 DHT11_Read_Bit(void);
alt_u8 DHT11_Init(void);
alt_u8 DHT11_Check(void) ;

#endif /* DHT11_H_ */</code></pre> 
<p><strong> 主函数代码</strong></p> 
<pre><code class="language-cpp">#include "lcd9341.h"
#include "dht11.h"
#include &lt;stdio.h&gt;

alt_u8 temperature;
alt_u8 humidity;

int main()
{
	printf("I am 666!\n");
 	LCD9341_Init();
 	unsigned char a1[20],a2[20];
 	while(DHT11_Init())	//DHT11初始化
	{
		LCD_ShowString(30,130,"DHT11 Error");
		usleep(1000000);
	}
 	LCD_ShowString(30,130,"DHT11 OK    ");
	while(1)
	{
		DHT11_Read_Data(&amp;temperature,&amp;humidity);	//读取温湿度值
		printf("%d\n",temperature);
		printf("%d\n",humidity);
  		sprintf(a1,"Temp = %dC",temperature);
  		sprintf(a2,"Hum  = %d%%",humidity);
		LCD_ShowString(30,150,a1);
		LCD_ShowString(30,170,a2);
		usleep(1000000);
	}
}</code></pre> 
<h3 id="%C2%A0%E7%AC%AC%E5%9B%9B%E9%83%A8%E5%88%86%E3%80%81%E6%80%BB%E7%BB%93"> 第四部分、总结</h3> 
<h4 id="1%E3%80%81%E6%95%88%E6%9E%9C%E6%BC%94%E7%A4%BA">1、效果演示</h4> 
<p style="text-indent:33px;">DHT11的数据脚接<strong><span style="color:#f33b45;">FPGA的R1管脚。</span></strong>这里只展示图片，视频文件我已经上传到群文件，你也可以点击这里看一下演示效果（<a href="https://live.csdn.net/v/121263" rel="nofollow">https://live.csdn.net/v/121263</a>）</p> 
<p style="text-align:center;"><img alt="" height="540" src="https://images2.imgbox.com/1d/2a/gxr9XSfu_o.png" width="1007"></p> 
<p> </p> 
<h4 id="2%E3%80%81%E6%84%9F%E6%83%B3">2、感想</h4> 
<p style="text-indent:33px;">调试这个模块确实搞得我头都大了，虽然只用了两三个小时，但是搞得我心烦气燥。一开始是移植CSDN上面的51的时序，结果出问题，然后没法，我又重新移植32上驱动这个模块的时序，调试了好半天才搞好。（其实这两个时序都是一样的，第一次出的问题，我懒得回去看，大概是延时不准，导致时序出了问题）。</p> 
<p style="text-indent:33px;">这个模块对时序的要求很严格，然后<strong>检测温度时温度值上升的很慢，但是检测湿度的值还是挺快的。</strong></p> 
<h4 id="3%E3%80%81%E5%AE%8C%E6%95%B4%E5%B7%A5%E7%A8%8B">3、完整工程</h4> 
<p style="text-indent:33px;"><strong><span style="color:#86ca5e;">嫖嫖怪</span></strong>时间，还是一样，扫码进群，我会放在群资料里面。<strong>或者让我<span style="color:#7c79e5;">骗</span>你几个积分</strong>（<a href="https://download.csdn.net/download/Learning1232/13695741">https://download.csdn.net/download/Learning1232/13695741</a>）再或者留下邮箱，我看到了就发给你。当然有问题直接留言。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c297955fcb1db9bfc5eb93e67fcd1382/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">su -s /bin/sh -c “nova-manage api_db sync“ nova报错</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/155cd169c5787292bdca4ea07fc2325d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python安装sklearn，亲测有效！！！</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>