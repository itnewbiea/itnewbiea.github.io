<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Python爬虫---js逆向】Js逆向之网易云音乐 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【Python爬虫---js逆向】Js逆向之网易云音乐" />
<meta property="og:description" content="通过逆向找打这个加密window.asrsea这个函数了
首先明确这里的4个参数分别对应什么，分别对应着下面四个参数
JSON.stringify(i8a), bsF6z([&#34;流泪&#34;, &#34;强&#34;]), bsF6z(St0x.md), bsF6z([&#34;爱心&#34;, &#34;女孩&#34;, &#34;惊恐&#34;, &#34;大笑&#34;]
所以发现JSON.stringify (i8a)被b函数加工以后，再次被b函数进行加工，接下来到b函数里面看看是什么
终于发现了这是AES加密的特征
1，扣代码，对数据进行加密 接下来就是如何破解
第一种方法：直接全扣下来，缺什么就补什么 不知道如何加密的情况下，直接扣代码，缺什么就补什么（比较耗时，考验耐心，也比较好用）
打开pycharm，新建一个js文件
（注意了，你得安装好Node环境，pycharm写的js代码需要Node环境才能运行，而且浏览器环境跟Node环境有一些区别，我们从浏览器环境扣下来的js代码，在node环境运行的话会有些问题，根据具体问题补环境即可，比如说Node下js不能操作dom，没有window对象，如果扣下来的代码有window对象或者右操作dom的代码则需要进行适当的补环境）
所以自行百度准备好node环境
接下来可以扣代码了，思路就是缺什么函数，从浏览器复制什么函数，直到补完位置
比如说，就从加密入口函数下手
function d(d, e, f, g) { var h = {} , i = a(16); return h.encText = b(d, g), h.encText = b(h.encText, i), h.encSecKey = c(i, e, f), h } var first = &#39;{&#34;logs&#34;:&#34;[{\\&#34;action\\&#34;:\\&#34;mobile_monitor\\&#34;,\\&#34;json\\&#34;:{\\&#34;meta._ver\\&#34;:2,\\&#34;meta._dataName\\&#34;:\\&#34;pip_lyric_monitor\\&#34;,\\&#34;action\\&#34;:\\&#34;render\\&#34;,\\&#34;userAgent\\&#34;:\\&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36\\&#34;,\\&#34;chromeVersion\\&#34;:116,\\&#34;resourceId\\&#34;:1974443814,\\&#34;resourceType\\&#34;:\\&#34;song\\&#34;}}]&#34;,&#34;csrf_token&#34;:&#34;&#34;}&#39; var second = &#39;010001&#39; var third = &#39;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7&#39; var forth = &#39;0CoJUm6Qyw8W8jud&#39; var result = d(first,second,third,forth) console." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/633111b8626e8333f051ce9652926a97/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-04T15:38:04+08:00" />
<meta property="article:modified_time" content="2023-10-04T15:38:04+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Python爬虫---js逆向】Js逆向之网易云音乐</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 id="1%EF%BC%8C%E6%8A%93%E5%8C%85%EF%BC%8C%E6%89%BE%E5%88%B0%E9%9C%80%E8%A6%81%E4%B8%8B%E8%BD%BD%E7%9A%84URL"></h2> 
<p><span style="color:#fe2c24;"><strong>通过逆向找打这个加密window.asrsea这个函数了</strong></span></p> 
<p><img alt="" height="555" src="https://images2.imgbox.com/7e/1f/3cuuicVW_o.png" width="899"></p> 
<p> <img alt="" height="203" src="https://images2.imgbox.com/c4/5a/ensBLctn_o.png" width="647"></p> 
<p><strong><span style="color:#fe2c24;">首先明确这里的4个参数分别对应什么，分别对应着下面四个参数</span></strong></p> 
<p><span style="color:#0d0016;">JSON.stringify(i8a), bsF6z(["流泪", "强"]), bsF6z(St0x.md), bsF6z(["爱心", "女孩", "惊恐", "大笑"]</span></p> 
<p><span style="color:#0d0016;">所以发现JSON.stringify (i8a)被b函数加工以后，再次被b函数进行加工，接下来到b函数里面看看是什么</span></p> 
<p><img alt="" height="240" src="https://images2.imgbox.com/0b/8b/FDtsUHV0_o.png" width="844"></p> 
<p> <strong><span style="color:#fe2c24;">终于发现了这是AES加密的特征</span></strong></p> 
<h2 id="3%EF%BC%8C%E6%89%A3%E4%BB%A3%E7%A0%81%EF%BC%8C%E5%AF%B9%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E5%8A%A0%E5%AF%86">1，扣代码，对数据进行加密</h2> 
<p>接下来就是如何破解</p> 
<h3 id="%E7%AC%AC%E4%B8%80%E7%A7%8D%E6%96%B9%E6%B3%95%EF%BC%9A%E7%9B%B4%E6%8E%A5%E5%85%A8%E6%89%A3%E4%B8%8B%E6%9D%A5%EF%BC%8C%E7%BC%BA%E4%BB%80%E4%B9%88%E5%B0%B1%E8%A1%A5%E4%BB%80%E4%B9%88">第一种方法：直接全扣下来，缺什么就补什么</h3> 
<p>不知道如何加密的情况下，直接扣代码，缺什么就补什么（比较耗时，考验耐心，也比较好用）</p> 
<p>打开pycharm，新建一个js文件</p> 
<p>（注意了，你得安装好Node环境，pycharm写的js代码需要Node环境才能运行，而且浏览器环境跟Node环境有一些区别，我们从浏览器环境扣下来的js代码，在node环境运行的话会有些问题，根据具体问题补环境即可，比如说Node下js不能操作dom，没有window对象，如果扣下来的代码有window对象或者右操作dom的代码则需要进行适当的补环境）</p> 
<p>所以自行百度准备好node环境</p> 
<p>接下来可以扣代码了，思路就是缺什么函数，从浏览器复制什么函数，直到补完位置</p> 
<p>比如说，就从加密入口函数下手</p> 
<pre><code class="language-javascript">function d(d, e, f, g) {
        var h = {}
          , i = a(16);
        return h.encText = b(d, g),
        h.encText = b(h.encText, i),
        h.encSecKey = c(i, e, f),
        h
}
    var first = '{"logs":"[{\\"action\\":\\"mobile_monitor\\",\\"json\\":{\\"meta._ver\\":2,\\"meta._dataName\\":\\"pip_lyric_monitor\\",\\"action\\":\\"render\\",\\"userAgent\\":\\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36\\",\\"chromeVersion\\":116,\\"resourceId\\":1974443814,\\"resourceType\\":\\"song\\"}}]","csrf_token":""}'

    var second = '010001'
    var third = '00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7'
    var forth = '0CoJUm6Qyw8W8jud'
    var result = d(first,second,third,forth)
console.log(result)</code></pre> 
<p>加密函数是d,d需要四个参数，之前讲过了，分别是</p> 
<p>JSON.stringify(i8a), bsF6z(["流泪", "强"]), bsF6z(St0x.md), bsF6z(["爱心", "女孩", "惊恐", "大笑"]</p> 
<p>分别在console里面输出一下可以拿到一个他的值（而且不是随机的，是固定的）</p> 
<p><img alt="" height="341" src="https://images2.imgbox.com/ab/34/F4nYKFxC_o.png" width="1200"></p> 
<p>需要注意的是第一个参数，JSON.stringify这个函数 用于把一个对象序列化，简单理解就是变成字符串，如有个对象{"name":"aini","age":18}，序列化以后就成了'{"name":"aini","age":18}',整体用单引号包裹，变成了字符串（可以自己百度一下JS序列化反序列相关知识</p> 
<p>接下来就是执行函数。缺什么补什么，直到成功为止</p> 
<p><img alt="" height="380" src="https://images2.imgbox.com/f8/51/HOJ0RkQU_o.png" width="1200"></p> 
<p>（注意运行js代码需要Node环境，请提前下载安装好，还有就是在终端cd 到你当前目录再运行）</p> 
<p><img alt="" height="813" src="https://images2.imgbox.com/33/72/XpEi73s0_o.png" width="1200"></p> 
<p><img alt="" height="1158" src="https://images2.imgbox.com/97/7b/mdBoHRl3_o.png" width="1188"> <img alt="" height="1200" src="https://images2.imgbox.com/4a/eb/0oQuTcd3_o.png" width="1200"></p> 
<p>b函数没找到，缺什么就补什么</p> 
<p><img alt="" height="159" src="https://images2.imgbox.com/23/7d/USF8osyl_o.png" width="1200"> <img alt="" height="813" src="https://images2.imgbox.com/36/01/1eEmmNDy_o.png" width="853"></p> 
<p>就这样缺什么就补什么，通过九九八十一难，终于所有加密代码都扣完了、</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/d1/65/nloj5rBD_o.png" width="1200"></p> 
<p>注意：有些需要补的函数直接全局搜即可，找起来比较快，比如现在提示缺digitToHex函数，那直接复制去浏览区全局搜，步骤如下</p> 
<p><img alt="" height="460" src="https://images2.imgbox.com/7e/6a/GKp3wryy_o.png" width="756"></p> 
<p> <img alt="" height="346" src="https://images2.imgbox.com/ca/7c/fRJudEOk_o.png" width="1160"></p> 
<p><img alt="" height="671" src="https://images2.imgbox.com/ba/8d/gNJih5Cv_o.png" width="1200"> 就这样很容易的找到函数了</p> 
<h3 id="%E7%AC%AC%E4%BA%8C%E4%B8%AD%E6%96%B9%E6%B3%95%EF%BC%8C%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E6%89%A3%E4%BB%A3%E7%A0%81">第二中方法，用第三方库扣代码</h3> 
<p>首先我们需要安装第三方库 crypto-js</p> 
<p>可以用包管理软件npm ,如果你下载安装好了node环境而且配置好了环境变量npm可以直接使用的</p> 
<p>先检车是否有npm </p> 
<p>打开终端以后 输入 npm -v 如果看到版本说明安装好了，如果报错请百度一下，如何安装node和npm</p> 
<p><img alt="" height="568" src="https://images2.imgbox.com/fe/55/Wq32PPtK_o.png" width="1200"></p> 
<p>npm install crypto-js 提示升级一下npm版本，那就先进行升级<img alt="" height="411" src="https://images2.imgbox.com/24/6d/JJ5mSPBs_o.png" width="1200"></p> 
<p> 我之前安装过这个包，所以我不安装了，我直接给大伙上代码</p> 
<p>首先需要引入我们安装的crypto-js包</p> 
<p>node环境中用 requere函数</p> 
<p>还有从一个Rsa加密文件里分别取出三个函数（这个文件内容很长，就不放这里了，有需要的留言）</p> 
<p></p> 
<p>我们注意带!function里面是一个立即执行函数，里面还有a,b,c,d四个函数，只要我们进行适当替换，就可以不用扣第一种方法一样扣大量代码了</p> 
<pre><code class="language-javascript">const CryptoJS = require("crypto-js")
var window = this

const {
	setMaxDigits,
	RSAKeyPair,
	encryptedString
} = require("./Ras加密");
!function() {
    function a(a) {
        var d, e, b = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789", c = "";
        for (d = 0; a &gt; d; d += 1)
            e = Math.random() * b.length,
            e = Math.floor(e),
            c += b.charAt(e);
        return c
    }
    function b(a, b) {
        var c = CryptoJS.enc.Utf8.parse(b)
          , d = CryptoJS.enc.Utf8.parse("0102030405060708")
          , e = CryptoJS.enc.Utf8.parse(a)
          , f = CryptoJS.AES.encrypt(e, c, {
            iv: d,
            mode: CryptoJS.mode.CBC
        });
        return f.toString()
    }
    function c(a, b, c) {
        var d, e;
        return setMaxDigits(131),
        d = new RSAKeyPair(b,"",c),
        e = encryptedString(d, a)
    }
    function d(d, e, f, g) {
        var h = {}
          , i = a(16);
        return h.encText = b(d, g),
        h.encText = b(h.encText, i),
        h.encSecKey = c(i, e, f),
        h
    }
    function e(a, b, d, e) {
        var f = {};
        return f.encText = c(a + e, b, d),
        f
    }
    window.asrsea = d,
    window.ecnonasr = e
}();

    var params = {
        csrf_token: "",
        encodeType: "aac",
        ids: "[1325905146]",
        level: "standard"
    }
    var second = '010001'
    var third = '00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7'
    var forth = '0CoJUm6Qyw8W8jud'


function fn(params) {
       return window.asrsea(JSON.stringify(params),second,third,forth)
}


function c(a,b,c){
    var d,e;
    return setMaxDigits(131),
        d = new RSAKeyPair(b,"",c),
        e = encryptedString(d,a)
}


</code></pre> 
<p>这是一个立即执行函数，里面是a,b,c,d四个函数，主要加密逻辑就在其中，我们已经导入了crypto-js包，还有从RSA加密里面导入了三个函数这个解密文件就写完了</p> 
<p></p> 
<p>需要注意的是var windows = this </p> 
<p>因为我们扣的代码里有window,而node里没有window ,所以需要补window环境 </p> 
<p><img alt="" height="979" src="https://images2.imgbox.com/c6/1d/8N8pmKpV_o.png" width="1080"></p> 
<h2 id="4%EF%BC%8C%E6%8E%A5%E4%B8%8B%E6%9D%A5%E5%B0%B1%E6%98%AF%E7%94%A8Python%E5%86%99%E4%BB%A3%E7%A0%81%E8%BF%9B%E9%A1%B9%E7%88%AC%E5%8F%96%E9%9F%B3%E4%B9%90">2，接下来就是用Python写代码进项爬取音乐</h2> 
<pre><code class="language-javascript">import requests

import subprocess
from functools import partial
subprocess.Popen = partial(subprocess.Popen, encoding='utf-8')

import execjs
url = 'https://music.163.com/weapi/song/enhance/player/url/v1?csrf_token='

f = open('用第三方库扣代码.js',mode='r',encoding="utf-8")
js_code = f.read()


params = {
	'csrf_token': "",
	'encodeType': "aac",
	'ids': "[1325905146,2025152494]",
	'level': "standard"
}

js = execjs.compile(js_code)
res = js.call("fn",params)


data = {
'params': res['encText'],
'encSecKey': res['encSecKey']
}
headers = {
'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36'
}
session = requests.Session()
session.headers = headers

res = session.post(url=url,data=data)
dic = res.json()

items = dic['data']

for i in items:
	print(i['url'])</code></pre> 
<p> 这是Python代码，我们直接读取第三方库扣代码文件里的代码，执行，拿到加密结果以后既可以发请求，获取到URL音乐URL了</p> 
<p><img alt="" height="504" src="https://images2.imgbox.com/5f/ef/W917TH0X_o.png" width="1200"></p> 
<p> 接下来就是再往这个URL发请求，直接拿到相应结果以后，以二进制形式写入到文件就可以了</p> 
<p>由于能分享的内容有限，详细逆向过程被迫删掉了，想了解的可以技术交流一下</p> 
<p>好了今天就讲到这里，如果遇到问题，或者不懂的地方可以留言，我会及时回复的 </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/85c553924a6995b9b5d404fd96e2ffb7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">记录下StableDiffusion的webui启动参数（cmd_args.py）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3bdd981ca0a669b47694e1b34c71fbc7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C#停车场管理系统</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>