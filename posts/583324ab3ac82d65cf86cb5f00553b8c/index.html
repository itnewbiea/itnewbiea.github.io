<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用EPPlus实现Excel导出 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用EPPlus实现Excel导出" />
<meta property="og:description" content="使用EPPlus实现Excel导出 引言一、如何获取对象(类)属性和值？1.1 创建对象(类)1.2 获取对象(类)的属性1.3 获取对象(类)的属性值 二、通过对象(类)的属性和值进行导出2.1 NuGet:EPPlus2.2 创建EPPlus导出Excel的辅助类2.3 Web层调用导出 引言 使用EPPlus导出Excel我们在封装之前，需要明白怎么去根据一个对象(类)获取到其属性和属性的值，当我们提前弄清楚这个东东的话，对我们后续的工作就好开展了！因为EPPlus导出Excel是需要进行行列对应的，不能每导出一个列表，我们都要手动去控制这个对象所需多少行，多少列吧，明显太费事也行不通。所以获取对象(类)获取到其属性和属性的值是我们前提必备的要件！
一、如何获取对象(类)属性和值？ 1.1 创建对象(类) public class FyLogDto { /// &lt;summary&gt; /// 标识 /// &lt;/summary&gt; public string ID { get; set; } /// &lt;summary&gt; /// IP /// &lt;/summary&gt; public string IP { get; set; } /// &lt;summary&gt; /// 机器名称 /// &lt;/summary&gt; public string MachineName { get; set; } /// &lt;summary&gt; /// 日志类型 /// &lt;/summary&gt; public string Level { get; set; } /// &lt;summary&gt; /// 日志内容 /// &lt;/summary&gt; public string Message { get; set; } /// &lt;summary&gt; /// 记录器名称 /// &lt;/summary&gt; public string Logger { get; set; } /// &lt;summary&gt; /// 调用站点 /// &lt;/summary&gt; public string Callsite { get; set; } /// &lt;summary&gt; /// Url /// &lt;/summary&gt; public string Url { get; set; } /// &lt;summary&gt; /// 控制器 /// &lt;/summary&gt; public string Controller { get; set; } /// &lt;summary&gt; /// 控制器的的方法 /// &lt;/summary&gt; public string Action { get; set; } /// &lt;summary&gt; /// 请求方式：GET,POST,PUT." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/583324ab3ac82d65cf86cb5f00553b8c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-16T19:11:38+08:00" />
<meta property="article:modified_time" content="2021-04-16T19:11:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用EPPlus实现Excel导出</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>使用EPPlus实现Excel导出</h4> 
 <ul><li><a href="#_1" rel="nofollow">引言</a></li><li><ul><li><a href="#_5" rel="nofollow">一、如何获取对象(类)属性和值？</a></li><li><ul><li><a href="#11__6" rel="nofollow">1.1 创建对象(类)</a></li><li><a href="#12__72" rel="nofollow">1.2 获取对象(类)的属性</a></li><li><a href="#13__92" rel="nofollow">1.3 获取对象(类)的属性值</a></li></ul> 
   </li><li><a href="#_133" rel="nofollow">二、通过对象(类)的属性和值进行导出</a></li><li><ul><li><a href="#21_NuGetEPPlus_134" rel="nofollow">2.1 NuGet:EPPlus</a></li><li><a href="#22_EPPlusExcel_136" rel="nofollow">2.2 创建EPPlus导出Excel的辅助类</a></li><li><a href="#23_Web_210" rel="nofollow">2.3 Web层调用导出</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>引言</h2> 
<blockquote> 
 <p>使用<strong>EPPlus</strong>导出<strong>Excel</strong>我们在封装之前，需要明白怎么去根据一个<strong>对象(类)获取到其属性和属性的值</strong>，当我们提前弄清楚这个东东的话，对我们后续的工作就好开展了！因为<strong>EPPlus</strong>导出<strong>Excel</strong>是需要进行行列对应的，不能每导出一个列表，我们都要手动去控制这个对象所需多少行，多少列吧，明显太费事也行不通。所以<strong>获取对象(类)获取到其属性和属性的值</strong>是我们前提必备的要件！</p> 
</blockquote> 
<h3><a id="_5"></a>一、如何获取对象(类)属性和值？</h3> 
<h4><a id="11__6"></a>1.1 创建对象(类)</h4> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FyLogDto</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 标识</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">string</span> ID <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// IP</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">string</span> IP <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 机器名称</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">string</span> MachineName <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 日志类型</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">string</span> Level <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 日志内容</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">string</span> Message <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 记录器名称</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">string</span> Logger <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 调用站点</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">string</span> Callsite <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Url</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">string</span> Url <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 控制器</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">string</span> Controller <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 控制器的的方法</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">string</span> Action <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 请求方式：GET,POST,PUT...</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">string</span> Method <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 日志记录时间</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">string</span> Logged <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h4><a id="12__72"></a>1.2 获取对象(类)的属性</h4> 
<pre><code class="prism language-csharp"> <span class="token keyword">class</span> <span class="token class-name">Program</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">FyLog</span> fyLog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FyLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            PropertyInfo<span class="token punctuation">[</span><span class="token punctuation">]</span> properties <span class="token operator">=</span> fyLog<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"============对象(类)的属性如下=============="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token keyword">var</span> property <span class="token keyword">in</span> properties<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>property<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            Console<span class="token punctuation">.</span><span class="token function">ReadKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/89/88/xc8DMKSt_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="13__92"></a>1.3 获取对象(类)的属性值</h4> 
<pre><code class="prism language-csharp"><span class="token keyword">class</span> <span class="token class-name">Program</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">FyLog</span> fyLog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FyLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
            <span class="token punctuation">{<!-- --></span>
                Id<span class="token operator">=</span><span class="token string">"ID"</span><span class="token punctuation">,</span>
                Ip<span class="token operator">=</span><span class="token string">"IP"</span><span class="token punctuation">,</span>
                Logged<span class="token operator">=</span>DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">,</span>
                Machinename<span class="token operator">=</span> <span class="token string">"Machinename"</span><span class="token punctuation">,</span>
                Level<span class="token operator">=</span><span class="token string">"Info"</span><span class="token punctuation">,</span>
                Message<span class="token operator">=</span> <span class="token string">"Message"</span><span class="token punctuation">,</span>
                Logger<span class="token operator">=</span> <span class="token string">"Logger"</span><span class="token punctuation">,</span>
                Callsite<span class="token operator">=</span> <span class="token string">"Callsite"</span><span class="token punctuation">,</span>
                Module<span class="token operator">=</span> <span class="token string">"Module"</span><span class="token punctuation">,</span>
                Url<span class="token operator">=</span><span class="token string">"http://42.193.5.236"</span><span class="token punctuation">,</span>
                Controller<span class="token operator">=</span> <span class="token string">"Controller"</span><span class="token punctuation">,</span>
                Action<span class="token operator">=</span><span class="token string">"Index"</span><span class="token punctuation">,</span>
                Method<span class="token operator">=</span><span class="token string">"GET"</span><span class="token punctuation">,</span>
                Exception<span class="token operator">=</span> <span class="token string">"Exception"</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>

            PropertyInfo<span class="token punctuation">[</span><span class="token punctuation">]</span> properties <span class="token operator">=</span> fyLog<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"==============获取对象(类)的属性值=============="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token keyword">var</span> item <span class="token keyword">in</span> properties<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">var</span> <span class="token keyword">value</span> <span class="token operator">=</span> fyLog<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetProperty</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetValue</span><span class="token punctuation">(</span>fyLog<span class="token punctuation">)</span><span class="token punctuation">;</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            Console<span class="token punctuation">.</span><span class="token function">ReadKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b1/99/UAaPaauj_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_133"></a>二、通过对象(类)的属性和值进行导出</h3> 
<h4><a id="21_NuGetEPPlus_134"></a>2.1 NuGet:EPPlus</h4> 
<p><img src="https://images2.imgbox.com/87/4d/K06l0VEM_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="22_EPPlusExcel_136"></a>2.2 创建EPPlus导出Excel的辅助类</h4> 
<blockquote> 
 <p>这里需要注意理解一下的是：<strong>EPPlus</strong>导出的一个行列顺序，表头：(1,1)，(1，2)，…，即：第一行第一列，第一行第二列，…，然后呢，第一行数据的起始位置：(2,1)，(2，2)…，即：第二行第一列，第二行第二列，接着(3,1)，(3,2)…，递推！！！把这个结构理解清楚，使用起<strong>EPPlus</strong>就显得相当简单了！</p> 
</blockquote> 
<pre><code class="prism language-csharp"> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExcelHelper</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token keyword">where</span> T<span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 获取类的属性值</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="obj"&gt;类&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name="property"&gt;属性&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">object</span> <span class="token function">GetPropertyValue</span><span class="token punctuation">(</span><span class="token keyword">object</span> obj<span class="token punctuation">,</span> <span class="token keyword">string</span> property<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> obj<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetProperty</span><span class="token punctuation">(</span>property<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetValue</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 获取类的全部属性</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="t"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> PropertyInfo<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">GetProperties</span><span class="token punctuation">(</span><span class="token class-name">T</span> t<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            PropertyInfo<span class="token punctuation">[</span><span class="token punctuation">]</span> properties <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> properties<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 导出Excel</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="fileInfo"&gt;FileInfo&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name="tList"&gt;数据&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token class-name">Task</span> <span class="token function">OutPutExcel</span><span class="token punctuation">(</span><span class="token class-name">FileInfo</span> fileInfo<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> tList<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//指定EPPlus使用非商业化许可证</span>
            ExcelPackage<span class="token punctuation">.</span>LicenseContext <span class="token operator">=</span> LicenseContext<span class="token punctuation">.</span>NonCommercial<span class="token punctuation">;</span>
            <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">ExcelPackage</span> package <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExcelPackage</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>      
                <span class="token comment">//工作簿</span>
                <span class="token class-name">ExcelWorksheet</span> worksheet <span class="token operator">=</span> package<span class="token punctuation">.</span>Workbook<span class="token punctuation">.</span>Worksheets<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">//实体属性</span>
                PropertyInfo<span class="token punctuation">[</span><span class="token punctuation">]</span> properties <span class="token operator">=</span> <span class="token function">GetProperties</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">//填充表头</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> properties<span class="token punctuation">.</span>Length<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> 
                <span class="token punctuation">{<!-- --></span>
                    worksheet<span class="token punctuation">.</span>Cells<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> i<span class="token punctuation">]</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> properties<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Name<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">//填充行(从第二行开始)</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> tList<span class="token punctuation">.</span>Count <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">//填充行内列</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> properties<span class="token punctuation">.</span>Length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">var</span> property <span class="token operator">=</span> properties<span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Name<span class="token punctuation">;</span>
                        worksheet<span class="token punctuation">.</span>Cells<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token function">GetPropertyValue</span><span class="token punctuation">(</span>tList<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> property<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>

                <span class="token comment">//列宽自适应</span>
                worksheet<span class="token punctuation">.</span>Cells<span class="token punctuation">.</span><span class="token function">AutoFitColumns</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">//保存</span>
                <span class="token keyword">await</span> package<span class="token punctuation">.</span><span class="token function">SaveAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>       
    <span class="token punctuation">}</span>
</code></pre> 
<h4><a id="23_Web_210"></a>2.3 Web层调用导出</h4> 
<pre><code class="prism language-csharp"> <span class="token punctuation">[</span><span class="token class-name">HttpGet</span><span class="token punctuation">(</span><span class="token string">"out"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token keyword">async</span> Task<span class="token operator">&lt;</span>FileResult<span class="token operator">&gt;</span> <span class="token function">OutPut</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">string</span> filePath <span class="token operator">=</span> Directory<span class="token punctuation">.</span><span class="token function">GetCurrentDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"/excels"</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Directory<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                Directory<span class="token punctuation">.</span><span class="token function">CreateDirectory</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">string</span> fileName <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token string">"yyyyMMddHHmmss"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".xlsx"</span><span class="token punctuation">;</span>
            <span class="token class-name">FileInfo</span> fileInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInfo</span><span class="token punctuation">(</span>Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> tlist <span class="token operator">=</span> <span class="token keyword">await</span> _fyLog<span class="token punctuation">.</span><span class="token function">GetListAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">await</span> ExcelHelper<span class="token operator">&lt;</span>FyLogDto<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">OutPutExcel</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">,</span> tlist<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">var</span> stream <span class="token operator">=</span> System<span class="token punctuation">.</span>IO<span class="token punctuation">.</span>File<span class="token punctuation">.</span><span class="token function">OpenRead</span><span class="token punctuation">(</span>Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> provider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileExtensionContentTypeProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">string</span> contentType <span class="token operator">=</span> provider<span class="token punctuation">.</span>Mappings<span class="token punctuation">[</span><span class="token class-name">Path<span class="token punctuation">.</span>GetExtension</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token function">File</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> contentType<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/58/31/CFbQBzYf_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f6f748e075efe98e3e77eefcd027e91f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">16.Flink开发笔记一</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8b1b6a879c6958c2dec4e8a550836237/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">二叉树遍历</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>