<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux中NTP同步，Server dropped: no data - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux中NTP同步，Server dropped: no data" />
<meta property="og:description" content="1.ntp同步配置内容，其中IP1、IP2代表同步时钟源IP，IP3代表本机IP
server IP1 server IP2 restrict IP3 nomodify notrap noquery restrict 192.168.0.1 mask 255.255.255.0 nomodify notrap server 127.127.1.0 # local clock fudge 127.127.1.0 stratum 10 第三行解释：
restrict [ 客户端IP ] mask [ IP掩码 ][参数]
“客户端IP” 和 “IP掩码” 指定了对网络中哪些范围的计算机进行控制，如果使用default关键字，则表示对所有的计算机进行控制，参数指定了具体的限制内容，常见的参数如下：
◆ ignore：拒绝连接到NTP服务器
◆ nomodiy： 客户端不能更改服务端的时间参数，但是客户端可以通过服务端进行网络校时。
◆ noquery： 不提供客户端的时间查询
◆ notrap： 不提供trap远程登录功能，trap服务是一种远程时间日志服务。
◆ notrust： 客户端除非通过认证，否则该客户端来源将被视为不信任子网 。
◆ nopeer： 提供时间服务，但不作为对等体。
◆ kod： 向不安全的访问者发送Kiss-Of-Death报文。
2.配置完成后，关闭ntpd服务，测试与时钟同步源之间是否可以同步上
service ntpd stop
ntpdate -u IP1或IP2
此时发现同步失败，执行ntpdate -d IP1，显示报错：xxx.xxx.xxx.xxx: Server dropped: no data" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/99e40ed60b0ca4b5a51d823a93d9ef01/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-05-28T16:30:55+08:00" />
<meta property="article:modified_time" content="2021-05-28T16:30:55+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux中NTP同步，Server dropped: no data</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>1.ntp同步配置内容，其中IP1、IP2代表同步时钟源IP，IP3代表本机IP</p> 
<pre><code>server IP1
server IP2
restrict IP3 nomodify notrap noquery
restrict 192.168.0.1 mask 255.255.255.0 nomodify notrap
server 127.127.1.0 # local clock
fudge 127.127.1.0 stratum 10</code></pre> 
<p>第三行解释：</p> 
<p>restrict [ 客户端IP ] mask [ IP掩码 ][参数]<br>  <br> “客户端IP” 和 “IP掩码” 指定了对网络中哪些范围的计算机进行控制，如果使用default关键字，则表示对所有的计算机进行控制，参数指定了具体的限制内容，常见的参数如下：<br>  <br> ◆ ignore：拒绝连接到NTP服务器<br>  <br> ◆ nomodiy： 客户端不能更改服务端的时间参数，但是客户端可以通过服务端进行网络校时。<br>  <br> ◆ noquery： 不提供客户端的时间查询<br>  <br> ◆ notrap： 不提供trap远程登录功能，trap服务是一种远程时间日志服务。<br>  <br> ◆ notrust： 客户端除非通过认证，否则该客户端来源将被视为不信任子网 。<br>  <br> ◆ nopeer： 提供时间服务，但不作为对等体。<br>  <br> ◆ kod： 向不安全的访问者发送Kiss-Of-Death报文。</p> 
<p>2.配置完成后，关闭ntpd服务，测试与时钟同步源之间是否可以同步上</p> 
<p style="margin-left:.0001pt;">service ntpd stop</p> 
<p style="margin-left:.0001pt;">ntpdate -u IP1或IP2</p> 
<p style="margin-left:.0001pt;">此时发现同步失败，执行ntpdate -d IP1，显示报错：xxx.xxx.xxx.xxx: Server dropped: no data</p> 
<p style="margin-left:.0001pt;">解决方案：</p> 
<p style="margin-left:.0001pt;">1.检查同步时钟源ntp服务是否启动；</p> 
<p style="margin-left:.0001pt;">2.若同步时钟源服务器上ntp服务已开启，如果还是报错，检查防火墙的udp端口123是否能用；</p> 
<p style="margin-left:.0001pt;">3.关闭防火墙，如果还是报错，检查时钟源服务器上/etc/ntp.conf是否限制其他服务器同步时钟，到IP1和IP2上操作：vi /etc/ntp.conf，</p> 
<p style="margin-left:.0001pt;">添加：server 127.127.1.0 # local clock<br>            fudge 127.127.1.0 stratum 10</p> 
<p style="margin-left:.0001pt;">注释掉：restrict default kod nomodify notrap nopeer noquery</p> 
<p><img alt="" height="83" src="https://images2.imgbox.com/90/78/HQp1ypWR_o.png" width="659"><img alt="" height="93" src="https://images2.imgbox.com/44/bb/sHIvqs52_o.png" width="519"></p> 
<p>4.步骤3操作完成之后，重启IP1和IP2的ntp服务，此时再次在IP3尝试ntpdate -u IP1，同步成功。注意，此时IP3ntp服务是停止状态</p> 
<pre><code>28 May 16:25:31 ntpdate[3390]: adjust time server IP1 offset 0.003874 sec</code></pre> 
<p>5.到IP3上执行service ntpd start，等待几分钟，执行ntpq -p</p> 
<p>结果显示如下，问题解决。</p> 
<p><img alt="" height="84" src="https://images2.imgbox.com/cf/2d/ebg4fFlu_o.png" width="659"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5ffba5edea6647da9deb7f933c5c8238/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">px em rem的区别</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/51f40097008c00cfec2ffa14c4a4e839/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">echars山东地图</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>