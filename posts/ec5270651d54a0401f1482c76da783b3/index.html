<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>uni-ui 版本升级提示做个记录 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="uni-ui 版本升级提示做个记录" />
<meta property="og:description" content="appUpdate.js
var _maskView, _contentView, _downloadTask, _loadingProgress, _screenHeight, _screenWidth, _config = {
forceUpgrade: false,
titleText: &#34;版本更新&#34;,
content: &#34;&#34;,
contentAlign: &#34;left&#34;,
loadingColor: &#34;#329EEE&#34;,
cancelText: &#34;暂不升级&#34;,
cancelColor: &#34;#666&#34;,
confirmText: &#34;立即升级&#34;,
confirmColor: &#34;#329EEE&#34;,
windowHeight: 380,
packageUrl: &#34;&#34;,
browser: false,
maskColor: &#34;rgba(0,0,0,0.3)&#34;
},
_calculatePosition = function() {
return {
top: (_screenHeight - _config.windowHeight) / 2,
left: _screenWidth * .05,
width: _screenWidth * .9,
right: _screenWidth * .05,
height: _config.windowHeight
}
},
_createMask = function() {" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/ec5270651d54a0401f1482c76da783b3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-04T14:52:43+08:00" />
<meta property="article:modified_time" content="2024-01-04T14:52:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">uni-ui 版本升级提示做个记录</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>appUpdate.js</p> 
<p>var _maskView, _contentView, _downloadTask, _loadingProgress, _screenHeight, _screenWidth, _config = {<!-- --><br>         forceUpgrade: false,<br>         titleText: "版本更新",<br>         content: "",<br>         contentAlign: "left",<br>         loadingColor: "#329EEE",<br>         cancelText: "暂不升级",<br>         cancelColor: "#666",<br>         confirmText: "立即升级",<br>         confirmColor: "#329EEE",<br>         windowHeight: 380,<br>         packageUrl: "",<br>         browser: false,<br>         maskColor: "rgba(0,0,0,0.3)"<br>     },<br>     _calculatePosition = function() {<!-- --><br>         return {<!-- --><br>             top: (_screenHeight - _config.windowHeight) / 2,<br>             left: _screenWidth * .05,<br>             width: _screenWidth * .9,<br>             right: _screenWidth * .05,<br>             height: _config.windowHeight<br>         }<br>     },<br>     _createMask = function() {<!-- --><br>         _maskView = new plus.nativeObj.View("maskView", {<!-- --><br>             top: "0px",<br>             left: "0px",<br>             width: "100%",<br>             height: "100%",<br>             backgroundColor: _config.maskColor<br>         })<br>     },<br>     _createContentView = function() {<!-- --><br>         var calculatePosition = _calculatePosition();<br>         _contentView = new plus.nativeObj.View("contentView", {<!-- --><br>             top: calculatePosition.top + "px",<br>             left: calculatePosition.left + "px",<br>             height: _config.windowHeight + "px",<br>             width: calculatePosition.width + "px",<br>             overflow: "auto"<br>         });<br>         _contentView.drawRect({<!-- --><br>             color: "#ffffff",<br>             radius: "20px"<br>         }, {<!-- --><br>             width: "100%",<br>             height: "100%"<br>         }, "roundedRect");<br>         _contentView.drawText(_config.titleText, {<!-- --><br>             top: "20px",<br>             height: "20px",<br>         }, {<!-- --><br>             size: "16px",<br>             color: "#333",<br>             align: "center",<br>         }, "titleText");<br>         _contentView.drawText(_config.content, {<!-- --><br>             top: "60px",<br>             left: "20px",<br>             right: "20px",<br>             height: _config.windowHeight - 120 + "px",<br>         }, {<!-- --><br>             size: "16px",<br>             color: "#666",<br>             align: _config.contentAlign,<br>             verticalAlign: "top",<br>             whiteSpace: "normal",<br>             overflow: "ellipsis"<br>         }, "UpdaterContent");<br>         _createLoading(-2);<br>         var top = _config.windowHeight - 60 + 15;<br>         var fontSize = '16px';<br>         if (!_config.forceUpgrade) {<!-- --><br>             _contentView.drawRichText("&lt;font style=\"font-size:" + fontSize + ";\" color=\"" + _config.cancelColor +<br>                 "\"&gt;" + _config<br>                 .cancelText + "&lt;/font&gt;", {<!-- --><br>                     width: "50%",<br>                     top: top + "px",<br>                     left: "0px"<br>                 }, {<!-- --><br>                     align: "center",<br>                     onClick: function() {<!-- --><br>                         close()<br>                     }<br>                 }, "cancel");<br>             _contentView.drawRichText("&lt;font color=\"" + _config.confirmColor +<br>                 "\" style=\"font-size:" + fontSize + ";\"&gt;" +<br>                 _config.confirmText + "&lt;/font&gt;", {<!-- --><br>                     width: "50%",<br>                     right: "0px",<br>                     top: top + "px"<br>                 }, {<!-- --><br>                     align: "center",<br>                     onClick: function() {<!-- --><br>                         _config.packageUrl ? "android" === plus.os.name.toLowerCase() ? _config.browser ? (plus<br>                             .runtime.openURL(_config.packageUrl)) : _createTask() : plus.runtime.openURL(<br>                             _config.packageUrl) : uni.showToast({<!-- --><br>                             title: "安装包地址为空",<br>                             icon: "none"<br>                         })<br>                     }<br>                 }, "submit")<br>         } else {<!-- --><br>             _contentView.drawRichText("&lt;font color=\"" + _config.confirmColor + "\" style=\"font-size:" + fontSize +<br>                 ";\"&gt;" +<br>                 _config.confirmText + "&lt;/font&gt;", {<!-- --><br>                     width: "100%",<br>                     right: "0px",<br>                     top: top + "px"<br>                 }, {<!-- --><br>                     align: "center",<br>                     onClick: function() {<!-- --><br>                         _config.packageUrl ? "android" === plus.os.name.toLowerCase() ? _config.browser ? (plus<br>                             .runtime.openURL(_config.packageUrl)) : _createTask() : plus.runtime.openURL(<br>                             _config.packageUrl) : uni.showToast({<!-- --><br>                             title: "安装包地址为空",<br>                             icon: "none"<br>                         })<br>                     }<br>                 }, "submit")<br>         }<br>     },<br>     _createLoading = function(progress) {<!-- --><br>         var calculatePosition = _calculatePosition();<br>         var top = _config.windowHeight - 65;<br>         var width = 0 &lt;= progress ? (calculatePosition.width - 100) / 100 * progress : 0;<br>         width = parseInt(width);<br>         var text = 100 &lt;= progress ? "下载完成" : "下载中...";<br>         var loadingText = "";<br>         loadingText = -1 == progress ? "资源加载中..." : 0 &lt;= progress ? text + "(" + progress + "%)" : "";<br>         _contentView.drawRect({<!-- --><br>             color: _config.loadingColor<br>         }, {<!-- --><br>             width: width + "px",<br>             height: "3px",<br>             left: "20px",<br>             top: top + "px"<br>         }, "loading");<br>         _contentView.drawRichText("&lt;font color=\"" + _config.loadingColor + "\"&gt;" + loadingText + "&lt;/font&gt;", {<!-- --><br>             width: "100px",<br>             top: top + "px",<br>             left: width + "px"<br>         }, {<!-- --><br>             align: "center"<br>         }, "loadingText")<br>     },<br>     _createTask = function() {<!-- --><br>         return _downloadTask ? void console.log("正在下载中") : void(_createLoading(-1),<br>             _downloadTask =<br>             uni.downloadFile({<!-- --><br>                 url: _config.packageUrl,<br>                 success: function(res) {<!-- --><br>                     if (200 === res.statusCode) {<!-- --><br>                         var tempFilePath = res.tempFilePath;<br>                         uni.saveFile({<!-- --><br>                             tempFilePath: tempFilePath,<br>                             success: function(res) {<!-- --><br>                                 plus.runtime.install(res.savedFilePath, {<!-- --><br>                                     force: true<br>                                 }, function(res) {<!-- --><br>                                     console.log('安装包信息' + JSON.stringify(res))<br>                                 }, function(res) {<!-- --><br>                                     uni.showToast({<!-- --><br>                                         title: '安装失败，请检查下载链接',<br>                                         icon: 'none',<br>                                         duration: 3000<br>                                     });<br>                                 });<br>                                 close();<br>                             }<br>                         })<br>                     }<br>                 }<br>             }), _downloadTask.onProgressUpdate(function(res) {<!-- --><br>                 _loadingProgress != res.progress &amp;&amp; (_loadingProgress = res.progress, _createLoading(res<br>                     .progress));<br>             }))<br>     },<br>     init = function(option) {<!-- --><br>         _screenHeight = plus.screen.resolutionHeight;<br>         _screenWidth = plus.screen.resolutionWidth;<br>         _downloadTask = null;<br>         option.titleText &amp;&amp; (_config.titleText = option.titleText);<br>         option.windowHeight &amp;&amp; (_config.windowHeight = option.windowHeight);<br>         option.forceUpgrade &amp;&amp; (_config.forceUpgrade = option.forceUpgrade);<br>         option.content &amp;&amp; (_config.content = option.content);<br>         option.contentAlign &amp;&amp; (_config.contentAlign = option.contentAlign);<br>         option.loadingColor &amp;&amp; (_config.loadingColor = option.loadingColor);<br>         option.cancelText &amp;&amp; (_config.cancelText = option.cancelText);<br>         option.cancelColor &amp;&amp; (_config.cancelColor = option.cancelColor);<br>         option.confirmText &amp;&amp; (_config.confirmText = option.confirmText);<br>         option.confirmColor &amp;&amp; (_config.confirmColor = option.confirmColor);<br>         option.packageUrl &amp;&amp; (_config.packageUrl = option.packageUrl);<br>         option.browser &amp;&amp; (_config.browser = option.browser);<br>         option.maskColor &amp;&amp; (_config.maskColor = option.maskColor);<br>         _createMask();<br>         _createContentView();<br>     },<br>     show = function() {<!-- --><br>         _maskView &amp;&amp; _maskView.show();<br>         _contentView &amp;&amp; _contentView.show();<br>     },<br>     close = function() {<!-- --><br>         _downloadTask &amp;&amp; (_downloadTask.abort(), _downloadTask = null, _createLoading(-2));<br>         _maskView &amp;&amp; _maskView.hide();<br>         _contentView &amp;&amp; _contentView.hide();<br>     };<br> export default {<!-- --><br>     init: init,<br>     show: show,<br>     close: close<br> }<br>  </p> 
<p>app.vue</p> 
<p>引入</p> 
<p>    import appUpgrade from '@/common/appUpgrade.js';</p> 
<p>使用</p> 
<p>//升级检测<br>             uni.getSystemInfo({<!-- --><br>                 success: (res)=&gt; {<!-- --><br>                     uni.setStorageSync('device', res.platform);<br>                     plus.runtime.getProperty(plus.runtime.appid, (widgetInfo)=&gt; {<!-- --><br>                         uni.setStorageSync('version', widgetInfo.version);<br>                         this.$http.request({<!-- --><br>                             url: '/common/getVersion',<br>                             success: (res) =&gt; {<!-- --><br>                                 if(res.data.data.upgrade=='Y'){<!-- --><br>                                     appUpgrade.init({<!-- --><br>                                         titleText: '版本更新'+res.data.data.version,<br>                                         packageUrl:res.data.data.url,<br>                                         content: res.data.data.content,<br>                                         forceUpgrade:res.data.data.forceUpgrade=='Y' ? true : false<br>                                     });<br>                                     appUpgrade.show();<br>                                 }<br>                             }<br>                         });<br>                     });<br>                 }<br>             });<br>             uni.onNetworkStatusChange( (res)=&gt; {<!-- --><br>                 if(res.isConnected){<!-- --><br>                     this.$store.dispatch('get_UserInfo')<br>                 }<br>             });<br>             // #endif</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b8eb3e879036167a6917ded5716603bb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Netapp数据恢复】Netapp存储lun被删除如何恢复数据？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b999bc2837ada13fe0c838f2b09dc375/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">echarts环形图内接分类名称并且颜色名称颜色跟随变化</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>