<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux引导过程和服务 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux引导过程和服务" />
<meta property="og:description" content="一、Linux操作系统引导过程 1.引导过程 bios 加电自检——mbr——grub——加载内核——启动进程
加电后BIOS程序回自检硬件，硬件无故障后，会根据第一次启动项去找内核，一般来说第一启动项是硬盘，找到硬盘后，会根据mbr指引找到完整的grub程序，再根据grub的配置文件找到内核文件具体位置，然后将内核文件加载到内存中运行内存加载好会启动第一个程序。
BIOS：检测硬件是否正常，然后根据BIOS中的启动项设置，去找内核文件
mbr：应为grub太大第一个扇区存不下所有的grub程序，所以分为两部分指引硬件找到内核文件
grub：根据grub配置文件中记录的位置，找到内核文件
加载内存：把内核运行在内存中
启动进程：启动第一个祖宗进程centos 6：init centos 7：systend
区别：
init :串行启动后续的程序一个一个按顺序启动
systemd: 是并行启动程序全部一起启动
二、服务排除启动类故障 2.1 systemd服务 systemd 是系统级的程序 代为管理系统上的服务程序
systemd 保姆级 yum以及rpm安装的软件可以直接使用systemctl去启动关闭，重启开机自启等功能编译安装，不可直接使用systemctl 命令去管理程序，需手写一个配置文件
2.2 Linux设置运行级别 格式：init 数字 runlevel 当前等级
Linux操作系统有运行级别
0：关机
1：单用户模式(root自动登录), single, 维护模式
2：多用户模式，启动网络功能，但不会启动NFS；维护模式
3：多用户模式，正常模式；文本界面
4：预留级别；可同3级别
5：多用户模式，正常模式；图形界面
6：重启
2.3 修复mbr分区 MBR位于第一块硬盘（/dev/sda）的第一个物理扇区处，总共512字节，前446个字节是GRUB程序，后面64个字节是分区表。
故障原因 病毒、木马的等造成的破坏；
不正确的分区操作、磁盘读写误操作等。
故障现象
找不到引导程序，启动中断；
无法加载操作系统，开机后黑屏
①备份mbr引导扇区到其他磁盘
②模拟破坏mbr引导扇区
③引导镜像急救模式进行mbr扇区恢复
练习1：模拟破坏mbr和分区表然后修复
第一步：新加一块硬盘，将文件备份到新盘
第二步：备份mbr分区表
第三步：模拟破坏
然后进入急救模式:选项3、2、1 再重启，就好了
ip a a 192.168.100.100 dev ens33 配置IP地址 scp 192." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/008c815246e59e39b6a43eeee35a4a12/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-04T16:04:25+08:00" />
<meta property="article:modified_time" content="2024-01-04T16:04:25+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux引导过程和服务</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>一、Linux操作系统引导过程</h2> 
<h3>1.引导过程</h3> 
<p><span style="color:#fe2c24;"><strong>bios 加电自检——mbr——grub——加载内核——启动进程</strong></span></p> 
<p>        加电后BIOS程序回自检硬件，硬件无故障后，会根据第一次启动项去找内核，一般来说第一启动项是硬盘，找到硬盘后，会根据mbr指引找到完整的grub程序，再根据grub的配置文件找到内核文件具体位置，然后将内核文件加载到内存中运行内存加载好会启动第一个程序。</p> 
<p><span style="color:#fe2c24;">BIOS</span>：检测硬件是否正常，然后根据BIOS中的启动项设置，去找内核文件</p> 
<p><span style="color:#fe2c24;">mbr</span>：应为grub太大第一个扇区存不下所有的grub程序，所以分为两部分指引硬件找到内核文件</p> 
<p><span style="color:#fe2c24;">grub</span>：根据grub配置文件中记录的位置，找到内核文件</p> 
<p><span style="color:#fe2c24;">加载内存</span>：把内核运行在内存中</p> 
<p><span style="color:#fe2c24;">启动进程</span>：启动第一个祖宗进程centos 6：init   centos 7：systend</p> 
<p><strong><span style="color:#fe2c24;">区别</span></strong>：</p> 
<p>init :串行启动后续的程序一个一个按顺序启动</p> 
<p>systemd: 是并行启动程序全部一起启动</p> 
<h3></h3> 
<h2>二、服务排除启动类故障</h2> 
<h3>2.1  systemd服务</h3> 
<p>systemd 是系统级的程序 代为管理系统上的服务程序</p> 
<p>systemd 保姆级 </p> 
<p>yum以及rpm安装的软件可以直接使用systemctl去启动关闭，重启开机自启等功能编译安装，不可直接使用systemctl 命令去管理程序，需手写一个配置文件</p> 
<h3>2.2  Linux设置运行级别</h3> 
<blockquote> 
 <p>格式：init   数字   runlevel  当前等级</p> 
</blockquote> 
<p>Linux操作系统有运行级别</p> 
<p>0：关机<br> 1：单用户模式(root自动登录), single, 维护模式<br> 2：多用户模式，启动网络功能，但不会启动NFS；维护模式<br> 3：多用户模式，正常模式；文本界面<br> 4：预留级别；可同3级别<br> 5：多用户模式，正常模式；图形界面<br> 6：重启</p> 
<h3>2.3  修复mbr分区</h3> 
<p>        MBR位于第一块硬盘（/dev/sda）的第一个物理扇区处，总共512字节，前446个字节是GRUB程序，后面64个字节是分区表。</p> 
<h5 id="%E6%95%85%E9%9A%9C%E5%8E%9F%E5%9B%A0">故障原因</h5> 
<p>病毒、木马的等造成的破坏；</p> 
<p>不正确的分区操作、磁盘读写误操作等。</p> 
<p>故障现象</p> 
<p>找不到引导程序，启动中断；</p> 
<p>无法加载操作系统，开机后黑屏</p> 
<p>①备份mbr引导扇区到其他磁盘</p> 
<p>②模拟破坏mbr引导扇区</p> 
<p>③引导镜像急救模式进行mbr扇区恢复</p> 
<p>练习1：模拟破坏mbr和分区表然后修复</p> 
<p>第一步：新加一块硬盘，将文件备份到新盘</p> 
<p>第二步：备份mbr分区表</p> 
<p>第三步：模拟破坏</p> 
<p>然后进入急救模式:选项3、2、1 <img alt="" height="749" src="https://images2.imgbox.com/6b/66/g38nlUxh_o.png" width="912"></p> 
<p><img alt="" height="309" src="https://images2.imgbox.com/12/fb/AW4gMWdz_o.png" width="955"></p> 
<p><img alt="" height="516" src="https://images2.imgbox.com/14/7a/cB9OOQXB_o.png" width="1115"></p> 
<p><img alt="" height="150" src="https://images2.imgbox.com/aa/aa/QbuipX77_o.png" width="1060"></p> 
<p><img alt="" height="742" src="https://images2.imgbox.com/ae/17/gBmPBwsj_o.png" width="1200"></p> 
<p><img alt="" height="630" src="https://images2.imgbox.com/46/03/sYAvW440_o.png" width="924"></p> 
<p><img alt="" height="717" src="https://images2.imgbox.com/6c/3c/tlvIBnmf_o.png" width="1037"></p> 
<p><img alt="" height="702" src="https://images2.imgbox.com/e8/e1/quz0GmDY_o.png" width="902"></p> 
<p><img alt="" height="577" src="https://images2.imgbox.com/a5/08/xL5EcYmo_o.png" width="960"></p> 
<p>再重启，就好了</p> 
<p></p> 
<pre><code>ip a a 192.168.100.100 dev ens33
配置IP地址
scp 192.168.100.100:/mbr.bak .
dd if=./mbr.bak of=/dev/sda bs=512 count=1


mkdir /bak
mount /dev/sdb1 /bak
dd if=/bak/mbr.bak of=/dev/sda


#备份MBR分区表
dd if=/dev/sda of=/data/dpt.img bs=1 count=64 skip=446
scp /data/dpt.img 10.0.0.102:
#破坏MBR分区表
[root@centos8 ~]#dd if=/dev/zero of=/dev/sda bs=1 count=64 seek=446
#无法启动
[root@centos8 ~]#reboot
#用光盘启动,进入rescue mode,选第3项skip to shell
#配置网络
#ifconfig ens33 10.0.0.8/24
#ip a a 10.0.0.8/24 dev ens33
#scp 10.0.0.102:/root/dpt.img ./
#恢复MBR分区表
#dd if=dpt.img of=/dev/sda bs=1 seek=446
#reboot</code></pre> 
<h3></h3> 
<h3>2.4  修复grub分区</h3> 
<h5>故障原因</h5> 
<p>MBR中的GRUB引导程序（1-446字节）遭到破坏</p> 
<p>grub.cfg文件丢失，引导配置有误，文件位置<code>/boot/grub2/grup.cfg</code></p> 
<h5><a name="t16"></a>故障现象</h5> 
<p>系统引导停滞，显示<code>grub &gt;</code>提示符</p> 
<p></p> 
<p>第一步： 模拟破坏grub.cfg 配置文件</p> 
<p>mv  /boot/grub2/grub.cfg/opt</p> 
<p>第二步：重启今日急救模式 3、2、1</p> 
<p>第三步：先切换根，从光盘的根切换到自己系统的根</p> 
<p>chroot  /mnt/sysimage </p> 
<p>第四步：重新安装grub 2 程序在sda磁盘里</p> 
<p>grub2 -install   /dev/sda</p> 
<p>第五步：重新生成配置文件</p> 
<p>grub2  -mkconfig  -o  /boot/grub/grub.cfg</p> 
<p>exit</p> 
<p>reboot</p> 
<h3>2.5 破解密码</h3> 
<p>有光驱·</p> 
<p>chroot  /mnt/sysimage              切换根目录</p> 
<p>passwd                                      修改密码</p> 
<p>无光驱</p> 
<p>进入系统再选择  内核界面选择带一个选项按e</p> 
<p>将光标移动到 Linux 开头行的最后，添加rd.break</p> 
<p>ctrl +x   运行</p> 
<p>进入单用户</p> 
<p>重新挂载mount  -o  remount.rw /sysroot  添加读写权限</p> 
<p>chroot  /sysroot  切换到真正的根</p> 
<p>passwd      修改密码</p> 
<p>touch /.autorelabel         如果你开启了selinux要重新打上标记</p> 
<p><img alt="" height="662" src="https://images2.imgbox.com/46/5b/TPaNMKyX_o.png" width="1159"><img alt="" height="510" src="https://images2.imgbox.com/a8/d6/tBkLODYJ_o.png" width="1067"><img alt="" height="634" src="https://images2.imgbox.com/64/99/kUa9J15T_o.png" width="912"></p> 
<p></p> 
<h3 id="%C2%A0%E4%B8%89.%E6%9C%8D%E5%8A%A1%E6%8E%A7%E5%88%B6%E5%8F%8A%E5%88%87%E6%8D%A2%E8%BF%90%E8%A1%8C%E7%BA%A7%E5%88%AB">三、服务控制及切换运行级别</h3> 
<h4 id="1.%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1%E6%8E%A7%E5%88%B6"><a name="t28"></a>3.1 系统服务控制</h4> 
<h5 id="1.1%20Systemctl"><a name="t29"></a>Systemctl</h5> 
<blockquote> 
 <p><strong>格式：</strong></p> 
 <p>Systemctl   控制类型   服务名称</p> 
</blockquote> 
<table border="1" cellpadding="1" cellspacing="1"><tbody><tr><td>start</td><td>启动</td></tr><tr><td>stop</td><td>停止</td></tr><tr><td>restart</td><td>重新启动</td></tr><tr><td>reload</td><td>重新加载</td></tr><tr><td>status</td><td>查看服务状态</td></tr></tbody></table> 
<p>chkconfig  --add  服务名称</p> 
<p>chkconfig  --level  35  服务程序  on  开机自启</p> 
<p>chkconfig  --level  35  服务程序  off  关闭开机启动</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8dc651122a1bcf8014fbb989bccb976a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">AE （4）_ 直方图调整的理论</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/792bf67909e478b31807f829a383e857/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【Linux驱动】Linux中断（二）—— 按键中断驱动</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>