<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Elasticsearch查询 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Elasticsearch查询" />
<meta property="og:description" content="说明 ​ ES中提供了一种强大的检索数据方式,这种检索方式称之为Query DSL ,Query DSL是利用Rest API传递JSON格式的请求体(Request Body)数据与ES进行交互，这种方式的丰富查询语法让ES检索变得更强大，更简洁。
语法 # GET /索引名/_doc/_search {json格式请求体数据} # GET /索引名/_search {json格式请求体数据} 测试数据 # 1.创建索引 映射 PUT /products/ { &#34;mappings&#34;: { &#34;properties&#34;: { &#34;title&#34;:{ &#34;type&#34;: &#34;keyword&#34; }, &#34;price&#34;:{ &#34;type&#34;: &#34;double&#34; }, &#34;created_at&#34;:{ &#34;type&#34;:&#34;date&#34; }, &#34;description&#34;:{ &#34;type&#34;:&#34;text&#34; } } } } # 2.测试数据 PUT /products/_doc/_bulk {&#34;index&#34;:{}} {&#34;title&#34;:&#34;iphone12 pro&#34;,&#34;price&#34;:8999,&#34;created_at&#34;:&#34;2020-10-23&#34;,&#34;description&#34;:&#34;iPhone 12 Pro采用超瓷晶面板和亚光质感玻璃背板，搭配不锈钢边框，有银色、石墨色、金色、海蓝色四种颜色。宽度:71.5毫米，高度:146.7毫米，厚度:7.4毫米，重量：187克&#34;} {&#34;index&#34;:{}} {&#34;title&#34;:&#34;iphone12&#34;,&#34;price&#34;:4999,&#34;created_at&#34;:&#34;2020-10-23&#34;,&#34;description&#34;:&#34;iPhone 12 高度：146.7毫米；宽度：71.5毫米；厚度：7.4毫米；重量：162克（5.73盎司） [5] 。iPhone 12设计采用了离子玻璃，以及7000系列铝金属外壳。&#34;} {&#34;index&#34;:{}} {&#34;title&#34;:&#34;iphone13&#34;,&#34;price&#34;:6000,&#34;created_at&#34;:&#34;2021-09-15&#34;,&#34;description&#34;:&#34;iPhone 13屏幕采用6.1英寸OLED屏幕；高度约146.7毫米，宽度约71.5毫米，厚度约7.65毫米，重量约173克。&#34;} {&#34;index&#34;:{}} {&#34;title&#34;:&#34;iphone13 pro&#34;,&#34;price&#34;:8999,&#34;created_at&#34;:&#34;2021-09-15&#34;,&#34;description&#34;:&#34;iPhone 13Pro搭载A15 Bionic芯片，拥有四种配色，支持5G。有128G、256G、512G、1T可选，售价为999美元起。&#34;} 常见检索 查询所有[match_all] match_all关键字: 返回索引中的全部文档" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/fb2ba2038a036d956d3dc1873d44e523/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-31T21:56:23+08:00" />
<meta property="article:modified_time" content="2022-07-31T21:56:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Elasticsearch查询</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="_0"></a>说明</h4> 
<p>​ ES中提供了一种强大的检索数据方式,这种检索方式称之为<code>Query DSL</code> ,<code>Query DSL</code>是利用<code>Rest API传递JSON格式的请求体(Request Body)数据</code>与ES进行交互，这种方式的<code>丰富查询语法</code>让ES检索变得<code>更强大，更简洁</code>。</p> 
<h4><a id="_4"></a>语法</h4> 
<pre><code class="prism language-markdown"># GET /索引名/_doc/_search {json格式请求体数据}
# GET /索引名/_search {json格式请求体数据}
</code></pre> 
<ul><li>测试数据</li></ul> 
<pre><code class="prism language-markdown"># 1.创建索引 映射
PUT /products/
{
  "mappings": {
    "properties": {
      "title":{
        "type": "keyword"
      },
      "price":{
        "type": "double"
      },
      "created_at":{
        "type":"date"
      },
      "description":{
        "type":"text"
      }
    }
  }
}
# 2.测试数据
PUT /products/_doc/_bulk
{"index":{}}
  {"title":"iphone12 pro","price":8999,"created_at":"2020-10-23","description":"iPhone 12 Pro采用超瓷晶面板和亚光质感玻璃背板，搭配不锈钢边框，有银色、石墨色、金色、海蓝色四种颜色。宽度:71.5毫米，高度:146.7毫米，厚度:7.4毫米，重量：187克"}
{"index":{}}
  {"title":"iphone12","price":4999,"created_at":"2020-10-23","description":"iPhone 12 高度：146.7毫米；宽度：71.5毫米；厚度：7.4毫米；重量：162克（5.73盎司） [5]  。iPhone 12设计采用了离子玻璃，以及7000系列铝金属外壳。"}
{"index":{}}
  {"title":"iphone13","price":6000,"created_at":"2021-09-15","description":"iPhone 13屏幕采用6.1英寸OLED屏幕；高度约146.7毫米，宽度约71.5毫米，厚度约7.65毫米，重量约173克。"}
{"index":{}}
  {"title":"iphone13 pro","price":8999,"created_at":"2021-09-15","description":"iPhone 13Pro搭载A15 Bionic芯片，拥有四种配色，支持5G。有128G、256G、512G、1T可选，售价为999美元起。"}
</code></pre> 
<h4><a id="_46"></a>常见检索</h4> 
<h5><a id="match_all_48"></a>查询所有[match_all]</h5> 
<blockquote> 
 <p><strong>match_all关键字:</strong> 返回索引中的全部文档</p> 
</blockquote> 
<pre><code class="prism language-http">GET /products/_search
{
  "query": {
    "match_all": {}
  }
}
</code></pre> 
<h5><a id="term_61"></a>关键词查询(term)</h5> 
<blockquote> 
 <p><strong>term 关键字</strong>: 用来使用关键词查询</p> 
</blockquote> 
<pre><code class="prism language-http">GET /products/_search
{
 "query": {
   "term": {
     "price": {
       "value": 4999
     }
   }
 }
}
</code></pre> 
<blockquote> 
 <p>NOTE1: 通过使用term查询得知ES中默认使用分词器为<code>标准分词器(StandardAnalyzer),标准分词器对于英文单词分词,对于中文单字分词</code>。</p> 
</blockquote> 
<blockquote> 
 <p>NOTE2: 通过使用term查询得知,<code>在ES的Mapping Type 中 keyword , date ,integer, long , double , boolean or ip 这些类型不分词，只有text类型分词</code>。</p> 
</blockquote> 
<h5><a id="range_82"></a>范围查询[range]</h5> 
<blockquote> 
 <p><strong>range 关键字</strong>: 用来指定查询指定范围内的文档</p> 
</blockquote> 
<pre><code class="prism language-http">GET /products/_search
{
  "query": {
    "range": {
      "price": {
        "gte": 1400,
        "lte": 9999
      }
    }
  }
}
</code></pre> 
<h5><a id="prefix_100"></a>前缀查询[prefix]</h5> 
<blockquote> 
 <p><strong>prefix 关键字</strong>: 用来检索含有指定前缀的关键词的相关文档</p> 
</blockquote> 
<pre><code class="prism language-http">GET /products/_search
{
  "query": {
    "prefix": {
      "title": {
        "value": "ipho"
      }
    }
  }
}
</code></pre> 
<h5><a id="wildcard_117"></a>通配符查询[wildcard]</h5> 
<blockquote> 
 <p><strong>wildcard 关键字</strong>: 通配符查询 <strong>? 用来匹配一个任意字符 * 用来匹配多个任意字符</strong></p> 
</blockquote> 
<pre><code class="prism language-http">GET /products/_search
{
  "query": {
    "wildcard": {
      "description": {
        "value": "iphon*"
      }
    }
  }
}
</code></pre> 
<h5><a id="idids_134"></a>多id查询[ids]</h5> 
<blockquote> 
 <p><strong>ids 关键字</strong> : 值为数组类型,用来根据一组id获取多个对应的文档</p> 
</blockquote> 
<pre><code class="prism language-http">GET /products/_search
{
  "query": {
    "ids": {
      "values": ["verUq3wBOTjuBizqAegi","vurUq3wBOTjuBizqAegk"]
    }
  }
}
</code></pre> 
<h5><a id="fuzzy_149"></a>模糊查询[fuzzy]</h5> 
<blockquote> 
 <p><strong>fuzzy 关键字</strong>: 用来模糊查询含有指定关键字的文档</p> 
</blockquote> 
<pre><code class="prism language-http">GET /products/_search
{
  "query": {
    "fuzzy": {
      "description": "iphooone"
    }
  }
}
</code></pre> 
<blockquote> 
 <p>注意: <code>fuzzy 模糊查询 最大模糊错误 必须在0-2之间</code></p> 
 <ul><li>搜索关键词长度为 2 不允许存在模糊</li><li>搜索关键词长度为3-5 允许一次模糊</li><li>搜索关键词长度大于5 允许最大2模糊</li></ul> 
</blockquote> 
<h5><a id="bool_170"></a>布尔查询[bool]</h5> 
<blockquote> 
 <p><strong>bool 关键字</strong>: 用来组合多个条件实现复杂查询</p> 
 <p>​ <strong>must: 相当于&amp;&amp; 同时成立</strong></p> 
 <p>​ <strong>should: 相当于|| 成立一个就行</strong></p> 
 <p>​ <strong>must_not: 相当于! 不能满足任何一个</strong></p> 
</blockquote> 
<pre><code class="prism language-http">GET /products/_search
{
  "query": {
    "bool": {
      "must": [
        {"term": {
          "price": {
            "value": 4999
          }
        }}
      ]
    }
  }
}
</code></pre> 
<h5><a id="multi_match_197"></a>多字段查询[multi_match]</h5> 
<pre><code class="prism language-http">GET /products/_search
{
  "query": {
    "multi_match": {
      "query": "iphone13 毫",
      "fields": ["title","description"]
    }
  }
}
注意: 字段类型分词,将查询条件分词之后进行查询改字段  如果该字段不分词就会将查询条件作为整体进行查询
</code></pre> 
<h5><a id="query_string_212"></a>默认字段分词查询[query_string]</h5> 
<pre><code class="prism language-http">GET /products/_search
{
  "query": {
    "query_string": {
      "default_field": "description",
      "query": "屏幕真的非常不错"
    }
  }
}
注意: 查询字段分词就将查询条件分词查询  查询字段不分词将查询条件不分词查询
</code></pre> 
<h5><a id="highlight_227"></a>高亮查询[highlight]</h5> 
<blockquote> 
 <p><strong>highlight 关键字</strong>: 可以让符合条件的文档中的关键词高亮</p> 
</blockquote> 
<pre><code class="prism language-http">GET /products/_search
{
  "query": {
    "term": {
      "description": {
        "value": "iphone"
      }
    }
  },
  "highlight": {
    "fields": {
      "*":{}
    }
  }
}
</code></pre> 
<blockquote> 
 <p><strong>自定义高亮html标签</strong>: 可以在highlight中使用<code>pre_tags</code>和<code>post_tags</code></p> 
</blockquote> 
<pre><code class="prism language-http">GET /products/_search
{
  "query": {
    "term": {
      "description": {
        "value": "iphone"
      }
    }
  },
  "highlight": {
    "post_tags": ["&lt;/span&gt;"], 
    "pre_tags": ["&lt;span style='color:red'&gt;"],
    "fields": {
      "*":{}
    }
  }
}
</code></pre> 
<blockquote> 
 <p>多字段高亮 使用<code>require_field_match</code>开启多个字段高亮</p> 
</blockquote> 
<pre><code class="prism language-http">GET /products/_search
{
  "query": {
    "term": {
      "description": {
        "value": "iphone"
      }
    }
  },
  "highlight": {
    "require_field_match": "false",
    "post_tags": ["&lt;/span&gt;"], 
    "pre_tags": ["&lt;span style='color:red'&gt;"],
    "fields": {
      "*":{}
    }
  }
}
</code></pre> 
<h5><a id="size_294"></a>返回指定条数[size]</h5> 
<blockquote> 
 <p><strong>size 关键字</strong>: 指定查询结果中返回指定条数。 <strong>默认返回值10条</strong></p> 
</blockquote> 
<pre><code class="prism language-http">GET /products/_search
{
  "query": {
    "match_all": {}
  },
  "size": 5
}
</code></pre> 
<h5><a id="form_308"></a>分页查询[form]</h5> 
<blockquote> 
 <p><strong>from 关键字</strong>: 用来指定起始返回位置，和<strong>size关键字连用可实现分页效果</strong></p> 
</blockquote> 
<pre><code class="prism language-http">GET /products/_search
{
  "query": {
    "match_all": {}
  },
  "size": 5,
  "from": 0
}
</code></pre> 
<h5><a id="sort_323"></a>指定字段排序[sort]</h5> 
<pre><code class="prism language-http">GET /products/_search
{
  "query": {
    "match_all": {}
  },
  "sort": [
    {
      "price": {
        "order": "desc"
      }
    }
  ]
}
</code></pre> 
<h5><a id="_source_341"></a>返回指定字段[_source]</h5> 
<blockquote> 
 <p><strong>_source 关键字</strong>: 是一个数组,在数组中用来指定展示那些字段</p> 
</blockquote> 
<pre><code class="prism language-http">GET /products/_search
{
  "query": {
    "match_all": {}
  },
  "_source": ["title","description"]
}
</code></pre> 
<h3><a id="_355"></a></h3>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b2517d9cdbd09404dee23503d4f804b1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">js中常见的几种递归用法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f53d9e9ebc414418c7745a0de8690685/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">史上最全MySql查询练习</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>