<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>微信小程序地图(map)组件点击(tap)获取经纬度 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="微信小程序地图(map)组件点击(tap)获取经纬度" />
<meta property="og:description" content="微信小程序中使用地图(map)组件，通过点击(tap)获取经纬度，按照官方的回应，暂时是没法做到的，从地图组件API多有残缺判断，怀疑是个实习生干的...
做个变通，适用性有限，请大家参考。基本思路就是在地图上铺满一层marker，从而通过点击marker获得经纬度。
&lt;map id=&#34;map&#34; longitude=&#34;102.324520&#34; latitude=&#34;40.099994&#34; scale=&#34;4&#34; bindcontroltap=&#34;controltap&#34; polygons=&#34;{{polygons}}&#34; bindregionchange=&#34;regionchange&#34; markers=&#34;{{markers}}&#34; bindmarkertap=&#34;markertap&#34; show-location style=&#34;width: 100%; height: 700px;&#34;&gt;&lt;/map&gt; const app = getApp() const markersize = 30 function range(start, edge, step) { for (var ret = []; (edge - start) * step &gt; 0; start &#43;= step) { ret.push(start); } return ret; } function markers(northeast, southwest, scale, width, height) { const markerslng = (northeast.longitude - southwest.longitude) * markersize / width const markerslat = (northeast." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/7fc57acdaa51197a51284f29b1aea26f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-01-09T04:44:40+08:00" />
<meta property="article:modified_time" content="2019-01-09T04:44:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">微信小程序地图(map)组件点击(tap)获取经纬度</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="article fmt article__content"> 
 <p>微信小程序中使用地图(map)组件，通过点击(tap)获取经纬度，按照官方的<a href="https://developers.weixin.qq.com/community/develop/doc/000c607abb0ea88e93e79875b56800" rel="nofollow">回应</a>，暂时是没法做到的，从地图组件API多有残缺判断，怀疑是个实习生干的...</p> 
 <p>做个变通，适用性有限，请大家参考。基本思路就是在地图上铺满一层marker，从而通过点击marker获得经纬度。</p> 
 <pre><code class="wxml">&lt;map id="map" longitude="102.324520" latitude="40.099994" scale="4"  bindcontroltap="controltap"  polygons="{<!-- -->{polygons}}" bindregionchange="regionchange" markers="{<!-- -->{markers}}" bindmarkertap="markertap" show-location style="width: 100%; height: 700px;"&gt;&lt;/map&gt;</code></pre> 
 <pre><code class="js">const app = getApp()

const markersize = 30

function range(start, edge, step) {
  for (var ret = [];
    (edge - start) * step &gt; 0; start += step) {
    ret.push(start);
  }
  return ret;
}

function markers(northeast, southwest, scale, width, height) {

  const markerslng = (northeast.longitude - southwest.longitude) * markersize / width
  const markerslat = (northeast.latitude - southwest.latitude) * markersize / height

  const maxlon = northeast.longitude
  const minlon = southwest.longitude
  const maxlat = northeast.latitude
  const minlat = southwest.latitude

  const lons = range(minlon, maxlon, markerslng)
  const lats = range(minlat, maxlat, markerslat)

  let _markers = []
  lons.forEach((lon, i) =&gt; {
    lats.forEach((lat, j) =&gt; {
      _markers.push({
        id: lon + ',' + lat,
        latitude: lat,
        longitude: lon,
        iconPath: '/marker.png',
        alpha: 0.1, //将图片设置为透明,通过开发者工具看不出效果,但真机是有效果的
        width: markersize,
        height: markersize
      })
    })
  })
  return _markers
}

Page({
  data: {
    polygons: [],
    controls: [{
      id: 1,
      position: {
        left: 0,
        top: 300 - 50,
        width: 50,
        height: 50
      },
      clickable: true
    }],
    markers: []
  },
  createMarkers() {

    this.mapCtx = wx.createMapContext('map')
    const query = wx.createSelectorQuery()
    const map = query.select('#map').boundingClientRect()

    let that = this

    that.mapCtx.getRegion({
      success(res1) {
        that.mapCtx.getScale({
          success(res2) {
            query.exec((res) =&gt; {
              let width = res[0].width;
              let height = res[0].height;
              let _markers = markers(res1.northeast, res1.southwest, res2.scale, width, height)
              that.data.markers = _markers
              that.setData(that.data)
            })
          }
        })
      }
    })
  },
  regionchange(e) {
    this.createMarkers()
  },
  markertap(e) {
    console.log(e.markerId)
  },
  controltap(e) {
    console.log(e.controlId)
  },
  onReady(e) {
    this.createMarkers()
  }
})</code></pre> 
 <p>效果如图<br><span class="img-wrap"><img src="https://images2.imgbox.com/a9/91/5sIBKjXn_o.gif" alt="效果如图" title="效果如图"></span></p> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/164f8a6a9c996b28f6fea02d832c5d78/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">汇编语言-王爽（学习笔记）-5-8章</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6a7fd4243158db3a5a7ea527ad8138b1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">深入理解printf函数的实现</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>