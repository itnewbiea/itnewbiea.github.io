<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>数据挖掘总结(考试版） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="数据挖掘总结(考试版）" />
<meta property="og:description" content="数据挖掘总结： 第一章： 数据挖掘KDD步骤：
数据清理: (消除噪声和删除不一致的数据)数据集成（多种数据源可以组合在一起）数据选择（从数据库中提取与分析任务相关的数据）数据变换（数据变换或统一成适合挖掘的形式)数据挖掘（核心步骤，使用智能方法提取数据模式）模式评估（根据某种兴趣度量识别提供知识的真正有趣的模式）知识表示（使用可视化和知识表示技术，向用户提供挖掘的知识） ​ 数据仓库(数据立方体)：是一个从多个数据源收集的信息存储库，存放在一致的模式下，并且通常驻留在单个站点上。
文本数据库的分类：
无结构类型、半结构类型、结构类型 研究任务：
关联规则，分类回归，聚类，离群点分析 数据库系统研究关注为单位和最终用户创建、维护和使用数据库。
数据仓库集成来自多种数据源和各个时间段的数据。
第二章： 数据集由数据对象组成。数据行对应数据对象,列对应属性。 属性：
标称属性 ：属性值是一些符号或者事物的名称，属于哪一类二元属性 ：只有两个状态例如：是或者不是，有或者没有序数属性：其可能的值之间具有有意义的序或者秩评定，例如评定等级数值属性：:定量的且用具体数值表示 对于数据的描述信息：
中心趋势度量
均值、中位数、众数、中列数 数据的散布
极差、四分位数极差、五数概括、盒图、变异系数 数据可视化
分位数图、分位数-分位数图、直方图、散点图、词云图 数据度量：
相似性、相异性、邻近性 空间距离：
曼哈顿距离、欧氏距离、切比雪夫距离、切比雪夫距离、绝对值距离，闵考夫斯基距离 数据规整：
数据归一化、数据标准化 from sklearn.preprocessing import StandardScaler from sklearn.preprocessing import MinMaxScaler 第三章： 数据预处理：
数据清理
填充缺失值，识别/去除离群点，光滑噪音，并纠正数据中的不一致 数据集成：
多个数据库，数据立方体或文件的集成 数据规约：
得到数据的归约表示，它小得多，但产生相同或类似的分析结果：维度规约、数值
规约、数据压缩
缺失值处理，离散点处理
重复值处理、相关性分析
主要成分分析(PCA降维)，奇异值分解
第四章： 数据仓库：
​ 数据仓库是一个面向主题的、集成的、随时间而变化的、不容易丢失的数据集合，支持管理部门的决策过程
数据仓库特征：面向主题、数据集成、随时间而变化、数据不易丢失
数据库的主要任务：联机事务处理(OLTP)和增删改查(CURD).
数据仓库的主要任务:联机分析处理(OLAP),数据分析和决策支持.
数据仓库的三层架构：
底层：数据仓库的数据库服务器中间层：OLAP服务器前端客户工具层 OLAP的优点：
数据展现方式
​ 基于多维模型的数据组织让数据的展示更加直观，可以从多个角度多个层面去发现事物的不同特性，而OLAP正是将这种寻常的思维模型应用到了数据分析上。
查询效率
​ 多维模型的建立是基于对OLAP操作的优化基础上的，比如基于各个维的索引、对于一些常用查询所建的视图等，这些优化使得对百万千万甚至上亿数量级的运算变得得心应手。
分析的灵活性" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/da1c16552be217d14c0e33fa82b61de5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-04T19:11:22+08:00" />
<meta property="article:modified_time" content="2024-01-04T19:11:22+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">数据挖掘总结(考试版）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="_1"></a>数据挖掘总结：</h4> 
<h4><a id="_3"></a>第一章：</h4> 
<p>数据挖掘<code>KDD</code>步骤：</p> 
<ol><li>数据清理: (消除噪声和删除不一致的数据)</li><li>数据集成（多种数据源可以组合在一起）</li><li>数据选择（从数据库中提取与分析任务相关的数据）</li><li>数据变换（数据变换或统一成适合挖掘的形式)</li><li>数据挖掘（核心步骤，使用智能方法提取数据模式）</li><li>模式评估（根据某种兴趣度量识别提供知识的真正有趣的模式）</li><li>知识表示（使用可视化和知识表示技术，向用户提供挖掘的知识）</li></ol> 
<p>​ 数据仓库(数据立方体)：是一个从<strong>多个数据源</strong>收集的信息存储库，存放在<strong>一致的模式</strong>下，并且通常驻留在单个站点上。</p> 
<p>文本数据库的分类：</p> 
<ul><li>无结构类型、半结构类型、结构类型</li></ul> 
<p>研究任务：</p> 
<ul><li>关联规则，分类回归，聚类，离群点分析</li></ul> 
<p>数据库系统研究关注为单位和最终用户创建、维护和使用数据库。</p> 
<p>数据仓库集成来自多种数据源和各个时间段的数据。</p> 
<h4><a id="_33"></a>第二章：</h4> 
<ul><li>数据集由数据对象组成。数据行对应数据对象,列对应属性。</li></ul> 
<p>属性：</p> 
<ul><li>标称属性 ：属性值是一些符号或者事物的名称，属于哪一类</li><li>二元属性 ：只有两个状态例如：是或者不是，有或者没有</li><li>序数属性：其可能的值之间具有有意义的序或者秩评定，例如评定等级</li><li>数值属性：:定量的且用具体数值表示</li></ul> 
<p>对于数据的描述信息：</p> 
<p>中心趋势度量</p> 
<ul><li>均值、中位数、众数、中列数</li></ul> 
<p>数据的散布</p> 
<ul><li>极差、四分位数极差、五数概括、盒图、变异系数</li></ul> 
<p>数据可视化</p> 
<ul><li>分位数图、分位数-分位数图、直方图、散点图、词云图</li></ul> 
<p>数据度量：</p> 
<ul><li>相似性、相异性、邻近性</li></ul> 
<p>空间距离：</p> 
<ul><li>曼哈顿距离、欧氏距离、切比雪夫距离、切比雪夫距离、绝对值距离，<strong>闵考夫斯基距离</strong></li></ul> 
<p>数据规整：</p> 
<ul><li>数据归一化、数据标准化</li></ul> 
<pre><code class="prism language-py"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> StandardScaler
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> MinMaxScaler
</code></pre> 
<h4><a id="_77"></a>第三章：</h4> 
<p>数据预处理：</p> 
<p>数据清理</p> 
<ul><li>填充缺失值，识别/去除离群点，光滑噪音，并纠正数据中的不一致</li></ul> 
<p>数据集成：</p> 
<ul><li>多个数据库，数据立方体或文件的集成</li></ul> 
<p>数据规约：</p> 
<ul><li> <p>得到数据的归约表示，它小得多，但产生相同或类似的分析结果：维度规约、数值</p> <p>规约、数据压缩</p> </li></ul> 
<p>缺失值处理，离散点处理</p> 
<p>重复值处理、相关性分析</p> 
<p>主要成分分析(PCA降维)，奇异值分解</p> 
<h4><a id="_103"></a>第四章：</h4> 
<p>数据仓库：</p> 
<p>​ 数据仓库是一个<strong>面向主题</strong>的、集成的、随时间而变化的、不容易丢失的数据集合，支持管理部门的决策过程</p> 
<p>数据仓库特征：<strong>面向主题</strong>、<strong>数据集成</strong>、<strong>随时间而变化</strong>、<strong>数据不易丢失</strong></p> 
<p>数据库的主要任务：联机事务处理(OLTP)和增删改查(CURD).</p> 
<p>数据仓库的主要任务:联机分析处理(OLAP),数据分析和决策支持.</p> 
<p>数据仓库的三层架构：</p> 
<ul><li>底层：数据仓库的数据库服务器</li><li>中间层：OLAP服务器</li><li>前端客户工具层</li></ul> 
<p>OLAP的优点：</p> 
<p>数据展现方式</p> 
<p>​ 基于多维模型的数据组织让数据的展示更加直观，可以从多个角度多个层面去发现事物的不同特性，而OLAP正是将这种寻常的思维模型应用到了数据分析上。</p> 
<p>查询效率</p> 
<p>​ 多维模型的建立是基于对OLAP操作的优化基础上的，比如基于各个维的索引、对于一些常用查询所建的视图等，这些优化使得对百万千万甚至上亿数量级的运算变得得心应手。</p> 
<p>分析的灵活性</p> 
<p>​ 多维数据模型可以从不同的角度和层面来观察数据，同时各类OLAP操作对数据进行聚合、细分和选取，可以从不同角度不同层面对数据进行细分和汇总，满足不同分析的需求。</p> 
<p>数据立方体是一种<strong>多维数据分析</strong>工具，提供了对数据仓库中的数据进行实时分析的能力。</p> 
<h4><a id="_143"></a>频繁模式挖掘：</h4> 
<h5><a id="_145"></a>关联规则：</h5> 
<p>​ 关联规则反映一个事物与其他事物之间的相互依存性和关联性。若两个或多个事物之间存在一定的关联关系，则其中一个事物就能够通过其他事物预测到。</p> 
<p>应用</p> 
<p>购物篮数据分析, 交叉销售, 顾客购买习惯分析, Web 日志 (click stream) 分析等。</p> 
<p>频繁模式: 频繁出现在数据集中的模式。</p> 
<p>项(item)</p> 
<ul><li>每种商品为项</li></ul> 
<p>项集(itemset)</p> 
<ul><li>项集：项的集合</li><li><em>k</em>-项集:含有<em>k</em>个项的项集</li><li>所有项的集合 I={I1,I2,I3,I4,I5}</li></ul> 
<p>​ 假如我们把一次购物当成一个购物篮，所购买的每一个东西叫做项，那么项集叫做项的集合，k项集就是还有k个项的项集(就是你买了k键物品)，所有项的集合={一项集，二项集，…，n项集}，这样是不是就比较好理解了呢。</p> 
<pre><code>Tid Milk Nuts Eggs Beer Coffe Diaper
10 	 0     1    0    1    0    1
20   0     0    0    1     1    1
30   0     1   1     1     0    1
40   1     0   1     0     0    0
50   1     1   0     0     1    1
</code></pre> 
<p>1频繁项集：{Beer}(支持度0.6), {Nuts} (支持度0.6), {Diaper}:(支持度0.8), {Eggs} (支持度0.6), -----竖着看</p> 
<p>2频繁项集：{Beer, Diaper}(支持度0.6)</p> 
<p>支持度</p> 
<p>​ 数据集<em>D</em>中包含项集<em>A</em>的事务中同时包含另一个项集<em>B</em>的比例，其中A ∩ 𝐵 = ∅ 。一个发生，同时另一个也发生。</p> 
<p><img src="https://images2.imgbox.com/6f/79/qIdYZKLs_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_187"></a>频繁项集挖掘：</h5> 
<p>​ 超集：若一个集合<em>S**2</em>中的每一个元素都在集合<em>S**1</em>中，且集合S1 中可能包含S2中没有的元素，则集合<em>S**1</em>就是<em>S**2</em>的一个超集。<em>S**1</em>是<em>S**2</em> 的超集，则S2是S1的真子集，反之亦然。支持度:0.3支持度:大于或等于0.3。<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          S 
         
        
          1 
         
        
          属于 
         
        
          S 
         
        
          2 
         
        
       
         S1属于S2 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0576em;">S</span><span class="mord">1</span><span class="mord cjk_fallback">属于</span><span class="mord mathnormal" style="margin-right: 0.0576em;">S</span><span class="mord">2</span></span></span></span></span></span><br> 现在有项集S1 <em>={b,c}</em> ，那么它就是{b}，{c}的超集。</p> 
<p>S1也是*{a,b,c}*等的真子集</p> 
<h5><a id="Apriori_197"></a>Apriori算法:</h5> 
<p>​ <strong>频繁项集的所有非空子集也必须是频繁的</strong>,就是如果三个都能同时发生，那么两个也一定发生。如果 {beer, diaper, nuts} 是频繁的, {beer, diaper}也是。</p> 
<p>​ **非频繁项集的超集(真子集)一定是非频繁的。**可以理解为一个事件不发生，那么这个事件和另一个事件同时发生的概率一定小于一个事件发生的概率，如果 {beer, diaper} 是非频繁的, 也是{beer, diaper, nuts}非频繁的。支持度:0.1，支持度:小于或等于0.1.</p> 
<p><strong>不相同元素只有两个的k-1频繁项集(只有一个不相同)才可以生成一个k待频繁项集.</strong></p> 
<pre><code>{I1,I3}+ {I1,I4}==&gt;&gt;{I1, I3,I4} (只有两个元素不相同的集合)
</code></pre> 
<p><code>Apriori</code>算法由连接和剪枝两个步骤组成。</p> 
<pre><code class="prism language-py"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> mlxtend<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> TransactionEncoder
<span class="token keyword">from</span> mlxtend<span class="token punctuation">.</span>frequent_patterns <span class="token keyword">import</span> association_rules
<span class="token keyword">from</span> mlxtend<span class="token punctuation">.</span>frequent_patterns <span class="token keyword">import</span> apriori
<span class="token keyword">from</span> mlxtend<span class="token punctuation">.</span>frequent_patterns <span class="token keyword">import</span> fpgrowth
pd<span class="token punctuation">.</span>set_option<span class="token punctuation">(</span><span class="token string">'display.max_columns'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>  <span class="token comment"># 显示所有列</span>
pd<span class="token punctuation">.</span>set_option<span class="token punctuation">(</span><span class="token string">'display.max_rows'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>  <span class="token comment"># 显示所有行</span>
column_names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>column_names<span class="token punctuation">)</span>
<span class="token comment"># 读取文件</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'./data/mushroom.dat'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">' '</span><span class="token punctuation">,</span> names<span class="token operator">=</span>column_names<span class="token punctuation">,</span> index_col<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token comment"># 查看前几行数据</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'------------------------------'</span><span class="token punctuation">)</span>
<span class="token comment"># 查看每列是否存在缺失值</span>
<span class="token comment"># print(df.isnull().sum())</span>
<span class="token comment"># 删除存在确实值的行</span>
df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 刷选毒蘑菇</span>
df2 <span class="token operator">=</span> df<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'a1'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">]</span>
df2<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>drop<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'------------------------------'</span><span class="token punctuation">)</span>
<span class="token comment"># print(df2.head())</span>
<span class="token comment"># 转化为2维度数组</span>
df3 <span class="token operator">=</span> df2<span class="token punctuation">.</span>values<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df3<span class="token punctuation">)</span>
<span class="token comment"># aprior</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'------------------------------'</span><span class="token punctuation">)</span>
te <span class="token operator">=</span> TransactionEncoder<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 生成模型对象</span>
te_ary <span class="token operator">=</span> te<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>df3<span class="token punctuation">)</span><span class="token punctuation">.</span>transform<span class="token punctuation">(</span>df3<span class="token punctuation">)</span>

<span class="token comment"># te.columns_就是出现的所有字段列名 te_df构成一个新的dafaframe类型</span>
te_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>te_ary<span class="token punctuation">,</span> columns<span class="token operator">=</span>te<span class="token punctuation">.</span>columns_<span class="token punctuation">)</span>
ap_result <span class="token operator">=</span> apriori<span class="token punctuation">(</span>te_df<span class="token punctuation">,</span> min_support<span class="token operator">=</span><span class="token number">0.4</span><span class="token punctuation">,</span> use_colnames<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ap_result<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ap_result<span class="token punctuation">[</span><span class="token string">'itemsets'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># FP 树算法</span>
fp_result <span class="token operator">=</span> fpgrowth<span class="token punctuation">(</span>te_df<span class="token punctuation">,</span> min_support<span class="token operator">=</span><span class="token number">0.4</span><span class="token punctuation">,</span> use_colnames<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>fp_result<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>fp_result<span class="token punctuation">[</span><span class="token string">'itemsets'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 关联规则生成</span>
res <span class="token operator">=</span> association_rules<span class="token punctuation">(</span>ap_result<span class="token punctuation">,</span> metric<span class="token operator">=</span><span class="token string">'confidence'</span><span class="token punctuation">,</span> min_threshold<span class="token operator">=</span><span class="token number">0.4</span><span class="token punctuation">,</span> support_only<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>

</code></pre> 
<h5><a id="_260"></a>模型评估度量:</h5> 
<ul><li>全置信度</li><li>最大置信度</li><li>Kulczynski</li><li>余弦</li></ul> 
<h4><a id="_267"></a>分类：</h4> 
<p>分类任务的两个极端：模型过拟合，模型欠拟合</p> 
<p>提高分类任务精度的方法：特征选择，特征工程，交叉验证，网格搜索，模型调优</p> 
<h5><a id="_275"></a>决策树：</h5> 
<p>​ 决策树是一种常用的机器学习算法，可用于分类和回归任务。它通过从数据中学习一系列的决策规则来构建一个树形结构，从而对新样本进行预测或估计。</p> 
<p>属性选择度量：</p> 
<ul><li> <p><strong>信息增益</strong></p> 
  <ul><li>偏向于多值属性</li></ul> <p><strong>增益率</strong></p> 
  <ul><li>倾向于不平衡的划分，其中一个分区比其他分区小得多</li></ul> <p><strong>基尼指数</strong></p> 
  <ul><li> <p>偏向于多值属性</p> </li><li> <p>当类的数量很大时会有困难</p> </li><li> <p>倾向于导致相等大小的分区和纯度</p> </li></ul> </li></ul> 
<pre><code class="prism language-py"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>feature_extraction <span class="token keyword">import</span> DictVectorizer
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">import</span> DecisionTreeClassifier
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> accuracy_score
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">import</span> DecisionTreeClassifier
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">import</span> export_graphviz
<span class="token keyword">import</span> graphviz
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'./data/lenses.txt'</span><span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">)</span>
<span class="token comment"># 数据探索</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 缺失值处理</span>
is_column_missing <span class="token operator">=</span> df<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">any</span><span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment"># print(is_column_missing)</span>
<span class="token comment"># 查看每一行是否存在缺失值</span>
is_row_missing <span class="token operator">=</span> df<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">any</span><span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment"># print(is_row_missing)</span>

<span class="token comment"># 分离特征和目标变量</span>
X <span class="token operator">=</span> df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">'eye_types'</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'eye_types'</span><span class="token punctuation">]</span>
<span class="token comment"># 使用独热编码进行特征向量化</span>
<span class="token comment"># X.to_dict() 是将每一列映射为数字</span>
vectorizer <span class="token operator">=</span> DictVectorizer<span class="token punctuation">(</span>sparse<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
X_encoded <span class="token operator">=</span> vectorizer<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>X<span class="token punctuation">.</span>to_dict<span class="token punctuation">(</span>orient<span class="token operator">=</span><span class="token string">'records'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>X_encoded<span class="token punctuation">,</span>X_encoded<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

<span class="token comment"># 划分训练集和测试集</span>
X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X_encoded<span class="token punctuation">,</span> y<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token number">6</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>

<span class="token comment"># 创建决策树分类器</span>
clf <span class="token operator">=</span> DecisionTreeClassifier<span class="token punctuation">(</span>criterion<span class="token operator">=</span><span class="token string">"entropy"</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span> splitter<span class="token operator">=</span><span class="token string">"best"</span><span class="token punctuation">)</span>
<span class="token comment"># # 在训练集上拟合模型</span>
clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
<span class="token comment"># # 评估方法一</span>
<span class="token comment"># # 在测试集上进行预测  准确率</span>
y_pred <span class="token operator">=</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
score <span class="token operator">=</span> clf<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span>

<span class="token comment"># # 评估方法二</span>
<span class="token comment"># # 计算测试精度</span>
accuracy <span class="token operator">=</span> accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> precision_score<span class="token punctuation">,</span> recall_score<span class="token punctuation">,</span> f1_score

precision <span class="token operator">=</span> precision_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span>
recall <span class="token operator">=</span> recall_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span>
f1 <span class="token operator">=</span> f1_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span>
<span class="token comment"># 打印测试精度</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'测试精度:'</span><span class="token punctuation">,</span> accuracy<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span> <span class="token string-interpolation"><span class="token string">f"模型的测试分类准确率为</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>score<span class="token punctuation">:</span><span class="token format-spec">.2%</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 生成Graphviz格式的决策树图形</span>
dot_data <span class="token operator">=</span> export_graphviz<span class="token punctuation">(</span>clf<span class="token punctuation">,</span> feature_names<span class="token operator">=</span>vectorizer<span class="token punctuation">.</span>feature_names_<span class="token punctuation">,</span> class_names<span class="token operator">=</span>clf<span class="token punctuation">.</span>classes_<span class="token punctuation">,</span> filled<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                           rounded<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># 渲染决策树图形</span>
graph <span class="token operator">=</span> graphviz<span class="token punctuation">.</span>Source<span class="token punctuation">(</span>dot_data<span class="token punctuation">)</span>

<span class="token comment"># # 保存决策树图形为PDF文件</span>
graph<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">'./show/decision_tree'</span><span class="token punctuation">)</span>

</code></pre> 
<h5><a id="_361"></a>贝叶斯：</h5> 
<p>​ 在正确辅助信息的指引下，后验概率比先验概率对分类决策更有效！</p> 
<pre><code class="prism language-py"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>naive_bayes <span class="token keyword">import</span> GaussianNB
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token comment"># 准备训练数据和标签</span>
X_train <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
y_train <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 创建 GaussianNB 对象</span>
gnb <span class="token operator">=</span> GaussianNB<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 拟合模型</span>
gnb<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>

<span class="token comment"># 预测新样本</span>
X_new <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
y_pred <span class="token operator">=</span> gnb<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_new<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>y_pred<span class="token punctuation">)</span>
</code></pre> 
<h5><a id="K_388"></a>K近邻：</h5> 
<ul><li> <p>核心思想：如果一个样本在特征空间中的<strong>k个最相邻的样本</strong>中的<strong>大多数属于某一个类别</strong>，则<strong>该样本也属于这个类别</strong>，并具有<strong>这个类别上样本的特性</strong>个类别，并具有这个类别上<strong>样本的特性</strong>。</p> </li><li> <p>距离越小则相似度越大</p> </li></ul> 
<p>常用的空间距离：<strong>闵可夫斯基距离</strong>、<strong>欧氏距离</strong>、<strong>曼哈顿距离</strong></p> 
<p>量纲处理：归一化、标准化</p> 
<p>K的选择：交叉验证</p> 
<p><code>KNN</code>优缺点对比:</p> 
<p>优点：</p> 
<ul><li>简单直观，训练非常快，易于实现；</li><li>特别适合多分类问题；</li><li>训练数据无限和足够大的K，K-NN方法效果会相当好！</li></ul> 
<p>缺点：</p> 
<ul><li>对噪声敏感（小K）；</li><li>即使在测试时间时，也需要存储所有训练数据；</li><li>查询时间慢：每个查询𝑂(𝑛𝑑)复杂度；</li><li>在高维度上，距离的概念是违反直觉的！</li><li>高维空间表现不佳（维度诅咒）</li></ul> 
<p>交叉验证：</p> 
<pre><code class="prism language-py"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

df<span class="token operator">=</span>pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'./data/datingTestSet.txt'</span><span class="token punctuation">,</span>sep<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">,</span>header<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"------------------------------"</span><span class="token punctuation">)</span>
<span class="token comment"># 1. 数据探索</span>
<span class="token comment"># 查看每一组分别有多少人</span>
value_counts <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 需要将目标变量映射为数值类型</span>
maplist<span class="token operator">=</span>value_counts<span class="token punctuation">.</span>index<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 建立映射关系</span>
mapping <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>value<span class="token punctuation">:</span> index <span class="token keyword">for</span> index<span class="token punctuation">,</span> value <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>maplist<span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>mapping<span class="token punctuation">)</span>
<span class="token comment"># df[3] = df[3].map(mapping)</span>
<span class="token comment"># print("映射之后的数据字段为-------------------")</span>
<span class="token comment"># print(df.head())</span>

<span class="token comment"># 2.数据预处理</span>
X <span class="token operator">=</span> df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment"># Features</span>
y <span class="token operator">=</span> df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>   <span class="token comment"># Target variabl</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> MinMaxScaler
<span class="token comment"># 创建一个MinMaxScaler对象</span>
scaler <span class="token operator">=</span> MinMaxScaler<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 对特征矩阵X进行归一化处理</span>
normalized_X <span class="token operator">=</span> scaler<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>normalized_X<span class="token punctuation">)</span>

<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> cross_val_score
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>neighbors <span class="token keyword">import</span> KNeighborsClassifier
<span class="token comment"># 3. 数据建模</span>
k_values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span>  <span class="token comment"># 可选的k值</span>
best_accuracy <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 最优准确率</span>
best_k <span class="token operator">=</span> <span class="token boolean">None</span>  <span class="token comment"># 最优的k值</span>

<span class="token keyword">for</span> k <span class="token keyword">in</span> k_values<span class="token punctuation">:</span>
    <span class="token comment"># 创建KNN分类器</span>
    knn <span class="token operator">=</span> KNeighborsClassifier<span class="token punctuation">(</span>n_neighbors<span class="token operator">=</span>k<span class="token punctuation">)</span>

    <span class="token comment"># 十折交叉验证，计算平均准确率</span>
    scores <span class="token operator">=</span> cross_val_score<span class="token punctuation">(</span>knn<span class="token punctuation">,</span> normalized_X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
    accuracy <span class="token operator">=</span> scores<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 更新最优准确率和k值</span>
    <span class="token keyword">if</span> accuracy <span class="token operator">&gt;</span> best_accuracy<span class="token punctuation">:</span>
        best_accuracy <span class="token operator">=</span> accuracy
        best_k <span class="token operator">=</span> k

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"最优的k值:"</span><span class="token punctuation">,</span> best_k<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"最优准确率:"</span><span class="token punctuation">,</span> best_accuracy<span class="token punctuation">)</span>
</code></pre> 
<p>网格搜索：</p> 
<pre><code class="prism language-py"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> GridSearchCV
<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> preprocessing
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>neighbors <span class="token keyword">import</span> KNeighborsClassifier
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">"./data/datingTestSet.txt"</span><span class="token punctuation">,</span>sep<span class="token operator">=</span><span class="token string">"\t"</span><span class="token punctuation">,</span>header<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
X <span class="token operator">=</span> preprocessing<span class="token punctuation">.</span>MinMaxScaler<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
Y <span class="token operator">=</span> df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment"># 获取因变量 </span>
param_grid <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'n_neighbors'</span> <span class="token punctuation">:</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token comment">#定义网格参数 </span>
clf <span class="token operator">=</span> KNeighborsClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span> 
GS_model <span class="token operator">=</span> GridSearchCV<span class="token punctuation">(</span>clf<span class="token punctuation">,</span> param_grid<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment"># GS_model 就是获得的最优参数</span>
GS_model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">)</span> <span class="token comment"># 训练</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'模型的最优参数最优配置为</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>GS_model<span class="token punctuation">.</span>best_params_<span class="token punctuation">}</span></span><span class="token string">，且训练精度为</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>GS_model<span class="token punctuation">.</span>best_score_<span class="token punctuation">:</span><span class="token format-spec">.3f</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="_489"></a>感知机：</h5> 
<p>​ 感知机(perceptron)是<strong>二分类</strong>的线性分类模型，其输入为实例的特征向量，输出为实例的类别。</p> 
<p>模型优化：梯度下降法</p> 
<p>单层感知机：</p> 
<pre><code class="prism language-py"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> datasets<span class="token punctuation">,</span> tree
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> cross_val_score
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> Perceptron
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> precision_score<span class="token punctuation">,</span> recall_score<span class="token punctuation">,</span> f1_score<span class="token punctuation">,</span>accuracy_score
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.sans-serif'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'SimHei'</span><span class="token punctuation">]</span>  <span class="token comment"># 用来显示中文，不然会乱码</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.family'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Microsoft YaHei'</span>  <span class="token comment"># 或者 'Source Han Sans'</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'axes.unicode_minus'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span>  <span class="token comment"># 用来正常显示负号</span>
<span class="token comment"># 定义数据集的URL</span>
<span class="token builtin">file</span> <span class="token operator">=</span> <span class="token string">'https://archive.ics.uci.edu/ml/machine-learning-databases/iris/iris.data'</span>
<span class="token comment"># 定义列名</span>
names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'sepal_length'</span><span class="token punctuation">,</span> <span class="token string">'sepal_width'</span><span class="token punctuation">,</span> <span class="token string">'petal_length'</span><span class="token punctuation">,</span> <span class="token string">'petal_width'</span><span class="token punctuation">,</span> <span class="token string">'class'</span><span class="token punctuation">]</span>
<span class="token comment"># 使用Pandas的read_csv函数加载数据集</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> names<span class="token operator">=</span>names<span class="token punctuation">)</span>

<span class="token comment"># 选择 sepal_length 和 petal_length 列数据作为目标数据</span>
target_data <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'sepal_length'</span><span class="token punctuation">,</span> <span class="token string">'petal_length'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

<span class="token comment"># 选择类别不是'Iris-virginica'的数据，并将其类别重命名为+1和-1</span>
filtered_data <span class="token operator">=</span> df<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'class'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'Iris-virginica'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
filtered_data<span class="token punctuation">[</span><span class="token string">'class'</span><span class="token punctuation">]</span> <span class="token operator">=</span> filtered_data<span class="token punctuation">[</span><span class="token string">'class'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token keyword">if</span> x <span class="token operator">==</span> <span class="token string">'Iris-versicolor'</span> <span class="token keyword">else</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>filtered_data<span class="token punctuation">)</span>
<span class="token comment"># 根据类别创建颜色映射字典</span>
colors <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">'blue'</span><span class="token punctuation">}</span>
<span class="token comment"># 获取 petal_length 和 sepal_length 列的数据</span>
petal_length <span class="token operator">=</span> filtered_data<span class="token punctuation">[</span><span class="token string">'petal_length'</span><span class="token punctuation">]</span>
sepal_length <span class="token operator">=</span> filtered_data<span class="token punctuation">[</span><span class="token string">'sepal_length'</span><span class="token punctuation">]</span>

<span class="token comment"># 根据类别绘制散点图</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> label <span class="token keyword">in</span> colors<span class="token punctuation">:</span>
    plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>sepal_length<span class="token punctuation">[</span>filtered_data<span class="token punctuation">[</span><span class="token string">'class'</span><span class="token punctuation">]</span> <span class="token operator">==</span> label<span class="token punctuation">]</span><span class="token punctuation">,</span>
                petal_length<span class="token punctuation">[</span>filtered_data<span class="token punctuation">[</span><span class="token string">'class'</span><span class="token punctuation">]</span> <span class="token operator">==</span> label<span class="token punctuation">]</span><span class="token punctuation">,</span>
                c<span class="token operator">=</span>colors<span class="token punctuation">[</span>label<span class="token punctuation">]</span><span class="token punctuation">,</span>
                label<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'Class </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>label<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'sepal_length'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'petal_length'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Petal Length vs Sepal Length (Scatter Plot)'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'best'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 随机打乱数据集</span>
shuffled_data <span class="token operator">=</span> filtered_data<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>frac<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>drop<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># 划分训练集和测试集</span>
X <span class="token operator">=</span> shuffled_data<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'sepal_length'</span><span class="token punctuation">,</span> <span class="token string">'petal_length'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
y <span class="token operator">=</span> shuffled_data<span class="token punctuation">[</span><span class="token string">'class'</span><span class="token punctuation">]</span>

X_train<span class="token punctuation">,</span> X_test <span class="token operator">=</span> X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">]</span>
y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> y<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">]</span>

<span class="token comment"># 训练感知机模型</span>
perceptron <span class="token operator">=</span> Perceptron<span class="token punctuation">(</span><span class="token punctuation">)</span>
perceptron<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>

<span class="token comment"># 计算测试精度</span>
y_pred <span class="token operator">=</span> perceptron<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>

<span class="token comment"># 使用预测结果和真实标签计算模型精度</span>
accuracy <span class="token operator">=</span> accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span>

<span class="token comment"># 打印模型精度</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"测试精度 (使用predict()):"</span><span class="token punctuation">,</span> accuracy<span class="token punctuation">)</span>

<span class="token comment"># 使用perceptron.score()来计算模型精度</span>
accuracy_score <span class="token operator">=</span> perceptron<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"测试精度 (使用score()):"</span><span class="token punctuation">,</span> accuracy_score<span class="token punctuation">)</span>
precision <span class="token operator">=</span> precision_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span>
recall <span class="token operator">=</span> recall_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span>
f1 <span class="token operator">=</span> f1_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span>

</code></pre> 
<p>多层感知机：</p> 
<pre><code class="prism language-py"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>neural_network <span class="token keyword">import</span> MLPClassifier
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> GridSearchCV
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> cross_val_score
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token comment"># 数据集的链接</span>
url <span class="token operator">=</span> <span class="token string">'https://archive.ics.uci.edu/ml/machine-learning-databases/iris/iris.data'</span>
<span class="token comment"># 列名</span>
column_names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'sepal_length'</span><span class="token punctuation">,</span> <span class="token string">'sepal_width'</span><span class="token punctuation">,</span> <span class="token string">'petal_length'</span><span class="token punctuation">,</span> <span class="token string">'petal_width'</span><span class="token punctuation">,</span> <span class="token string">'class'</span><span class="token punctuation">]</span>
<span class="token comment"># 使用 pandas 加载数据集</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>url<span class="token punctuation">,</span> names<span class="token operator">=</span>column_names<span class="token punctuation">)</span>
<span class="token comment"># 查看数据集的前几行</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 数据准备</span>
X <span class="token operator">=</span> df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 特征</span>
y <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'class'</span><span class="token punctuation">]</span>  <span class="token comment"># 目标变量</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span>
<span class="token comment"># 构建多层感知机模型</span>
mlp <span class="token operator">=</span> MLPClassifier<span class="token punctuation">(</span>max_iter<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token comment"># 定义参数网格</span>
param_grid <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'hidden_layer_sizes'</span><span class="token punctuation">:</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'activation'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"identity"</span><span class="token punctuation">,</span> <span class="token string">"logistic"</span><span class="token punctuation">,</span> <span class="token string">"tanh"</span><span class="token punctuation">,</span> <span class="token string">"relu"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment"># 使用GridSearchCV进行参数搜索</span>
grid_search <span class="token operator">=</span> GridSearchCV<span class="token punctuation">(</span>mlp<span class="token punctuation">,</span> param_grid<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
grid_search<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
<span class="token comment"># 打印最佳参数配置</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"最佳参数配置: "</span><span class="token punctuation">,</span> grid_search<span class="token punctuation">.</span>best_params_<span class="token punctuation">)</span>
<span class="token comment"># 执行交叉验证来评估模型性能</span>
best_mlp <span class="token operator">=</span> grid_search<span class="token punctuation">.</span>best_estimator_
cv_scores <span class="token operator">=</span> cross_val_score<span class="token punctuation">(</span>best_mlp<span class="token punctuation">,</span> X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"交叉验证得分: "</span><span class="token punctuation">,</span> cv_scores<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"平均得分: "</span><span class="token punctuation">,</span> cv_scores<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre> 
<h4><a id="_616"></a>聚类：</h4> 
<h5><a id="Kmeans_618"></a>Kmeans：</h5> 
<pre><code class="prism language-py"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>cluster <span class="token keyword">import</span> KMeans
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> StandardScaler
<span class="token keyword">import</span> os

os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'OMP_NUM_THREADS'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'4'</span>
<span class="token comment"># 读取数据</span>
data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">'./data/consumption_data.xls'</span><span class="token punctuation">)</span>
<span class="token comment"># 数据探索与数据预处理</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"查看前几条数据"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token comment"># 缺失值</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"每一列缺失值查看:"</span><span class="token punctuation">)</span>
<span class="token comment"># 查看缺失值</span>
missing_values <span class="token operator">=</span> data<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>missing_values<span class="token punctuation">)</span>
<span class="token comment"># 查看缺失行</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"查看缺失行:"</span><span class="token punctuation">)</span>
missing_rows <span class="token operator">=</span> data<span class="token punctuation">[</span>data<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">any</span><span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>missing_rows<span class="token punctuation">)</span>

<span class="token comment"># 删除缺失值所在的行</span>
data <span class="token operator">=</span> data<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># 打印删除缺失值后的数据</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token comment"># 数据预处理和特征选择</span>
X <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'R'</span><span class="token punctuation">,</span> <span class="token string">'F'</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token comment"># 选择特征列</span>

<span class="token comment"># 特征标准化</span>
scaler <span class="token operator">=</span> StandardScaler<span class="token punctuation">(</span><span class="token punctuation">)</span>
X_scaled <span class="token operator">=</span> scaler<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>X<span class="token punctuation">)</span>

 <span class="token comment"># 设置聚类的簇数</span>
n_clusters <span class="token operator">=</span> <span class="token number">3</span>

<span class="token comment"># 创建KMeans对象并进行聚类</span>
kmeans <span class="token operator">=</span> KMeans<span class="token punctuation">(</span>n_clusters<span class="token operator">=</span>n_clusters<span class="token punctuation">,</span>n_init<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
kmeans<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_scaled<span class="token punctuation">)</span>

<span class="token comment"># 获取聚类结果标签</span>
labels <span class="token operator">=</span> kmeans<span class="token punctuation">.</span>labels_
<span class="token comment"># 将聚类结果添加到原始数据中</span>
data<span class="token punctuation">[</span><span class="token string">'Cluster'</span><span class="token punctuation">]</span> <span class="token operator">=</span> labels
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"聚类中心------"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>kmeans<span class="token punctuation">.</span>cluster_centers_<span class="token punctuation">)</span>

<span class="token comment"># 分别提取不同群体的数据</span>
cluster0 <span class="token operator">=</span> data<span class="token punctuation">[</span>data<span class="token punctuation">[</span><span class="token string">'Cluster'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">]</span>
cluster1 <span class="token operator">=</span> data<span class="token punctuation">[</span>data<span class="token punctuation">[</span><span class="token string">'Cluster'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">]</span>
cluster2 <span class="token operator">=</span> data<span class="token punctuation">[</span>data<span class="token punctuation">[</span><span class="token string">'Cluster'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">]</span>
<span class="token comment"># 单图展示</span>
<span class="token comment"># 获取属性列的名称</span>
attribute_columns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'R'</span><span class="token punctuation">,</span> <span class="token string">'F'</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">]</span>  <span class="token comment"># 假设属性列为'R', 'F', 'M'</span>

<span class="token comment"># 创建一个图像</span>
fig<span class="token punctuation">,</span> axes <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>attribute_columns<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 绘制概率密度函数图像</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> attribute <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>attribute_columns<span class="token punctuation">)</span><span class="token punctuation">:</span>
    cluster0<span class="token punctuation">[</span>attribute<span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>kind<span class="token operator">=</span><span class="token string">'kde'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Cluster 0'</span><span class="token punctuation">,</span> ax<span class="token operator">=</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    cluster1<span class="token punctuation">[</span>attribute<span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>kind<span class="token operator">=</span><span class="token string">'kde'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Cluster 1'</span><span class="token punctuation">,</span> ax<span class="token operator">=</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    cluster2<span class="token punctuation">[</span>attribute<span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>kind<span class="token operator">=</span><span class="token string">'kde'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Cluster 2'</span><span class="token punctuation">,</span> ax<span class="token operator">=</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span>attribute<span class="token punctuation">)</span>
    axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'Density'</span><span class="token punctuation">)</span>
    axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># plt.savefig(r'./img/2_mode.png')</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<h4><a id="_695"></a>模型评估：</h4> 
<pre><code class="prism language-py"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> Perceptron
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> cross_val_score<span class="token punctuation">,</span> train_test_split
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>neighbors <span class="token keyword">import</span> KNeighborsClassifier
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">import</span> DecisionTreeClassifier
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>naive_bayes <span class="token keyword">import</span> GaussianNB
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> roc_curve<span class="token punctuation">,</span> roc_auc_score<span class="token punctuation">,</span> auc
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token comment"># 读取数据集</span>
data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'./data/balance.dat'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"数据类型查看:"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 去除列名中的空格</span>
data<span class="token punctuation">.</span>columns <span class="token operator">=</span> data<span class="token punctuation">.</span>columns<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
class_counts <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'Class'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span>
data<span class="token punctuation">[</span><span class="token string">'Class'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'Class'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>
unique_class_values <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'Class'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>unique<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"查看都有那些值"</span><span class="token punctuation">,</span> unique_class_values<span class="token punctuation">)</span>

<span class="token comment"># 将类别属性"class"取值为"L"的类定义为正例，取值为"R"的类定义为负类</span>
data<span class="token punctuation">[</span><span class="token string">'Class'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'Class'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'L'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'R'</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'Class'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'Class'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token comment"># 打印前几行数据以验证处理结果</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"处理后的数据："</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 准备特征和目标变量</span>
X <span class="token operator">=</span> data<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Class'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'Class'</span><span class="token punctuation">]</span>

<span class="token comment"># 数据建模与模型选择</span>
<span class="token comment"># 构建不同模型的分类器</span>
classifiers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'Naive Bayes'</span><span class="token punctuation">:</span> GaussianNB<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'Decision Tree'</span><span class="token punctuation">:</span> DecisionTreeClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'K-Nearest Neighbors'</span><span class="token punctuation">:</span> KNeighborsClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'Perceptron'</span><span class="token punctuation">:</span> Perceptron<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment"># 使用十折交叉验证计算各算法的召回率、精度和F度量</span>
results <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token keyword">for</span> name<span class="token punctuation">,</span> clf <span class="token keyword">in</span> classifiers<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    recall_scores <span class="token operator">=</span> cross_val_score<span class="token punctuation">(</span>clf<span class="token punctuation">,</span> X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> scoring<span class="token operator">=</span><span class="token string">'recall'</span><span class="token punctuation">)</span>  <span class="token comment"># 召回率</span>
    precision_scores <span class="token operator">=</span> cross_val_score<span class="token punctuation">(</span>clf<span class="token punctuation">,</span> X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> scoring<span class="token operator">=</span><span class="token string">'precision'</span><span class="token punctuation">)</span>
    f1_scores <span class="token operator">=</span> cross_val_score<span class="token punctuation">(</span>clf<span class="token punctuation">,</span> X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> scoring<span class="token operator">=</span><span class="token string">'f1'</span><span class="token punctuation">)</span>

    results<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'Recall'</span><span class="token punctuation">:</span> recall_scores<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'Precision'</span><span class="token punctuation">:</span> precision_scores<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'F-Measure'</span><span class="token punctuation">:</span> f1_scores<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span>
<span class="token comment"># 打印各算法的性能指标</span>
<span class="token keyword">for</span> name<span class="token punctuation">,</span> metrics <span class="token keyword">in</span> results<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Algorithm: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>name<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Recall: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>metrics<span class="token punctuation">[</span><span class="token string">"Recall"</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Precision: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>metrics<span class="token punctuation">[</span><span class="token string">"Precision"</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'F-Measure: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>metrics<span class="token punctuation">[</span><span class="token string">"F-Measure"</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 选择最优的分类算法（以F度量为准则）</span>
best_algorithm <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>results<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> results<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'F-Measure'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Best Algorithm: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>best_algorithm<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
<span class="token comment"># ROC 图制作与 AUC 取值计算</span>
<span class="token comment"># 将数据集分为训练集和测试集</span>
X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>

<span class="token comment"># 创建决策树分类器</span>
dt_classifier <span class="token operator">=</span> DecisionTreeClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 创建朴素贝叶斯分类器</span>
nb_classifier <span class="token operator">=</span> GaussianNB<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 训练模型</span>
dt_classifier<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
nb_classifier<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>

<span class="token comment"># 预测概率</span>
y_prob_dt <span class="token operator">=</span> dt_classifier<span class="token punctuation">.</span>predict_proba<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
y_prob_nb <span class="token operator">=</span> nb_classifier<span class="token punctuation">.</span>predict_proba<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>

<span class="token comment"># 计算 ROC 曲线</span>
fpr_dt<span class="token punctuation">,</span> tpr_dt<span class="token punctuation">,</span> _ <span class="token operator">=</span> roc_curve<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_prob_dt<span class="token punctuation">)</span>
fpr_nb<span class="token punctuation">,</span> tpr_nb<span class="token punctuation">,</span> _ <span class="token operator">=</span> roc_curve<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_prob_nb<span class="token punctuation">)</span>

<span class="token comment"># 计算 AUC 值</span>
auc_dt <span class="token operator">=</span> auc<span class="token punctuation">(</span>fpr_dt<span class="token punctuation">,</span> tpr_dt<span class="token punctuation">)</span>
auc_nb <span class="token operator">=</span> auc<span class="token punctuation">(</span>fpr_nb<span class="token punctuation">,</span> tpr_nb<span class="token punctuation">)</span>

<span class="token comment"># 绘制 ROC 曲线</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>fpr_dt<span class="token punctuation">,</span> tpr_dt<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'Decision Tree (AUC = </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>auc_dt<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">)'</span></span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>fpr_nb<span class="token punctuation">,</span> tpr_nb<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'Naive Bayes (AUC = </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>auc_nb<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">)'</span></span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> linestyle<span class="token operator">=</span><span class="token string">'--'</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'Random'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'False Positive Rate'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'True Positive Rate'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'ROC Curve'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 打印 AUC 值</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Decision Tree AUC: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>auc_dt<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Naive Bayes AUC: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>auc_nb<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2c4a2c7d23910535ca8fab7ed90b920e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">linux安装jdk环境</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/357e0c3e317fc777aea912feed1ce234/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">矩阵式键盘按键值的数码管显示实验</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>