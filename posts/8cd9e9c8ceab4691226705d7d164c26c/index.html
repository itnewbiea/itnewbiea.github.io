<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Qt调试详细日志文件输出 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Qt调试详细日志文件输出" />
<meta property="og:description" content="qInstallMessageHandle安装消息，注册回调函数，对qDebug()、qWarning()、qCritial()、qInfo()、qFatal() 等函数输出信息重定向处理。
注明：以下方法仅适用于 Qt5 及以上版本。
目的：生成log.txt日志文件，记录详细日志信息（包括等级、所在文件、所在行号、描述信息、产生时间等）,以便于快速跟踪、定位。那么在qt createor的应用程序输出窗口就不会有调试信息显示。
QtMessageHandler qInstallMessageHandler(QtMessageHandler handler)
qInstallMessageHandler安装写在main()方法中，这样全局所有类的qDebug都可以将信息直接打印到日志文件中（即安装了消息处理）。如果想恢复消息处理程序,调用qInstallMessageHandler(0)。
QtMessageHandler 回调函数处理日志信息，包括等级、所在文件、所在行号、描述信息、产生时间。并保存到本地文件。
其中等级：
qDebug： 调试信息
qWarning：警告信息
qCritical： 严重错误
qFatal： 致命错误
#ifndef LOGGINGOUTPUT_H #define LOGGINGOUTPUT_H #include &lt;QObject&gt; #include &lt;QApplication&gt; #include &lt;QDir&gt; #include &lt;QMutex&gt; #include &lt;QDateTime&gt; #include &lt;QTextStream&gt; #include &lt;QFile&gt; const int LOG_OPERATE_OK = 100; //操作成功 const int LOG_OPENFILE_FAILED = 101; //打开文件失败 class QLogOutput : public QObject { Q_OBJECT public: explicit QLogOutput(QObject *parent = nullptr); //安装信息处理函数 static void install(QString strLogFile); //卸载信息处理函数 static void uninstall(); private: //日志信息处理函数 static void outPutMsg(QtMsgType msgType, const QMessageLogContext &amp;context, const QString &amp;strText); //保存日志 static int SaveLog(const QString &amp;strMsg); //保存日志路径 static QString m_strLogFile; }; #endif // LOGGINGOUTPUT_H #include &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/8cd9e9c8ceab4691226705d7d164c26c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-19T19:42:36+08:00" />
<meta property="article:modified_time" content="2023-06-19T19:42:36+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Qt调试详细日志文件输出</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:.0001pt;text-align:justify;"><strong>qInstallMessageHandle</strong>安装消息，注册<strong>回调函数</strong>，对qDebug()、<span style="background-color:#ffffff;">qWarning()、qCritial()、qInfo()、qFatal()</span> 等函数输出信息重定向处理。</p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><span style="background-color:#ffffff;"><span style="color:#4d4d4d;"><strong>注明</strong></span></span></strong><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">：以下方法仅适用于 Qt5 及以上版本</span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">。</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><span style="background-color:#ffffff;"><span style="color:#4d4d4d;"><strong>目的</strong></span></span></strong><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">：生成log.txt日志文件，记录详细日志信息（包括等级、所在文件、所在行号、描述信息、产生时间等）,以便于快速跟踪、定位。</span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">那么在qt createor的应用程序输出窗口就不会有调试信息显示。</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">QtMessageHandler </span></span><strong><span style="background-color:#ffffff;"><span style="color:#4d4d4d;"><strong>qInstallMessageHandler</strong></span></span></strong><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">(</span></span><strong><span style="background-color:#ffffff;">QtMessageHandler </span></strong><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">handler)</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><span style="background-color:#ffffff;"><span style="color:#4d4d4d;"><strong>qInstallMessageHandler</strong></span></span></strong><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">安装写在main()方法中，这样全局所有类的</span></span><a href="https://so.csdn.net/so/search?q=qDebug&amp;spm=1001.2101.3001.7020" title="qDebug">qDebug</a><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">都可以将信息直接打印到日志文件中</span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">（</span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">即安装了</span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">消息处理</span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">）。</span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">如果想</span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">恢复消息处理程序,调用qInstallMessageHandler(0)。</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><strong><span style="background-color:#ffffff;"><strong>QtMessageHandler </strong></span></strong><span style="background-color:#ffffff;">回调函数处理日志信息，</span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">包括等级、所在文件、所在行号、描述信息、产生时间</span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">。</span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">并保存到本地文件。</span></span></span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">其中等级：</p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">qDebug： 调试信息</span></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">qWarning：警告信息</span></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">qCritical： 严重错误</span></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">qFatal： 致命错误</span></span></span></p> 
<pre><code class="language-cpp">#ifndef LOGGINGOUTPUT_H
#define LOGGINGOUTPUT_H

#include &lt;QObject&gt;
#include &lt;QApplication&gt;
#include &lt;QDir&gt;
#include &lt;QMutex&gt;
#include &lt;QDateTime&gt;
#include &lt;QTextStream&gt;
#include &lt;QFile&gt;


const int LOG_OPERATE_OK = 100; //操作成功
const int LOG_OPENFILE_FAILED = 101; //打开文件失败


class QLogOutput : public QObject
{
    Q_OBJECT
public:
    explicit QLogOutput(QObject *parent = nullptr);

    //安装信息处理函数
    static void install(QString strLogFile);

    //卸载信息处理函数
    static void uninstall();

private:
    //日志信息处理函数
    static void outPutMsg(QtMsgType msgType, const QMessageLogContext &amp;context, const QString &amp;strText);

     //保存日志
    static int SaveLog(const QString &amp;strMsg);

    //保存日志路径
    static QString m_strLogFile;

};


#endif // LOGGINGOUTPUT_H</code></pre> 
<pre><code class="language-cpp">#include "loggingoutput.h"

QString  QLogOutput::m_strLogFile = "";

QLogOutput::QLogOutput(QObject *parent) : QObject(parent)
{

}

void QLogOutput::outPutMsg(QtMsgType msgType, const QMessageLogContext &amp;context, const QString &amp;strText)
{
    static QMutex mutex;
    mutex.lock();

    QByteArray localMsg = strText.toLocal8Bit();

    QString strMsg("");
    QString strMessage;
    // 设置输出信息格式
    QString strDateTime = QDateTime::currentDateTime().toString("yyyy-MM-dd hh:mm:ss");

    switch(msgType)
    {
    case QtDebugMsg:
    {
        strMsg = QString("Debug:");
         strMessage = QString("[%1] %5 %6\t--File:%2  Line:%3  Function:%4  ")
                .arg(strDateTime).arg(context.file).arg(context.line).arg(context.function).arg(strMsg).arg(strText);
    }
        break;
    case QtInfoMsg:
    {
         strMsg = QString("Info:");
         strMessage = QString("[%1] %2 %3\t").arg(strDateTime).arg(strMsg).arg(strText);
    }
        break;
    case QtWarningMsg:
    {
        strMsg = QString("Warning:");
        strMessage = QString("[%1] %5 %6\t--File:%2  Line:%3  Function:%4  ")
               .arg(strDateTime).arg(context.file).arg(context.line).arg(context.function).arg(strMsg).arg(strText);
    }
        break;
    case QtCriticalMsg:
    {
        strMsg = QString("Critical:");
        strMessage = QString("[%1] %5 %6\t--File:%2  Line:%3  Function:%4  ")
               .arg(strDateTime).arg(context.file).arg(context.line).arg(context.function).arg(strMsg).arg(strText);
    }
        break;
    case QtFatalMsg:
    {
        strMsg = QString("Fatal:");
        strMessage = QString("[%1] %5 %6\t--File:%2  Line:%3  Function:%4  ")
               .arg(strDateTime).arg(context.file).arg(context.line).arg(context.function).arg(strMsg).arg(strText);
    }
        break;
    }

    SaveLog(strMessage);

    // 解锁
    mutex.unlock();

}

void QLogOutput::install(QString strLogFile)
{
    qInstallMessageHandler(outPutMsg);
    QString log_dir = strLogFile+"/log";
    QDir dir(log_dir);
    if(!dir.exists())
    {
        //创建在可执行程序所在目录创建log文件
        dir.mkdir(log_dir);
    }
    m_strLogFile = log_dir;
}

void QLogOutput::uninstall()
{
    qInstallMessageHandler(0);
}

int QLogOutput::SaveLog(const QString&amp; strMsg)
{
    QString log_fileName;
    QDateTime current_date_time =QDateTime::currentDateTime();
    QString date = current_date_time.toString("yyyy-MM-dd");
    log_fileName = m_strLogFile +"/"+"log_"+date+".txt";
    // 输出信息至文件中（读写、追加形式）
    QFile file(log_fileName);
    bool bOpen = file.open(QIODevice::ReadWrite | QIODevice::Append);
    if(!bOpen)
        return  LOG_OPENFILE_FAILED;
    QTextStream stream(&amp;file);
    stream &lt;&lt; strMsg &lt;&lt; "\r\n";
    file.flush();
    file.close();
    return  LOG_OPERATE_OK;
}
</code></pre> 
<pre><code class="language-cpp">int main(int argc, char *argv[])
{
    QApplication a(argc, argv);
    QString strLogFile = QCoreApplication::applicationDirPath();
    QLogOutput::install(strLogFile);

    qDebug("This is a 调试 message.");
    qInfo("This is a info message.");

    Dialog w;
    w.show();
    return a.exec();
}</code></pre> 
<p style="margin-left:0;text-align:left;">在vs2017 msvc + qt 的环境下，防止中文乱码，在pro文件配置</p> 
<p style="margin-left:0;text-align:left;">msvc{<!-- --><br> QMAKE_CXXFLAGS += -utf-8<br> }</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/12866757cf71d98bf5dfc8848dca5e3d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">servlet的创建方式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4d08bff510243a18ae7205471d679b31/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">抖音人气协议开发最新版</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>