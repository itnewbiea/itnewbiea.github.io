<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用Git Hook技术定义和校验代码提交模板 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用Git Hook技术定义和校验代码提交模板" />
<meta property="og:description" content="1.背景 使用Git做项目的版本控制时，在版本系统中会有很多的代码的提交记录，我们使用git log命令就会得到如下图中的提交记录：
当我们的项目比较简单，规模较小、开发人员也只有一两个的时候，其实可以不用定义代码的提交记录模板，但是当我们的项目开始变得庞大，有很多的开发者都在参与开发的时候，我们会发现每个人提交的信息都是千奇百怪的，出现了一个问题，要定位具体的提交时更是如大海捞针。特别痛苦。所以Git提供了代码提交记录模板，和对提交记录模板的验证，让每个提交代码的开发者按照模板填写提交的信息，提交后再验证下开发者是否按照模板的要求填写提交信息，如果没有就不让其执行接下来的git push命令。
2.解决方案 2.1 技术可行性 2.1.1 如何实现 其实当我们创建了一个Git的本地仓库后，项目的根目录下看到一个.git文件夹，在文件夹下的hooks目录下有很多的.sample 为后缀的文件，如下图所示
这些文件就是我们要改造的脚本，这个以.sample后缀结束的脚本文件是不会执行的，如果需要执行，我们需要去掉.sample后缀。我们要实现的功能是定义Git提交模板和校验模板的正确性。所以我们可以参考prepare-commit-msg.sample（提交模板）和commit-msg.sample（验证模板）完成我们的功能，修改完这个模板后我们就可以使用模板了，当我们需要使用命令git commit 提交代码时，在出现的提交信息编辑器中会出现我们在prepare-commit-msg脚本中定义好的模板，我们填写完模板后保存模板，这时会使用commit-msg脚本对模板做校验。这样的话我们的本地提交代码就能使用我们定义好的模板了。
2.1.2 如何同步配置到项目中其他开发者 现在还有一个问题，就是这些配置都是在我们的本地，项目中的其他开发者并没有这个环境，我们如果让他们去配置显然不合适，因为有的人可能不会搭理你。所以我们需要做到让开发者无感知的就装上了我们的环境，原理其实就是我们将模板提交到代码仓库中，然后通过脚本将配置的模板拷贝到用户的&#34;.git/hooks&#34;目录下，当用户触发某个操作时，就执行脚本。本文我们以Android项目为例子，使用Gradle脚本，当用户执行构建操作的时候，我们执行配置提交模板的脚本
2.2 实现方案 2.2.1 提交模板的脚本示例 在.git/hooks目录下，复制prepare-commit-msg.sample文件，重命名为prepare-commit-msg(注意这里没有“.sample后缀名”)，我们定义一个模板：
项目名称: [MountTai] 部门名称: [] 禅道BUGID: [无]
原因分析: {}
解决方案: {}
prepare-commit-msg:（脚本是用perl语言和shell语言搭配写的，比较简单就不细讲了),逻辑就是在开发者进入编辑器之前，往编辑器写入我们的模板。这样编辑器打开后显示的就是我们写的模板啦。
#!/bin/sh COMMIT_MSG_FILE=$1 COMMIT_SOURCE=$2 SHA1=$3 case &#34;$2,$3&#34; in merge,) /usr/bin/perl -i.bak -ne &#39;s/^/# /, s/^# #/#/ if /^Conflicts/ .. /#/; print&#39; &#34;$1&#34; ;; ,|template,) /usr/bin/perl -i.bak -pe &#39;print &#34;项目名称: [MountTai] 部门名称: [] 禅道BUGID: [无]\n #部门名称: Android开发部 / 三维软件部 \n\n原因分析: {}\n解决方案: {}\n&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/306c595ea83179705199b34b130b9784/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-08T21:33:12+08:00" />
<meta property="article:modified_time" content="2023-03-08T21:33:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用Git Hook技术定义和校验代码提交模板</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="1_0"></a>1.背景</h2> 
<p>使用Git做项目的版本控制时，在版本系统中会有很多的代码的提交记录，我们使用git log命令就会得到如下图中的提交记录：<br> <img src="https://images2.imgbox.com/b0/63/f610EQ3B_o.png" alt="在这里插入图片描述"></p> 
<p>当我们的项目比较简单，规模较小、开发人员也只有一两个的时候，其实可以不用定义代码的提交记录模板，但是当我们的项目开始变得庞大，有很多的开发者都在参与开发的时候，我们会发现每个人提交的信息都是千奇百怪的，出现了一个问题，要定位具体的提交时更是如大海捞针。特别痛苦。所以Git提供了代码提交记录模板，和对提交记录模板的验证，让每个提交代码的开发者按照模板填写提交的信息，提交后再验证下开发者是否按照模板的要求填写提交信息，如果没有就不让其执行接下来的<code>git push</code>命令。</p> 
<h2><a id="2_5"></a>2.解决方案</h2> 
<h3><a id="21__6"></a>2.1 技术可行性</h3> 
<h4><a id="211__7"></a>2.1.1 如何实现</h4> 
<p>其实当我们创建了一个Git的本地仓库后，项目的根目录下看到一个<code>.git</code>文件夹，在文件夹下的<code>hooks</code>目录下有很多的<code>.sample </code>为后缀的文件，如下图所示<br> <img src="https://images2.imgbox.com/f5/89/5UkXTNU5_o.png" alt="在这里插入图片描述"></p> 
<p>这些文件就是我们要改造的脚本，这个以<code>.sample</code>后缀结束的脚本文件是不会执行的，如果需要执行，我们需要去掉<code>.sample</code>后缀。我们要实现的功能是定义Git提交模板和校验模板的正确性。所以我们可以参考<code>prepare-commit-msg.sample</code>（提交模板）和<code>commit-msg.sample</code>（验证模板）完成我们的功能，修改完这个模板后我们就可以使用模板了，当我们需要使用命令<code>git commit </code>提交代码时，在出现的提交信息编辑器中会出现我们在<code>prepare-commit-msg</code>脚本中定义好的模板，我们填写完模板后保存模板，这时会使用<code>commit-msg</code>脚本对模板做校验。这样的话我们的本地提交代码就能使用我们定义好的模板了。</p> 
<h4><a id="212__12"></a>2.1.2 如何同步配置到项目中其他开发者</h4> 
<p>现在还有一个问题，就是这些配置都是在我们的本地，项目中的其他开发者并没有这个环境，我们如果让他们去配置显然不合适，因为有的人可能不会搭理你。所以我们需要做到让开发者无感知的就装上了我们的环境，原理其实就是我们将模板提交到代码仓库中，然后通过脚本将配置的模板拷贝到用户的".git/hooks"目录下，当用户触发某个操作时，就执行脚本。本文我们以Android项目为例子，使用Gradle脚本，当用户执行构建操作的时候，我们执行配置提交模板的脚本</p> 
<h3><a id="22____14"></a>2.2 实现方案</h3> 
<h4><a id="221__15"></a>2.2.1 提交模板的脚本示例</h4> 
<p>在<code>.git/hooks</code>目录下，复制<code>prepare-commit-msg.sample</code>文件，重命名为<code>prepare-commit-msg</code>(注意这里没有“<code>.sample</code>后缀名”)，我们定义一个模板：</p> 
<blockquote> 
 <p>项目名称: [MountTai] 部门名称: [] 禅道BUGID: [无]<br> 原因分析: {}<br> 解决方案: {}</p> 
</blockquote> 
<p><code>prepare-commit-msg:</code>（脚本是用perl语言和shell语言搭配写的，比较简单就不细讲了),逻辑就是在开发者进入编辑器之前，往编辑器写入我们的模板。这样编辑器打开后显示的就是我们写的模板啦。</p> 
<pre><code class="prism language-perl"><span class="token comment">#!/bin/sh</span>
COMMIT_MSG_FILE<span class="token operator">=</span><span class="token variable">$1</span>
COMMIT_SOURCE<span class="token operator">=</span><span class="token variable">$2</span>
SHA1<span class="token operator">=</span><span class="token variable">$3</span>
case <span class="token string">"$2,$3"</span> in
 merge<span class="token punctuation">,</span><span class="token punctuation">)</span>
  <span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token regex">/perl -i.bak -ne 's/</span><span class="token operator">^</span><span class="token regex">/# /</span><span class="token punctuation">,</span> <span class="token regex">s/^# #/#/</span> <span class="token keyword">if</span> <span class="token regex">/^Conflicts/</span> <span class="token operator">..</span> <span class="token regex">/#/</span><span class="token punctuation">;</span> <span class="token keyword">print</span>' <span class="token string">"$1"</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
 <span class="token punctuation">,</span><span class="token operator">|</span>template<span class="token punctuation">,</span><span class="token punctuation">)</span>
  <span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>perl <span class="token operator">-</span>i<span class="token operator">.</span>bak <span class="token operator">-</span>pe '<span class="token keyword">print</span> <span class="token string">"项目名称: [MountTai] 部门名称: [] 禅道BUGID: [无]\n
  #部门名称: Android开发部 / 三维软件部 \n\n原因分析: {}\n解决方案: {}\n"</span> <span class="token keyword">if</span> <span class="token regex">/^#/</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$first</span><span class="token operator">++</span> <span class="token operator">==</span> <span class="token number">0</span>' <span class="token string">"$1"</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
 <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
esac
</code></pre> 
<p>这个文件编写好后，直接放到<code>.git/hooks</code>目录下，然后我们执行<code>git commit</code> 命令后就会出现下图中的模板<br> <img src="https://images2.imgbox.com/70/96/x5XHLpjK_o.png" alt="[图片]"></p> 
<blockquote> 
 <p>提交编辑界面：这里需要重点注意下，如上图所示，在编辑器的最上面会有一个空格，这个空格需要我们手动删除，然后再填写我们的提交信息。若是无法编辑，请将输入法切换为英文，按下键盘的<code>i</code>键，进入编辑模式，要保存的时候，切换输入法到英文，然后按下<code>esc</code>键，可以按下 <code>shift+zz</code> 组合键直接保存，或者按下<code>shift + : </code> 进入指令模式，再输入<code>wq</code>，回车就行了，放弃则输入<code>q!</code>。</p> 
</blockquote> 
<p>删除空格后，第一行会显示黄色，如下图：<br> <img src="https://images2.imgbox.com/de/f0/Q6ElLez0_o.png" alt="[图片]"></p> 
<h4><a id="222__47"></a>2.2.2 校验模板示例</h4> 
<p>复制<code>.git/hooks</code>下的<code>commit-msg.sample</code>文件，重命名为<code>commit-msg</code>,然后编写模板校验规则，使用正则表达式验证开发者提交的代码信息。下面的逻辑就是获取提交的信息后，使用正则表达式去匹配。成功的话就可以继续提交，否则的话提示用户消息提交格式不合法，重新编辑提交</p> 
<pre><code class="prism language-perl">commit_msg<span class="token operator">=</span><span class="token string">`cat $1`</span>
msg_re<span class="token operator">=</span><span class="token string">"^(项目名称|部门名称|禅道BUGID|原因分析|解决方案)(\(.+\))?: .{1,100}"</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token variable">$commit_msg</span> <span class="token operator">=~</span> <span class="token variable">$msg_re</span> <span class="token punctuation">]</span><span class="token punctuation">]</span>
then
   echo <span class="token operator">-e</span> <span class="token string">"不合法的 commit 消息提交格式，请使用正确的格式:\n
   详情请查看 git commit 提交规范：https://t3hx1u77li.feishu.cn/docx/CJr7d7aHJofPcYxOA1NcISVBn0d"</span>
   
   <span class="token comment"># 异常退出</span>
   exit <span class="token number">1</span> 
fi
</code></pre> 
<p>提交成功会展示：<br> <img src="https://images2.imgbox.com/4b/5f/VCc5DaT1_o.png" alt="[图片]"></p> 
<p>失败会显示<br> <img src="https://images2.imgbox.com/cf/58/mcpCJt6F_o.png" alt="[图片]"></p> 
<p><code>标出的部分，就是提交规范文档，让开发者可以在失败的时候通过这个文档查看提交规范。</code></p> 
<h4><a id="223__72"></a>2.2.3 配置同步到项目的其他开发者脚本示例</h4> 
<p>（1）本地配置好了后，我们就可以把<code>prepare-commit-msg和commit-msg</code>两个脚本放到你的项目根目录下<br> <img src="https://images2.imgbox.com/0f/ba/8NoA7S6z_o.png" alt="[图片]"></p> 
<p>（2）创建一个gradle脚本，做环境拷贝工作<br> <img src="https://images2.imgbox.com/87/b8/hIlCobye_o.png" alt="[图片]"></p> 
<p>Git配置提交模板和校验模板的gradle脚本示例：</p> 
<pre><code class="prism language-groovy"><span class="token keyword">def</span> useGitTemplate <span class="token operator">=</span> <span class="token boolean">false</span>

project<span class="token punctuation">.</span>afterEvaluate <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>useGitTemplate<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        preBuild<span class="token punctuation">.</span><span class="token function">dependsOn</span><span class="token punctuation">(</span><span class="token string">'resetGitHookConfig'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"exec tasks"</span><span class="token punctuation">)</span>
        preBuild<span class="token punctuation">.</span><span class="token function">dependsOn</span><span class="token punctuation">(</span><span class="token string">'prepareCommitMsgConfig'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

task <span class="token function">prepareCommitMsgConfig</span><span class="token punctuation">(</span>type<span class="token punctuation">:</span>Copy<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">from</span><span class="token punctuation">(</span><span class="token function">getCommitMsgConfigFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">into</span><span class="token punctuation">(</span><span class="token function">getGitHookDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    File file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token function">getGitHookDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"GitHookDir: "</span> <span class="token operator">+</span> <span class="token function">getGitHookDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" ,permission: "</span> <span class="token operator">+</span> file<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
            <span class="token string">" ,readable: "</span> <span class="token operator">+</span> file<span class="token punctuation">.</span><span class="token function">canRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" ,writable: "</span> <span class="token operator">+</span> file<span class="token punctuation">.</span><span class="token function">canWrite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token function">into</span><span class="token punctuation">(</span><span class="token function">getGitHookDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">from</span><span class="token punctuation">(</span><span class="token function">getPrePareCommitMsgConfigFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

task resetGitHookConfig<span class="token punctuation">{<!-- --></span>
    doFirst <span class="token punctuation">{<!-- --></span>
        File commitMsgFile <span class="token operator">=</span> <span class="token function">getGitHookFile</span><span class="token punctuation">(</span><span class="token string">'commit-msg'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>commitMsgFile <span class="token operator">!=</span> null<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            commitMsgFile<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        File prepareCommitMsgFile <span class="token operator">=</span> <span class="token function">getGitHookFile</span><span class="token punctuation">(</span><span class="token string">'prepare-commit-msg'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>commitMsgFile <span class="token operator">!=</span> null<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            prepareCommitMsgFile<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">getGitHookFile</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">def</span> dirPath <span class="token operator">=</span> <span class="token function">getGitHookDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"getGitHookFile:dirPath: "</span> <span class="token operator">+</span> dirPath<span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>dirPath <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> dirPath<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">def</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>dirPath<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"getGitHookFile: file path: "</span> <span class="token operator">+</span> file<span class="token punctuation">.</span>absolutePath<span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> file
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> null
<span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">getCommitMsgConfigFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    File configFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>project<span class="token punctuation">.</span>rootDir<span class="token punctuation">,</span><span class="token string">"git-hook/commit-msg"</span><span class="token punctuation">)</span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"getCommitMsgConfigFile: configFile: "</span> <span class="token operator">+</span> configFile<span class="token punctuation">.</span>absolutePath
    <span class="token operator">+</span> <span class="token string">" ,isExist: "</span> <span class="token operator">+</span> configFile<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>configFile<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> configFile<span class="token punctuation">.</span>absolutePath
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> null
<span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">getPrePareCommitMsgConfigFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    File configFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>project<span class="token punctuation">.</span>rootDir<span class="token punctuation">,</span><span class="token string">"git-hook/prepare-commit-msg"</span><span class="token punctuation">)</span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"getPrePareCommitMsgConfigFile: prepareConfigFile: "</span> <span class="token operator">+</span> configFile<span class="token punctuation">.</span>absolutePath
    <span class="token operator">+</span> <span class="token string">" ,isExist: "</span> <span class="token operator">+</span> configFile<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>configFile<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> configFile<span class="token punctuation">.</span>absolutePath
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> null
<span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">getGitHookDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    File gitHookDir <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>project<span class="token punctuation">.</span>rootDir<span class="token punctuation">,</span><span class="token string">".git/hooks"</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gitHookDir<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Your project can't find .git directory in the ${project.rootDir.absolutePath},"</span> <span class="token operator">+</span>
                <span class="token string">" please ensure it have been tracked by git VCS!"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> null
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> gitHookDir<span class="token punctuation">.</span>absolutePath
<span class="token punctuation">}</span>
</code></pre> 
<p>脚本的意思就是当我们运行Android的构建时，就会执行我们的这个脚本，把项目中的<code>prepare-commit-msg</code>和<code>commit-msg</code>脚本拷贝到开发者的<code>.git/hooks</code>目录下，然后开发者就可以使用提交模板和验证功能了</p> 
<p>提交代码的时候若是使用图形界面，可以把模板复制到界面中提交<br> <img src="https://images2.imgbox.com/21/b2/XRidLsoS_o.png" alt="[图片]"></p> 
<p>Git 模板改造完后，我们的提交记录就会变得很规整了<br> <img src="https://images2.imgbox.com/52/6f/zxMYIudh_o.png" alt="[图片]"></p> 
<h2><a id="3_174"></a>3.总结</h2> 
<p>Git Hook技术可以用来实现很多功能，比如在push操作之前想做一些其他操作，和Java的hook技术差不多，都是希望执行某个操作之前或者之后先执行我们定义的操作，使用这个技术可以做代码的规范验证，提交模板的定义，模板的校验等功能，更多的功能后面用到的时候再做分享。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/09853bf72932f789ca39656c14151947/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">核酸检测信息管理系统</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0fccd511c2ed135dea0d9a60af10bce1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【软件卸载-ASM(IsaHelper)入网小助手卸载】</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>