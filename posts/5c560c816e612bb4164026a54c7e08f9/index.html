<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python--sys.stdout重定向 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="python--sys.stdout重定向" />
<meta property="og:description" content="1.print
def print(self, *args, sep=&#39; &#39;, end=&#39;\n&#39;, file=None): # known special case of print &#34;&#34;&#34; print(value, ..., sep=&#39; &#39;, end=&#39;\n&#39;, file=sys.stdout, flush=False) Prints the values to a stream, or to sys.stdout by default. Optional keyword arguments: file: a file-like object (stream); defaults to the current sys.stdout. sep: string inserted between values, default a space. end: string appended after the last value, default a newline. flush: whether to forcibly flush the stream." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/5c560c816e612bb4164026a54c7e08f9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-16T16:37:38+08:00" />
<meta property="article:modified_time" content="2021-08-16T16:37:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python--sys.stdout重定向</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>1.print</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">print</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">' '</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># known special case of print</span>
    <span class="token triple-quoted-string string">"""
    print(value, ..., sep=' ', end='\n', file=sys.stdout, flush=False)
    
    Prints the values to a stream, or to sys.stdout by default.
    Optional keyword arguments:
    file:  a file-like object (stream); defaults to the current sys.stdout.
    sep:   string inserted between values, default a space.
    end:   string appended after the last value, default a newline.
    flush: whether to forcibly flush the stream.
    """</span>
    <span class="token keyword">pass</span>
</code></pre> 
<p>阅读上面的源代码，print的file对象指向sys.stdout，即标准输出流，打印输出到控制台；</p> 
<p>可以直接给file对象赋值，使其指向文件对象，打印输出到文件；</p> 
<pre><code class="prism language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"text1.log"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>text1.log文件已经写入123</p> 
</blockquote> 
<p><strong>2.sys.stdout重定向</strong></p> 
<p>sys.stdout是python中的标准输出流，默认是映射到控制台的，即将信息打印到控制台。</p> 
<p>在python中调用print时，默认情况下，实际上是调用了sys.stdout.write(obj+"\n")</p> 
<pre><code class="prism language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span>
sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"hello\n"</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>控制台输出<br> hello<br> hello</p> 
</blockquote> 
<p><strong>3.sys.stdout重定向到文件对象</strong></p> 
<p>sys.stdout默认是映射到控制台，可以通过修改映射关系把打印操作重定向到其他地方，例如：可以将文件对象引用赋给sys.stdout，实现sys.stdout的重定向。</p> 
<pre><code class="prism language-python"><span class="token comment"># 保存原始sys.stdout进行备份</span>
save_stdout <span class="token operator">=</span> sys<span class="token punctuation">.</span>stdout
<span class="token comment"># sys.stdout重定向，指向文件对象</span>
sys<span class="token punctuation">.</span>stdout <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span>
<span class="token comment"># print调用sys.stdout的write方法（此时sys.stdout指向文件对象，实际上调用的就是文件对象的write方法），打印到test.txt文件</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">)</span>
<span class="token comment"># 恢复，标准输出流</span>
sys<span class="token punctuation">.</span>stdout <span class="token operator">=</span> save_stdout
<span class="token comment"># print调用sys.stdout的write方法，标准输出流默认打印到控制台</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"hello world again"</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>test.txt文件已经写入hello world</p> 
</blockquote> 
<blockquote> 
 <p>控制台输出<br> hello world again</p> 
</blockquote> 
<p>上面代码可以理解为：</p> 
<p><img src="https://images2.imgbox.com/4e/38/Ew5lva5A_o.png" alt="在这里插入图片描述"></p> 
<p><strong>4.sys.stdout重定向到自定义对象</strong></p> 
<p>sys.stdout可以重定向到一个实现write方法的自定义对象，从上面的例子中知道，print方法调用的实际是sys.stdout.write方法，所以自定义对象一定要实现write方法。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> sys
<span class="token keyword">import</span> tkinter
<span class="token keyword">import</span> tkinter<span class="token punctuation">.</span>scrolledtext


<span class="token keyword">class</span> <span class="token class-name">RedictStdout</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> scroll_text<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 保存原始sys.stdout进行备份</span>
        self<span class="token punctuation">.</span>save_stdout <span class="token operator">=</span> sys<span class="token punctuation">.</span>stdout
        <span class="token comment"># sys.stdout重定向，指向该对象</span>
        sys<span class="token punctuation">.</span>stdout <span class="token operator">=</span> self
        self<span class="token punctuation">.</span>scroll_text <span class="token operator">=</span> scroll_text

    <span class="token keyword">def</span> <span class="token function">write</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># message即sys.stdout接收到的输出信息</span>
        self<span class="token punctuation">.</span>scroll_text<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>tkinter<span class="token punctuation">.</span>END<span class="token punctuation">,</span> message<span class="token punctuation">)</span>  <span class="token comment"># 在多行文本控件最后一行插入message</span>
        <span class="token comment"># self.scroll_text.update()  # 更新显示的文本</span>
        self<span class="token punctuation">.</span>scroll_text<span class="token punctuation">.</span>see<span class="token punctuation">(</span>tkinter<span class="token punctuation">.</span>END<span class="token punctuation">)</span>  <span class="token comment"># 始终显示最后一行，不加这句，当文本溢出控件最后一行时，可能不会自动显示最后一行</span>

    <span class="token keyword">def</span> <span class="token function">restore</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    	<span class="token comment"># 恢复标准输出流</span>
        sys<span class="token punctuation">.</span>stdout <span class="token operator">=</span> self<span class="token punctuation">.</span>save_stdout


<span class="token keyword">def</span> <span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"hello word"</span><span class="token punctuation">)</span>


window <span class="token operator">=</span> tkinter<span class="token punctuation">.</span>Tk<span class="token punctuation">(</span><span class="token punctuation">)</span>
scroll_text <span class="token operator">=</span> tkinter<span class="token punctuation">.</span>scrolledtext<span class="token punctuation">.</span>ScrolledText<span class="token punctuation">(</span>window<span class="token punctuation">,</span> bg<span class="token operator">=</span><span class="token string">"pink"</span><span class="token punctuation">)</span>
scroll_text<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token punctuation">)</span>
button <span class="token operator">=</span> tkinter<span class="token punctuation">.</span>Button<span class="token punctuation">(</span>window<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">"点击"</span><span class="token punctuation">,</span> command<span class="token operator">=</span>click<span class="token punctuation">)</span>
button<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 实例化对象</span>
rs <span class="token operator">=</span> RedictStdout<span class="token punctuation">(</span>scroll_text<span class="token punctuation">)</span>
<span class="token comment"># print调用sys.stdout的write方法，sys.stdout指向rs对象，实际上print调用rs的write方法</span>
<span class="token comment"># rs的write方法，实现了scrolltext组件插入sys.stdout收到的message信息，即print要打印的信息</span>
window<span class="token punctuation">.</span>mainloop<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 恢复标准输出流</span>
rs<span class="token punctuation">.</span>restore<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>效果：<br> <img src="https://images2.imgbox.com/f7/4c/ohtIM0kN_o.gif" alt="在这里插入图片描述"></p> 
<p>上面代码可以理解为：<br> <img src="https://images2.imgbox.com/56/c0/lNpCIUQR_o.png" alt="在这里插入图片描述"><br> <strong>5.logging模块日志输出</strong></p> 
<p>logging的基本用法：</p> 
<pre><code class="prism language-python"><span class="token comment"># 设置日志等级为DEBUG</span>
logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>DEBUG<span class="token punctuation">)</span>
logging<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"logging error message"</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>控制台输出<br> ERROR:root:logging error message</p> 
</blockquote> 
<p>阅读logging模块源代码，发现basicConfig默认创建一个StreamHandler，并且其指向标准错误输出流，即sys.stderr，默认情况下日志输出到控制台。</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">basicConfig</span><span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">""</span>"
    Do basic configuration <span class="token keyword">for</span> the logging system<span class="token punctuation">.</span>

    This function does nothing <span class="token keyword">if</span> the root logger already has handlers
    configured<span class="token punctuation">,</span> unless the keyword argument <span class="token operator">*</span>force<span class="token operator">*</span> <span class="token keyword">is</span> <span class="token builtin">set</span> to ``<span class="token boolean">True</span>``<span class="token punctuation">.</span>
    It <span class="token keyword">is</span> a convenience method intended <span class="token keyword">for</span> use by simple scripts
    to do one<span class="token operator">-</span>shot configuration of the logging package<span class="token punctuation">.</span>

    The default behaviour <span class="token keyword">is</span> to create a StreamHandler which writes to
    sys<span class="token punctuation">.</span>stderr<span class="token punctuation">,</span> <span class="token builtin">set</span> a formatter using the BASIC_FORMAT <span class="token builtin">format</span> string<span class="token punctuation">,</span> <span class="token keyword">and</span>
    add the handler to the root logger<span class="token punctuation">.</span>

    A number of optional keyword arguments may be specified<span class="token punctuation">,</span> which can alter
    the default behaviour<span class="token punctuation">.</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">StreamHandler</span><span class="token punctuation">(</span>Handler<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    A handler class which writes logging records, appropriately formatted,
    to a stream. Note that this class does not close the stream, as
    sys.stdout or sys.stderr may be used.
    """</span>

    terminator <span class="token operator">=</span> <span class="token string">'\n'</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> stream<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        Initialize the handler.

        If stream is not specified, sys.stderr is used.
        """</span>
        Handler<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        <span class="token keyword">if</span> stream <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            stream <span class="token operator">=</span> sys<span class="token punctuation">.</span>stderr
        self<span class="token punctuation">.</span>stream <span class="token operator">=</span> stream
</code></pre> 
<p>所以，在4点中直接使用logging的基本用法，是无法让scrolltext显示logging要打印的日志信息的，因为，4点中的代码只做了对sys.stdout的重定向，我们应该加一步对sys.stderr的重定向。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> logging
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> tkinter
<span class="token keyword">import</span> tkinter<span class="token punctuation">.</span>scrolledtext


<span class="token keyword">class</span> <span class="token class-name">RedictStdout</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> scroll_text<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 保存原始sys.stdout/sys.stderr进行备份</span>
        self<span class="token punctuation">.</span>save_stdout <span class="token operator">=</span> sys<span class="token punctuation">.</span>stdout
        self<span class="token punctuation">.</span>save_stderr <span class="token operator">=</span> sys<span class="token punctuation">.</span>stderr
        <span class="token comment"># sys.stdout/sys.stderr重定向，指向该对象</span>
        sys<span class="token punctuation">.</span>stdout <span class="token operator">=</span> self
        sys<span class="token punctuation">.</span>stderr <span class="token operator">=</span> self
        self<span class="token punctuation">.</span>scroll_text <span class="token operator">=</span> scroll_text

    <span class="token keyword">def</span> <span class="token function">write</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># message即sys.stdout/sys.stderr接收到的输出信息</span>
        self<span class="token punctuation">.</span>scroll_text<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>tkinter<span class="token punctuation">.</span>END<span class="token punctuation">,</span> message<span class="token punctuation">)</span>  <span class="token comment"># 在多行文本控件最后一行插入message</span>
        <span class="token comment"># self.scroll_text.update()  # 更新显示的文本</span>
        self<span class="token punctuation">.</span>scroll_text<span class="token punctuation">.</span>see<span class="token punctuation">(</span>tkinter<span class="token punctuation">.</span>END<span class="token punctuation">)</span>  <span class="token comment"># 始终显示最后一行，不加这句，当文本溢出控件最后一行时，可能不会自动显示最后一行</span>

    <span class="token keyword">def</span> <span class="token function">restore</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    	<span class="token comment"># 恢复标准输出流</span>
        sys<span class="token punctuation">.</span>stdout <span class="token operator">=</span> self<span class="token punctuation">.</span>save_stdout
        sys<span class="token punctuation">.</span>stderr <span class="token operator">=</span> self<span class="token punctuation">.</span>save_stderr


<span class="token keyword">def</span> <span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"hello word"</span><span class="token punctuation">)</span>
    logging<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"logging error message"</span><span class="token punctuation">)</span>


window <span class="token operator">=</span> tkinter<span class="token punctuation">.</span>Tk<span class="token punctuation">(</span><span class="token punctuation">)</span>
scroll_text <span class="token operator">=</span> tkinter<span class="token punctuation">.</span>scrolledtext<span class="token punctuation">.</span>ScrolledText<span class="token punctuation">(</span>window<span class="token punctuation">,</span> bg<span class="token operator">=</span><span class="token string">"pink"</span><span class="token punctuation">)</span>
scroll_text<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token punctuation">)</span>
button <span class="token operator">=</span> tkinter<span class="token punctuation">.</span>Button<span class="token punctuation">(</span>window<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">"点击"</span><span class="token punctuation">,</span> command<span class="token operator">=</span>click<span class="token punctuation">)</span>
button<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 实例化对象</span>
rs <span class="token operator">=</span> RedictStdout<span class="token punctuation">(</span>scroll_text<span class="token punctuation">)</span>
<span class="token comment"># print调用sys.stdout的write方法，sys.stdout指向rs对象，实际上print调用rs的write方法</span>
<span class="token comment"># rs的write方法，实现了scrolltext组件插入sys.stdout收到的message信息，即print要打印的信息</span>

<span class="token comment"># 设置日志等级为DEBUG</span>
logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>DEBUG<span class="token punctuation">)</span>
<span class="token comment"># logging.error调用了sys.stderr的write方法，sys.stderr指向rs对象，实际上logging.error调用rs的write方法</span>
<span class="token comment"># rs的write方法，实现了scrolltext组件插入sys.stderr收到的message信息，即logging.error要打印的信息</span>

window<span class="token punctuation">.</span>mainloop<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 恢复标准输出流</span>
rs<span class="token punctuation">.</span>restore<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>效果：<br> <img src="https://images2.imgbox.com/85/cb/QM7X0ra4_o.gif" alt="在这里插入图片描述"><br> 上面代码可以理解为：<br> <img src="https://images2.imgbox.com/29/69/JQdqHQIf_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d7a23aab317d45fd933c7eb405435889/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">推荐26个GitHub上好玩又有挑战的前端项目（涵盖初中高阶）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a2856f8eb69c79ce194aeb01e764fdb5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java 过滤器解决URLSQL注入漏洞、跨站漏洞、框架注入漏洞、链接注入漏洞</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>