<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Sqlite常用语句 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Sqlite常用语句" />
<meta property="og:description" content="一、基础
1、说明：创建数据库
CREATE DATABASE database-name
2、说明：删除数据库
drop database dbname
3、说明：备份sql server
--- 创建 备份数据的 device
USE master
EXEC sp_addumpdevice &#39;disk&#39;, &#39;testBack&#39;, &#39;c:\mssql7backup\MyNwind_1.dat&#39;
--- 开始 备份
BACKUP DATABASE pubs TO testBack
4、说明：创建新表
create table tabname(col1 type1 [not null] [primary key],col2 type2 [not null],..)
根据已有的表创建新表：
A：create table tab_new like tab_old (使用旧表创建新表)
B：create table tab_new as select col1,col2… from tab_old definition only
5、说明：删除新表
drop table tabname
6、说明：增加一个列
Alter table tabname add column col type" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/5c9266836aa71824ef39ba35e489a62a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2014-08-27T14:01:54+08:00" />
<meta property="article:modified_time" content="2014-08-27T14:01:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Sqlite常用语句</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin:10px auto; color:rgb(51,51,51); line-height:24px; background-color:rgb(214,211,214)"> </p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">一、基础</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">1</span>、说明：创建数据库</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">CREATE DATABASE database-name</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">2</span>、说明：删除数据库</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">drop database dbname</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">3<span class="s2">、说明：备份</span>sql server</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">--- <span class="s2"> 创建</span> <span class="s2">备份数据的</span> device</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">USE master</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">EXEC sp_addumpdevice 'disk', 'testBack', 'c:\mssql7backup\MyNwind_1.dat'</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">--- <span class="s2"> 开始</span> <span class="s2">备份</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">BACKUP DATABASE pubs TO testBack</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">4</span>、说明：创建新表</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">create table tabname(col1 type1 [not null] [primary key],col2 type2 [not null],..)</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">根据已有的表创建新表：</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">A<span class="s2">：</span>create table tab_new like tab_old (<span class="s2">使用旧表创建新表</span>)</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">B<span class="s2">：</span>create table tab_new as select col1,col2… from tab_old definition only</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">5</span>、说明：删除新表</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">drop table tabname</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">6</span>、说明：增加一个列</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">Alter table tabname add column col type</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">注：列增加后将不能删除。<span class="s1">DB2</span>中列加上后数据类型也不能改变，唯一能改变的是增加<span class="s1">varchar</span>类型的长度。</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">7<span class="s2">、说明：添加主键：</span> Alter table tabname add primary key(col)</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s2">说明：删除主键：</span> Alter table tabname drop primary key(col)</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">8<span class="s2">、说明：创建索引：</span>create [unique] index idxname on tabname(col….)</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s2">删除索引：</span>drop index idxname</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">注：索引是不可更改的，想更改必须删除重新建。</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">9<span class="s2">、说明：创建视图：</span>create view viewname as select statement</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s2">删除视图：</span>drop view viewname</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">10</span>、说明：几个简单的基本的<span class="s1">sql</span>语句</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s2">选择：</span>select * from table1 where <span class="s2">范围</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s2">插入：</span>insert into table1(field1,field2) values(value1,value2)</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s2">删除：</span>delete from table1 where <span class="s2">范围</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s2">更新：</span>update table1 set field1=value1 where <span class="s2">范围</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s2">查找：</span>select * from table1 where field1 like ’%value1%’ ---like<span class="s2">的语法很精妙，查资料</span>!</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s2">排序：</span>select * from table1 order by field1,field2 [desc]</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s2">总数：</span>select count as totalcount from table1</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s2">求和：</span>select sum(field1) as sumvalue from table1</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s2">平均：</span>select avg(field1) as avgvalue from table1</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s2">最大：</span>select max(field1) as maxvalue from table1</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s2">最小：</span>select min(field1) as minvalue from table1</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">另附详细解释用法: </span></p> 
<p class="p3"></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">sqlite3<span class="s1">指令</span></span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><span class="s2">sql</span>的指令格式：所有<span class="s2">sql</span>指令都是以分号<span class="s2">(;)</span>结尾，两个减号<span class="s2">(--)</span>则表示注释。</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px">如：</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">sqlite&gt;create studen_table(Stu_no interger PRIMARY KEY, Name text NOT <span class="s3">NULL</span>, Id interger UNIQUE, Age interger CHECK(Age&gt;6), School text DEFAULT 'xx<span class="s1">小学</span>);</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           <span class="s1">该语句创建一个记录学生信息的数据表。</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">                           </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           3.1 sqlite3<span class="s1">存储数据的类型</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           <span class="s3">NULL</span><span class="s1">：标识一个</span><span class="s3">NULL</span><span class="s1">值</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           INTERGER<span class="s1">：整数类型</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           REAL<span class="s1">：浮点数</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           TEXT<span class="s1">：字符串</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           BLOB<span class="s1">：二进制数</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">                           </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           3.2 sqlite3<span class="s1">存储数据的约束条件</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           Sqlite<span class="s1">常用约束条件如下：</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           PRIMARY KEY - <span class="s1">主键：</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           1<span class="s1">）主键的值必须唯一，用于标识每一条记录，如学生的学号</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           2<span class="s1">）主键同时也是一个索引，通过主键查找记录速度较快</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           3<span class="s1">）主键如果是整数类型，该列的值可以自动增长</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           NOT <span class="s3">NULL</span> - <span class="s1">非空：</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           <span class="s1">约束列记录不能为空，否则报错</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           UNIQUE - <span class="s1">唯一：</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           <span class="s1">除主键外，约束其他列的数据的值唯一</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           CHECK - <span class="s1">条件检查：</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           <span class="s1">约束该列的值必须符合条件才可存入</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           DEFAULT - <span class="s1">默认值：</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           <span class="s1">列数据中的值基本都是一样的，这样的字段列可设为默认值</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">                           </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           3.3 sqlite3<span class="s1">常用指令</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           1<span class="s1">）建立数据表</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           create table table_name(field1 type1, field2 type1, ...);</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           table_name<span class="s1">是要创建数据表名称，</span>fieldx<span class="s1">是数据表内字段名称，</span>typex<span class="s1">则是字段类型。</span></span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><span class="s2">                           </span>例，建立一个简单的学生信息表，它包含学号与姓名等学生信息：</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           create table student_info(stu_no interger primary key, name text);</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">                           </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">                           </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           create table <span class="s3">if</span> not exists <span class="s1">表名</span>(<span class="s1">字段名</span>1,<span class="s1">字段名</span>2...);</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">                           </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">                           </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           2<span class="s1">）添加数据记录</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           insert into table_name(field1, field2, ...) values(val1, val2, ...);</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           valx<span class="s1">为需要存入字段的值。</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           <span class="s1">例，往学生信息表添加数据：</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           Insert into student_info(stu_no, name) values(0001, alex);</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">                           </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           3<span class="s1">）修改数据记录</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           update table_name set field1=val1, field2=val2 where expression;</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           where<span class="s1">是</span>sql<span class="s1">语句中用于条件判断的命令，</span>expression<span class="s1">为判断表达式</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           <span class="s1">例，修改学生信息表学号为</span>0001<span class="s1">的数据记录：</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           update student_info set stu_no=0001, name=hence where stu_no=0001;</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">                           </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           4<span class="s1">）删除数据记录</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           delete from table_name [where expression];</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           <span class="s1">不加判断条件则清空表所有数据记录。</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           <span class="s1">例，删除学生信息表学号为</span>0001<span class="s1">的数据记录：</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           delete from student_info where stu_no=0001;</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">                           </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           5<span class="s1">）查询数据记录</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           select<span class="s1">指令基本格式：</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           select columns from table_name [where expression];</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           a<span class="s1">查询输出所有数据记录</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           select * from table_name;</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           b<span class="s1">限制输出数据记录数量</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           select * from table_name limit val;</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           c<span class="s1">升序输出数据记录</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           select * from table_name order by field asc;</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           d<span class="s1">降序输出数据记录</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           select * from table_name order by field desc;</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           e<span class="s1">条件查询</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           select * from table_name where expression;</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           select * from table_name where field <span class="s3">in</span> ('val1', 'val2', 'val3');</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           select * from table_name where field between val1 and val2;</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           f<span class="s1">查询记录数目</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           select count (*) from table_name;</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           g<span class="s1">区分列数据</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           select distinct field from table_name;</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           <span class="s1">有一些字段的值可能会重复出现，</span>distinct<span class="s1">去掉重复项，将列中各字段值单个列出。</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">                           </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           6<span class="s1">）建立索引</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           <span class="s1">当说数据表存在大量记录，索引有助于加快查找数据表速度。</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           create index index_name on table_name(field);</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           <span class="s1">例，针对学生表</span>stu_no<span class="s1">字段，建立一个索引：</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           create index student_index on student_table(stu_no);</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           <span class="s1">建立完成后，</span>sqlite3<span class="s1">在对该字段查询时，会自动使用该索引。</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">                           </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           7<span class="s1">）删除数据表或索引</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           drop table table_name;</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">                           drop index index_name;</span></p> 
<span style="font-family:Tahoma; font-size:14px"><br> </span> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">11</span>、说明：几个高级查询运算词</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">A<span class="s2">：</span> UNION <span class="s2">运算符</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">UNION </span>运算符通过组合其他两个结果表（例如<span class="s1"> TABLE1 </span>和<span class="s1"> TABLE2</span>）并消去表中任何重复行而派生出一个结果表。当<span class="s1"> ALL </span>随<span class="s1"> UNION </span>一起使用时（即<span class="s1"> UNION ALL</span>），不消除重复行。两种情况下，派生表的每一行不是来自<span class="s1"> TABLE1 </span>就是来自<span class="s1"> TABLE2</span>。</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">B<span class="s2">：</span> EXCEPT <span class="s2">运算符</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">EXCEPT </span>运算符通过包括所有在<span class="s1"> TABLE1 </span>中但不在<span class="s1"> TABLE2 </span> 中的行并消除所有重复行而派生出一个结果表。当<span class="s1"> ALL </span>随<span class="s1"> EXCEPT </span> 一起使用时<span class="s1"> (EXCEPT ALL)</span>，不消除重复行。</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">C<span class="s2">：</span> INTERSECT <span class="s2">运算符</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">INTERSECT <span class="s2"> 运算符通过只包括</span> TABLE1 <span class="s2">和</span> TABLE2 <span class="s2">中都有的行并消除所有重复行而派生出一个结果表。当</span> ALL <span class="s2">随</span> INTERSECT <span class="s2">一起使用时</span> (INTERSECT ALL)<span class="s2">，不消除重复行。</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">注：使用运算词的几个查询结果行必须是一致的。</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">12</span>、说明：使用外连接</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">A<span class="s2">、</span>left <span class="s2">（</span>outer<span class="s2">）</span> join<span class="s2">：</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">左外连接（左连接）：结果集几包括连接表的匹配行，也包括左连接表的所有行。</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">SQL: select a.a, a.b, a.c, b.c, b.d, b.f from a LEFT OUT JOIN b ON a.a = b.c</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">B<span class="s2">：</span>right <span class="s2">（</span>outer<span class="s2">）</span> join:</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">右外连接<span class="s1">(</span>右连接<span class="s1">)</span>：结果集既包括连接表的匹配连接行，也包括右连接表的所有行。</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">C<span class="s2">：</span>full/cross <span class="s2">（</span>outer<span class="s2">）</span> join<span class="s2">：</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">全外连接：不仅包括符号连接表的匹配行，还包括两个连接表中的所有记录。</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">12<span class="s2">、分组</span>:Group by:</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">一张表，一旦分组<span class="s1"> </span>完成后，查询后只能得到组相关的信息。</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s2">组相关的信息：（统计信息）</span> count,sum,max,min,avg  <span class="s2">分组的标准</span>)</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s2">在</span>SQLServer<span class="s2">中分组时：不能以</span>text,ntext,image<span class="s2">类型的字段作为分组依据</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">在<span class="s1">selecte</span>统计函数中的字段，不能和普通的字段放在一起；</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">13</span>、对数据库进行操作：</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s2">分离数据库：</span> sp_detach_db; <span class="s2">附加数据库：</span>sp_attach_db <span class="s2">后接表明，附加需要完整的路径名</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">14.</span>如何修改数据库的名称<span class="s1">:</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">sp_renamedb 'old_name', 'new_name'</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">二、提升</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">1</span>、说明：复制表<span class="s1">(</span>只复制结构<span class="s1">,</span>源表名：<span class="s1">a </span>新表名：<span class="s1">b) (Access</span>可用<span class="s1">)</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s2">法一：</span>select * into b from a where 1&lt;&gt;1<span class="s2">（仅用于</span>SQlServer<span class="s2">）</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s2">法二：</span>select top 0 * into b from a</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">2</span>、说明：拷贝表<span class="s1">(</span>拷贝数据<span class="s1">,</span>源表名：<span class="s1">a </span>目标表名：<span class="s1">b) (Access</span>可用<span class="s1">)</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">insert into b(a, b, c) select d,e,f from b;</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">3</span>、说明：跨数据库之间表的拷贝<span class="s1">(</span>具体数据使用绝对路径<span class="s1">) (Access</span>可用<span class="s1">)</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">insert into b(a, b, c) select d,e,f from b <span class="s3">in</span> ‘<span class="s2">具体数据库</span>’ where <span class="s2"> 条件</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s2">例子：</span>..from b <span class="s3">in</span> '"&amp;Server.MapPath(".")&amp;"\data.mdb" &amp;"' where..</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">4</span>、说明：子查询<span class="s1">(</span>表名<span class="s1">1</span>：<span class="s1">a </span>表名<span class="s1">2</span>：<span class="s1">b)</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select a,b,c from a where a IN (select d from b ) <span class="s2">或者</span>: select a,b,c from a where a IN (1,2,3)</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">5</span>、说明：显示文章、提交人和最后回复时间</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select a.title,a.username,b.adddate from table a,(select max(adddate) adddate from table where table.title=a.title) b</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">6</span>、说明：外连接查询<span class="s1">(</span>表名<span class="s1">1</span>：<span class="s1">a </span>表名<span class="s1">2</span>：<span class="s1">b)</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select a.a, a.b, a.c, b.c, b.d, b.f from a LEFT OUT JOIN b ON a.a = b.c</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">7</span>、说明：在线视图查询<span class="s1">(</span>表名<span class="s1">1</span>：<span class="s1">a )</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select * from (SELECT a,b,c FROM a) T where t.a &gt; 1;</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">8<span class="s2">、说明：</span>between<span class="s2">的用法</span>,between<span class="s2">限制查询数据范围时包括了边界值</span>,not between<span class="s2">不包括</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select * from table1 where time between time1 and time2</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select a,b,c, from table1 where a not between <span class="s2">数值</span>1 and <span class="s2">数值</span>2</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">9</span>、说明：<span class="s4">in</span><span class="s1"> </span>的使用方法</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select * from table1 where a [not] <span class="s3">in</span> (‘<span class="s2">值</span>1’,’<span class="s2">值</span>2’,’<span class="s2">值</span>4’,’<span class="s2">值</span>6’)</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">10</span>、说明：两张关联表，删除主表中已经在副表中没有的信息</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">delete from table1 where not exists ( select * from table2 where table1.field1=table2.field1 )</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">11</span>、说明：四表联查问题：</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select * from a left inner join b on a.a=b.b right inner join c on a.a=c.c inner join d on a.a=d.d where .....</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">12</span>、说明：日程安排提前五分钟提醒</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">SQL: select * from <span class="s2">日程安排</span> where datediff('minute',f<span class="s2">开始时间</span>,getdate())&gt;5</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">13</span>、说明：一条<span class="s1">sql </span>语句搞定数据库分页</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select top 10 b.* from (select top 20 <span class="s2">主键字段</span>,<span class="s2">排序字段</span> from <span class="s2">表名</span> order by <span class="s2">排序字段</span> desc) a,<span class="s2">表名</span> b where b.<span class="s2">主键字段</span> = a.<span class="s2">主键字段</span> order by a.<span class="s2">排序字段</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">具体实现：</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">关于数据库分页：</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">declare @start <span class="s3"> int</span>,<span class="s3">@end</span> <span class="s3">int</span></span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">@sql  nvarchar(600)</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">set @sql=’select top’+str(<span class="s3">@end</span>-@start+1)+’+from T where rid not <span class="s3">in</span>(select top’+str(@str-1)+’Rid from T where Rid&gt;-1)’</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">exec sp_executesql @sql</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">注意：在<span class="s1">top</span>后不能直接跟一个变量，所以在实际应用中只有这样的进行特殊的处理。<span class="s1">Rid</span>为一个标识列，如果<span class="s1">top</span>后还有具体的字段，这样做是非常有好处的。因为这样可以避免<span class="s1"> top</span>的字段如果是逻辑索引的，查询的结果后实际表中的不一致（逻辑索引中的数据有可能和数据表中的不一致，而查询时如果处在索引则首先查询索引）</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">14</span>、说明：前<span class="s1">10</span>条记录</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select top 10 * form table1 where <span class="s2">范围</span></span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">15</span>、说明：选择在每一组<span class="s1">b</span>值相同的数据中对应的<span class="s1">a</span>最大的记录的所有信息<span class="s1">(</span>类似这样的用法可以用于论坛每月排行榜<span class="s1">,</span>每月热销产品分析<span class="s1">,</span>按科目成绩排名<span class="s1">,</span>等等<span class="s1">.)</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select a,b,c from tablename ta where a=(select max(a) from tablename tb where tb.b=ta.b)</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">16</span>、说明：包括所有在<span class="s1"> TableA </span>中但不在<span class="s1"> TableB</span>和<span class="s1">TableC </span>中的行并消除所有重复行而派生出一个结果表</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">(select a from tableA ) except (select a from tableB) except (select a from tableC)</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">17</span>、说明：随机取出<span class="s1">10</span>条数据</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select top 10 * from tablename order by newid()</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">18</span>、说明：随机选择记录</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select newid()</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">19</span>、说明：删除重复记录</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">1),delete from tablename where <span class="s3">id</span> not <span class="s3">in</span> (select max(<span class="s3">id</span>) from tablename group by col1,col2,...)</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">2),select distinct * into temp from tablename</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">delete from tablename</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">insert into tablename select * from temp</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">评价：<span class="s1"> </span>这种操作牵连大量的数据的移动，这种做法不适合大容量但数据操作</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">3),</span>例如：在一个外部表中导入数据，由于某些原因第一次只导入了一部分，但很难判断具体位置，这样只有在下一次全部导入，这样也就产生好多重复的字段，怎样删除重复字段</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">alter table tablename</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">--</span>添加一个自增列</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">add  column_b <span class="s3"> int</span> identity(1,1)</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">delete from tablename where column_b not <span class="s3">in</span>(</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">                                            select max(column_b)  from tablename group by column1,column2,...)</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">alter table tablename drop column column_b</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">20</span>、说明：列出数据库里所有的表名</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select name from sysobjects where type='U' <span class="s5">// U</span><span class="s6">代表用户</span></span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">21</span>、说明：列出表里的所有的列名</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select name from syscolumns where <span class="s3">id</span>=object_id('TableName')</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">22<span class="s2">、说明：列示</span>type<span class="s2">、</span>vender<span class="s2">、</span>pcs<span class="s2">字段，以</span>type<span class="s2">字段排列，</span><span class="s3">case</span><span class="s2">可以方便地实现多重选择，类似</span>select <span class="s2">中的</span><span class="s3">case</span><span class="s2">。</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select type,sum(<span class="s3">case</span> vender when 'A' then pcs <span class="s3">else</span> 0 end),sum(<span class="s3">case</span> vender when 'C' then pcs <span class="s3">else</span> 0 end),sum(<span class="s3">case</span> vender when 'B' then pcs <span class="s3">else</span> 0 end) FROM tablename group by type</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">显示结果：</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">type vender pcs</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s2">电脑</span> A 1</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s2">电脑</span> A 1</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s2">光盘</span> B 2</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s2">光盘</span> A 2</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s2">手机</span> B 3</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s2">手机</span> C 3</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">23<span class="s2">、说明：初始化表</span>table1</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">TRUNCATE TABLE table1</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">24</span>、说明：选择从<span class="s1">10</span>到<span class="s1">15</span>的记录</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select top 5 * from (select top 15 * from table order by <span class="s3">id</span> asc) table_<span class="s2">别名</span> order by <span class="s3"> id</span> desc</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">三、技巧</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">1</span>、<span class="s1">1=1</span>，<span class="s1">1=2</span>的使用，在<span class="s1">SQL</span>语句组合时用的较多</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">“where 1=1” <span class="s2"> 是表示选择全部</span>    “where 1=2”<span class="s2">全部不选，</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">如：</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s3">if</span> @strWhere !=''</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">begin</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">set @strSQL = 'select count(*) as Total from [' + @tblName + '] where ' + @strWhere</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">end</span></p> 
<p class="p4"><span style="font-family:Tahoma; font-size:14px">else</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">begin</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">set @strSQL = 'select count(*) as Total from [' + @tblName + ']'</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">end</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">我们可以直接写成</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">错误！未找到目录项。</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">set @strSQL = 'select count(*) as Total from [' + @tblName + '] where 1=1 <span class="s2">安定</span> '+ @strWhere 2<span class="s2">、收缩数据库</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">--</span>重建索引</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">DBCC REINDEX</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">DBCC INDEXDEFRAG</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">--</span>收缩数据和日志</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">DBCC SHRINKDB</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">DBCC SHRINKFILE</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">3</span>、压缩数据库</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">dbcc shrinkdatabase(dbname)</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">4</span>、转移数据库给新用户以已存在用户权限</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">exec sp_change_users_login 'update_one','newname','oldname'</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">go</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">5</span>、检查备份集</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">RESTORE VERIFYONLY from disk='E:\dvbbs.bak'</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">6</span>、修复数据库</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">ALTER DATABASE [dvbbs] SET SINGLE_USER</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">GO</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">DBCC CHECKDB('dvbbs',repair_allow_data_loss) WITH TABLOCK</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">GO</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">ALTER DATABASE [dvbbs] SET MULTI_USER</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">GO</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">7</span>、日志清除</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">SET NOCOUNT ON</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">DECLARE @LogicalFileName sysname,</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">@MaxMinutes INT,</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">@NewSize INT</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">USE tablename -- <span class="s2"> 要操作的数据库名</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">SELECT  @LogicalFileName = 'tablename_log', -- <span class="s2">日志文件名</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">@MaxMinutes = 10, -- Limit on time allowed to wrap log.</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">@NewSize = 1  -- <span class="s2"> 你想设定的日志文件的大小</span>(M)</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">Setup / initialize</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">DECLARE @OriginalSize <span class="s3">int</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">SELECT @OriginalSize = size</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">FROM sysfiles</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">WHERE name = @LogicalFileName</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">SELECT 'Original Size of ' + db_name() + ' LOG is ' +</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">CONVERT(VARCHAR(30),@OriginalSize) + ' 8K pages or ' +</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">CONVERT(VARCHAR(30),(@OriginalSize*8/1024)) + 'MB'</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">FROM sysfiles</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">WHERE name = @LogicalFileName</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">CREATE TABLE DummyTrans</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">(DummyColumn <span class="s3"> char</span> (8000) not null)</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">DECLARE @Counter    INT,</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">@StartTime DATETIME,</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">@TruncLog   VARCHAR(255)</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">SELECT @StartTime = GETDATE(),</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">@TruncLog = 'BACKUP LOG ' + db_name() + ' WITH TRUNCATE_ONLY'</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">DBCC SHRINKFILE (@LogicalFileName, @NewSize)</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">EXEC (@TruncLog)</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">-- Wrap the log <span class="s3"> if</span> necessary.</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">WHILE @MaxMinutes &gt; DATEDIFF (mi, @StartTime, GETDATE()) -- time has not expired</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">AND @OriginalSize = (SELECT size FROM sysfiles WHERE name = @LogicalFileName)</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">AND (@OriginalSize * 8 /1024) &gt; @NewSize</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">BEGIN -- Outer loop.</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">SELECT @Counter = 0</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">WHILE   ((@Counter &lt; @OriginalSize / 16) AND (@Counter &lt; 50000))</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">BEGIN -- update</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">INSERT DummyTrans VALUES ('Fill Log') DELETE DummyTrans</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">SELECT @Counter = @Counter + 1</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">END</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">EXEC (@TruncLog)</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">END</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">SELECT 'Final Size of ' + db_name() + ' LOG is ' +</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">CONVERT(VARCHAR(30),size) + ' 8K pages or ' +</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">CONVERT(VARCHAR(30),(size*8/1024)) + 'MB'</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">FROM sysfiles</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">WHERE name = @LogicalFileName</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">DROP TABLE DummyTrans</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">SET NOCOUNT OFF</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">8</span>、说明：更改某个表</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">exec sp_changeobjectowner 'tablename','dbo'</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">9</span>、存储更改全部表</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">CREATE PROCEDURE dbo.User_ChangeObjectOwnerBatch</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">@OldOwner as NVARCHAR(128),</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">@NewOwner as NVARCHAR(128)</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">AS</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">DECLARE @Name    as NVARCHAR(128)</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">DECLARE @Owner   as NVARCHAR(128)</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">DECLARE @OwnerName   as NVARCHAR(128)</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">DECLARE curObject CURSOR FOR</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select 'Name'    = name,</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">'Owner'    = user_name(uid)</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">from sysobjects</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">where user_name(uid)=@OldOwner</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">order by name</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">OPEN   curObject</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">FETCH NEXT FROM curObject INTO @Name, @Owner</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">WHILE(@@FETCH_STATUS=0)</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">BEGIN</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s3">if</span> @Owner=@OldOwner</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">begin</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">set @OwnerName = @OldOwner + '.' + rtrim(@Name)</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">exec sp_changeobjectowner @OwnerName, @NewOwner</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">end</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">-- select @name,@NewOwner,@OldOwner</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">FETCH NEXT FROM curObject INTO @Name, @Owner</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">END</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">close curObject</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">deallocate curObject</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">GO</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">10<span class="s2">、</span>SQL SERVER<span class="s2">中直接循环写入数据</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">declare @i <span class="s3"> int</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">set @i=1</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s3">while</span> @i&lt;30</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">begin</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">insert into test (userid) values(@i)</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">set @i=@i+1</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">end</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">案例：</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">有如下表，要求就裱中所有沒有及格的成績，在每次增長<span class="s1">0.1</span>的基礎上，使他們剛好及格<span class="s1">:</span></span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">Name     score</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">Zhangshan   80</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">Lishi       59</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">Wangwu      50</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">Songquan    69</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s3">while</span>((select min(score) from tb_table)&lt;60)</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">begin</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">update tb_table set score =score*1.01</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">where score&lt;60</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s3">if</span>  (select min(score) from tb_table)&gt;60</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p4"><span style="font-family:Tahoma; font-size:14px">break</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p4"><span style="font-family:Tahoma; font-size:14px">else</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p4"><span style="font-family:Tahoma; font-size:14px">continue</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">end</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">数据开发<span class="s1">-</span>经典</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">1.</span>按姓氏笔画排序<span class="s1">:</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">Select * From TableName Order By CustomerName Collate Chinese_PRC_Stroke_ci_as <span class="s5">//</span><span class="s6">从少到多</span></span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">2.</span>数据库加密<span class="s1">:</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select encrypt('<span class="s2">原始密码</span>')</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select pwdencrypt('<span class="s2">原始密码</span>')</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select pwdcompare('<span class="s2">原始密码</span>','<span class="s2">加密后密码</span>') = 1--<span class="s2">相同；否则不相同</span> encrypt('<span class="s2">原始密码</span>')</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select pwdencrypt('<span class="s2">原始密码</span>')</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select pwdcompare('<span class="s2">原始密码</span>','<span class="s2">加密后密码</span>') = 1--<span class="s2">相同；否则不相同</span></span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">3.</span>取回表中字段<span class="s1">:</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">declare @list varchar(1000),</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">@sql nvarchar(1000)</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select @list=@list+','+b.name from sysobjects a,syscolumns b where a.<span class="s3">id</span>=b.<span class="s3">id</span> and a.name='<span class="s2">表</span>A'</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">set @sql='select '+right(@list,len(@list)-1)+' from <span class="s2">表</span>A'</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">exec (@sql)</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">4.</span>查看硬盘分区<span class="s1">:</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">EXEC master..xp_fixeddrives</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">5.</span>比较<span class="s1">A,B</span>表是否相等<span class="s1">:</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px"><span class="s3">if</span> (select checksum_agg(binary_checksum(*)) from A)</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">=</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">(select checksum_agg(binary_checksum(*)) from B)</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">print '<span class="s2">相等</span>'</span></p> 
<p class="p4"><span style="font-family:Tahoma; font-size:14px">else</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">print '<span class="s2">不相等</span>'</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">6.</span>杀掉所有的事件探察器进程<span class="s1">:</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">DECLARE hcforeach CURSOR GLOBAL FOR SELECT 'kill '+RTRIM(spid) FROM master.dbo.sysprocesses</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">WHERE program_name IN('SQL profiler',N'SQL <span class="s2">事件探查器</span>')</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">EXEC sp_msforeach_worker '?'</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">7.</span>记录搜索<span class="s1">:</span></span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">开头到<span class="s1">N</span>条记录</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">Select Top N * From <span class="s2">表</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">-------------------------------</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">N</span>到<span class="s1">M</span>条记录<span class="s1">(</span>要有主索引<span class="s1">ID)</span></span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">Select Top M-N * From <span class="s2">表</span> Where ID <span class="s3">in</span> (Select Top M ID From <span class="s2">表</span>) Order by ID   Desc</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">----------------------------------</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">N</span>到结尾记录</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">Select Top N * From <span class="s2">表</span> Order by ID Desc</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">案例</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">例如<span class="s1">1</span>：一张表有一万多条记录，表的第一个字段<span class="s1"> RecID </span>是自增长字段，<span class="s1"> </span>写一个<span class="s1">SQL</span>语句，<span class="s1"> </span>找出表的第<span class="s1">31</span>到第<span class="s1">40</span>个记录。</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select top 10 recid from A where recid not  <span class="s3">in</span>(select top 30 recid from A)</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">分析：如果这样写会产生某些问题，如果<span class="s1">recid</span>在表中存在逻辑索引。</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">select top 10 recid from A where……</span>是从索引中查找，而后面的<span class="s1">select top 30 recid from A</span>则在数据表中查找，这样由于索引中的顺序有可能和数据表中的不一致，这样就导致查询到的不是本来的欲得到的数据。</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">解决方案</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">1<span class="s2">，</span> <span class="s2">用</span>order by select top 30 recid from A order by ricid <span class="s2"> 如果该字段不是自增长，就会出现问题</span></span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">2<span class="s2">，</span> <span class="s2">在那个子查询中也加条件：</span>select top 30 recid from A where recid&gt;-1</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">例<span class="s1">2</span>：查询表中的最后以条记录，并不知道这个表共有多少数据<span class="s1">,</span>以及表结构。</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">set @s = 'select top 1 * from T   where pid not in (select top ' + str(@count-1) + ' pid  from  T)'</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">print @s      exec  sp_executesql  @s</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">9</span>：获取当前数据库中的所有用户表</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select Name from sysobjects where xtype='u' and status&gt;=0</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">10</span>：获取某一个表的所有字段</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select name from syscolumns where <span class="s3">id</span>=object_id('<span class="s2">表名</span>')</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select name from syscolumns where <span class="s3">id</span> <span class="s3">in</span> (select <span class="s3">id</span> from sysobjects where type = 'u' and name = '<span class="s2">表名</span>')</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">两种方式的效果相同</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">11</span>：查看与某一个表相关的视图、存储过程、函数</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select a.* from sysobjects a, syscomments b where a.<span class="s3">id</span> = b.<span class="s3">id</span> and b.text like '%<span class="s2">表名</span>%'</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">12</span>：查看当前数据库中所有存储过程</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select name as <span class="s2"> 存储过程名称</span> from sysobjects where xtype='P'</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">13</span>：查询用户创建的所有数据库</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select * from master..sysdatabases D where sid not <span class="s3">in</span>(select sid from master..syslogins where name='sa')</span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px">或者</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select dbid, name AS DB_NAME from master..sysdatabases where sid &lt;&gt; 0x01</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">14</span>：查询某一个表的字段和数据类型</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select column_name,data_type from information_schema.columns</span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">where table_name = '<span class="s2">表名</span>'</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">15</span>：不同服务器数据库之间的数据操作</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">--</span>创建链接服务器</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">exec sp_addlinkedserver   'ITSV ', ' ', 'SQLOLEDB ', '<span class="s2">远程服务器名或</span>ip<span class="s2">地址</span> '</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">exec sp_addlinkedsrvlogin  'ITSV ', 'false ',null, '<span class="s2">用户名</span> ', '<span class="s2">密码</span> '</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">--</span>查询示例</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select * from ITSV.<span class="s2">数据库名</span>.dbo.<span class="s2">表名</span></span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">--</span>导入示例</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select * into <span class="s2"> 表</span> from ITSV.<span class="s2">数据库名</span>.dbo.<span class="s2">表名</span></span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">--</span>以后不再使用时删除链接服务器</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">exec sp_dropserver  'ITSV ', 'droplogins '</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">--<span class="s2">连接远程</span>/<span class="s2">局域网数据</span>(openrowset/openquery/opendatasource)</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">--1<span class="s2">、</span>openrowset</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">--</span>查询示例</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select * from openrowset( 'SQLOLEDB ', 'sql<span class="s2">服务器名</span> '; '<span class="s2">用户名</span> '; '<span class="s2">密码</span> ',<span class="s2">数据库名</span>.dbo.<span class="s2">表名</span>)</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">--</span>生成本地表</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select * into <span class="s2"> 表</span> from openrowset( 'SQLOLEDB ', 'sql<span class="s2">服务器名</span> '; '<span class="s2">用户名</span> '; '<span class="s2">密码</span> ',<span class="s2">数据库名</span>.dbo.<span class="s2">表名</span>)</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">--</span>把本地表导入远程表</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">insert openrowset( 'SQLOLEDB ', 'sql<span class="s2">服务器名</span> '; '<span class="s2">用户名</span> '; '<span class="s2">密码</span> ',<span class="s2">数据库名</span>.dbo.<span class="s2">表名</span>)</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select *from <span class="s2"> 本地表</span></span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">--</span>更新本地表</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">update b</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">set b.<span class="s2">列</span>A=a.<span class="s2">列</span>A</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">from openrowset( 'SQLOLEDB ', 'sql<span class="s2">服务器名</span> '; '<span class="s2">用户名</span> '; '<span class="s2">密码</span> ',<span class="s2">数据库名</span>.dbo.<span class="s2">表名</span>)as a inner join <span class="s2">本地表</span> b</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">on a.column1=b.column1</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">--openquery<span class="s2">用法需要创建一个连接</span></span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">--</span>首先创建一个连接创建链接服务器</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">exec sp_addlinkedserver   'ITSV ', ' ', 'SQLOLEDB ', '<span class="s2">远程服务器名或</span>ip<span class="s2">地址</span> '</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">--<span class="s2">查询</span></span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select *</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">FROM openquery(ITSV,  'SELECT *  FROM <span class="s2">数据库</span>.dbo.<span class="s2">表名</span> ')</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">--</span>把本地表导入远程表</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">insert openquery(ITSV,  'SELECT *  FROM <span class="s2">数据库</span>.dbo.<span class="s2">表名</span> ')</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select * from <span class="s2"> 本地表</span></span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">--</span>更新本地表</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">update b</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">set b.<span class="s2">列</span>B=a.<span class="s2">列</span>B</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">FROM openquery(ITSV,  'SELECT * FROM <span class="s2">数据库</span>.dbo.<span class="s2">表名</span> ') as a</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">inner join <span class="s2"> 本地表</span> b on a.<span class="s2">列</span>A=b.<span class="s2">列</span>A</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">--3<span class="s2">、</span>opendatasource/openrowset</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">SELECT   *</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">FROM   opendatasource( 'SQLOLEDB ',  'Data Source=ip/ServerName;User ID=<span class="s2">登陆名</span>;Password=<span class="s2">密码</span> ' ).test.dbo.roy_ta</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p1"><span style="font-family:Tahoma; font-size:14px"><span class="s1">--</span>把本地表导入远程表</span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">insert opendatasource( 'SQLOLEDB ',  'Data Source=ip/ServerName;User ID=<span class="s2">登陆名</span>;Password=<span class="s2">密码</span> ').<span class="s2">数据库</span>.dbo.<span class="s2">表名</span></span></p> 
<p class="p2"><span style="font-family:Tahoma; font-size:14px"><br> </span></p> 
<p class="p3"><span style="font-family:Tahoma; font-size:14px">select * from <span class="s2"> 本地表</span></span></p> 
<p style="margin:10px auto; color:rgb(51,51,51); line-height:24px; background-color:rgb(214,211,214)"> </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/95508b0af57dd2c44277bf712b4d0f41/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">dts改单流程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ff1ad3dd17f4fdcdaa926c1b136738e7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ARP表  MAC表  路由表</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>