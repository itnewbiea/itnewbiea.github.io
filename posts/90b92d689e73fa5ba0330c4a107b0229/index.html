<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Linux网络】从原理到实操，感受PXE无人值守自动化高效批量网络安装系统 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【Linux网络】从原理到实操，感受PXE无人值守自动化高效批量网络安装系统" />
<meta property="og:description" content="一、PXE网络批量装机的介绍
1、常见的三种系统安装方式
2、回顾系统安装的过程，了解系统安装的必要条件
3、什么是pxe
4、搭建pxe的原理
5、Linux的光盘镜像中的isolinux中的相关文件学习
二、关于实现PXE无人值守装机的四大文件与五个软件的对应关系详解
5个程序的使用原因：
1、DHCP服务器：
2、TFTP服务器：
3、syslinux程序：
4、FTP服务器：
5、kickstart程序：
三、实操PXE批量安装详解
做任何动作之前先关闭selinux和防火墙，以及安装五个软件
第一步：dhcp服务器搭建
第二步：准备好vsftpd服务，挂载光盘镜像
第三步：开启tftp开机自启，配置好tftp传输的文件，内核和驱动
第四步：找到grub小程序——也就是syslinux提供的pxelinux.0程序
第五步：手写grub.cfg配置文件——default文件
第六步：生成ks.cfg配置文件
第七步：启动所有服务，见证奇迹
第八步：实现自动化装机过程
四、总结
一、PXE网络批量装机的介绍 1、常见的三种系统安装方式 第一种：u启动安装，在优盘中下载相关的安装系统和镜像文件，优盘插入即可安装，将想要的操作系统安装进自己的硬盘（需要将优盘设置u启动或者把镜像烧录进去）
第二种：光驱安装，将相关的安装系统镜像放入光盘，插入电脑服务器中，即可按照引导进行装机，将操作系统安装进自己的硬盘
第三种：网卡安装，需要通过网络下载，在网上的某个服务器上去下载相关镜像系统，来进行安装
2、回顾系统安装的过程，了解系统安装的必要条件 这是硬盘启动的过程：开机自检（bios主板）——mbr引导（主要是去找grub菜单）——找到grub配置文件（找到内核的位置）——加载内核到内存——初始化启动
光驱安装系统的过程：bios引导选择光驱——boot.cat引导（通过isolinux.bin程序找到配置文件）——读取isolinux.cfg配置文件知道内核和光驱的位置——加载光驱里面的内核vmlinuz和驱动initrd.img到内存——再通过光驱里面找到各种初始化程序安装包，启动进程并开机
那么我们想要裸机通过网络来能够完成这样的过程，那么得有哪些必要条件呢？
①裸机主板需要支持网络引导（现在大多数的服务器主机都支持，需要在bios设置中可以允许network或者lan启动）
②需要有一个引导程序能找到grub配置文件（类似mbr引导）
③需要有一个类似grub配置文件指引找到内核（类似于grub.cfg）
④需要有vmlinuz内核程序和initrd.img驱动，加载到内存中（类似于vmlinuz-3.10.0-693.el7.x86_64和initramfs-3.10.0-693.el7.x86_64.img）
3、什么是pxe PXE 的全称是 preboot execute environment它其实是Intel在很久以前提出来的一项用于通过网络来引导系统的标准。允许客户机通过网络从远程服务器上下载引导镜像，并加载安装文件或者整个操作系统。
pxe是通过网卡引导启动需要的条件：
1.BIOS支持
2.网卡支持（现在基本都已支持）
3.需要在bios中开启开关，服务器一般没打开（bmc界面里打开）
4.网络中有一台 DHCP 服务器以便为客户机自动分配地址、指定引导文件位置，网卡自带DHCP功能，dhcp 指明分配的ip地址
4、搭建pxe的原理 第一步网卡需要查找相关的dhcp服务器，来获取ip地址和时间；第二步dhcp服务器，通过offer报文传给裸机客户端，不仅提供了ip地址，还提供了引导程序（boot loader，这里是pxelinux.0）的地址，以及tftp-server的地址（指向dhcp服务器自己）；第三步客户机通过tftp服务器获取引导程序pxelinux.0，将其加载到内存中；第四步引导程序pxelinux.0通过tftp服务器获取pxelinux.cfg中的default配置文件；第五步配置文件指明内核和驱动的位置，通过tftp服务器获取vmlinuz和initrd.img；最后启动内核； 5、Linux的光盘镜像中的isolinux中的相关文件学习 boot.cat相当于grub的第一阶段 isolinux.bin光盘引导程序，在mkisofs的选项中需要明确给出文件路径，这个文件属于SYSLINUX项目isolinux.cfg启动菜单的配置文件，当光盘启动后（即运行isolinux.bin），会自动去找isolinux.cfg文件（相当于boot里面的grub.cfg）vesamenu.c32是光盘启动后的启动菜单图形界面，也属于SYSLINUX项目，menu.c32提供纯文本的菜单（指明背景图位置）memtest内存检测程序splash.png光盘启动菜单界面的背景图（这是一张图片）vmlinuz是内核映像initrd.imgramfs文件（精简版的linux系统，文件系统驱动等） 二、关于实现PXE无人值守装机的四大文件与五个软件的对应关系详解 TFTP服务器的家目录/var/lib/tftpboot的四大文件一定是这样，标点符号都要一模一样：
​​​​​​
5个程序的使用原因： 1、DHCP服务器： 在这里DHCP服务器是用来动态分配客户端ip地址以及指明TFTP服务器的ip地址和引导程序“pxelinux.0”的位置
DHCP服务端是udp的67端口，客户端是udp的68端口
2、TFTP服务器： 这是网卡自带的功能，基于udp协议实现客户机和服务端之间进行简单的文件传输协议，适用于小型文件传输。TFTP服务默认由xinetd服务进行管理，使用UDP69端口。
这里的TFTP服务器是用来提供传输四大文件，一共52M
3、syslinux程序： syslinux是一个功能强大的引导加载程序，而且兼容各种介质。它的目的是简化首次安装Linux的时间，并建立修护或其它特殊用途的启动盘。它的安装很简单，一旦安装syslinux好之后，sysLinux启动盘就可以引导各种基于DOS的工具，以及MS-DOS/Windows或者任何其它操作系统。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/90b92d689e73fa5ba0330c4a107b0229/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-18T14:58:15+08:00" />
<meta property="article:modified_time" content="2023-11-18T14:58:15+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Linux网络】从原理到实操，感受PXE无人值守自动化高效批量网络安装系统</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"></p> 
<p id="%E4%B8%80%E3%80%81PXE%E7%BD%91%E7%BB%9C%E6%89%B9%E9%87%8F%E8%A3%85%E6%9C%BA%E7%9A%84%E4%BB%8B%E7%BB%8D-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81PXE%E7%BD%91%E7%BB%9C%E6%89%B9%E9%87%8F%E8%A3%85%E6%9C%BA%E7%9A%84%E4%BB%8B%E7%BB%8D" rel="nofollow">一、PXE网络批量装机的介绍</a></p> 
<p id="1%E3%80%81%E5%B8%B8%E8%A7%81%E7%9A%84%E4%B8%89%E7%A7%8D%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F-toc" style="margin-left:40px;"><a href="#1%E3%80%81%E5%B8%B8%E8%A7%81%E7%9A%84%E4%B8%89%E7%A7%8D%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F" rel="nofollow">1、常见的三种系统安装方式</a></p> 
<p id="2%E3%80%81%E5%9B%9E%E9%A1%BE%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E7%9A%84%E8%BF%87%E7%A8%8B%EF%BC%8C%E4%BA%86%E8%A7%A3%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E7%9A%84%E5%BF%85%E8%A6%81%E6%9D%A1%E4%BB%B6-toc" style="margin-left:40px;"><a href="#2%E3%80%81%E5%9B%9E%E9%A1%BE%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E7%9A%84%E8%BF%87%E7%A8%8B%EF%BC%8C%E4%BA%86%E8%A7%A3%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E7%9A%84%E5%BF%85%E8%A6%81%E6%9D%A1%E4%BB%B6" rel="nofollow">2、回顾系统安装的过程，了解系统安装的必要条件</a></p> 
<p id="3%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AFpxe-toc" style="margin-left:40px;"><a href="#3%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AFpxe" rel="nofollow">3、什么是pxe</a></p> 
<p id="4%E3%80%81%E6%90%AD%E5%BB%BApxe%E7%9A%84%E5%8E%9F%E7%90%86-toc" style="margin-left:40px;"><a href="#4%E3%80%81%E6%90%AD%E5%BB%BApxe%E7%9A%84%E5%8E%9F%E7%90%86" rel="nofollow">4、搭建pxe的原理</a></p> 
<p id="5%E3%80%81Linux%E7%9A%84%E5%85%89%E7%9B%98%E9%95%9C%E5%83%8F%E4%B8%AD%E7%9A%84isolinux%E4%B8%AD%E7%9A%84%E7%9B%B8%E5%85%B3%E6%96%87%E4%BB%B6%E5%AD%A6%E4%B9%A0-toc" style="margin-left:40px;"><a href="#5%E3%80%81Linux%E7%9A%84%E5%85%89%E7%9B%98%E9%95%9C%E5%83%8F%E4%B8%AD%E7%9A%84isolinux%E4%B8%AD%E7%9A%84%E7%9B%B8%E5%85%B3%E6%96%87%E4%BB%B6%E5%AD%A6%E4%B9%A0" rel="nofollow">5、Linux的光盘镜像中的isolinux中的相关文件学习</a></p> 
<p id="%E4%BA%8C%E3%80%81%E5%85%B3%E4%BA%8E%E5%AE%9E%E7%8E%B0PXE%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88%E8%A3%85%E6%9C%BA%E7%9A%84%E5%9B%9B%E5%A4%A7%E6%96%87%E4%BB%B6%E4%B8%8E%E4%BA%94%E4%B8%AA%E8%BD%AF%E4%BB%B6%E7%9A%84%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB%E8%AF%A6%E8%A7%A3-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E5%85%B3%E4%BA%8E%E5%AE%9E%E7%8E%B0PXE%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88%E8%A3%85%E6%9C%BA%E7%9A%84%E5%9B%9B%E5%A4%A7%E6%96%87%E4%BB%B6%E4%B8%8E%E4%BA%94%E4%B8%AA%E8%BD%AF%E4%BB%B6%E7%9A%84%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB%E8%AF%A6%E8%A7%A3" rel="nofollow">二、关于实现PXE无人值守装机的四大文件与五个软件的对应关系详解</a></p> 
<p id="5%E4%B8%AA%E7%A8%8B%E5%BA%8F%E7%9A%84%E4%BD%BF%E7%94%A8%E5%8E%9F%E5%9B%A0%EF%BC%9A-toc" style="margin-left:40px;"><a href="#5%E4%B8%AA%E7%A8%8B%E5%BA%8F%E7%9A%84%E4%BD%BF%E7%94%A8%E5%8E%9F%E5%9B%A0%EF%BC%9A" rel="nofollow">5个程序的使用原因：</a></p> 
<p id="%C2%A01%E3%80%81DHCP%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%9A-toc" style="margin-left:40px;"><a href="#%C2%A01%E3%80%81DHCP%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%9A" rel="nofollow"> 1、DHCP服务器：</a></p> 
<p id="2%E3%80%81TFTP%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%9A-toc" style="margin-left:40px;"><a href="#2%E3%80%81TFTP%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%9A" rel="nofollow">2、TFTP服务器：</a></p> 
<p id="3%E3%80%81syslinux%E7%A8%8B%E5%BA%8F%EF%BC%9A-toc" style="margin-left:40px;"><a href="#3%E3%80%81syslinux%E7%A8%8B%E5%BA%8F%EF%BC%9A" rel="nofollow">3、syslinux程序：</a></p> 
<p id="4%E3%80%81FTP%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%9A-toc" style="margin-left:40px;"><a href="#4%E3%80%81FTP%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%9A" rel="nofollow">4、FTP服务器：</a></p> 
<p id="5%E3%80%81kickstart%E7%A8%8B%E5%BA%8F%EF%BC%9A-toc" style="margin-left:40px;"><a href="#5%E3%80%81kickstart%E7%A8%8B%E5%BA%8F%EF%BC%9A" rel="nofollow">5、kickstart程序：</a></p> 
<p id="%E4%B8%89%E3%80%81%E5%AE%9E%E6%93%8DPXE%E6%89%B9%E9%87%8F%E5%AE%89%E8%A3%85%E8%AF%A6%E8%A7%A3-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81%E5%AE%9E%E6%93%8DPXE%E6%89%B9%E9%87%8F%E5%AE%89%E8%A3%85%E8%AF%A6%E8%A7%A3" rel="nofollow">三、实操PXE批量安装详解</a></p> 
<p id="%E5%81%9A%E4%BB%BB%E4%BD%95%E5%8A%A8%E4%BD%9C%E4%B9%8B%E5%89%8D%E5%85%88%E5%85%B3%E9%97%ADselinux%E5%92%8C%E9%98%B2%E7%81%AB%E5%A2%99%EF%BC%8C%E4%BB%A5%E5%8F%8A%E5%AE%89%E8%A3%85%E4%BA%94%E4%B8%AA%E8%BD%AF%E4%BB%B6-toc" style="margin-left:40px;"><a href="#%E5%81%9A%E4%BB%BB%E4%BD%95%E5%8A%A8%E4%BD%9C%E4%B9%8B%E5%89%8D%E5%85%88%E5%85%B3%E9%97%ADselinux%E5%92%8C%E9%98%B2%E7%81%AB%E5%A2%99%EF%BC%8C%E4%BB%A5%E5%8F%8A%E5%AE%89%E8%A3%85%E4%BA%94%E4%B8%AA%E8%BD%AF%E4%BB%B6" rel="nofollow">做任何动作之前先关闭selinux和防火墙，以及安装五个软件</a></p> 
<p id="%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9Adhcp%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA-toc" style="margin-left:40px;"><a href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9Adhcp%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA" rel="nofollow">第一步：dhcp服务器搭建</a></p> 
<p id="%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E5%87%86%E5%A4%87%E5%A5%BDvsftpd%E6%9C%8D%E5%8A%A1%EF%BC%8C%E6%8C%82%E8%BD%BD%E5%85%89%E7%9B%98%E9%95%9C%E5%83%8F-toc" style="margin-left:40px;"><a href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E5%87%86%E5%A4%87%E5%A5%BDvsftpd%E6%9C%8D%E5%8A%A1%EF%BC%8C%E6%8C%82%E8%BD%BD%E5%85%89%E7%9B%98%E9%95%9C%E5%83%8F" rel="nofollow">第二步：准备好vsftpd服务，挂载光盘镜像</a></p> 
<p id="%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E5%BC%80%E5%90%AFtftp%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%EF%BC%8C%E9%85%8D%E7%BD%AE%E5%A5%BDtftp%E4%BC%A0%E8%BE%93%E7%9A%84%E6%96%87%E4%BB%B6%EF%BC%8C%E5%86%85%E6%A0%B8%E5%92%8C%E9%A9%B1%E5%8A%A8-toc" style="margin-left:40px;"><a href="#%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E5%BC%80%E5%90%AFtftp%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%EF%BC%8C%E9%85%8D%E7%BD%AE%E5%A5%BDtftp%E4%BC%A0%E8%BE%93%E7%9A%84%E6%96%87%E4%BB%B6%EF%BC%8C%E5%86%85%E6%A0%B8%E5%92%8C%E9%A9%B1%E5%8A%A8" rel="nofollow">第三步：开启tftp开机自启，配置好tftp传输的文件，内核和驱动</a></p> 
<p id="%E7%AC%AC%E5%9B%9B%E6%AD%A5%EF%BC%9A%E6%89%BE%E5%88%B0grub%E5%B0%8F%E7%A8%8B%E5%BA%8F%E2%80%94%E2%80%94%E4%B9%9F%E5%B0%B1%E6%98%AFsyslinux%E6%8F%90%E4%BE%9B%E7%9A%84pxelinux.0%E7%A8%8B%E5%BA%8F-toc" style="margin-left:40px;"><a href="#%E7%AC%AC%E5%9B%9B%E6%AD%A5%EF%BC%9A%E6%89%BE%E5%88%B0grub%E5%B0%8F%E7%A8%8B%E5%BA%8F%E2%80%94%E2%80%94%E4%B9%9F%E5%B0%B1%E6%98%AFsyslinux%E6%8F%90%E4%BE%9B%E7%9A%84pxelinux.0%E7%A8%8B%E5%BA%8F" rel="nofollow">第四步：找到grub小程序——也就是syslinux提供的pxelinux.0程序</a></p> 
<p id="%E7%AC%AC%E4%BA%94%E6%AD%A5%EF%BC%9A%E6%89%8B%E5%86%99grub.cfg%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E2%80%94%E2%80%94default%E6%96%87%E4%BB%B6-toc" style="margin-left:40px;"><a href="#%E7%AC%AC%E4%BA%94%E6%AD%A5%EF%BC%9A%E6%89%8B%E5%86%99grub.cfg%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E2%80%94%E2%80%94default%E6%96%87%E4%BB%B6" rel="nofollow">第五步：手写grub.cfg配置文件——default文件</a></p> 
<p id="%E7%AC%AC%E5%85%AD%E6%AD%A5%EF%BC%9A%E7%94%9F%E6%88%90ks.cfg%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-toc" style="margin-left:40px;"><a href="#%E7%AC%AC%E5%85%AD%E6%AD%A5%EF%BC%9A%E7%94%9F%E6%88%90ks.cfg%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" rel="nofollow">第六步：生成ks.cfg配置文件</a></p> 
<p id="%E7%AC%AC%E4%B8%83%E6%AD%A5%EF%BC%9A%E5%90%AF%E5%8A%A8%E6%89%80%E6%9C%89%E6%9C%8D%E5%8A%A1%EF%BC%8C%E8%A7%81%E8%AF%81%E5%A5%87%E8%BF%B9-toc" style="margin-left:40px;"><a href="#%E7%AC%AC%E4%B8%83%E6%AD%A5%EF%BC%9A%E5%90%AF%E5%8A%A8%E6%89%80%E6%9C%89%E6%9C%8D%E5%8A%A1%EF%BC%8C%E8%A7%81%E8%AF%81%E5%A5%87%E8%BF%B9" rel="nofollow">第七步：启动所有服务，见证奇迹</a></p> 
<p id="%E7%AC%AC%E5%85%AB%E6%AD%A5%EF%BC%9A%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E5%8C%96%E8%A3%85%E6%9C%BA%E8%BF%87%E7%A8%8B-toc" style="margin-left:40px;"><a href="#%E7%AC%AC%E5%85%AB%E6%AD%A5%EF%BC%9A%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E5%8C%96%E8%A3%85%E6%9C%BA%E8%BF%87%E7%A8%8B" rel="nofollow">第八步：实现自动化装机过程</a></p> 
<p id="%E5%9B%9B%E3%80%81%E6%80%BB%E7%BB%93-toc" style="margin-left:0px;"><a href="#%E5%9B%9B%E3%80%81%E6%80%BB%E7%BB%93" rel="nofollow">四、总结</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%E4%B8%80%E3%80%81PXE%E7%BD%91%E7%BB%9C%E6%89%B9%E9%87%8F%E8%A3%85%E6%9C%BA%E7%9A%84%E4%BB%8B%E7%BB%8D">一、PXE网络批量装机的介绍</h2> 
<h3 id="1%E3%80%81%E5%B8%B8%E8%A7%81%E7%9A%84%E4%B8%89%E7%A7%8D%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F">1、常见的三种系统安装方式</h3> 
<p><span style="color:#fe2c24;"><strong>第一种：u启动安装，</strong></span>在优盘中下载相关的安装系统和镜像文件，优盘插入即可安装，将想要的操作系统安装进自己的硬盘（需要将优盘设置u启动或者把镜像烧录进去）</p> 
<p><span style="color:#fe2c24;"><strong>第二种：光驱安装，</strong></span>将相关的安装系统镜像放入光盘，插入电脑服务器中，即可按照引导进行装机，将操作系统安装进自己的硬盘</p> 
<p><span style="color:#fe2c24;"><strong>第三种：网卡安装，</strong></span>需要通过网络下载，在网上的某个服务器上去下载相关镜像系统，来进行安装</p> 
<h3 id="2%E3%80%81%E5%9B%9E%E9%A1%BE%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E7%9A%84%E8%BF%87%E7%A8%8B%EF%BC%8C%E4%BA%86%E8%A7%A3%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E7%9A%84%E5%BF%85%E8%A6%81%E6%9D%A1%E4%BB%B6">2、回顾系统安装的过程，了解系统安装的必要条件</h3> 
<p><strong>这是硬盘启动的过程：</strong>开机自检（bios主板）——mbr引导（主要是去找grub菜单）——找到grub配置文件（找到内核的位置）——加载内核到内存——初始化启动</p> 
<p><strong>光驱安装系统的过程：</strong>bios引导选择光驱——<span style="color:#333333;">boot.cat引导（通过isolinux.bin程序找到配置文件）</span>——<span style="color:#333333;">读取isolinux.cfg配置文件知道内核和光驱的位置</span>——加载光驱里面的内核vmlinuz和驱动initrd.img到内存——再通过光驱里面找到各种初始化程序安装包，启动进程并开机</p> 
<p>那么我们想要裸机通过网络来能够完成这样的过程，那么得有哪些必要条件呢？</p> 
<p><strong>①裸机主板需要<span style="color:#fe2c24;">支持网络引导</span>（现在大多数的服务器主机都支持，需要在bios设置中可以允许network或者lan启动）</strong></p> 
<p><img alt="" height="190" src="https://images2.imgbox.com/66/fa/BusDdWwG_o.png" width="1116"></p> 
<p><strong>②需要有一个<span style="color:#fe2c24;">引导程序</span>能找到grub配置文件（类似mbr引导）</strong></p> 
<p><strong>③需要有一个<span style="color:#fe2c24;">类似grub配置文件</span>指引找到内核（类似于grub.cfg）</strong></p> 
<p><img alt="" height="180" src="https://images2.imgbox.com/6b/32/NslLobeM_o.png" width="1200"></p> 
<p><strong>④需要有<span style="color:#fe2c24;">vmlinuz内核程序和initrd.img驱动</span>，加载到内存中（类似于vmlinuz-3.10.0-693.el7.x86_64和initramfs-3.10.0-693.el7.x86_64.img）</strong></p> 
<p><img alt="" height="115" src="https://images2.imgbox.com/c5/de/WZXcx7yl_o.png" width="1200"></p> 
<h3 id="3%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AFpxe">3、什么是pxe</h3> 
<p>PXE 的全称是 preboot execute environment它其实是Intel在很久以前提出来的一项用于通过网络来引导系统的标准。允许客户机通过网络从远程服务器上下载引导镜像，并加载安装文件或者整个操作系统。</p> 
<p>pxe是通过网卡引导启动需要的条件：</p> 
<p>1.BIOS支持</p> 
<p>2.网卡支持（现在基本都已支持）</p> 
<p>3.需要在bios中开启开关，服务器一般没打开（bmc界面里打开）</p> 
<p>4.网络中有一台 DHCP 服务器以便为客户机自动分配地址、指定引导文件位置，网卡自带DHCP功能，dhcp 指明分配的ip地址</p> 
<h3 id="4%E3%80%81%E6%90%AD%E5%BB%BApxe%E7%9A%84%E5%8E%9F%E7%90%86">4、搭建pxe的原理</h3> 
<p><img alt="" height="615" src="https://images2.imgbox.com/27/13/wTsaEYig_o.png" width="750"></p> 
<table cellspacing="0" style="width:507pt;"><tbody><tr><td style="border-color:#000000;text-align:center;vertical-align:middle;width:52pt;"><span style="color:#000000;">第一步</span></td><td style="border-color:#000000;text-align:left;vertical-align:middle;width:455pt;"><span style="color:#000000;">网卡需要查找相关的dhcp服务器，来获取ip地址和时间；</span></td></tr><tr><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">第二步</span></td><td style="border-color:#000000;text-align:left;vertical-align:middle;width:455pt;"><span style="color:#000000;">dhcp服务器，通过offer报文传给裸机客户端，不仅提供了ip地址，还提供了引导程序（boot loader，这里是pxelinux.0）的地址，以及tftp-server的地址（指向dhcp服务器自己）；</span></td></tr><tr><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">第三步</span></td><td style="border-color:#000000;text-align:left;vertical-align:middle;width:455pt;"><span style="color:#000000;">客户机通过tftp服务器获取引导程序pxelinux.0，将其加载到内存中；</span></td></tr><tr><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">第四步</span></td><td style="border-color:#000000;text-align:left;vertical-align:middle;width:455pt;"><span style="color:#000000;">引导程序pxelinux.0通过tftp服务器获取pxelinux.cfg中的default配置文件；</span></td></tr><tr><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">第五步</span></td><td style="border-color:#000000;text-align:left;vertical-align:middle;width:455pt;"><span style="color:#000000;">配置文件指明内核和驱动的位置，通过tftp服务器获取vmlinuz和initrd.img；</span></td></tr><tr><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">最后</span></td><td style="border-color:#000000;text-align:left;vertical-align:middle;width:455pt;"><span style="color:#000000;">启动内核；</span></td></tr></tbody></table> 
<h3 id="5%E3%80%81Linux%E7%9A%84%E5%85%89%E7%9B%98%E9%95%9C%E5%83%8F%E4%B8%AD%E7%9A%84isolinux%E4%B8%AD%E7%9A%84%E7%9B%B8%E5%85%B3%E6%96%87%E4%BB%B6%E5%AD%A6%E4%B9%A0">5、Linux的光盘镜像中的isolinux中的相关文件学习</h3> 
<p><img alt="" height="309" src="https://images2.imgbox.com/f8/fd/USLoZPxc_o.png" width="1200"></p> 
<table cellspacing="0"><tbody><tr><td style="border-color:#000000;text-align:left;vertical-align:middle;width:77pt;"><span style="color:#333333;">boot.cat</span></td><td style="border-color:#000000;text-align:left;vertical-align:middle;width:463pt;"><span style="color:#c00000;">相当于grub的第一阶段 </span></td></tr><tr><td style="border-color:#000000;text-align:left;vertical-align:middle;width:77pt;"><span style="color:#333333;">isolinux.bin</span></td><td style="border-color:#000000;text-align:left;vertical-align:middle;width:463pt;"><span style="color:#333333;"><span style="color:#c00000;">光盘引导程序</span><span style="color:#333333;">，在mkisofs的选项中需要明确给出文件路径，这个文件属于</span><span style="color:#c00000;">SYSLINUX项目</span></span></td></tr><tr><td style="border-color:#000000;text-align:left;vertical-align:middle;width:77pt;"><span style="color:#333333;">isolinux.cfg</span></td><td style="border-color:#000000;text-align:left;vertical-align:middle;width:463pt;"><span style="color:#333333;"><span style="color:#c00000;">启动菜单的配置文件</span><span style="color:#333333;">，当光盘启动后（即运行isolinux.bin），会自动去找isolinux.cfg文件（相当于boot里面的grub.cfg）</span></span></td></tr><tr><td style="border-color:#000000;text-align:left;vertical-align:middle;width:77pt;"><span style="color:#333333;">vesamenu.c32</span></td><td style="border-color:#000000;text-align:left;vertical-align:middle;width:463pt;"><span style="color:#333333;">是光盘启动后的启动菜单图形界面，也属于<span style="color:#c00000;">SYSLINUX项目</span><span style="color:#333333;">，menu.c32提供纯文本的菜单（指明背景图位置）</span></span></td></tr><tr><td style="border-color:#000000;text-align:left;vertical-align:middle;width:77pt;"><span style="color:#333333;">memtest</span></td><td style="border-color:#000000;text-align:left;vertical-align:middle;width:463pt;"><span style="color:#333333;">内存检测程序</span></td></tr><tr><td style="border-color:#000000;text-align:left;vertical-align:middle;width:77pt;"><span style="color:#333333;">splash.png</span></td><td style="border-color:#000000;text-align:left;vertical-align:middle;width:463pt;"><span style="color:#333333;">光盘启动菜单界面的背景图（这是一张图片）</span></td></tr><tr><td style="border-color:#000000;text-align:left;vertical-align:middle;width:77pt;"><span style="color:#333333;">vmlinuz</span></td><td style="border-color:#000000;text-align:left;vertical-align:middle;width:463pt;"><span style="color:#333333;">是内核映像</span></td></tr><tr><td style="border-color:#000000;text-align:left;vertical-align:middle;width:77pt;"><span style="color:#333333;">initrd.img</span></td><td style="border-color:#000000;text-align:left;vertical-align:middle;width:463pt;"><span style="color:#333333;">ramfs文件（精简版的linux系统，<span style="color:#c00000;">文件系统驱动</span><span style="color:#333333;">等）</span></span></td></tr></tbody></table> 
<h2 id="%E4%BA%8C%E3%80%81%E5%85%B3%E4%BA%8E%E5%AE%9E%E7%8E%B0PXE%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88%E8%A3%85%E6%9C%BA%E7%9A%84%E5%9B%9B%E5%A4%A7%E6%96%87%E4%BB%B6%E4%B8%8E%E4%BA%94%E4%B8%AA%E8%BD%AF%E4%BB%B6%E7%9A%84%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB%E8%AF%A6%E8%A7%A3">二、关于实现PXE无人值守装机的四大文件与五个软件的对应关系详解</h2> 
<h3 id="%E2%80%8B%E7%BC%96%E8%BE%91"><img alt="" height="1200" src="https://images2.imgbox.com/6b/d6/TiEqTtGm_o.png" width="1200"></h3> 
<p><strong><span style="color:#fe2c24;">TFTP服务器的家目录/var/lib/tftpboot的四大文件一定是这样，标点符号都要一模一样：</span></strong></p> 
<p> ​​​​​​<img alt="" height="273" src="https://images2.imgbox.com/79/55/KCIVbFMR_o.png" width="1012"></p> 
<h3 id="5%E4%B8%AA%E7%A8%8B%E5%BA%8F%E7%9A%84%E4%BD%BF%E7%94%A8%E5%8E%9F%E5%9B%A0%EF%BC%9A">5个程序的使用原因：</h3> 
<h3 id="%C2%A01%E3%80%81DHCP%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%9A"> 1、DHCP服务器：</h3> 
<p>在这里DHCP服务器是用来动态分配客户端ip地址以及指明TFTP服务器的ip地址和引导程序“pxelinux.0”的位置</p> 
<p>DHCP服务端是udp的67端口，客户端是udp的68端口</p> 
<h3 id="2%E3%80%81TFTP%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%9A">2、TFTP服务器：</h3> 
<p>这是网卡自带的功能，基于udp协议实现客户机和服务端之间进行简单的文件传输协议，适用于小型文件传输。TFTP服务默认由xinetd服务进行管理，使用UDP69端口。</p> 
<p><img alt="" height="169" src="https://images2.imgbox.com/5b/87/SdIKo7mu_o.png" width="769"></p> 
<p>这里的TFTP服务器是用来提供传输四大文件，一共52M</p> 
<p><img alt="" height="427" src="https://images2.imgbox.com/da/33/nPbp3etn_o.png" width="1200"></p> 
<h3 id="3%E3%80%81syslinux%E7%A8%8B%E5%BA%8F%EF%BC%9A">3、syslinux程序：</h3> 
<p>syslinux是一个功能强大的引导加载程序，而且兼容各种介质。它的目的是简化首次安装Linux的时间，并建立修护或其它特殊用途的启动盘。它的安装很简单，一旦安装syslinux好之后，sysLinux启动盘就可以引导各种基于DOS的工具，以及MS-DOS/Windows或者任何其它操作系统。</p> 
<p>这里的syslinux提供pxelinux.0程序</p> 
<p><img alt="" height="210" src="https://images2.imgbox.com/5b/f2/5SKYjAzO_o.png" width="1200"></p> 
<h3 id="4%E3%80%81FTP%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%9A">4、FTP服务器（使用HTTP也是一样的功能）：</h3> 
<p>TFTP用来传输小文件，这里的FTP用来传输大文件，提供镜像和安装包，以及存放传输ks.cfg文件，能够让系统自动化安装完以后重启并开机直接使用</p> 
<h3 id="5%E3%80%81kickstart%E7%A8%8B%E5%BA%8F%EF%BC%9A">5、kickstart程序：</h3> 
<p>通过图形化配置记录想要安装的方式，生成ks.cfg配置文件，放入在FTP服务器中（/var/ftp）</p> 
<h2 id="%E4%B8%89%E3%80%81%E5%AE%9E%E6%93%8DPXE%E6%89%B9%E9%87%8F%E5%AE%89%E8%A3%85%E8%AF%A6%E8%A7%A3">三、实操PXE批量安装详解</h2> 
<h3 id="%E5%81%9A%E4%BB%BB%E4%BD%95%E5%8A%A8%E4%BD%9C%E4%B9%8B%E5%89%8D%E5%85%88%E5%85%B3%E9%97%ADselinux%E5%92%8C%E9%98%B2%E7%81%AB%E5%A2%99%EF%BC%8C%E4%BB%A5%E5%8F%8A%E5%AE%89%E8%A3%85%E4%BA%94%E4%B8%AA%E8%BD%AF%E4%BB%B6">做任何动作之前先关闭selinux和防火墙，以及安装五个软件</h3> 
<p><img alt="" height="34" src="https://images2.imgbox.com/db/aa/cVZPZ2Wv_o.png" width="1134"></p> 
<p><img alt="" height="33" src="https://images2.imgbox.com/69/85/aXhu3y69_o.png" width="1017"></p> 
<h3 id="%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9Adhcp%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA">第一步：dhcp服务器搭建</h3> 
<pre><code> 40 subnet 192.168.20.0 netmask 255.255.255.0 {
 41   range 192.168.20.80 192.168.20.100;
 42   option routers 192.168.20.2;
 43  next-server 192.168.20.18;
 44  filename "pxelinux.0";
 45 }
</code></pre> 
<p><img alt="" height="259" src="https://images2.imgbox.com/c1/ea/6Nnaltp3_o.png" width="1200"></p> 
<p> <img alt="" height="226" src="https://images2.imgbox.com/6b/34/tnwi3Hcw_o.png" width="1131"></p> 
<h3 id="%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E5%87%86%E5%A4%87%E5%A5%BDvsftpd%E6%9C%8D%E5%8A%A1%EF%BC%8C%E6%8C%82%E8%BD%BD%E5%85%89%E7%9B%98%E9%95%9C%E5%83%8F">第二步：准备好vsftpd服务，挂载光盘镜像</h3> 
<pre><code>[root@localhost isolinux]#cd /var/ftp/
[root@localhost ftp]#ls
ks.cfg  pub
[root@localhost ftp]#mkdir centos7
[root@localhost ftp]#mount /dev/sr0 centos7/</code></pre> 
<p><img alt="" height="163" src="https://images2.imgbox.com/d2/a0/QKSuvb8Z_o.png" width="1032"></p> 
<h3 id="%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E5%BC%80%E5%90%AFtftp%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%EF%BC%8C%E9%85%8D%E7%BD%AE%E5%A5%BDtftp%E4%BC%A0%E8%BE%93%E7%9A%84%E6%96%87%E4%BB%B6%EF%BC%8C%E5%86%85%E6%A0%B8%E5%92%8C%E9%A9%B1%E5%8A%A8">第三步：开启tftp开机自启，配置好tftp传输的文件，内核和驱动</h3> 
<pre><code>[root@localhost boot]#rpm -qc tftp-server 
/etc/xinetd.d/tftp
[root@localhost boot]#vim /etc/xinetd.d/tftp
 14         disable                 = no  ##改为no，改为不关闭
</code></pre> 
<p><img alt="" height="127" src="https://images2.imgbox.com/67/72/a3pnUpr3_o.png" width="931"></p> 
<p><img alt="" height="465" src="https://images2.imgbox.com/df/1e/Q4E8VVnN_o.png" width="1200"></p> 
<pre><code>[root@localhost isolinux]#ll -h
总用量 53M
-r--r--r-- 1 root root 2.0K 9月   6 2017 boot.cat
-rw-r--r-- 1 root root   84 9月   5 2017 boot.msg
-rw-r--r-- 1 root root  281 9月   5 2017 grub.conf
-rw-r--r-- 1 root root  47M 9月   5 2017 initrd.img
-rw-r--r-- 1 root root  24K 9月   5 2017 isolinux.bin
-rw-r--r-- 1 root root 3.0K 9月   5 2017 isolinux.cfg
-rw-r--r-- 1 root root 187K 11月  6 2016 memtest
-rw-r--r-- 1 root root  186 10月  1 2015 splash.png
-r--r--r-- 1 root root 2.2K 9月   6 2017 TRANS.TBL
-rw-r--r-- 1 root root 150K 11月  6 2016 vesamenu.c32
-rwxr-xr-x 1 root root 5.7M 8月  23 2017 vmlinuz
[root@localhost isolinux]#cp initrd.img vmlinuz /var/lib/tftpboot/</code></pre> 
<p></p> 
<p><img alt="" height="370" src="https://images2.imgbox.com/fa/0d/4aA6OaTK_o.png" width="1200"></p> 
<h3 id="%E7%AC%AC%E5%9B%9B%E6%AD%A5%EF%BC%9A%E6%89%BE%E5%88%B0grub%E5%B0%8F%E7%A8%8B%E5%BA%8F%E2%80%94%E2%80%94%E4%B9%9F%E5%B0%B1%E6%98%AFsyslinux%E6%8F%90%E4%BE%9B%E7%9A%84pxelinux.0%E7%A8%8B%E5%BA%8F">第四步：找到grub小程序——也就是syslinux提供的pxelinux.0程序</h3> 
<p><img alt="" height="211" src="https://images2.imgbox.com/3c/ba/1s8SDUit_o.png" width="1200"></p> 
<h3 id="%E7%AC%AC%E4%BA%94%E6%AD%A5%EF%BC%9A%E6%89%8B%E5%86%99grub.cfg%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E2%80%94%E2%80%94default%E6%96%87%E4%BB%B6">第五步：手写grub.cfg配置文件——default文件</h3> 
<p><img alt="" height="331" src="https://images2.imgbox.com/ac/aa/28mdhWH0_o.png" width="1200"></p> 
<h3 id="%E7%AC%AC%E5%85%AD%E6%AD%A5%EF%BC%9A%E7%94%9F%E6%88%90ks.cfg%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">第六步：生成ks.cfg配置文件</h3> 
<p><img alt="" height="634" src="https://images2.imgbox.com/ea/9c/uerZQuI1_o.png" width="1135"></p> 
<p><img alt="" height="570" src="https://images2.imgbox.com/63/e8/E2yfVp7I_o.png" width="858"></p> 
<p><img alt="" height="463" src="https://images2.imgbox.com/f6/93/kxor07e6_o.png" width="829"> <img alt="" height="547" src="https://images2.imgbox.com/3c/48/turX5uoH_o.png" width="772"></p> 
<p><img alt="" height="808" src="https://images2.imgbox.com/a9/31/G4zUlkxw_o.png" width="1008"> <img alt="" height="528" src="https://images2.imgbox.com/a4/8e/FTKYO6UF_o.png" width="972"></p> 
<p><img alt="" height="439" src="https://images2.imgbox.com/c4/52/p59PjvQH_o.png" width="964"> <img alt="" height="490" src="https://images2.imgbox.com/a0/50/qOpCXqUm_o.png" width="988"></p> 
<p><img alt="" height="576" src="https://images2.imgbox.com/40/cc/HVihrW8T_o.png" width="999"> <img alt="" height="573" src="https://images2.imgbox.com/98/15/xbcR1mA5_o.png" width="960"></p> 
<h3 id="%E7%AC%AC%E4%B8%83%E6%AD%A5%EF%BC%9A%E5%90%AF%E5%8A%A8%E6%89%80%E6%9C%89%E6%9C%8D%E5%8A%A1%EF%BC%8C%E8%A7%81%E8%AF%81%E5%A5%87%E8%BF%B9">第七步：启动所有服务，见证奇迹</h3> 
<pre><code>[root@localhost centos7]#systemctl restart dhcpd
[root@localhost ftp]#systemctl restart tftp
[root@localhost ftp]#systemctl restart vsftpd
</code></pre> 
<p><img alt="" height="159" src="https://images2.imgbox.com/0f/10/CQDj2aSA_o.png" width="1200"></p> 
<h3 id="%E7%AC%AC%E5%85%AB%E6%AD%A5%EF%BC%9A%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E5%8C%96%E8%A3%85%E6%9C%BA%E8%BF%87%E7%A8%8B">第八步：实现自动化装机过程</h3> 
<p> <img alt="" height="649" src="https://images2.imgbox.com/24/08/2NE62mBP_o.png" width="1200"></p> 
<p><img alt="" height="894" src="https://images2.imgbox.com/83/ff/BfGLfBOj_o.png" width="1200"></p> 
<p><img alt="" height="343" src="https://images2.imgbox.com/d7/ad/a0dRxvIX_o.png" width="1045"></p> 
<p><img alt="" height="489" src="https://images2.imgbox.com/ad/ef/2lVlblhB_o.png" width="1200"></p> 
<h2 id="%E5%9B%9B%E3%80%81%E6%80%BB%E7%BB%93">四、总结</h2> 
<p>这一章有很多关于硬件的知识点，如果不理解就先放弃，明白pxe和kickstart的原理即可。</p> 
<p><span style="color:#fe2c24;"><strong>还有个优化方向：可以直接将DNS也一起放在DHCP的服务器上，让其自动获取</strong></span></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ed039c623412d85ef522f9b9ed089959/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">系统盘升级-系统迁移记录</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/68c4c9ab355499b7a2edb8d7259983db/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">小程序申请，商户号申请，微信支付开通操作流程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>