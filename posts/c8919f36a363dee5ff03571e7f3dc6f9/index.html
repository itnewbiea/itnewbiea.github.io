<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>gradle--groovy-dsl和kotlin-dsl对比 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="gradle--groovy-dsl和kotlin-dsl对比" />
<meta property="og:description" content="文章目录 gradle--groovy-dsl和kotlin-dsl对比常用对比插件引用对比gradle脚本引用对比任务task对比配置任务创建任务 仓库对比依赖对比groovy的ext和kotlin的extra独立gradle文件对比示例groovykotlin 参考 gradle–groovy-dsl和kotlin-dsl对比 官方文档：Migrating build logic from Groovy to Kotlin官方demo:kotlin-dsl-samples/samples at master · gradle/kotlin-dsl-samples · GitHubandroid相关的迁移可以查阅：将构建配置从 Groovy 迁移到 KTS | Android 开发者 | Android Developers对于想使用kotlin的小伙伴来说，经常会遇到groovy的这个东西kotlin该怎么写的烦恼，为此本文总结一些常用的对比 常用对比 groovy可以使用单引号和双引号，而kotlin只能使用双引号groovy在函数调用时可以省略括号，而kotlin必须加上括号groovy在赋值时可以省略等于号，而kotlin必须加上等号为了减少迁移成本，在groovy时就应该约定使用双引号，调用加上括号，使用等号赋值 插件引用对比 Groovy DSL有两种方式去引用插件： 1 plugins{} //强烈推荐2 apply plugin 注意，核心插件可以用短名称，非核心插件必须声明id和version(非核心插件地址：Gradle - Plugins) //groovy dsl plugins { id &#39;java&#39; //核心插件，可以省略version id &#39;jacoco&#39; id &#39;maven-publish&#39; id &#39;org.springframework.boot&#39; version &#39;2.4.1&#39; } //kotlin dsl plugins { java //核心插件，可以直接用短名称 jacoco `maven-publish` id(&#34;org.springframework.boot&#34;) version &#34;2.4.1&#34; } //groovy dsl apply plugin: &#39;java&#39; apply plugin: &#39;jacoco&#39; apply plugin: &#39;org." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/c8919f36a363dee5ff03571e7f3dc6f9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-24T14:31:25+08:00" />
<meta property="article:modified_time" content="2023-12-24T14:31:25+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">gradle--groovy-dsl和kotlin-dsl对比</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#gradlegroovydslkotlindsl_1" rel="nofollow">gradle--groovy-dsl和kotlin-dsl对比</a></li><li><ul><li><a href="#_6" rel="nofollow">常用对比</a></li><li><a href="#_11" rel="nofollow">插件引用对比</a></li><li><a href="#gradle_51" rel="nofollow">gradle脚本引用对比</a></li><li><a href="#task_60" rel="nofollow">任务task对比</a></li><li><ul><li><a href="#_61" rel="nofollow">配置任务</a></li><li><a href="#_121" rel="nofollow">创建任务</a></li></ul> 
   </li><li><a href="#_179" rel="nofollow">仓库对比</a></li><li><a href="#_198" rel="nofollow">依赖对比</a></li><li><a href="#groovyextkotlinextra_229" rel="nofollow">groovy的ext和kotlin的extra</a></li><li><a href="#gradle_278" rel="nofollow">独立gradle文件对比</a></li><li><a href="#_281" rel="nofollow">示例</a></li><li><ul><li><a href="#groovy_283" rel="nofollow">groovy</a></li><li><a href="#kotlin_371" rel="nofollow">kotlin</a></li></ul> 
   </li><li><a href="#_457" rel="nofollow">参考</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="gradlegroovydslkotlindsl_1"></a>gradle–groovy-dsl和kotlin-dsl对比</h2> 
<ul><li>官方文档：<a href="https://docs.gradle.org/current/userguide/migrating_from_groovy_to_kotlin_dsl.html" rel="nofollow">Migrating build logic from Groovy to Kotlin</a></li><li>官方demo:<a href="https://github.com/gradle/kotlin-dsl-samples/tree/master/samples">kotlin-dsl-samples/samples at master · gradle/kotlin-dsl-samples · GitHub</a></li><li>android相关的迁移可以查阅：<a href="https://developer.android.google.cn/studio/build/migrate-to-kts" rel="nofollow">将构建配置从 Groovy 迁移到 KTS | Android 开发者 | Android Developers</a></li><li>对于想使用kotlin的小伙伴来说，经常会遇到groovy的这个东西kotlin该怎么写的烦恼，为此本文总结一些常用的对比</li></ul> 
<h3><a id="_6"></a>常用对比</h3> 
<ul><li>groovy可以使用单引号和双引号，而<strong>kotlin只能使用双引号</strong></li><li>groovy在函数调用时可以省略括号，而<strong>kotlin必须加上括号</strong></li><li>groovy在赋值时可以省略等于号，而<strong>kotlin必须加上等号</strong></li><li>为了减少迁移成本，<strong>在groovy时就应该约定使用双引号，调用加上括号，使用等号赋值</strong></li></ul> 
<h3><a id="_11"></a>插件引用对比</h3> 
<ul><li>Groovy DSL有两种方式去引用插件： 
  <ul><li>1 plugins{} //强烈推荐</li><li>2 apply plugin</li></ul> </li><li>注意，核心插件可以用短名称，非核心插件必须声明id和version(非核心插件地址：<a href="https://plugins.gradle.org/" rel="nofollow">Gradle - Plugins</a>)</li></ul> 
<pre><code class="prism language-groovy"><span class="token comment">//groovy dsl</span>
plugins <span class="token punctuation">{<!-- --></span>
    id <span class="token string">'java'</span> <span class="token comment">//核心插件，可以省略version</span>
    id <span class="token string">'jacoco'</span>
    id <span class="token string">'maven-publish'</span>
    id <span class="token string">'org.springframework.boot'</span> version <span class="token string">'2.4.1'</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-kotlin"><span class="token comment">//kotlin dsl</span>
plugins <span class="token punctuation">{<!-- --></span>
    java <span class="token comment">//核心插件，可以直接用短名称</span>
    jacoco
    `maven<span class="token operator">-</span>publish`
    <span class="token function">id</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"org.springframework.boot"</span></span><span class="token punctuation">)</span> version <span class="token string-literal singleline"><span class="token string">"2.4.1"</span></span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-groovy"><span class="token comment">//groovy dsl</span>
apply plugin<span class="token punctuation">:</span> <span class="token string">'java'</span>
apply plugin<span class="token punctuation">:</span> <span class="token string">'jacoco'</span>
apply plugin<span class="token punctuation">:</span> <span class="token string">'org.springframework.boot'</span>
</code></pre> 
<pre><code class="prism language-kotlin"><span class="token comment">//kotlin dsl</span>
<span class="token function">apply</span><span class="token punctuation">(</span>plugin <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"java"</span></span><span class="token punctuation">)</span>
<span class="token function">apply</span><span class="token punctuation">(</span>plugin <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"jacoco"</span></span><span class="token punctuation">)</span>
<span class="token function">apply</span><span class="token punctuation">(</span>plugin <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"org.springframework.boot"</span></span><span class="token punctuation">)</span>

<span class="token comment">//另外还有这种写法</span>
apply<span class="token operator">&lt;</span>ExamplePlugin<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="gradle_51"></a>gradle脚本引用对比</h3> 
<ul><li>groovy</li></ul> 
<pre><code class="prism language-groovy">apply from<span class="token punctuation">:</span> <span class="token string">'other.gradle'</span>
</code></pre> 
<ul><li>kotlin</li></ul> 
<pre><code class="prism language-kotlin"><span class="token function">apply</span><span class="token punctuation">(</span>from <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"other.gradle.kts"</span></span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="task_60"></a>任务task对比</h3> 
<h4><a id="_61"></a>配置任务</h4> 
<pre><code class="prism language-groovy"><span class="token comment">// groovy-dsl</span>
tasks<span class="token punctuation">.</span>jar <span class="token punctuation">{<!-- --></span>
    archiveFileName <span class="token operator">=</span> <span class="token string">'foo.jar'</span>
<span class="token punctuation">}</span>

tasks<span class="token punctuation">.</span><span class="token function">named</span><span class="token punctuation">(</span><span class="token string">'jar'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    archiveFileName <span class="token operator">=</span> <span class="token string">'foo.jar'</span>
<span class="token punctuation">}</span>

tasks<span class="token punctuation">.</span><span class="token function">getByName</span><span class="token punctuation">(</span><span class="token string">'jar'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    archiveFileName <span class="token operator">=</span> <span class="token string">'foo.jar'</span>
<span class="token punctuation">}</span>

tasks<span class="token punctuation">.</span><span class="token function">named</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">useJUnitPlatform</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 指定编码</span>
tasks<span class="token punctuation">.</span><span class="token function">withType</span><span class="token punctuation">(</span>JavaCompile<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    options<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"UTF-8"</span></span>
<span class="token punctuation">}</span>

<span class="token comment">// 打包sourcesJar任务</span>
task <span class="token function">sourcesJar</span><span class="token punctuation">(</span>type<span class="token punctuation">:</span> Jar<span class="token punctuation">,</span> dependsOn<span class="token punctuation">:</span> classes<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    archiveClassifier <span class="token operator">=</span> <span class="token string">'sources'</span>
    from sourceSets<span class="token punctuation">.</span>main<span class="token punctuation">.</span>allSource
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-kotlin"><span class="token comment">// kotlin-dsl</span>
tasks<span class="token punctuation">.</span><span class="token function">jar</span> <span class="token punctuation">{<!-- --></span>
    archiveFileName<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"foo.jar"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

tasks<span class="token punctuation">.</span>named<span class="token operator">&lt;</span>Jar<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"jar"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    archiveFileName<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"foo.jar"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

tasks<span class="token punctuation">.</span>getByName<span class="token operator">&lt;</span>Jar<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"jar"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    archiveFileName<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"foo.jar"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

tasks<span class="token punctuation">.</span>withType<span class="token operator">&lt;</span>Test<span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">useJUnitPlatform</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

tasks<span class="token punctuation">.</span>withType<span class="token operator">&lt;</span>JavaCompile<span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    options<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"UTF-8"</span></span>
<span class="token punctuation">}</span>

<span class="token comment">// 打包sourcesJar任务</span>
<span class="token keyword">val</span> sourcesJar <span class="token keyword">by</span> tasks<span class="token punctuation">.</span><span class="token function">registering</span><span class="token punctuation">(</span>Jar<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">dependsOn</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"classes"</span></span><span class="token punctuation">)</span>
    archiveClassifier<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"sources"</span></span><span class="token punctuation">)</span>
    <span class="token function">from</span><span class="token punctuation">(</span>sourceSets<span class="token punctuation">[</span><span class="token string-literal singleline"><span class="token string">"main"</span></span><span class="token punctuation">]</span><span class="token punctuation">.</span>allSource<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_121"></a>创建任务</h4> 
<pre><code class="prism language-groovy"><span class="token comment">// groovy-dsl</span>
task greeting <span class="token punctuation">{<!-- --></span>
    doLast <span class="token punctuation">{<!-- --></span> println <span class="token string">'Hello, World!'</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

tasks<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">'greeting'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    doLast <span class="token punctuation">{<!-- --></span> <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">'Hello, World!'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

tasks<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'greeting'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    doLast <span class="token punctuation">{<!-- --></span> <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">'Hello, World!'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

tasks<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'docZip'</span><span class="token punctuation">,</span> Zip<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    archiveFileName <span class="token operator">=</span> <span class="token string">'doc.zip'</span>
    from <span class="token string">'doc'</span>
<span class="token punctuation">}</span>

tasks<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">'docZip'</span><span class="token punctuation">,</span> type<span class="token punctuation">:</span> Zip<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    archiveFileName <span class="token operator">=</span> <span class="token string">'doc.zip'</span>
    from <span class="token string">'doc'</span>
<span class="token punctuation">}</span>

task <span class="token function">clean</span><span class="token punctuation">(</span>type<span class="token punctuation">:</span> Delete<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    delete rootProject<span class="token punctuation">.</span>buildDir
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-kotlin"><span class="token comment">// kotlin-dsl</span>
<span class="token function">task</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"greeting"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    doLast <span class="token punctuation">{<!-- --></span> <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Hello, World!"</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

tasks<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"greeting"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    doLast <span class="token punctuation">{<!-- --></span> <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Hello, World!"</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

tasks<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"greeting"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    doLast <span class="token punctuation">{<!-- --></span> <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Hello, World!"</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

tasks<span class="token punctuation">.</span>register<span class="token operator">&lt;</span>Zip<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"docZip"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    archiveFileName<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"doc.zip"</span></span><span class="token punctuation">)</span>
    <span class="token function">from</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"doc"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

tasks<span class="token punctuation">.</span>create<span class="token operator">&lt;</span>Zip<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"docZip"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    archiveFileName<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"doc.zip"</span></span><span class="token punctuation">)</span>
    <span class="token function">from</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"doc"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

tasks<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"clean"</span></span><span class="token punctuation">,</span> Delete<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">delete</span><span class="token punctuation">(</span>rootProject<span class="token punctuation">.</span>buildDir<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_179"></a>仓库对比</h3> 
<pre><code class="prism language-groovy"><span class="token comment">// groovy-dsl</span>
repositories <span class="token punctuation">{<!-- --></span>
        <span class="token function">mavenLocal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">google</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">mavenCentral</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        maven <span class="token punctuation">{<!-- --></span> url <span class="token string">'https://www.jitpack.io'</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-kotlin"><span class="token comment">// kotlin-dsl</span>
repositories <span class="token punctuation">{<!-- --></span>
        <span class="token function">mavenLocal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">google</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">mavenCentral</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">maven</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"https://www.jitpack.io"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_198"></a>依赖对比</h3> 
<pre><code class="prism language-groovy"><span class="token comment">// groovy-dsl</span>
plugins <span class="token punctuation">{<!-- --></span>
    id <span class="token string">'java-library'</span>
<span class="token punctuation">}</span>
dependencies <span class="token punctuation">{<!-- --></span>
    implementation <span class="token string">'com.example:lib:1.1'</span>
    runtimeOnly <span class="token string">'com.example:runtime:1.0'</span>
    <span class="token function">testImplementation</span><span class="token punctuation">(</span><span class="token string">'com.example:test-support:1.3'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">exclude</span><span class="token punctuation">(</span>module<span class="token punctuation">:</span> <span class="token string">'junit'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    testRuntimeOnly <span class="token string">'com.example:test-junit-jupiter-runtime:1.3'</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-kotlin"><span class="token comment">// kotlin-dsl</span>
plugins <span class="token punctuation">{<!-- --></span>
    `java<span class="token operator">-</span>library`
<span class="token punctuation">}</span>
dependencies <span class="token punctuation">{<!-- --></span>
    <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"com.example:lib:1.1"</span></span><span class="token punctuation">)</span>
    <span class="token function">runtimeOnly</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"com.example:runtime:1.0"</span></span><span class="token punctuation">)</span>
    <span class="token function">testImplementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"com.example:test-support:1.3"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">exclude</span><span class="token punctuation">(</span>module <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"junit"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">testRuntimeOnly</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"com.example:test-junit-jupiter-runtime:1.3"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="groovyextkotlinextra_229"></a>groovy的ext和kotlin的extra</h3> 
<ul><li><a href="https://docs.gradle.org/current/dsl/org.gradle.api.plugins.ExtraPropertiesExtension.html#org.gradle.api.plugins.ExtraPropertiesExtension" rel="nofollow">ExtraPropertiesExtension - Gradle DSL Version 7.4.2</a></li><li>groovy我们可以用ext来统一管理变量</li><li>而kotlin则变为extra，但统一管理变量还用buildSrc更好一些</li></ul> 
<pre><code class="prism language-groovy"><span class="token comment">// groovy-dsl</span>
<span class="token comment">// root build.gradle</span>
<span class="token punctuation">...</span>
ext <span class="token punctuation">{<!-- --></span>
	min_sdk <span class="token operator">=</span> <span class="token number">21</span>
    target_sdk <span class="token operator">=</span> <span class="token number">31</span>
<span class="token punctuation">}</span>

<span class="token comment">//sub build.gradle</span>
android <span class="token punctuation">{<!-- --></span>
    defaultConfig <span class="token punctuation">{<!-- --></span>
       	minSdk min_sdk <span class="token comment">//groovy的省略写法</span>
        targetSdk rootProject<span class="token punctuation">.</span>target_sdk
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-kotlin"><span class="token comment">// kotlin-dsl</span>
<span class="token comment">// root build.gradle</span>
<span class="token operator">..</span><span class="token punctuation">.</span>
rootProject<span class="token punctuation">.</span>extra<span class="token punctuation">[</span><span class="token string-literal singleline"><span class="token string">"min_sdk"</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">21</span>
extra<span class="token punctuation">[</span><span class="token string-literal singleline"><span class="token string">"target_sdk"</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">31</span>

<span class="token comment">//sub build.gradle</span>
<span class="token keyword">val</span> min_sdk<span class="token operator">:</span> Int <span class="token keyword">by</span> rootProject<span class="token punctuation">.</span>extra
android <span class="token punctuation">{<!-- --></span>
    defaultConfig <span class="token punctuation">{<!-- --></span>
        minSdk <span class="token operator">=</span> rootProject<span class="token punctuation">.</span>extra<span class="token punctuation">[</span><span class="token string-literal singleline"><span class="token string">"min_sdk"</span></span><span class="token punctuation">]</span> <span class="token keyword">as</span> Int 
        <span class="token comment">// minSdk = min_sdk //与上面等效</span>
        targetSdk <span class="token operator">=</span> rootProject<span class="token punctuation">.</span>properties<span class="token punctuation">[</span><span class="token string-literal singleline"><span class="token string">"target_sdk"</span></span><span class="token punctuation">]</span> <span class="token keyword">as</span> Int
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>假如工程里groovy和kotln都有，那么kotlin可以通过 <strong>rootProject.extra[“min_sdk”]</strong> 或<strong>rootProject.properties[“target_sdk”]</strong> 得到groovy主工程中定义的ext,如下</li></ul> 
<pre><code class="prism language-groovy"><span class="token comment">// groovy-dsl</span>
<span class="token comment">// root build.gradle</span>
ext <span class="token punctuation">{<!-- --></span>
	min_sdk <span class="token operator">=</span> <span class="token number">21</span>
    target_sdk <span class="token operator">=</span> <span class="token number">31</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="gradle_278"></a>独立gradle文件对比</h3> 
<ul><li>在groovy中，当我们发现一个build.gradle文件比较庞大臃肿时，可以很方便地将其中部分内容独立成另一个xxx.gradle文件并用<code>apply from</code>进行引用</li><li>然而当你使用kotlin-dsl时，你会发现上面的想法并不顺利，脚本根本无法正常执行，因为kotlin-dsl并不支持这样做，要实现类似的功能，还得使用预编译脚本插件<a href="https://docs.gradle.org/current/userguide/custom_plugins.html#sec:precompiled_plugins" rel="nofollow">Developing Custom Gradle Plugins</a></li></ul> 
<h3><a id="_281"></a>示例</h3> 
<ul><li>最后以android为例，提供一份对比</li></ul> 
<h4><a id="groovy_283"></a>groovy</h4> 
<ul><li>setting.gradle</li></ul> 
<pre><code class="prism language-groovy">dependencyResolutionManagement <span class="token punctuation">{<!-- --></span>
    repositoriesMode<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>RepositoriesMode<span class="token punctuation">.</span>FAIL_ON_PROJECT_REPOS<span class="token punctuation">)</span>
    repositories <span class="token punctuation">{<!-- --></span>
        <span class="token function">google</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">mavenCentral</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
rootProject<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"My Application"</span></span>
include <span class="token string">':app'</span>

</code></pre> 
<ul><li>root build.gradle</li></ul> 
<pre><code class="prism language-groovy"><span class="token comment">// Top-level build file where you can add configuration options common to all sub-projects/modules.</span>
buildscript <span class="token punctuation">{<!-- --></span>
    repositories <span class="token punctuation">{<!-- --></span>
        <span class="token function">google</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">mavenCentral</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    dependencies <span class="token punctuation">{<!-- --></span>
        classpath <span class="token interpolation-string"><span class="token string">"com.android.tools.build:gradle:7.0.4"</span></span>
        classpath <span class="token interpolation-string"><span class="token string">"org.jetbrains.kotlin:kotlin-gradle-plugin:1.5.20"</span></span>

        <span class="token comment">// NOTE: Do not place your application dependencies here; they belong</span>
        <span class="token comment">// in the individual module build.gradle files</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

task <span class="token function">clean</span><span class="token punctuation">(</span>type<span class="token punctuation">:</span> Delete<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    delete rootProject<span class="token punctuation">.</span>buildDir
<span class="token punctuation">}</span>

ext<span class="token punctuation">{<!-- --></span>
    min_sdk<span class="token operator">=</span><span class="token number">21</span>
    target_sdk <span class="token operator">=</span><span class="token number">31</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>app build.gradle</li></ul> 
<pre><code class="prism language-bash">plugins <span class="token punctuation">{<!-- --></span>
    <span class="token function">id</span> <span class="token string">'com.android.application'</span>
    <span class="token function">id</span> <span class="token string">'kotlin-android'</span>
<span class="token punctuation">}</span>

android <span class="token punctuation">{<!-- --></span>
    compileSdk <span class="token number">31</span>

    defaultConfig <span class="token punctuation">{<!-- --></span>
        applicationId <span class="token string">"com.xxx.myapplication"</span>
        minSdk min_sdk
        targetSdk rootProject.target_sdk
        versionCode <span class="token number">1</span>
        versionName <span class="token string">"1.0"</span>

        testInstrumentationRunner <span class="token string">"androidx.test.runner.AndroidJUnitRunner"</span>
    <span class="token punctuation">}</span>

    buildTypes <span class="token punctuation">{<!-- --></span>
        release <span class="token punctuation">{<!-- --></span>
            minifyEnabled <span class="token boolean">false</span>
            proguardFiles getDefaultProguardFile<span class="token punctuation">(</span><span class="token string">'proguard-android-optimize.txt'</span><span class="token punctuation">)</span>, <span class="token string">'proguard-rules.pro'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    compileOptions <span class="token punctuation">{<!-- --></span>
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    <span class="token punctuation">}</span>
    kotlinOptions <span class="token punctuation">{<!-- --></span>
        jvmTarget <span class="token operator">=</span> <span class="token string">'1.8'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

dependencies <span class="token punctuation">{<!-- --></span>
 	implementation fileTree<span class="token punctuation">(</span>dir: <span class="token string">'libs'</span>, include: <span class="token punctuation">[</span><span class="token string">'*.jar'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    implementation <span class="token string">'androidx.core:core-ktx:1.2.0'</span>
    implementation <span class="token string">'androidx.appcompat:appcompat:1.4.1'</span>
    implementation <span class="token string">'com.google.android.material:material:1.5.0'</span>
    implementation <span class="token string">'androidx.constraintlayout:constraintlayout:2.1.3'</span>
    testImplementation <span class="token string">'junit:junit:4.+'</span>
    androidTestImplementation <span class="token string">'androidx.test.ext:junit:1.1.3'</span>
    androidTestImplementation <span class="token string">'androidx.test.espresso:espresso-core:3.4.0'</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="kotlin_371"></a>kotlin</h4> 
<ul><li>setting.gradle</li></ul> 
<pre><code class="prism language-kotlin">dependencyResolutionManagement <span class="token punctuation">{<!-- --></span>
    repositoriesMode<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>RepositoriesMode<span class="token punctuation">.</span>FAIL_ON_PROJECT_REPOS<span class="token punctuation">)</span>
    repositories <span class="token punctuation">{<!-- --></span>
        <span class="token function">google</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">mavenCentral</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
rootProject<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"My Application"</span></span>
<span class="token function">include</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">":app"</span></span><span class="token punctuation">)</span>

</code></pre> 
<ul><li>root build.gradle</li></ul> 
<pre><code class="prism language-kotlin"><span class="token comment">// Top-level build file where you can add configuration options common to all sub-projects/modules.</span>
buildscript <span class="token punctuation">{<!-- --></span>
    repositories <span class="token punctuation">{<!-- --></span>
        <span class="token function">google</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">mavenCentral</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    dependencies <span class="token punctuation">{<!-- --></span>
        <span class="token function">classpath</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"com.android.tools.build:gradle:7.0.4"</span></span><span class="token punctuation">)</span>
        <span class="token function">classpath</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"org.jetbrains.kotlin:kotlin-gradle-plugin:1.5.20"</span></span><span class="token punctuation">)</span>

        <span class="token comment">// NOTE: Do not place your application dependencies here; they belong</span>
        <span class="token comment">// in the individual module build.gradle.groovy files</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

tasks<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"clean"</span></span><span class="token punctuation">,</span> Delete<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> 
    <span class="token function">delete</span><span class="token punctuation">(</span>rootProject<span class="token punctuation">.</span>buildDir<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

extra<span class="token punctuation">[</span><span class="token string-literal singleline"><span class="token string">"min_sdk"</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">21</span>
extra<span class="token punctuation">[</span><span class="token string-literal singleline"><span class="token string">"target_sdk"</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">31</span>
</code></pre> 
<ul><li>app build.gradle</li></ul> 
<pre><code class="prism language-kotlin">plugins <span class="token punctuation">{<!-- --></span>
    <span class="token function">id</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"com.android.application"</span></span><span class="token punctuation">)</span>
    <span class="token function">id</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"kotlin-android"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
android <span class="token punctuation">{<!-- --></span>
    compileSdk <span class="token operator">=</span> <span class="token number">31</span>

    defaultConfig <span class="token punctuation">{<!-- --></span>
        applicationId <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"com.xxx.myapplication"</span></span>
        minSdk <span class="token operator">=</span> rootProject<span class="token punctuation">.</span>properties<span class="token punctuation">[</span><span class="token string-literal singleline"><span class="token string">"min_sdk"</span></span><span class="token punctuation">]</span> <span class="token keyword">as</span> Int
        targetSdk <span class="token operator">=</span> rootProject<span class="token punctuation">.</span>properties<span class="token punctuation">[</span><span class="token string-literal singleline"><span class="token string">"target_sdk"</span></span><span class="token punctuation">]</span> <span class="token keyword">as</span> Int
        versionCode <span class="token operator">=</span> <span class="token number">1</span>
        versionName <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"1.0"</span></span>

        testInstrumentationRunner <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"androidx.test.runner.AndroidJUnitRunner"</span></span>
    <span class="token punctuation">}</span>

    buildTypes <span class="token punctuation">{<!-- --></span>
        release <span class="token punctuation">{<!-- --></span>
            isMinifyEnabled <span class="token operator">=</span> <span class="token boolean">false</span>
            <span class="token function">proguardFiles</span><span class="token punctuation">(</span><span class="token function">getDefaultProguardFile</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"proguard-android-optimize.txt"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"proguard-rules.pro"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    compileOptions <span class="token punctuation">{<!-- --></span>
        sourceCompatibility <span class="token operator">=</span> JavaVersion<span class="token punctuation">.</span>VERSION_1_8
        targetCompatibility <span class="token operator">=</span> JavaVersion<span class="token punctuation">.</span>VERSION_1_8
    <span class="token punctuation">}</span>
    kotlinOptions <span class="token punctuation">{<!-- --></span>
        jvmTarget <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"1.8"</span></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

dependencies <span class="token punctuation">{<!-- --></span>
 	<span class="token function">implementation</span> <span class="token punctuation">(</span><span class="token function">fileTree</span><span class="token punctuation">(</span><span class="token function">mapOf</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"dir"</span></span> <span class="token keyword">to</span> <span class="token string-literal singleline"><span class="token string">"libs"</span></span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"include"</span></span> <span class="token keyword">to</span> <span class="token function">listOf</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"*.jar"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"androidx.core:core-ktx:1.2.0"</span></span><span class="token punctuation">)</span>
    <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"androidx.appcompat:appcompat:1.4.1"</span></span><span class="token punctuation">)</span>
    <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"com.google.android.material:material:1.5.0"</span></span><span class="token punctuation">)</span>
    <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"androidx.constraintlayout:constraintlayout:2.1.3"</span></span><span class="token punctuation">)</span>
    <span class="token function">testImplementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"junit:junit:4.+"</span></span><span class="token punctuation">)</span>
    <span class="token function">androidTestImplementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"androidx.test.ext:junit:1.1.3"</span></span><span class="token punctuation">)</span>
    <span class="token function">androidTestImplementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"androidx.test.espresso:espresso-core:3.4.0"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_457"></a>参考</h3> 
<ul><li><a href="https://docs.gradle.org/current/userguide/migrating_from_groovy_to_kotlin_dsl.html" rel="nofollow">Migrating build logic from Groovy to Kotlin</a></li><li><a href="https://blog.csdn.net/blue_zy/article/details/104765687">(6条消息) 使用Kotlin DSL构建Android项目_blue_zy的博客-CSDN博客</a></li><li><a href="http://www.javashuo.com/article/p-xhanffhh-nv.html" rel="nofollow">再见，Groovy! 教你如何使用Kotlin SDL 编写Gradle脚本！ - JavaShuo</a></li></ul>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/34d09b6325a0446833400d440a938490/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【深入剖析K8s】第五章 1 为什么我们需要Pod</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/55d8ad2ff13f3180be75b72afe2177f5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Spark编程实验三：Spark SQL编程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>