<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Open CASCADE自定义MeshVS_DataSource - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Open CASCADE自定义MeshVS_DataSource" />
<meta property="og:description" content="由MeshVS_DataSource派生自定义DataSource OCC在DataExchange中提供了.stl数据格式的导入与导出方法。在该类型文件中，模型以三角网格形式存储，OCC为此定义了针对.stl格式文件的数据存储方式，即XSDRAWSTLVRML_DataSource。如下为导入.stl并为其定义显示生成器的方法：
CFileDialog dlg(TRUE, NULL, NULL, OFN_HIDEREADONLY | OFN_OVERWRITEPROMPT, L&#34;stl Files (*.stl)|*.stl;|STL Files (*.STL)|*.STL;||&#34;, NULL); CString SHAREPATHValue; SHAREPATHValue.GetEnvironmentVariable(L&#34;CSF_OCCTDataPath&#34;); CString initdir = (SHAREPATHValue &#43; &#34;\\stl&#34;); dlg.m_ofn.lpstrInitialDir = initdir; if (dlg.DoModal() != IDOK) return; // read the data and create a data source TCollection_AsciiString aFileName((const wchar_t*)dlg.GetPathName()); Handle(Message_ProgressIndicator) aProgInd = Handle(Message_ProgressIndicator)(); Handle(Poly_Triangulation) aSTLMesh = RWStl::ReadFile(aFileName, aProgInd); Handle(XSDRAWSTLVRML_DataSource) aDS = new XSDRAWSTLVRML_DataSource(aSTLMesh); // create mesh Handle(MeshVS_Mesh) aMesh = new MeshVS_Mesh(); aMesh-&gt;SetDataSource(aDS); // use builder Handle(MeshVS_MeshPrsBuilder) aBuilder = new MeshVS_MeshPrsBuilder(aMesh); aMesh-&gt;GetDrawer()-&gt;SetColor(MeshVS_DA_EdgeColor, Quantity_NOC_YELLOW); aMesh-&gt;AddBuilder(aBuilder, Standard_False); myAISContext-&gt;Display(aMesh, Standard_True); Fit(); 如果不是读取STL文件，而是有三角网格的点坐标数据 std::vector&lt; PointXYZ&gt; CoordData 以及点之间的拓扑关系std::vector&lt;std::vector&gt; Ele2NodeData（比如三个点构成一个三角形的索引值），需要自己定义DataSource来显示网格。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/68ea5507ffc56ac6a4ad4449e247add3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-10-26T21:48:11+08:00" />
<meta property="article:modified_time" content="2019-10-26T21:48:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Open CASCADE自定义MeshVS_DataSource</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="MeshVS_DataSourceDataSource_0"></a>由MeshVS_DataSource派生自定义DataSource</h2> 
<p>OCC在DataExchange中提供了.stl数据格式的导入与导出方法。在该类型文件中，模型以三角网格形式存储，OCC为此定义了针对.stl格式文件的数据存储方式，即XSDRAWSTLVRML_DataSource。如下为导入.stl并为其定义显示生成器的方法：</p> 
<pre><code class="prism language-cpp">	CFileDialog <span class="token function">dlg</span><span class="token punctuation">(</span>TRUE<span class="token punctuation">,</span>
		<span class="token constant">NULL</span><span class="token punctuation">,</span>
		<span class="token constant">NULL</span><span class="token punctuation">,</span>
		OFN_HIDEREADONLY <span class="token operator">|</span> OFN_OVERWRITEPROMPT<span class="token punctuation">,</span>
		L<span class="token string">"stl Files (*.stl)|*.stl;|STL Files (*.STL)|*.STL;||"</span><span class="token punctuation">,</span>
		<span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	CString SHAREPATHValue<span class="token punctuation">;</span>
	SHAREPATHValue<span class="token punctuation">.</span><span class="token function">GetEnvironmentVariable</span><span class="token punctuation">(</span>L<span class="token string">"CSF_OCCTDataPath"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	CString initdir <span class="token operator">=</span> <span class="token punctuation">(</span>SHAREPATHValue <span class="token operator">+</span> <span class="token string">"\\stl"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	dlg<span class="token punctuation">.</span>m_ofn<span class="token punctuation">.</span>lpstrInitialDir <span class="token operator">=</span> initdir<span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>dlg<span class="token punctuation">.</span><span class="token function">DoModal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> IDOK<span class="token punctuation">)</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>

	<span class="token comment">// read the data and create a data source</span>
	TCollection_AsciiString <span class="token function">aFileName</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">wchar_t</span><span class="token operator">*</span><span class="token punctuation">)</span>dlg<span class="token punctuation">.</span><span class="token function">GetPathName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Handle</span><span class="token punctuation">(</span>Message_ProgressIndicator<span class="token punctuation">)</span> aProgInd <span class="token operator">=</span> <span class="token function">Handle</span><span class="token punctuation">(</span>Message_ProgressIndicator<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Handle</span><span class="token punctuation">(</span>Poly_Triangulation<span class="token punctuation">)</span> aSTLMesh <span class="token operator">=</span> RWStl<span class="token operator">::</span><span class="token function">ReadFile</span><span class="token punctuation">(</span>aFileName<span class="token punctuation">,</span> aProgInd<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Handle</span><span class="token punctuation">(</span>XSDRAWSTLVRML_DataSource<span class="token punctuation">)</span> aDS <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">XSDRAWSTLVRML_DataSource</span><span class="token punctuation">(</span>aSTLMesh<span class="token punctuation">)</span><span class="token punctuation">;</span>         
	<span class="token comment">// create mesh</span>
	<span class="token function">Handle</span><span class="token punctuation">(</span>MeshVS_Mesh<span class="token punctuation">)</span> aMesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">MeshVS_Mesh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	aMesh<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">SetDataSource</span><span class="token punctuation">(</span>aDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// use builder</span>
	<span class="token function">Handle</span><span class="token punctuation">(</span>MeshVS_MeshPrsBuilder<span class="token punctuation">)</span> aBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">MeshVS_MeshPrsBuilder</span><span class="token punctuation">(</span>aMesh<span class="token punctuation">)</span><span class="token punctuation">;</span>
	aMesh<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">GetDrawer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">SetColor</span><span class="token punctuation">(</span>MeshVS_DA_EdgeColor<span class="token punctuation">,</span> Quantity_NOC_YELLOW<span class="token punctuation">)</span><span class="token punctuation">;</span>
	aMesh<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">AddBuilder</span><span class="token punctuation">(</span>aBuilder<span class="token punctuation">,</span> Standard_False<span class="token punctuation">)</span><span class="token punctuation">;</span>
	myAISContext<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Display</span><span class="token punctuation">(</span>aMesh<span class="token punctuation">,</span> Standard_True<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Fit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>如果不是读取STL文件，而是有三角网格的点坐标数据 std::vector&lt; PointXYZ&gt; CoordData 以及点之间的拓扑关系std::vector&lt;std::vector&gt; Ele2NodeData（比如三个点构成一个三角形的索引值），需要自己定义DataSource来显示网格。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">struct</span> PointXYZ
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">double</span> X<span class="token punctuation">;</span>
	<span class="token keyword">double</span> Y<span class="token punctuation">;</span>
	<span class="token keyword">double</span> Z<span class="token punctuation">;</span>
	<span class="token function">PointXYZ</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		X <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		Y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		Z <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>根据XSDRAWSTLVRML_DataSource派生方法，自定义myDataSource类。添加对应的 myDataSource.h 与myDataSource.cpp，参考XSDRAWSTLVRML_DataSource类，只需要构造函数。具体如下：</p> 
<pre><code class="prism language-cpp"><span class="token comment">// myDataSource.h</span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> once</span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;Standard.hxx&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;Standard_Type.hxx&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;Standard_Real.hxx&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;Standard_Address.hxx&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;Standard_Boolean.hxx&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;Standard_Integer.hxx&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;TColStd_PackedMapOfInteger.hxx&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;TColStd_HArray2OfInteger.hxx&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;TColStd_HArray2OfReal.hxx&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;TColStd_Array1OfReal.hxx&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;TColStd_Array1OfInteger.hxx&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;MeshVS_EntityType.hxx&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;MeshVS_DataSource.hxx&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;Poly_Triangulation.hxx&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">myDataSource</span><span class="token punctuation">;</span>
<span class="token function">DEFINE_STANDARD_HANDLE</span><span class="token punctuation">(</span>myDataSource<span class="token punctuation">,</span> MeshVS_DataSource<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">myDataSource</span><span class="token operator">:</span> <span class="token keyword">public</span> MeshVS_DataSource
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	
	 <span class="token function">myDataSource</span><span class="token punctuation">(</span>std<span class="token operator">::</span>vector<span class="token operator">&lt;</span> PointXYZ<span class="token operator">&gt;</span> CoordData<span class="token punctuation">,</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;&gt;</span> Ele2NodeData<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//! Returns geometry information about node ( if IsElement is False ) or element ( IsElement is True )</span>
	<span class="token comment">//! by co-ordinates. For element this method must return all its nodes co-ordinates in the strict order: X, Y, Z and</span>
	<span class="token comment">//! with nodes order is the same as in wire bounding the face or link. NbNodes is number of nodes of element.</span>
	<span class="token comment">//! It is recommended to return 1 for node. Type is an element type.</span>
	  Standard_Boolean <span class="token function">GetGeom</span><span class="token punctuation">(</span><span class="token keyword">const</span> Standard_Integer ID<span class="token punctuation">,</span> <span class="token keyword">const</span> Standard_Boolean IsElement<span class="token punctuation">,</span> TColStd_Array1OfReal<span class="token operator">&amp;</span> Coords<span class="token punctuation">,</span> Standard_Integer<span class="token operator">&amp;</span> NbNodes<span class="token punctuation">,</span> MeshVS_EntityType<span class="token operator">&amp;</span> Type<span class="token punctuation">)</span> <span class="token keyword">const</span> Standard_OVERRIDE<span class="token punctuation">;</span>

	 <span class="token comment">//! This method is similar to GetGeom, but returns only element or node type. This method is provided for</span>
	 <span class="token comment">//! a fine performance.</span>
	  Standard_Boolean <span class="token function">GetGeomType</span><span class="token punctuation">(</span><span class="token keyword">const</span> Standard_Integer ID<span class="token punctuation">,</span> <span class="token keyword">const</span> Standard_Boolean IsElement<span class="token punctuation">,</span> MeshVS_EntityType<span class="token operator">&amp;</span> Type<span class="token punctuation">)</span> <span class="token keyword">const</span> Standard_OVERRIDE<span class="token punctuation">;</span>

	 <span class="token comment">//! This method returns by number an address of any entity which represents element or node data structure.</span>
	  Standard_Address <span class="token function">GetAddr</span><span class="token punctuation">(</span><span class="token keyword">const</span> Standard_Integer ID<span class="token punctuation">,</span> <span class="token keyword">const</span> Standard_Boolean IsElement<span class="token punctuation">)</span> <span class="token keyword">const</span> Standard_OVERRIDE<span class="token punctuation">;</span>

	 <span class="token comment">//! This method returns information about what node this element consist of.</span>
	  <span class="token keyword">virtual</span> Standard_Boolean <span class="token function">GetNodesByElement</span><span class="token punctuation">(</span><span class="token keyword">const</span> Standard_Integer ID<span class="token punctuation">,</span> TColStd_Array1OfInteger<span class="token operator">&amp;</span> NodeIDs<span class="token punctuation">,</span> Standard_Integer<span class="token operator">&amp;</span> NbNodes<span class="token punctuation">)</span> <span class="token keyword">const</span> Standard_OVERRIDE<span class="token punctuation">;</span>

	 <span class="token comment">//! This method returns map of all nodes the object consist of.</span>
	  <span class="token keyword">const</span> TColStd_PackedMapOfInteger<span class="token operator">&amp;</span> <span class="token function">GetAllNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> Standard_OVERRIDE<span class="token punctuation">;</span>

	 <span class="token comment">//! This method returns map of all elements the object consist of.</span>
	  <span class="token keyword">const</span> TColStd_PackedMapOfInteger<span class="token operator">&amp;</span> <span class="token function">GetAllElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> Standard_OVERRIDE<span class="token punctuation">;</span>

	 <span class="token comment">//! This method calculates normal of face, which is using for correct reflection presentation.</span>
	 <span class="token comment">//! There is default method, for advance reflection this method can be redefined.</span>
	  <span class="token keyword">virtual</span> Standard_Boolean <span class="token function">GetNormal</span><span class="token punctuation">(</span><span class="token keyword">const</span> Standard_Integer Id<span class="token punctuation">,</span> <span class="token keyword">const</span> Standard_Integer Max<span class="token punctuation">,</span> Standard_Real<span class="token operator">&amp;</span> nx<span class="token punctuation">,</span> Standard_Real<span class="token operator">&amp;</span> ny<span class="token punctuation">,</span> Standard_Real<span class="token operator">&amp;</span> nz<span class="token punctuation">)</span> <span class="token keyword">const</span> Standard_OVERRIDE<span class="token punctuation">;</span>



	<span class="token function">DEFINE_STANDARD_RTTIEXT</span><span class="token punctuation">(</span>myDataSource<span class="token punctuation">,</span> MeshVS_DataSource<span class="token punctuation">)</span>

<span class="token keyword">protected</span><span class="token operator">:</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	TColStd_PackedMapOfInteger myNodes<span class="token punctuation">;</span>
	TColStd_PackedMapOfInteger myElements<span class="token punctuation">;</span>
	<span class="token function">Handle</span><span class="token punctuation">(</span>TColStd_HArray2OfInteger<span class="token punctuation">)</span> myElemNodes<span class="token punctuation">;</span>
	<span class="token function">Handle</span><span class="token punctuation">(</span>TColStd_HArray2OfReal<span class="token punctuation">)</span> myNodeCoords<span class="token punctuation">;</span>
	<span class="token function">Handle</span><span class="token punctuation">(</span>TColStd_HArray2OfReal<span class="token punctuation">)</span> myElemNormals<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


</code></pre> 
<p>在构造函数myDataSource（）中，需要赋值的主要有五个，即Private中所定义的参数。myNodes，myElements分别存储顶点、网格单元的索引号，要注意的是，起始序号从1开始。myNodeCoords是一个 CoordData.size() x 3 的矩阵，每一行为点的x，y，z坐标。myElemNodes存储每一个三角网格对应的顶点索引值。而myElemNormals为每一个三角网格的法向量，在需要区分三角网格正反面属性时有用。除了构造函数之外其他重写的函数不需要做改动。</p> 
<pre><code class="prism language-cpp"><span class="token comment">// myDataSource.cpp</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"myDataSource.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;Precision.hxx&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;Standard_Type.hxx&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;TColgp_SequenceOfXYZ.hxx&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;TColStd_DataMapOfIntegerInteger.hxx&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;TColStd_DataMapOfIntegerReal.hxx&gt;</span></span>

<span class="token function">IMPLEMENT_STANDARD_RTTIEXT</span><span class="token punctuation">(</span>myDataSource<span class="token punctuation">,</span> MeshVS_DataSource<span class="token punctuation">)</span>

myDataSource<span class="token operator">::</span><span class="token function">myDataSource</span><span class="token punctuation">(</span>std<span class="token operator">::</span>vector<span class="token operator">&lt;</span> PointXYZ<span class="token operator">&gt;</span> CoordData<span class="token punctuation">,</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;&gt;</span> Ele2NodeData<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	myNodeCoords <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">TColStd_HArray2OfReal</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> CoordData<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> CoordData<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			myNodes<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
			myNodeCoords<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">SetValue</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> CoordData<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>X<span class="token punctuation">)</span><span class="token punctuation">;</span>
			myNodeCoords<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">SetValue</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> CoordData<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span>
			myNodeCoords<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">SetValue</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> CoordData<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Z<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		myElemNormals <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">TColStd_HArray2OfReal</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> Ele2NodeData<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		myElemNodes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">TColStd_HArray2OfInteger</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> Ele2NodeData<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
		<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> Ele2NodeData<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			myElements<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Standard_Integer index <span class="token operator">=</span> Ele2NodeData<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
				myElemNodes<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">SetValue</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>		
			myElemNormals<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">SetValue</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			myElemNormals<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">SetValue</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			myElemNormals<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">SetValue</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//================================================================</span>
<span class="token comment">// Function : GetGeom</span>
<span class="token comment">// Purpose  :</span>
<span class="token comment">//================================================================</span>
Standard_Boolean myDataSource<span class="token operator">::</span>GetGeom
<span class="token punctuation">(</span><span class="token keyword">const</span> Standard_Integer ID<span class="token punctuation">,</span> <span class="token keyword">const</span> Standard_Boolean IsElement<span class="token punctuation">,</span>
TColStd_Array1OfReal<span class="token operator">&amp;</span> Coords<span class="token punctuation">,</span> Standard_Integer<span class="token operator">&amp;</span> NbNodes<span class="token punctuation">,</span>
MeshVS_EntityType<span class="token operator">&amp;</span> Type<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>IsElement<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>ID <span class="token operator">&gt;=</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> ID <span class="token operator">&lt;=</span> myElements<span class="token punctuation">.</span><span class="token function">Extent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			Type <span class="token operator">=</span> MeshVS_ET_Face<span class="token punctuation">;</span>
			NbNodes <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

			<span class="token keyword">for</span> <span class="token punctuation">(</span>Standard_Integer i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> k <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Standard_Integer IdxNode <span class="token operator">=</span> myElemNodes<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Value</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span>Standard_Integer j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">,</span> k<span class="token operator">++</span><span class="token punctuation">)</span>
					<span class="token function">Coords</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">=</span> myNodeCoords<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Value</span><span class="token punctuation">(</span>IdxNode<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">return</span> Standard_True<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
			<span class="token keyword">return</span> Standard_False<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>ID <span class="token operator">&gt;=</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> ID <span class="token operator">&lt;=</span> myNodes<span class="token punctuation">.</span><span class="token function">Extent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Type <span class="token operator">=</span> MeshVS_ET_Node<span class="token punctuation">;</span>
		NbNodes <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

		<span class="token function">Coords</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> myNodeCoords<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Value</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">Coords</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> myNodeCoords<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Value</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">Coords</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=</span> myNodeCoords<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Value</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> Standard_True<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
		<span class="token keyword">return</span> Standard_False<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//================================================================</span>
<span class="token comment">// Function : GetGeomType</span>
<span class="token comment">// Purpose  :</span>
<span class="token comment">//================================================================</span>
Standard_Boolean myDataSource<span class="token operator">::</span>GetGeomType
<span class="token punctuation">(</span><span class="token keyword">const</span> Standard_Integer<span class="token punctuation">,</span>
<span class="token keyword">const</span> Standard_Boolean IsElement<span class="token punctuation">,</span>
MeshVS_EntityType<span class="token operator">&amp;</span> Type<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>IsElement<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Type <span class="token operator">=</span> MeshVS_ET_Face<span class="token punctuation">;</span>
		<span class="token keyword">return</span> Standard_True<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{<!-- --></span>
		Type <span class="token operator">=</span> MeshVS_ET_Node<span class="token punctuation">;</span>
		<span class="token keyword">return</span> Standard_True<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//================================================================</span>
<span class="token comment">// Function : GetAddr</span>
<span class="token comment">// Purpose  :</span>
<span class="token comment">//================================================================</span>
Standard_Address myDataSource<span class="token operator">::</span>GetAddr
<span class="token punctuation">(</span><span class="token keyword">const</span> Standard_Integer<span class="token punctuation">,</span> <span class="token keyword">const</span> Standard_Boolean<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//================================================================</span>
<span class="token comment">// Function : GetNodesByElement</span>
<span class="token comment">// Purpose  :</span>
<span class="token comment">//================================================================</span>
Standard_Boolean myDataSource<span class="token operator">::</span>GetNodesByElement
<span class="token punctuation">(</span><span class="token keyword">const</span> Standard_Integer ID<span class="token punctuation">,</span>
TColStd_Array1OfInteger<span class="token operator">&amp;</span> theNodeIDs<span class="token punctuation">,</span>
Standard_Integer<span class="token operator">&amp;</span> <span class="token comment">/*theNbNodes*/</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>ID <span class="token operator">&gt;=</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> ID <span class="token operator">&lt;=</span> myElements<span class="token punctuation">.</span><span class="token function">Extent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> theNodeIDs<span class="token punctuation">.</span><span class="token function">Length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">3</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Standard_Integer aLow <span class="token operator">=</span> theNodeIDs<span class="token punctuation">.</span><span class="token function">Lower</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">theNodeIDs</span><span class="token punctuation">(</span>aLow<span class="token punctuation">)</span> <span class="token operator">=</span> myElemNodes<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Value</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">theNodeIDs</span><span class="token punctuation">(</span>aLow <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> myElemNodes<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Value</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">theNodeIDs</span><span class="token punctuation">(</span>aLow <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> myElemNodes<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Value</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> Standard_True<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> Standard_False<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//================================================================</span>
<span class="token comment">// Function : GetAllNodes</span>
<span class="token comment">// Purpose  :</span>
<span class="token comment">//================================================================</span>
<span class="token keyword">const</span> TColStd_PackedMapOfInteger<span class="token operator">&amp;</span> myDataSource<span class="token operator">::</span><span class="token function">GetAllNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> myNodes<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//================================================================</span>
<span class="token comment">// Function : GetAllElements</span>
<span class="token comment">// Purpose  :</span>
<span class="token comment">//================================================================</span>
<span class="token keyword">const</span> TColStd_PackedMapOfInteger<span class="token operator">&amp;</span> myDataSource<span class="token operator">::</span><span class="token function">GetAllElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> myElements<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//================================================================</span>
<span class="token comment">// Function : GetNormal</span>
<span class="token comment">// Purpose  :</span>
<span class="token comment">//================================================================</span>
Standard_Boolean myDataSource<span class="token operator">::</span>GetNormal
<span class="token punctuation">(</span><span class="token keyword">const</span> Standard_Integer Id<span class="token punctuation">,</span> <span class="token keyword">const</span> Standard_Integer Max<span class="token punctuation">,</span>
Standard_Real<span class="token operator">&amp;</span> nx<span class="token punctuation">,</span> Standard_Real<span class="token operator">&amp;</span> ny<span class="token punctuation">,</span> Standard_Real<span class="token operator">&amp;</span> nz<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>Id <span class="token operator">&gt;=</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> Id <span class="token operator">&lt;=</span> myElements<span class="token punctuation">.</span><span class="token function">Extent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> Max <span class="token operator">&gt;=</span> <span class="token number">3</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		nx <span class="token operator">=</span> myElemNormals<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Value</span><span class="token punctuation">(</span>Id<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		ny <span class="token operator">=</span> myElemNormals<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Value</span><span class="token punctuation">(</span>Id<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		nz <span class="token operator">=</span> myElemNormals<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Value</span><span class="token punctuation">(</span>Id<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> Standard_True<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
		<span class="token keyword">return</span> Standard_False<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>前面所述为根据OCC提供源代码定义自己三角网格数据显示的方法，当需要显示体单元时，参考XSDRAWSTLVRML_DataSource3D类。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/94a2831c23239fe176ea7cc5a3ef24d7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">LWIP接收发送数据时间间隔设置</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/703f471995bf2065fa0727b6535d4273/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">为什么2&gt;1&gt;3为false？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>