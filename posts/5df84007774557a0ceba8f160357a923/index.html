<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>crui_lvgl 一个LVGL的DSL辅助工具的设想 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="crui_lvgl 一个LVGL的DSL辅助工具的设想" />
<meta property="og:description" content="设想 Target以LVGL为目标，语法以CSS为Reference。
CSS 规范 略
CSS规范最强大的属于CSS自身的属性很多，可以通过class和伪属性选择器对UI进行直接控制。
QML规范 ApplicationWindow { visible: true width: Constants.width height: Constants.height title: qsTr(&#34;Coffee&#34;) ApplicationFlowForm { id: applicationFlow state: &#34;initial&#34; property int animationDuration: 400 choosingCoffee.brewButtonSelection.onClicked: { applicationFlow.state = &#34;settings&#34; } } Image { id: root source: &#34;images/icons/coffees/cappucino.png&#34; signal clicked property int duration: 250 property alias text: label.text MouseArea { anchors.fill: parent onClicked: root.clicked() onPressed: { glow.visible = true animation1.start() animation2.start() } } Rectangle { id: glow visible: false width: 250 height: 250 color: &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/5df84007774557a0ceba8f160357a923/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-29T10:41:01+08:00" />
<meta property="article:modified_time" content="2023-11-29T10:41:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">crui_lvgl 一个LVGL的DSL辅助工具的设想</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>设想</h2> 
<p>Target以LVGL为目标，语法以CSS为Reference。</p> 
<h2><a id="CSS__3"></a>CSS 规范</h2> 
<p>略</p> 
<p>CSS规范最强大的属于CSS自身的属性很多，可以通过class和伪属性选择器对UI进行直接控制。</p> 
<h2><a id="QML_8"></a>QML规范</h2> 
<pre><code class="prism language-qml">ApplicationWindow {
    visible: true
    width: Constants.width
    height: Constants.height
    title: qsTr("Coffee")
    
    ApplicationFlowForm {
      id: applicationFlow
      state: "initial"

      property int animationDuration: 400

      choosingCoffee.brewButtonSelection.onClicked: {
          applicationFlow.state = "settings"
      }
    }  
    
    Image {
        id: root
        source: "images/icons/coffees/cappucino.png"
        signal clicked

        property int duration: 250
        property alias text: label.text
        MouseArea {
            anchors.fill: parent
            onClicked: root.clicked()
            onPressed: {
                glow.visible = true
                animation1.start()
                animation2.start()
            }
        }

        Rectangle {
            id: glow
            visible: false

            width: 250
            height: 250
            color: "#00000000"
            radius: 125
            scale: 1.05
            border.color: "#ffffff"
        }

        Label {
            id: label
            x: 292
            y: 252
            text: qsTr("Label")
            anchors.horizontalCenter: parent.horizontalCenter
            color: "#443224"
            font.family: Constants.fontFamily
            font.pixelSize: 28
        }
    }

}
</code></pre> 
<h2><a id="Slint_Demo_72"></a>Slint Demo</h2> 
<p>Slint本身来源于QML, flutter 等项目，吸收优化得到的Design。</p> 
<pre><code class="prism language-qml">import { Button } from "std-widgets.slint";
export component MainWindow inherits Window {
  height: 720px;
  width: 1200px;
  title: "Button!";
  Button { 
    height: 66px;
    width: 310px;
    icon: @image-url("../../imgs/rust.png");
    text: "I am a Button";
    clicked =&gt; {
      self.text = "Clicked!";
      self.width = 360px;
    }
  }
  
  GridLayout {
    spacing: 10px;
    padding: 4px;
    //使用Row进行行声明
    Row{
      Rectangle { background: red; }
      Rectangle { background: yellow;}
      Rectangle { background: pink; }
    }
    Row{
      Rectangle { background: white; colspan: 2; }
      Rectangle { background: green; colspan: 1; col: 2;} 
    }
    Rectangle { background: violet; colspan: 3;row:3;}
    Rectangle { background: orange; colspan: 3;row:2;}
  }
}
</code></pre> 
<p>QML和Slint是将CSS的属性选择等能力，作为Object的属性存在，单独设定。虽然一定程度上解决了UI复用问题，但是不灵活。</p> 
<p>QML胜在周边成熟，与Qt Object高度绑定，代码融合比较简单。Slint反而优点不伦不类，没有生态支撑，但是IDE配套做的不错，比LVGL好太多。</p> 
<h2><a id="LVGL_117"></a>LVGL规范</h2> 
<ul><li>Demos https://docs.lvgl.io/master/examples.html</li><li>Object基础属性 https://docs.lvgl.io/master/widgets/obj.html#overview</li><li>Theme和定制 https://docs.lvgl.io/master/overview/style.html#themes</li></ul> 
<pre><code class="prism language-bash"><span class="token comment"># demo1, label</span>
<span class="token function">screen</span>
    *color
    label
        *text
        *color
        
<span class="token comment"># demo2, button</span>
<span class="token function">screen</span>
    button
        *pos
        *size
        *event  <span class="token comment"># &lt;== 这里进行事件绑定  </span>
        label
            *text
            *align
            
<span class="token comment"># demo3, flex</span>
<span class="token function">screen</span>
    object1
        *size
        *align
        *flex
        button*N
            *size
            label
                *text
                *algin
    object2
        *size
        *align
        *flex
        button*N
            *size
            label
                *text
                *algin
       
<span class="token comment"># demo4, grid</span>
<span class="token function">screen</span>
    object
        *grid
        *size
        *algin
        *layout_grid    
        button*N
            label
                *text
                *align     
                
<span class="token comment"># style, == class</span>
style
    *radius
    *bg_opa
    *bg_color
    *border_width
    *border_color
    <span class="token comment"># ...</span>

<span class="token function">screen</span>
    object
        *style
        image
            *algin

<span class="token comment"># theme</span>
default_theme

theme2
    style
    
<span class="token function">screen</span>
    button   
        *align
        label
            *text
    button<span class="token punctuation">(</span>theme2<span class="token punctuation">)</span>  <span class="token comment"># change theme</span>
        *align
        label
            *text
</code></pre> 
<p>总结：</p> 
<ol><li>Screen为root, 但是可以有多个，每次选一个作为default。</li><li>每个Screen有2个Layer层，但是用户一般只用top layer。(一般coding时，不用在乎这个问题)</li><li>Layer(screen)内部可以自由组合 Object/Widgets, 每个Object/Widget 可以自由设定Layout为Grid/Flex/Absolute(默认)</li><li>每个Object/Widget都有默认的style(来源于默认的theme)，可以自己custom style给object/widget使用。</li><li>Theme是各种style的集合，也可以继承或者自己custom.</li><li>字体和图片需要转换后才能使用。中文支持需要添加中文字体。屏幕键盘默认不支持中文。</li></ol> 
<p>与QML/Slint比，没有DSL部分，全是C/C++ Code生成，也没有Nodejs/Go/Rust等binding部分(部分有，但不成熟)。有theme和style部分，很接近CSS的味道，但是没有DSL的加持，写起来很痛苦。</p> 
<p>一句话：<em>LVGL是个灵活的胖子!</em></p> 
<h2><a id="_218"></a>想法</h2> 
<h3><a id="Idea_Target_219"></a>Idea Target</h3> 
<p>鉴于Slint和QML的授权协议，在嵌入式设备上收费，还有Rust/Qt的依赖问题，如果能有一个DSL和对应的C code tool, LVGL应该回是一个不错的选择。</p> 
<p>所以，向借鉴Slint的VS Code插件，能不能仿照Vue、React一类的用法，将CSS和template一起渲染为C Code, 并绑定event，还支持UI的preview in design？</p> 
<p>如果能做这样一个插件，并且提供LVGL工具库，支持UI动态Load, 这将会是一个非常不错的主意，并且对Coding有很大的帮助。</p> 
<p>如果这个工具支持的DSL语法类似QML更好，不支持也尽量类似。</p> 
<p>以上，于2023年11月28日。</p> 
<h3><a id="Design_230"></a>Design</h3> 
<ol><li>[v] Kotlin DSL有类似的感觉</li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> 自己做解析，难以支持语法检查和扩展</li><li>[?] 不知道QML的那种解析怎么实现的</li><li>[v] template 模拟vue/json那种</li></ol> 
<p>参考：Groovy =&gt; Gradle</p> 
<p>使用：Kotlin native + kts + ffi(DSL+LVGL)</p> 
<ul><li>先实现PC平台的调用</li><li>然后做一个<code>xxx.lvgl</code>的实时预览和代码生成</li><li>然后做一个开源库，LVGL辅助库函数</li></ul> 
<p>deadline: 2024/06/28, name: crui_lvgl</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1b92b0e8e87d8f8755551a9c803fa8ea/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">微信小程序本地和真机调试文件上传成功但体验版不成功</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8d43add4e23903f550e7f0c8c5bcc600/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">运行芋道代码，Cannot find module @rollup/rollup-win32-x64-msvc. 报错</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>