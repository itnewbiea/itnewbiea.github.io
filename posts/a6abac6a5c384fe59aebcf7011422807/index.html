<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Java集群实战：单体架构升级到集群架构（一）使用NGINX建立集群 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Java集群实战：单体架构升级到集群架构（一）使用NGINX建立集群" />
<meta property="og:description" content="Java集群实战：单体架构升级到集群架构（二）实现session共享
Java集群实战：单体架构升级到集群架构（三）上传文件的共享
Java集群实战：单体架构升级到集群架构（四）使用REDIS分布式锁
Java集群实战：单体架构升级到集群架构（五）定时任务
Java集群实战：单体架构升级到集群架构（六）分布式缓存REDIS
对于大厂的IT技术人员来说，微服务架构是天天都在使用，滚瓜烂熟了。而对小厂的菜鸟程序员来说，我们天天做的都是CRUD，对我们来说集群、分布式、微服务也只是头脑中一个模糊的概念。我们写的大多是单体架构的系统，运行在一台服务器上，如果用户量增加了，服务器撑不住了，我们就加配置吧，反正阿里云腾讯云现在加配置也很容易。但是如果有一天（希望所有菜鸟都有这么一天），我们的用户数增加太快太多，使用最高配置的服务器还是撑不住，对我们来说这算不算是幸福的烦恼？――幸福的是老板，烦恼的却是我们。
这种情况下，我们想到了使用微服务，于我们开始学习spring cloud alibaba，就是不知道在我们学会之前，我们的服务器要崩溃多少次，就怕老板一生气把我们杀了祭天。所以说临时抱佛脚是不行的，学习要趁早！那么这时候，什么才是比较快的解决方法呢？我想可能就是使用集群架构。集群架构学起来相对容易，代码修改量也会少一些。
今天我们首先来建一个简单的集群，如下图所示：
总共三台电脑，一台安装NGINX，两台安装TOMCAT。这两个TOMCAT运行我们的单体应用程序，NGINX接受浏览器发来的请求，再把请求轮流转发给其中一台TOMCAT处理。如果您不理解这段话，也没关系，咱们开始动手操作，做完之后，你就明白了。没有三台电脑的同学，可以用虚拟机。要么就在一台电脑上操作也行，这时两个IP都要改成127.0.0.1
GitHub: GitHub - Dengxd/JavaCluster 所有源码都在这里，GitHub经常连不上，要多刷新几次
安装NGINX 因为所有程序员都会用WINDOWS，而有部分程序员不会用LINUX，所以我选择了WINDOWS7来安装。
NGINX下载地址：nginx: download
Stable version是稳定版，选择这个版本。下载下来是一个文件nginx-1.22.1.zip，解压之后，如下图所示：
打开文件夹conf里面的nginx.conf文件，找到这几行：
server { listen 80; server_name localhost; #charset koi8-r; #access_log logs/host.access.log main; location / { root html; index index.html index.htm; } 改成这样：
upstream mytomcat { server 192.168.1.200:8000; server 192.168.1.201:8001; } server { listen 80; server_name localhost; #charset koi8-r; #access_log logs/host.access.log main; location / { proxy_pass http://mytomcat; } 保存一下，NGINX就配置好了。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/a6abac6a5c384fe59aebcf7011422807/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-02T09:02:11+08:00" />
<meta property="article:modified_time" content="2023-04-02T09:02:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Java集群实战：单体架构升级到集群架构（一）使用NGINX建立集群</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:.0001pt;text-align:justify;"><a class="link-info" href="https://blog.csdn.net/dengxiaodai/article/details/129707451?spm=1001.2014.3001.5501" title="Java集群实战：单体架构升级到集群架构（二）实现session共享">Java集群实战：单体架构升级到集群架构（二）实现session共享</a></p> 
<p style="margin-left:.0001pt;text-align:justify;"><a class="link-info" href="https://blog.csdn.net/dengxiaodai/article/details/129707609?spm=1001.2014.3001.5501" title="Java集群实战：单体架构升级到集群架构（三）上传文件的共享">Java集群实战：单体架构升级到集群架构（三）上传文件的共享</a></p> 
<p style="margin-left:.0001pt;text-align:justify;"><a class="link-info" href="https://blog.csdn.net/dengxiaodai/article/details/129707740?spm=1001.2014.3001.5501" title="Java集群实战：单体架构升级到集群架构（四）使用REDIS分布式锁">Java集群实战：单体架构升级到集群架构（四）使用REDIS分布式锁</a></p> 
<p style="margin-left:.0001pt;text-align:justify;"><a class="link-info" href="https://blog.csdn.net/dengxiaodai/article/details/129707851?spm=1001.2014.3001.5501" title="Java集群实战：单体架构升级到集群架构（五）定时任务">Java集群实战：单体架构升级到集群架构（五）定时任务</a></p> 
<p style="margin-left:.0001pt;text-align:justify;"><a class="link-info" href="https://blog.csdn.net/dengxiaodai/article/details/129901783?spm=1001.2014.3001.5501" title="Java集群实战：单体架构升级到集群架构（六）分布式缓存REDIS">Java集群实战：单体架构升级到集群架构（六）分布式缓存REDIS</a></p> 
<p style="margin-left:.0001pt;text-align:justify;">对于大厂的IT技术人员来说，微服务架构是天天都在使用，滚瓜烂熟了。而对小厂的菜鸟程序员来说，我们天天做的都是CRUD，对我们来说集群、分布式、微服务也只是头脑中一个模糊的概念。我们写的大多是单体架构的系统，运行在一台服务器上，如果用户量增加了，服务器撑不住了，我们就加配置吧，反正阿里云腾讯云现在加配置也很容易。但是如果有一天（希望所有菜鸟都有这么一天），我们的用户数增加太快太多，使用最高配置的服务器还是撑不住，对我们来说这算不算是幸福的烦恼？――幸福的是老板，烦恼的却是我们。</p> 
<p style="margin-left:.0001pt;text-align:justify;">这种情况下，我们想到了使用微服务，于我们开始学习spring cloud alibaba，就是不知道在我们学会之前，我们的服务器要崩溃多少次，就怕老板一生气把我们杀了祭天。所以说临时抱佛脚是不行的，学习要趁早！那么这时候，什么才是比较快的解决方法呢？我想可能就是使用集群架构。集群架构学起来相对容易，代码修改量也会少一些。</p> 
<p style="margin-left:.0001pt;text-align:justify;">今天我们首先来建一个简单的集群，如下图所示：</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="334" src="https://images2.imgbox.com/ae/d8/hk31pHNl_o.png" width="605"></p> 
<p></p> 
<p style="margin-left:.0001pt;text-align:justify;">总共三台电脑，一台安装NGINX，两台安装TOMCAT。这两个TOMCAT运行我们的单体应用程序，NGINX接受浏览器发来的请求，再把请求轮流转发给其中一台TOMCAT处理。如果您不理解这段话，也没关系，咱们开始动手操作，做完之后，你就明白了。没有三台电脑的同学，可以用虚拟机。<span style="color:#ff0000;">要么就在一台电脑上操作也行，这时两个</span><span style="color:#ff0000;">IP</span><span style="color:#ff0000;">都要改成</span><span style="color:#ff0000;">127.0.0.1</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#ff0000;">GitHub:  <a href="https://github.com/Dengxd/JavaCluster" title="GitHub - Dengxd/JavaCluster">GitHub - Dengxd/JavaCluster</a>  </span><span style="color:#ff0000;">所有源码都在这里，</span><span style="color:#ff0000;">GitHub</span><span style="color:#ff0000;">经常连不上，要多刷新几次</span></p> 
<h2 style="text-align:justify;">安装NGINX</h2> 
<p style="margin-left:.0001pt;text-align:justify;">因为所有程序员都会用WINDOWS，而有部分程序员不会用LINUX，所以我选择了WINDOWS7来安装。</p> 
<p style="margin-left:.0001pt;text-align:justify;">NGINX下载地址：<a href="http://nginx.org/en/download.html" rel="nofollow" title="nginx: download">nginx: download</a></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="454" src="https://images2.imgbox.com/b9/e6/W3Ne8tMr_o.png" width="562"></p> 
<p></p> 
<p style="margin-left:.0001pt;text-align:justify;">Stable version是稳定版，选择这个版本。下载下来是一个文件nginx-1.22.1.zip，解压之后，如下图所示：</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="333" src="https://images2.imgbox.com/b5/b8/wBKMk4wp_o.png" width="368"></p> 
<p></p> 
<p style="margin-left:.0001pt;text-align:justify;">打开文件夹conf里面的nginx.conf文件，找到这几行：</p> 
<pre><code>server {
        listen       80;
        server_name  localhost;

        #charset koi8-r;

        #access_log  logs/host.access.log  main;

        location / {
            root   html;
            index  index.html index.htm;
        }
</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;">改成这样：</p> 
<pre><code>upstream mytomcat {
		server 192.168.1.200:8000;
		server 192.168.1.201:8001;
    }
    server {
        listen       80;
		server_name  localhost;
		
        #charset koi8-r;

        #access_log  logs/host.access.log  main;

        location / {
            proxy_pass http://mytomcat;
        }
</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;">保存一下，NGINX就配置好了。</p> 
<p style="margin-left:.0001pt;text-align:justify;">在这几行代码里</p> 
<p style="margin-left:.0001pt;text-align:justify;">server 192.168.1.200:8000;</p> 
<p style="margin-left:.0001pt;text-align:justify;">server 192.168.1.201:8001;</p> 
<p style="margin-left:.0001pt;text-align:justify;">这两行就是我们两个TOMCAT的IP和端口，如果你要多加几个TOMCAT，直接多加几行就可以了。如果你没有三台电脑，<span style="color:#ff0000;">只在一台电脑上操作，就把两个</span><span style="color:#ff0000;">IP</span><span style="color:#ff0000;">地址都改成</span><span style="color:#ff0000;">127.0.0.1</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#ff0000;">注意事项：在生产环境，</span><span style="color:#ff0000;">server_name  localhost; </span><span style="color:#ff0000;">这一行要把</span><span style="color:#ff0000;">localhost</span><span style="color:#ff0000;">改成您的域名</span></p> 
<p style="margin-left:.0001pt;text-align:justify;">mytomcat其实就是给集群起个名字，可以按自己的习惯取名，这个名字会用在这一行：proxy_pass http://mytomcat;</p> 
<p style="margin-left:.0001pt;text-align:justify;">改完之后要测试配置文件nginx.conf是否正确</p> 
<p style="margin-left:.0001pt;text-align:justify;">使用nginx –t 命令进行测试：</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="442" src="https://images2.imgbox.com/b3/1d/7XmZP9J6_o.png" width="677"></p> 
<p></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">如上图，出现“syntax is ok”，“test is successful”就说明测试成功，如果没出现这两行，就说明nginx.conf有错误，要修改错误直至测试成功。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h2 style="margin-left:.0001pt;text-align:justify;">写个简单的单体程序</h2> 
<p style="margin-left:.0001pt;text-align:justify;">这个程序使用Spring boot框架，这货自带了TOMCAT，省了不少麻烦。程序的功能是在网页上显示端口号，要么显示8000，要么显示8001</p> 
<p style="margin-left:.0001pt;text-align:justify;">主要代码如下：</p> 
<pre><code class="language-java">static String port;
public static void main(String[] args) throws Exception{
    SpringApplication app = new SpringApplication(MainApplication.class);
    Environment env = app.run(args).getEnvironment();
    port=env.getProperty("server.port");//获取端口号
    System.out.println(port);
}

@RequestMapping("/")
@ResponseBody
public String test(HttpServletRequest request, HttpServletResponse response){
    return port;//返回端口号
}
</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;">main方法在启动程序的时候获取端口号，test方法在用户访问时返回端口号</p> 
<h2 style="margin-left:.0001pt;text-align:justify;">在两台业务服务器上运行程序</h2> 
<p style="margin-left:.0001pt;text-align:justify;">我们把程序打包，复制到两台Tomcat业务服务器上。</p> 
<p style="margin-left:.0001pt;text-align:justify;">IP为182.168.1.200那台服务器用命令：java -jar ShowPort-1.0-SNAPSHOT.jar  --server.port=8000 启动程序。然后在服务器上用浏览器访问：<a href="http://localhost:8000/" rel="nofollow" title="http://localhost:8000/">http://localhost:8000/</a>  ，如果网页显示8000，就说明程序正常：</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="132" src="https://images2.imgbox.com/20/8b/J6y9DoSe_o.png" width="244"></p> 
<p></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">IP为182.168.1.201那台服务器用命令：java -jar ShowPort-1.0-SNAPSHOT.jar  --server.port=8001 启动程序。然后在服务器上用浏览器访问：<a href="http://localhost:8001/" rel="nofollow" title="http://localhost:8001/">http://localhost:8001/</a>  ，如果网页显示8001，就说明程序正常。</p> 
<h2 style="text-align:justify;">在NGINX服务器上启动NGINX</h2> 
<p style="margin-left:.0001pt;text-align:justify;">使用命令nginx启动服务:</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="442" src="https://images2.imgbox.com/bb/59/o8b49WNC_o.png" width="663"></p> 
<p></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">注意：如果您想停止NGINX，不能直接关掉这个CMD窗口。您得再开一个CMD窗口，然后用命令nginx -s stop才能能关闭NGINX:</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="442" src="https://images2.imgbox.com/77/ed/d9uUvUaR_o.png" width="677"></p> 
<p></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h2 style="text-align:justify;">在NGINX服务器上测试集群</h2> 
<p style="margin-left:.0001pt;text-align:justify;">现在我们在NGINX那台服务器上启动浏览器，输入网址：<a href="http://localhost/" rel="nofollow" title="http://localhost/">http://localhost/</a>   ，</p> 
<p style="margin-left:.0001pt;text-align:justify;">可以看到网页显示8001 :</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="165" src="https://images2.imgbox.com/fc/eb/R7l5BnwH_o.png" width="245"></p> 
<p></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">我们在浏览器里多开几个标签页，就会看到有的显示8000，有的显示8001</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="218" src="https://images2.imgbox.com/ca/8e/6iGUnijP_o.png" width="546"></p> 
<p></p> 
<p>这样，我们的集群就配置成功了。下回我们来实现session共享。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/27414b7e6cd999ea530b794abf166388/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">十进制整数N转换成R进制数</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0aa50075a848c1b5bfef31022b40f47c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java集群实战：单体架构升级到集群架构（四）使用REDIS分布式锁</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>