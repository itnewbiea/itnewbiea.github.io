<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>yolov5 安全帽检测 全流程 全资源 技术交流（相互学习）！！！ - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="yolov5 安全帽检测 全流程 全资源 技术交流（相互学习）！！！" />
<meta property="og:description" content="yolov5 做安全帽检测示例 （全流程、全资源） 文章目录 yolov5 做安全帽检测示例 （全流程、全资源）前言一、追根溯源：目标检测框架 yolov5二、言归正传：软硬件环境搭建我的硬件：软件环境 三、闪转腾挪：闭坑关键点四、摩拳擦掌：开始训练---验证---检测数据集的使用 写在最后： 前言 在业余时间看了很多关于手把手教你搭建yolov5目标识别框架的博主文章，大多涉及的细节不够多，很多内容一笔带过，不够开源。写这篇技术总结性质的文章，主要是1、尽可能详尽，指导闭坑，完全开源。2、技术交流，取长补短，相互学习。
**项目背景：**用yolov5框架来实时检测安全帽佩戴状态。
数据集的获取及标定：1，直接可以在百度飞浆网站上获取相应的数据集（数据集只有两个标签分类：person和hat（带安全帽的），已经标定好，大约7500张，标定的数据集是json格式的，需要进行转化------txt格式。网上很多数据集只有json格式和图片，有这两个就够了，不要想要什么自行车，本文附带了json格式转化成txt格式的代码。欢迎品尝！！！）
硬件：不建议使用cpu来训练大量数据集，太慢了，想出验证结果或者优化参数，CPU不适合做！！！CPU不适合做！！！CPU不适合做！！！别问为什么，因为我已经试过了。可以在百度飞浆上用免费算力进行训练。但百度飞浆的维护又不太好，兼容性太差。感兴趣可以试试。有条件的，最好自己搭建硬件平台。
一、追根溯源：目标检测框架 yolov5 链接: 这是一位博主写的目标检测算法演变及比较，很不错！！！
二、言归正传：软硬件环境搭建 我的硬件： 处理器 12th Gen Intel® Core™ i9-12900K 3.20 GHz
机带 RAM 32.0 GB (31.8 GB 可用)
设备 ID BEE4439A-3A46-43A3-8657-B9F8873A1A5D
产品 ID 00331-10000-00001-AA112
系统类型 64 位操作系统, 基于 x64 的处理器
显卡：英伟达3060
注意程序的版本号！我们使用GPU进行数据集的训练！
软件环境 链接: 软件主要是cuda—cudnn—anaconda—pycharm环境及版本的相互匹配！！！
链接: 快速下载cuda—注意和你的驱动版本匹配
这个链接可以指导你完成cuda—cudnn 的安装。我在这里不详细讲了，很多博主都写了相关文章，很不错。但是！！！！！
他们没有将如何闭坑，示例：
这是cuda的安装好的运行结果。
配置完成后，我们可以验证是否配置成功，主要使用CUDA内置的deviceQuery.exe 和 bandwidthTest.exe：
首先win&#43;R启动cmd，cd到安装目录下的 …\extras\demo_suite,然后分别执行bandwidthTest.exe和deviceQuery.exe（进到目录后需要直接输“bandwidthTest.exe”和“deviceQuery.exe”）,得到下图:
截止到这里，软件环境搭建好了一半，然后安装软件配套环境anaconda和pycharm，他们二者也得搭配起来使用，不然后面涉及到YOLOV5相关环境，很是麻烦，容易出现版本调整，频繁报错的情况。
我这里的anaconda版本是：
Anaconda3-2023.03-0-Windows-x86_64
pycharm版本是：PyCharm 2021.1.3 x64" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/845ac61b6bf1a242a7e904cdde697c65/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-04T10:21:45+08:00" />
<meta property="article:modified_time" content="2023-12-04T10:21:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">yolov5 安全帽检测 全流程 全资源 技术交流（相互学习）！！！</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="yolov5___0"></a>yolov5 做安全帽检测示例 （全流程、全资源）</h2> 
<p><img src="https://images2.imgbox.com/2f/57/gqRcerwK_o.jpg" alt="在这里插入图片描述"></p> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#yolov5___0" rel="nofollow">yolov5 做安全帽检测示例 （全流程、全资源）</a></li><li><a href="#_8" rel="nofollow">前言</a></li><li><a href="#_yolov5_13" rel="nofollow">一、追根溯源：目标检测框架 yolov5</a></li><li><a href="#_18" rel="nofollow">二、言归正传：软硬件环境搭建</a></li><li><ul><li><a href="#_19" rel="nofollow">我的硬件：</a></li><li><a href="#_28" rel="nofollow">软件环境</a></li></ul> 
  </li><li><a href="#_44" rel="nofollow">三、闪转腾挪：闭坑关键点</a></li><li><a href="#_62" rel="nofollow">四、摩拳擦掌：开始训练---验证---检测</a></li><li><ul><li><a href="#_63" rel="nofollow">数据集的使用</a></li></ul> 
  </li><li><a href="#_284" rel="nofollow">写在最后：</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_8"></a>前言</h2> 
<p>在业余时间看了很多关于手把手教你搭建yolov5目标识别框架的博主文章，大多涉及的细节不够多，很多内容一笔带过，不够开源。写这篇技术总结性质的文章，主要是1、尽可能详尽，指导闭坑，完全开源。2、技术交流，取长补短，相互学习。<br> **项目背景：**用yolov5框架来实时检测安全帽佩戴状态。<br> 数据集的获取及标定：1，直接可以在百度飞浆网站上获取相应的数据集（数据集只有两个标签分类：person和hat（带安全帽的），已经标定好，大约7500张，标定的数据集是json格式的，需要进行转化------txt格式。网上很多数据集只有json格式和图片，有这两个就够了，不要想要什么自行车，本文附带了json格式转化成txt格式的代码。欢迎品尝！！！）<br> 硬件：不建议使用cpu来训练大量数据集，太慢了，想出验证结果或者优化参数，CPU不适合做！！！CPU不适合做！！！CPU不适合做！！！别问为什么，因为我已经试过了。可以在百度飞浆上用免费算力进行训练。但百度飞浆的维护又不太好，兼容性太差。感兴趣可以试试。有条件的，最好自己搭建硬件平台。</p> 
<h2><a id="_yolov5_13"></a>一、追根溯源：目标检测框架 yolov5</h2> 
<p>链接: <a href="https://blog.csdn.net/weixin_48799576/article/details/126693919">这是一位博主写的目标检测算法演变及比较，很不错！！！</a></p> 
<h2><a id="_18"></a>二、言归正传：软硬件环境搭建</h2> 
<h3><a id="_19"></a>我的硬件：</h3> 
<p>处理器 12th Gen Intel® Core™ i9-12900K 3.20 GHz<br> 机带 RAM 32.0 GB (31.8 GB 可用)<br> 设备 ID BEE4439A-3A46-43A3-8657-B9F8873A1A5D<br> 产品 ID 00331-10000-00001-AA112<br> 系统类型 64 位操作系统, 基于 x64 的处理器<br> 显卡：英伟达3060<br> <img src="https://images2.imgbox.com/58/54/7bvZWcQ7_o.png" alt=""><br> 注意程序的版本号！我们使用GPU进行数据集的训练！</p> 
<h3><a id="_28"></a>软件环境</h3> 
<p>链接: <a href="https://blog.csdn.net/anmin8888/article/details/127910084">软件主要是cuda—cudnn—anaconda—pycharm环境及版本的相互匹配！！！</a><br> 链接: <a href="https://developer.download.nvidia.cn/compute/cuda/repos/wsl-ubuntu/x86_64/" rel="nofollow">快速下载cuda—注意和你的驱动版本匹配</a><br> 这个链接可以指导你完成cuda—cudnn 的安装。我在这里不详细讲了，很多博主都写了相关文章，很不错。但是！！！！！<br> 他们没有将如何闭坑，示例：<br> <img src="https://images2.imgbox.com/d9/0b/Elc9MNIO_o.png" alt="在这里插入图片描述"><br> 这是cuda的安装好的运行结果。<br> 配置完成后，我们可以验证是否配置成功，主要使用CUDA内置的deviceQuery.exe 和 bandwidthTest.exe：</p> 
<p>首先win+R启动cmd，cd到安装目录下的 …\extras\demo_suite,然后分别执行bandwidthTest.exe和deviceQuery.exe（进到目录后需要直接输“bandwidthTest.exe”和“deviceQuery.exe”）,得到下图:</p> 
<p><img src="https://images2.imgbox.com/0f/a8/aY14kbrY_o.png" alt="网络插图---">截止到这里，软件环境搭建好了一半，然后安装软件配套环境anaconda和pycharm，他们二者也得搭配起来使用，不然后面涉及到YOLOV5相关环境，很是麻烦，容易出现版本调整，频繁报错的情况。<br> 我这里的anaconda版本是：<br> <strong>Anaconda3-2023.03-0-Windows-x86_64</strong><br> <strong>pycharm版本是：PyCharm 2021.1.3 x64</strong><br> **PyCharm 2021.1.3 x64破解方法：安装一个30天无限激活的插件就可以。这个方法很多网站有，不再赘述。**链接: <a href="https://blog.csdn.net/weixin_47878443/article/details/122699531">激活方法</a></p> 
<h2><a id="_44"></a>三、闪转腾挪：闭坑关键点</h2> 
<p>经过上述安装—卸载—安装的过程，基本上都好了，再通过各种渠道下载好yolov5的源码及权重文件，终于可以开始测试代码了。但是，但是，但是！又出现问题了：<br> https://blog.csdn.net/charlie_C9299/article/details/126092797<br> **我也出现了类似的情况：原因是在运行yolov5代码时候，它会自动检测系统环境版本是否满足：<br> YOLOv5 requirements.txt中的环境要求，不满足的话，它会自动下载更新，这个环节就容易反复导致运行时提示你没有GPU设备，或者是提示你插在不到GPU，即使你前面环境搭建过程中没有任何错误。<br> Usage: pip install -r requirements.txt<br> torch&gt;=1.7.0<br> <strong>torchvision&gt;=0.8.1</strong><br> Logging -------------------------------------<br> <strong>tensorboard&gt;=2.4.1</strong></p> 
<p>出现这样的情况，多数都是因为torchvision和tensorboard版本更新时候，anaconda中自动把相关的cuda和pytorch版本进行了更新，所以这块我们<strong>最好是自己在英伟达官网下载和你自己版本匹配的torchvision和tensorboard，</strong><br> 链接: <a href="https://blog.csdn.net/m0_69358860/article/details/130164508/">可以看看这个文章！</a><br> <img src="https://images2.imgbox.com/dc/0c/yotcI5dx_o.png" alt="在这里插入图片描述"><br> 在anaconda的命令行中用pip安装。<br> 其中CU118是你的cuda版本号 注意：torch版本和torchvision都是CU118，三者版本必须一致才可以。保险起见，可以将YOLOv5 requirements.txt中torchvision和tensorboard前面加上#（表示跳过版本检测，不更新下载）。这样的话，基本就避免了AssertionError: Invalid CUDA ‘–device 0,1,2’ requested, use ‘–device cpu’ or pass valid CUDA device(s)错误的发生。<br> 关于其他问题的报错，基本上通过度娘可以快速解决。<br> <strong>示例：AttributeError: module ‘numpy‘ has no attribute ‘int‘.</strong> https://blog.csdn.net/hhhhhhhhhhwwwwwwwwww/article/details/131430993</p> 
<h2><a id="_62"></a>四、摩拳擦掌：开始训练—验证—检测</h2> 
<h3><a id="_63"></a>数据集的使用</h3> 
<p>labelme软件使用，这里不做介绍了，自己做数据集很慢，但是专业检测领域的话，必须自己做数据集并进行标注。现在有个职业就是数据标注员，拉框框就可以赚钱那种。</p> 
<p>使用现成的数据集，主要得看懂数据集分类情况和标注格式，一般是json格式，你可以打开相应的图片和json，可以发现分类标签名称和个数，------这里只要用于修改.yaml训练参数文件。特别提示：<br> <img src="https://images2.imgbox.com/e9/11/aUycyXxo_o.png" alt="在这里插入图片描述"><br> name中person和hat 位置是不能颠倒的，因为：</p> 
<pre><code class="prism language-c">import os
import xml<span class="token punctuation">.</span>etree<span class="token punctuation">.</span>ElementTree as ET
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">VOC 标签和对应的类别名称</span></span>
VOC_LABELS <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token char">'person'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token char">'hat'</span><span class="token operator">:</span> <span class="token number">1</span>
    #可以根据自己的分类增加字典内容，但是需要和yaml文件中name列表一一对应。
<span class="token punctuation">}</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">VOC 数据集路径</span></span>
VOC_PATH <span class="token operator">=</span> 'E<span class="token operator">:</span>\pythonProject\yolov5_wzry\yolov5\safetyhat\datasets\VOC2028\Annotations'
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">YOLO 格式标注文件保存路径</span></span>
YOLO_PATH <span class="token operator">=</span> 'E<span class="token operator">:</span>\pythonProject\yolov5_wzry\yolov5\safetyhat\datasets\VOC2028\Label'
def <span class="token function">convert_voc_to_yolo</span><span class="token punctuation">(</span>xml_file<span class="token punctuation">)</span><span class="token operator">:</span>
    # 解析 XML 文件
    tree <span class="token operator">=</span> ET<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>xml_file<span class="token punctuation">)</span>
    root <span class="token operator">=</span> tree<span class="token punctuation">.</span><span class="token function">getroot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    # 获取图像的宽度和高度
    size <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token char">'size'</span><span class="token punctuation">)</span>
    width <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>size<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token char">'width'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    height <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>size<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token char">'height'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    # 遍历每一个物体
    <span class="token keyword">for</span> obj in root<span class="token punctuation">.</span><span class="token function">findall</span><span class="token punctuation">(</span><span class="token char">'object'</span><span class="token punctuation">)</span><span class="token operator">:</span>
        # 获取物体的类别和位置信息
        label <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token char">'name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
        xmin <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token char">'bndbox/xmin'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>
        ymin <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token char">'bndbox/ymin'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>
        xmax <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token char">'bndbox/xmax'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>
        ymax <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token char">'bndbox/ymax'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>
        # 将坐标信息转换为 YOLO 格式
        x_center <span class="token operator">=</span> <span class="token keyword">float</span><span class="token punctuation">(</span>xmin <span class="token operator">+</span> xmax<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">/</span> width
        y_center <span class="token operator">=</span> <span class="token keyword">float</span><span class="token punctuation">(</span>ymin <span class="token operator">+</span> ymax<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">/</span> height
        w <span class="token operator">=</span> <span class="token keyword">float</span><span class="token punctuation">(</span>xmax <span class="token operator">-</span> xmin<span class="token punctuation">)</span> <span class="token operator">/</span> width
        h <span class="token operator">=</span> <span class="token keyword">float</span><span class="token punctuation">(</span>ymax <span class="token operator">-</span> ymin<span class="token punctuation">)</span> <span class="token operator">/</span> height
        # 获取类别的 ID
        label_id <span class="token operator">=</span> VOC_LABELS<span class="token punctuation">[</span>label<span class="token punctuation">]</span>
        # 将标注信息保存到 YOLO 格式的文件中
        yolo_file<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>f'<span class="token punctuation">{<!-- --></span>label_id<span class="token punctuation">}</span> <span class="token punctuation">{<!-- --></span>x_center<span class="token punctuation">}</span> <span class="token punctuation">{<!-- --></span>y_center<span class="token punctuation">}</span> <span class="token punctuation">{<!-- --></span>w<span class="token punctuation">}</span> <span class="token punctuation">{<!-- --></span>h<span class="token punctuation">}</span>\n'<span class="token punctuation">)</span>
# 遍历 VOC 数据集中的所有 XML 文件
<span class="token keyword">for</span> root<span class="token punctuation">,</span> dirs<span class="token punctuation">,</span> files in os<span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>VOC_PATH<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token keyword">for</span> file in files<span class="token operator">:</span>
        <span class="token keyword">if</span> file<span class="token punctuation">.</span><span class="token function">endswith</span><span class="token punctuation">(</span><span class="token char">'.xml'</span><span class="token punctuation">)</span><span class="token operator">:</span>
            # 打开 YOLO 格式的文件
            yolo_filename <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">splitext</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token char">'.txt'</span>
            yolo_file <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>YOLO_PATH<span class="token punctuation">,</span> yolo_filename<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token char">'w'</span><span class="token punctuation">)</span>
            # 转换 XML 文件为 YOLO 格式
            xml_file <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> file<span class="token punctuation">)</span>
            <span class="token function">convert_voc_to_yolo</span><span class="token punctuation">(</span>xml_file<span class="token punctuation">)</span>
            # 关闭 YOLO 格式的文件
            yolo_file<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
# 上述代码中，我们将 VOC_LABELS 字典中的键值对修改为 person<span class="token operator">:</span> <span class="token number">0</span> 和 bat<span class="token operator">:</span> <span class="token number">1</span>，然后在 #convert_voc_to_yolo 函数中根据标签名称获取类别 ID。需要注意的是，如果你的数据集中存在其他标签
# 或类别，也需要根据实际情况进行修改。
</code></pre> 
<p>在上述代码（json转化为txt文件，标签定义的顺是固定的，txt文件中的0代表person，1代表hat。与它对应的name【0,1，2,…】）如果不一一对应就容易出现 张冠李戴的检测结果。训练半天，小细节翻车。<br> train.py</p> 
<pre><code class="prism language-c">def <span class="token function">parse_opt</span><span class="token punctuation">(</span>known<span class="token operator">=</span>False<span class="token punctuation">)</span><span class="token operator">:</span>
    parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span><span class="token function">ArgumentParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--weights'</span><span class="token punctuation">,</span> type<span class="token operator">=</span>str<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span><span class="token char">'yolov5x'</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'initial weights path'</span><span class="token punctuation">)</span>    # 修改处 初始权重
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--cfg'</span><span class="token punctuation">,</span> type<span class="token operator">=</span>str<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span>ROOT <span class="token operator">/</span><span class="token char">'safetyhat/safetyhat_model.yaml'</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'model.yaml path'</span><span class="token punctuation">)</span>  # 修改处 训练模型文件
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--data'</span><span class="token punctuation">,</span> type<span class="token operator">=</span>str<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span>ROOT <span class="token operator">/</span><span class="token char">'safetyhat/safetyhat.yaml'</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'dataset.yaml path'</span><span class="token punctuation">)</span>  # 修改处 数据集参数文件
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--hyp'</span><span class="token punctuation">,</span> type<span class="token operator">=</span>str<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span>ROOT <span class="token operator">/</span> <span class="token char">'data/hyps/hyp.scratch-low.yaml'</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'hyperparameters path'</span><span class="token punctuation">)</span>  # 超参数设置
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--epochs'</span><span class="token punctuation">,</span> type<span class="token operator">=</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>  # 修改处 训练轮数
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--batch-size'</span><span class="token punctuation">,</span> type<span class="token operator">=</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> help<span class="token operator">=</span>'total batch size <span class="token keyword">for</span> all GPUs<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">for</span> autobatch'<span class="token punctuation">)</span>  # 修改处 batch size
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--imgsz'</span><span class="token punctuation">,</span> <span class="token char">'--img'</span><span class="token punctuation">,</span> <span class="token char">'--img-size'</span><span class="token punctuation">,</span> type<span class="token operator">=</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span><span class="token number">384</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'train, val image size (pixels)'</span><span class="token punctuation">)</span># 修改处 图片大小
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--rect'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token char">'store_true'</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'rectangular training'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--resume'</span><span class="token punctuation">,</span> nargs<span class="token operator">=</span><span class="token char">'?'</span><span class="token punctuation">,</span> <span class="token keyword">const</span><span class="token operator">=</span>True<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span>False<span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'resume most recent training'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--nosave'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token char">'store_true'</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'only save final checkpoint'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--noval'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token char">'store_true'</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'only validate final epoch'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--noautoanchor'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token char">'store_true'</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'disable AutoAnchor'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--noplots'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token char">'store_true'</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'save no plot files'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--evolve'</span><span class="token punctuation">,</span> type<span class="token operator">=</span><span class="token keyword">int</span><span class="token punctuation">,</span> nargs<span class="token operator">=</span><span class="token char">'?'</span><span class="token punctuation">,</span> <span class="token keyword">const</span><span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> help<span class="token operator">=</span>'evolve hyperparameters <span class="token keyword">for</span> x generations'<span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--bucket'</span><span class="token punctuation">,</span> type<span class="token operator">=</span>str<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span><span class="token char">''</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'gsutil bucket'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--cache'</span><span class="token punctuation">,</span> type<span class="token operator">=</span>str<span class="token punctuation">,</span> nargs<span class="token operator">=</span><span class="token char">'?'</span><span class="token punctuation">,</span> <span class="token keyword">const</span><span class="token operator">=</span><span class="token char">'ram'</span><span class="token punctuation">,</span> help<span class="token operator">=</span>'<span class="token operator">--</span>cache images in <span class="token string">"ram"</span> <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">)</span> or <span class="token string">"disk"</span>'<span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--image-weights'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token char">'store_true'</span><span class="token punctuation">,</span> help<span class="token operator">=</span>'use weighted image selection <span class="token keyword">for</span> training'<span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--device'</span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span><span class="token char">'0'</span><span class="token punctuation">,</span> help<span class="token operator">=</span>'cuda device<span class="token punctuation">,</span> i<span class="token punctuation">.</span>e<span class="token punctuation">.</span> <span class="token number">0</span> or <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span> or cpu'<span class="token punctuation">)</span>#修改处，选择
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--multi-scale'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token char">'store_true'</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'vary img-size +/- 50%%'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--single-cls'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token char">'store_true'</span><span class="token punctuation">,</span> help<span class="token operator">=</span>'train multi<span class="token operator">-</span>class data as single<span class="token operator">-</span>class'<span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--optimizer'</span><span class="token punctuation">,</span> type<span class="token operator">=</span>str<span class="token punctuation">,</span> choices<span class="token operator">=</span><span class="token punctuation">[</span><span class="token char">'SGD'</span><span class="token punctuation">,</span> <span class="token char">'Adam'</span><span class="token punctuation">,</span> <span class="token char">'AdamW'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span><span class="token char">'SGD'</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'optimizer'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--sync-bn'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token char">'store_true'</span><span class="token punctuation">,</span> help<span class="token operator">=</span>'use SyncBatchNorm<span class="token punctuation">,</span> only available in DDP mode'<span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--workers'</span><span class="token punctuation">,</span> type<span class="token operator">=</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> help<span class="token operator">=</span>'max dataloader <span class="token function">workers</span> <span class="token punctuation">(</span>per RANK in DDP mode<span class="token punctuation">)</span>'<span class="token punctuation">)</span>#修改处
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--project'</span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span>ROOT <span class="token operator">/</span> <span class="token char">'runs/train'</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'save to project/name'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--name'</span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span><span class="token char">'exp'</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'save to project/name'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--exist-ok'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token char">'store_true'</span><span class="token punctuation">,</span> help<span class="token operator">=</span>'existing project<span class="token operator">/</span>name ok<span class="token punctuation">,</span> <span class="token keyword">do</span> not increment'<span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--quad'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token char">'store_true'</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'quad dataloader'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--cos-lr'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token char">'store_true'</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'cosine LR scheduler'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--label-smoothing'</span><span class="token punctuation">,</span> type<span class="token operator">=</span><span class="token keyword">float</span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'Label smoothing epsilon'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--patience'</span><span class="token punctuation">,</span> type<span class="token operator">=</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> help<span class="token operator">=</span>'EarlyStopping <span class="token function">patience</span> <span class="token punctuation">(</span>epochs without improvement<span class="token punctuation">)</span>'<span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--freeze'</span><span class="token punctuation">,</span> nargs<span class="token operator">=</span><span class="token char">'+'</span><span class="token punctuation">,</span> type<span class="token operator">=</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> help<span class="token operator">=</span>'Freeze layers<span class="token operator">:</span> backbone<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> first3<span class="token operator">=</span><span class="token number">0</span> <span class="token number">1</span> <span class="token number">2</span>'<span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--save-period'</span><span class="token punctuation">,</span> type<span class="token operator">=</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> help<span class="token operator">=</span>'Save checkpoint every x <span class="token function">epochs</span> <span class="token punctuation">(</span>disabled <span class="token keyword">if</span> <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span>'<span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--local_rank'</span><span class="token punctuation">,</span> type<span class="token operator">=</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'DDP parameter, do not modify'</span><span class="token punctuation">)</span>

    <span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Weights <span class="token operator">&amp;</span> Biases arguments</span></span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--entity'</span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span>None<span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'W&amp;B: Entity'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--upload_dataset'</span><span class="token punctuation">,</span> nargs<span class="token operator">=</span><span class="token char">'?'</span><span class="token punctuation">,</span> <span class="token keyword">const</span><span class="token operator">=</span>True<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span>False<span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'W&amp;B: Upload data, "val" option'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--bbox_interval'</span><span class="token punctuation">,</span> type<span class="token operator">=</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> help<span class="token operator">=</span>'W<span class="token operator">&amp;</span>B<span class="token operator">:</span> Set bounding<span class="token operator">-</span>box image logging interval'<span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--artifact_alias'</span><span class="token punctuation">,</span> type<span class="token operator">=</span>str<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span><span class="token char">'latest'</span><span class="token punctuation">,</span> help<span class="token operator">=</span>'W<span class="token operator">&amp;</span>B<span class="token operator">:</span> Version of dataset artifact to use'<span class="token punctuation">)</span>

    opt <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse_known_args</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">if</span> known <span class="token keyword">else</span> parser<span class="token punctuation">.</span><span class="token function">parse_args</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> opt
</code></pre> 
<p>这里是调整参数的重点：<br> <img src="https://images2.imgbox.com/06/60/eZ8QJFUJ_o.png" alt="在这里插入图片描述"><br> 可以看出来一一对应的参数设置—很简单。注意地址的对应关系就行。<br> 这里要搞懂yolov5的文件组织框架<br> 链接: <a href="https://zhuanlan.zhihu.com/p/463176500" rel="nofollow">yolov5 这个可以作为参考</a></p> 
<p>yaml相关参数设置</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">YOLOv5 🚀 by Ultralytics<span class="token punctuation">,</span> GPL<span class="token operator">-</span><span class="token number">3.0</span> license</span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">COCO128 dataset https<span class="token operator">:</span></span><span class="token comment">//www.kaggle.com/ultralytics/coco128 (first 128 images from COCO train2017) by Ultralytics</span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Example usage<span class="token operator">:</span> python train<span class="token punctuation">.</span>py <span class="token operator">--</span>datasets coco128<span class="token punctuation">.</span>yaml</span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">parent</span></span>
# ├── yolov5
# └── datasets
#     └── coco128  ← downloads <span class="token function">here</span> <span class="token punctuation">(</span><span class="token number">7</span> MB<span class="token punctuation">)</span>


<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Train<span class="token operator">/</span>val<span class="token operator">/</span>test sets as <span class="token number">1</span><span class="token punctuation">)</span> dir<span class="token operator">:</span> path<span class="token operator">/</span>to<span class="token operator">/</span>imgs<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> file<span class="token operator">:</span> path<span class="token operator">/</span>to<span class="token operator">/</span>imgs<span class="token punctuation">.</span>txt<span class="token punctuation">,</span> or <span class="token number">3</span><span class="token punctuation">)</span> list<span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token operator">/</span>to<span class="token operator">/</span>imgs1<span class="token punctuation">,</span> path<span class="token operator">/</span>to<span class="token operator">/</span>imgs2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span></span></span>
path<span class="token operator">:</span> safetyhat\datasets  # dataset root dir
train<span class="token operator">:</span> images\train  # train <span class="token function">images</span> <span class="token punctuation">(</span>relative to <span class="token char">'path'</span><span class="token punctuation">)</span> <span class="token number">128</span> images
val<span class="token operator">:</span> images\train # val <span class="token function">images</span> <span class="token punctuation">(</span>relative to <span class="token char">'path'</span><span class="token punctuation">)</span> <span class="token number">128</span> images
test<span class="token operator">:</span>  # test <span class="token function">images</span> <span class="token punctuation">(</span>optional<span class="token punctuation">)</span>

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Classes</span></span>
nc<span class="token operator">:</span> <span class="token number">2</span>  # number of classes
names<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token char">'person'</span><span class="token punctuation">,</span>
         <span class="token char">'hat'</span>
         <span class="token punctuation">]</span>  # class names

</code></pre> 
<p>上面是训练参数设置，主要设置了训练图片的地址和训练图片标注好的数据集地址（txt文件地址），设置了分类数量nc 以及标签名称name</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">YOLOv5 🚀 by Ultralytics<span class="token punctuation">,</span> GPL<span class="token operator">-</span><span class="token number">3.0</span> license</span></span>

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Parameters</span></span>
nc<span class="token operator">:</span> <span class="token number">2</span>  # number of classes
depth_multiple<span class="token operator">:</span> <span class="token number">1.33</span>  # model depth multiple
width_multiple<span class="token operator">:</span> <span class="token number">1.25</span>  # layer channel multiple
anchors<span class="token operator">:</span>
  <span class="token operator">-</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">]</span>  # P3<span class="token operator">/</span><span class="token number">8</span>
  <span class="token operator">-</span> <span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span><span class="token number">119</span><span class="token punctuation">]</span>  # P4<span class="token operator">/</span><span class="token number">16</span>
  <span class="token operator">-</span> <span class="token punctuation">[</span><span class="token number">116</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">156</span><span class="token punctuation">,</span><span class="token number">198</span><span class="token punctuation">,</span> <span class="token number">373</span><span class="token punctuation">,</span><span class="token number">326</span><span class="token punctuation">]</span>  # P5<span class="token operator">/</span><span class="token number">32</span>

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">YOLOv5 v6<span class="token punctuation">.</span><span class="token number">0</span> backbone</span></span>
backbone<span class="token operator">:</span>
  # <span class="token punctuation">[</span>from<span class="token punctuation">,</span> number<span class="token punctuation">,</span> module<span class="token punctuation">,</span> args<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  # <span class="token number">0</span><span class="token operator">-</span>P1<span class="token operator">/</span><span class="token number">2</span>
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  # <span class="token number">1</span><span class="token operator">-</span>P2<span class="token operator">/</span><span class="token number">4</span>
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> C3<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  # <span class="token number">3</span><span class="token operator">-</span>P3<span class="token operator">/</span><span class="token number">8</span>
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> C3<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  # <span class="token number">5</span><span class="token operator">-</span>P4<span class="token operator">/</span><span class="token number">16</span>
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> C3<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  # <span class="token number">7</span><span class="token operator">-</span>P5<span class="token operator">/</span><span class="token number">32</span>
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> C3<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> SPPF<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  # <span class="token number">9</span>
  <span class="token punctuation">]</span>

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">YOLOv5 v6<span class="token punctuation">.</span><span class="token number">0</span> head</span></span>
head<span class="token operator">:</span>
  <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Upsample<span class="token punctuation">,</span> <span class="token punctuation">[</span>None<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token char">'nearest'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Concat<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  # cat backbone P4
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> C3<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">,</span> False<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  # <span class="token number">13</span>

   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Upsample<span class="token punctuation">,</span> <span class="token punctuation">[</span>None<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token char">'nearest'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Concat<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  # cat backbone P3
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> C3<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">,</span> False<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  # <span class="token number">17</span> <span class="token punctuation">(</span>P3<span class="token operator">/</span><span class="token number">8</span><span class="token operator">-</span>small<span class="token punctuation">)</span>

   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Concat<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  # cat head P4
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> C3<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">,</span> False<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  # <span class="token number">20</span> <span class="token punctuation">(</span>P4<span class="token operator">/</span><span class="token number">16</span><span class="token operator">-</span>medium<span class="token punctuation">)</span>

   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Concat<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  # cat head P5
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> C3<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">,</span> False<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  # <span class="token number">23</span> <span class="token punctuation">(</span>P5<span class="token operator">/</span><span class="token number">32</span><span class="token operator">-</span>large<span class="token punctuation">)</span>

   <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Detect<span class="token punctuation">,</span> <span class="token punctuation">[</span>nc<span class="token punctuation">,</span> anchors<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  # <span class="token function">Detect</span><span class="token punctuation">(</span>P3<span class="token punctuation">,</span> P4<span class="token punctuation">,</span> P5<span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
</code></pre> 
<p><strong>这里主要设置了训练网络结构参数，# Parameters<br> nc: 2 # number of classes<br> depth_multiple: 1.33 # model depth multiple<br> width_multiple: 1.25 # layer channel multiple<br> 这些都是今后调参的重点内容。可以根据训练及验证情况进行调整。</strong><br> <img src="https://images2.imgbox.com/2a/ac/RwGqVP5t_o.jpg" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c0/f6/pFk2dNDH_o.jpg" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/66/0b/eyyvX6dq_o.jpg" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/58/65/yntw0ivu_o.jpg" alt="在这里插入图片描述"><br> 这就是训练后的结果，识别效果很不错。</p> 
<p>在detect中，我们选择GPU 视频实时检测：</p> 
<pre><code class="prism language-c">def <span class="token function">parse_opt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
    parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span><span class="token function">ArgumentParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--weights'</span><span class="token punctuation">,</span> nargs<span class="token operator">=</span><span class="token char">'+'</span><span class="token punctuation">,</span> type<span class="token operator">=</span>str<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span>ROOT <span class="token operator">/</span><span class="token char">'runs/train/exp18/weights/last.pt'</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'model path(s)'</span><span class="token punctuation">)</span>  # 修改处 权重文件
    <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">parser</span><span class="token expression"><span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span></span><span class="token char">'--source'</span><span class="token expression"><span class="token punctuation">,</span> type<span class="token operator">=</span>str<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span>ROOT <span class="token operator">/</span>'wzry<span class="token operator">/</span>datasets<span class="token operator">/</span>images<span class="token operator">/</span>test<span class="token operator">/</span>SVID_20210726_111258_1<span class="token punctuation">.</span>mp4</span><span class="token char">', help='</span><span class="token expression">file<span class="token operator">/</span>dir<span class="token operator">/</span>URL<span class="token operator">/</span>glob<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">for</span> webcam'<span class="token punctuation">)</span># 修改处 图像、视频或摄像头</span></span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--source'</span><span class="token punctuation">,</span> type<span class="token operator">=</span>str<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span><span class="token char">'0'</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'file/dir/URL/glob, 0 for webcam'</span><span class="token punctuation">)</span># 修改处 图像、视频或摄像头
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--data'</span><span class="token punctuation">,</span> type<span class="token operator">=</span>str<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span>ROOT <span class="token operator">/</span> <span class="token char">'safetyhat/safetyhat.yaml'</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'(optional) dataset.yaml path'</span><span class="token punctuation">)</span>  # 修改处 参数文件
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--imgsz'</span><span class="token punctuation">,</span> <span class="token char">'--img'</span><span class="token punctuation">,</span> <span class="token char">'--img-size'</span><span class="token punctuation">,</span> nargs<span class="token operator">=</span><span class="token char">'+'</span><span class="token punctuation">,</span> type<span class="token operator">=</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">640</span><span class="token punctuation">]</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'inference size h,w'</span><span class="token punctuation">)</span>  # 修改处 高 宽
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--conf-thres'</span><span class="token punctuation">,</span> type<span class="token operator">=</span><span class="token keyword">float</span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span><span class="token number">0.85</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'confidence threshold'</span><span class="token punctuation">)</span>  # 置信度
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--iou-thres'</span><span class="token punctuation">,</span> type<span class="token operator">=</span><span class="token keyword">float</span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span><span class="token number">0.45</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'NMS IoU threshold'</span><span class="token punctuation">)</span># 非极大抑制
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--max-det'</span><span class="token punctuation">,</span> type<span class="token operator">=</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'maximum detections per image'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--device'</span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span><span class="token char">'0'</span><span class="token punctuation">,</span> help<span class="token operator">=</span>'cuda device<span class="token punctuation">,</span> i<span class="token punctuation">.</span>e<span class="token punctuation">.</span> <span class="token number">0</span> or <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span> or cpu'<span class="token punctuation">)</span>  # 修改处
</code></pre> 
<p>实际效果</p> 
<p><img src="https://images2.imgbox.com/59/8f/JjcKBPba_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_284"></a>写在最后：</h2> 
<p>经过一段时间折腾，完成了软硬件环境搭建和代码调试，出现过很多反复和错误，多尝试，一旦实现效果，收获满满。对yolov5运行机制和训练模式有更深的理解，理解之后，通过一次次成功的试验，向实际应用靠拢。接下来要做的内容是：掌握调参，加速、移植，甚至是改写c。上面的所有内容及代码我将开源，不设任何限制获取。链接：https://pan.baidu.com/s/1_1fd5dqzwZI6DEptmMbkUQ<br> 提取码：r85g</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0bd29e0274fca84d2b0141e9de94e826/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【ARM Cortex-M 系列 1 -- Cortex-M0, M3, M4, M7, M33, M35P 差异】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/347b21cf7ece6488eec1cf871c07e089/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">流批一体历史背景及基础介绍</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>