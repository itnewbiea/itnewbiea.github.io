<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>OpenCV学习——轮廓检测 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="OpenCV学习——轮廓检测" />
<meta property="og:description" content="前言 轮廓检测是传统视觉中非常常用的功能，这里简单记录一下opencv中的轮廓检测算法使用方法，至于理论，后续有机会再去细品。
国际惯例：
OpenCV官方的轮廓检测教程python版
OpenCV中的二值化方法教程
OpenCV轮廓层级官方文档
维基百科：图像矩(Image Moment)
调用流程和方法 OpenCV里面通常要求是针对二值图像进行二值化，所以轮廓检测包含如下步骤：
载入图像灰度化二值化轮廓检测 代码实现如下：
img =cv2.imread(&#34;blackBG.jpg&#34;) # grayscale # https://docs.opencv.org/4.5.0/d7/d4d/tutorial_py_thresholding.html gray_img = cv2.cvtColor(img,cv2.COLOR_BGR2GRAY) ret,bin_img = cv2.threshold(gray_img,0,255,cv2.THRESH_BINARY&#43;cv2.THRESH_OTSU) 二值化 注意二值化方法，这里使用的是threshold函数，它的第三个参数代表的意义可以查询此处的官方文档，这里将方法截图贴出来
其实除了threshold还有一个adaptiveThreshold函数可以做二值化，调用方法：
#dst=cv.adaptiveThreshold(src,maxValue,adaptiveMethod,thresholdType,blockSize,C[, dst]) bin_img1 = cv.adaptiveThreshold(img,255,cv.ADAPTIVE_THRESH_MEAN_C,\ cv.THRESH_BINARY,11,2) bin_img2 = cv.adaptiveThreshold(img,255,cv.ADAPTIVE_THRESH_GAUSSIAN_C,\ cv.THRESH_BINARY,11,2) 从第三个参数可以发现也有两个二值化方法：
ADAPTIVE_THRESH_MEAN_C：阈值是每个像素邻域区域的均值减去常量CADAPTIVE_THRESH_GAUSSIAN_C:：阈值是每个像素相邻域区域的高斯加权和减去常量C 轮廓检测 python的调用方法如下：
contours, hierarchy	=cv.findContours(image,mode,method[,contours[, hierarchy[, offset]]]) 返回的参数
contours：检测到的轮廓，每个轮廓是由一些点构成的向量组成hierarchy：记录轮廓之间的关系，四个维度分别代表：同级后一个轮廓的序号、同级上一个轮廓的序号、第一个孩子序号，父亲序号 第二个数参数mode是检测轮廓的层级关系排列规则：
RETR_EXTERNAL：仅仅检测外圈轮廓RETR_LIST：检测所有轮廓，但是没有层级关系RETR_CCOMP：仅仅两层包含关系，即只有外层和内层，假设有夹层，那么夹层也算外层，只要某个轮廓还包含有轮廓，都算外部轮廓RETR_TREE：检测所有的轮廓，并建议非常完整的层级关系RETR_FLOODFILL：无描述 第三个参数method是轮廓点的存储方式：
CHAIN_APPROX_NONE：相邻的轮廓点坐标只相差一个像素，所以是连续轮廓点CHAIN_APPROX_SIMPLE：横、竖、对角线段只保存断点数据，比如矩形就只保存四个顶点。还有两种没做过多叙述：CHAIN_APPROX_TC89_L1和CHAIN_APPROX_TC89_KCOS是Teh-Chin chain近似算法里面采取的两种表示 画图函数 就一个函数drawContours，调用方法如下：
image=cv.drawContours(image, contours, contourIdx, color[, thickness[, lineType[, hierarchy[, maxLevel[, offset]]]]]	) 输入参数：
contours：是list类型的数组，里面存储了很多array数组去代表各个轮廓contourIdx：从上面的轮廓list中取出哪一个画出来，-1代表全部color：线条颜色thickness：线条粗细，-1代表填充式画轮廓，整个轮廓内部被指定颜色填充lineType：线条类型，虚线、实线之类的 【注意】如果将原图传入画图函数，这个原图会被画上轮廓，所以画图时候最好建立一个副本，在副本上画图。
轮廓检测函数验证 主要验证检测时的层级结构和记录关键点的方式，也就是第2和3个参数。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/de6f43fb16d912adceb4afd6915c0706/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-10-31T16:30:43+08:00" />
<meta property="article:modified_time" content="2020-10-31T16:30:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">OpenCV学习——轮廓检测</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>前言</h2> 
<p>轮廓检测是传统视觉中非常常用的功能，这里简单记录一下<code>opencv</code>中的轮廓检测算法使用方法，至于理论，后续有机会再去细品。</p> 
<p>国际惯例：</p> 
<p><a href="https://docs.opencv.org/4.5.0/d3/d05/tutorial_py_table_of_contents_contours.html" rel="nofollow"><code>OpenCV</code>官方的轮廓检测教程<code>python</code>版</a></p> 
<p><a href="https://docs.opencv.org/4.5.0/d7/d4d/tutorial_py_thresholding.html" rel="nofollow"><code>OpenCV</code>中的二值化方法教程</a></p> 
<p><a href="https://docs.opencv.org/4.5.0/d9/d8b/tutorial_py_contours_hierarchy.html" rel="nofollow"><code>OpenCV</code>轮廓层级官方文档</a></p> 
<p><a href="https://zh.wikipedia.org/wiki/%E7%9F%A9_%28%E5%9B%BE%E5%83%8F%29" rel="nofollow">维基百科：图像矩(Image Moment)</a></p> 
<h2><a id="_14"></a>调用流程和方法</h2> 
<p><code>OpenCV</code>里面通常要求是针对二值图像进行二值化，所以轮廓检测包含如下步骤：</p> 
<ul><li>载入图像</li><li>灰度化</li><li>二值化</li><li>轮廓检测</li></ul> 
<p>代码实现如下：</p> 
<pre><code class="prism language-python">img <span class="token operator">=</span>cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">"blackBG.jpg"</span><span class="token punctuation">)</span>
<span class="token comment"># grayscale </span>
<span class="token comment"># https://docs.opencv.org/4.5.0/d7/d4d/tutorial_py_thresholding.html</span>
gray_img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
ret<span class="token punctuation">,</span>bin_img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>gray_img<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>THRESH_BINARY<span class="token operator">+</span>cv2<span class="token punctuation">.</span>THRESH_OTSU<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_33"></a>二值化</h3> 
<p>注意二值化方法，这里使用的是<code>threshold</code>函数，它的第三个参数代表的意义可以查询<a href="https://docs.opencv.org/4.5.0/d7/d1b/group__imgproc__misc.html#ggaa9e58d2860d4afa658ef70a9b1115576ac7e89a5e95490116e7d2082b3096b2b8" rel="nofollow">此处的官方文档</a>，这里将方法截图贴出来</p> 
<p><img src="https://images2.imgbox.com/4f/98/LxB2ZdJ5_o.png" alt="在这里插入图片描述"></p> 
<p>其实除了<code>threshold</code>还有一个<a href="https://docs.opencv.org/4.5.0/d7/d1b/group__imgproc__misc.html#ga72b913f352e4a1b1b397736707afcde3" rel="nofollow">adaptiveThreshold</a>函数可以做二值化，调用方法：</p> 
<pre><code class="prism language-python"><span class="token comment">#dst=cv.adaptiveThreshold(src,maxValue,adaptiveMethod,thresholdType,blockSize,C[, dst])</span>
bin_img1 <span class="token operator">=</span> cv<span class="token punctuation">.</span>adaptiveThreshold<span class="token punctuation">(</span>img<span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>cv<span class="token punctuation">.</span>ADAPTIVE_THRESH_MEAN_C<span class="token punctuation">,</span>\
            cv<span class="token punctuation">.</span>THRESH_BINARY<span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
bin_img2 <span class="token operator">=</span> cv<span class="token punctuation">.</span>adaptiveThreshold<span class="token punctuation">(</span>img<span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>cv<span class="token punctuation">.</span>ADAPTIVE_THRESH_GAUSSIAN_C<span class="token punctuation">,</span>\
            cv<span class="token punctuation">.</span>THRESH_BINARY<span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre> 
<p>从第三个参数可以发现也有两个二值化方法：</p> 
<ul><li><code>ADAPTIVE_THRESH_MEAN_C</code>：阈值是每个像素邻域区域的均值减去常量C</li><li><code>ADAPTIVE_THRESH_GAUSSIAN_C:</code>：阈值是每个像素相邻域区域的高斯加权和减去常量C</li></ul> 
<h3><a id="_55"></a>轮廓检测</h3> 
<p><code>python</code>的调用方法如下：</p> 
<pre><code class="prism language-python">contours<span class="token punctuation">,</span> hierarchy	<span class="token operator">=</span>cv<span class="token punctuation">.</span>findContours<span class="token punctuation">(</span>image<span class="token punctuation">,</span>mode<span class="token punctuation">,</span>method<span class="token punctuation">[</span><span class="token punctuation">,</span>contours<span class="token punctuation">[</span><span class="token punctuation">,</span> hierarchy<span class="token punctuation">[</span><span class="token punctuation">,</span> offset<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>返回的参数</p> 
<ul><li><code>contours</code>：检测到的轮廓，每个轮廓是由一些点构成的向量组成</li><li><code>hierarchy</code>：记录轮廓之间的关系，四个维度分别代表：同级后一个轮廓的序号、同级上一个轮廓的序号、第一个孩子序号，父亲序号</li></ul> 
<p>第二个数参数<code>mode</code>是检测轮廓的层级关系排列规则：</p> 
<ul><li><code>RETR_EXTERNAL</code>：仅仅检测外圈轮廓</li><li><code>RETR_LIST</code>：检测所有轮廓，但是没有层级关系</li><li><code>RETR_CCOMP</code>：仅仅两层包含关系，即只有外层和内层，假设有夹层，那么夹层也算外层，只要某个轮廓还包含有轮廓，都算外部轮廓</li><li><code>RETR_TREE</code>：检测所有的轮廓，并建议非常完整的层级关系</li><li><code>RETR_FLOODFILL</code>：无描述</li></ul> 
<p>第三个参数<code>method</code>是轮廓点的存储方式：</p> 
<ul><li><code>CHAIN_APPROX_NONE</code>：相邻的轮廓点坐标只相差一个像素，所以是连续轮廓点</li><li><code>CHAIN_APPROX_SIMPLE</code>：横、竖、对角线段只保存断点数据，比如矩形就只保存四个顶点。</li><li>还有两种没做过多叙述：<code>CHAIN_APPROX_TC89_L1</code>和<code>CHAIN_APPROX_TC89_KCOS</code>是<code>Teh-Chin chain</code>近似算法里面采取的两种表示</li></ul> 
<h3><a id="_82"></a>画图函数</h3> 
<p>就一个函数<code>drawContours</code>，调用方法如下：</p> 
<pre><code class="prism language-python">image<span class="token operator">=</span>cv<span class="token punctuation">.</span>drawContours<span class="token punctuation">(</span>image<span class="token punctuation">,</span> contours<span class="token punctuation">,</span> contourIdx<span class="token punctuation">,</span> color<span class="token punctuation">[</span><span class="token punctuation">,</span> thickness<span class="token punctuation">[</span><span class="token punctuation">,</span> lineType<span class="token punctuation">[</span><span class="token punctuation">,</span> hierarchy<span class="token punctuation">[</span><span class="token punctuation">,</span> maxLevel<span class="token punctuation">[</span><span class="token punctuation">,</span> offset<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>	<span class="token punctuation">)</span>
</code></pre> 
<p>输入参数：</p> 
<ul><li><code>contours</code>：是<code>list</code>类型的数组，里面存储了很多<code>array</code>数组去代表各个轮廓</li><li><code>contourIdx</code>：从上面的轮廓<code>list</code>中取出哪一个画出来，<code>-1</code>代表全部</li><li><code>color</code>：线条颜色</li><li><code>thickness</code>：线条粗细，<code>-1</code>代表填充式画轮廓，整个轮廓内部被指定颜色填充</li><li><code>lineType</code>：线条类型，虚线、实线之类的</li></ul> 
<p>【注意】如果将原图传入画图函数，这个原图会被画上轮廓，所以画图时候最好建立一个副本，在副本上画图。</p> 
<h2><a id="_100"></a>轮廓检测函数验证</h2> 
<p>主要验证检测时的层级结构和记录关键点的方式，也就是第2和3个参数。</p> 
<h3><a id="_104"></a>检测黑色还是白色边界</h3> 
<p>黑色背景图，以下图为例</p> 
<p><img src="https://images2.imgbox.com/a6/83/Z3AMRWmk_o.jpg" alt="在这里插入图片描述"></p> 
<p>先检测所有的轮廓并且画出来</p> 
<pre><code class="prism language-python">img <span class="token operator">=</span>cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">"blackBG.jpg"</span><span class="token punctuation">)</span>
gray_img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
ret<span class="token punctuation">,</span>bin_img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>gray_img<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>THRESH_BINARY<span class="token operator">+</span>cv2<span class="token punctuation">.</span>THRESH_OTSU<span class="token punctuation">)</span>
contours<span class="token punctuation">,</span> hierarchy <span class="token operator">=</span> cv2<span class="token punctuation">.</span>findContours<span class="token punctuation">(</span>bin_img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>RETR_TREE<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>CHAIN_APPROX_SIMPLE<span class="token punctuation">)</span>

cv2<span class="token punctuation">.</span>drawContours<span class="token punctuation">(</span>img<span class="token punctuation">,</span>contours<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/5b/82/AVQsoZj5_o.png" alt="在这里插入图片描述"></p> 
<p>白色背景图以下图左为例，同时以同样的代码尽心轮廓检测，轮廓图为下图右：</p> 
<p><img src="https://images2.imgbox.com/2b/d2/OHhloF4u_o.png" alt="在这里插入图片描述"></p> 
<p><strong>结论</strong>：检测白色背景的图片，会有一个和图像宽高相等的轮廓，而黑色区域没有；所以轮廓检测是针对白色区域的边缘进行的，这个和图像等宽高的轮廓经常会影响一些逻辑的书写。</p> 
<h3><a id="_134"></a>层级关系</h3> 
<ul><li> <p><code>RETR_EXTERNAL</code>：仅外圈轮廓</p> <pre><code class="prism language-python"><span class="token comment"># RETR_EXTERNAL:仅外圈轮廓</span>
contours<span class="token punctuation">,</span> hierarchy <span class="token operator">=</span> cv2<span class="token punctuation">.</span>findContours<span class="token punctuation">(</span>bin_img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>RETR_EXTERNAL<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>CHAIN_APPROX_SIMPLE<span class="token punctuation">)</span>

cv2<span class="token punctuation">.</span>drawContours<span class="token punctuation">(</span>img<span class="token punctuation">,</span>contours<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>hierarchy<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
[[[ 1 -1 -1 -1]
  [ 2  0 -1 -1]
  [-1  1 -1 -1]]]
'''</span>
</code></pre> </li></ul> 
<p><img src="https://images2.imgbox.com/48/a2/u0z3CTHB_o.png" alt="在这里插入图片描述"></p> 
<p>从轮廓图可以发现，仅仅只有确定为最外圈的轮廓被画出来，而且输出的<code>hierarchy</code>数组可以发现，前两列分别代表当前层级当前轮廓的下一个轮廓和上一个轮廓索引，而后两列分别代表当前层级的子层级的第一个轮廓索引和父层级的轮廓索引，因为<code>RETR_EXTERNAL</code>只提取最外层轮廓，所以上下层级都是<code>-1</code></p> 
<ul><li> <p><code>RETR_LIST</code>：所有轮廓都包含，但是没有层级关系</p> <pre><code class="prism language-python"><span class="token comment"># RETR_EXTERNAL:全部轮廓，无层级关系</span>
contours<span class="token punctuation">,</span> hierarchy <span class="token operator">=</span> cv2<span class="token punctuation">.</span>findContours<span class="token punctuation">(</span>bin_img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>RETR_LIST<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>CHAIN_APPROX_SIMPLE<span class="token punctuation">)</span>

cv2<span class="token punctuation">.</span>drawContours<span class="token punctuation">(</span>img<span class="token punctuation">,</span>contours<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>hierarchy<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
[[[ 1 -1 -1 -1]
  [ 2  0 -1 -1]
  [ 3  1 -1 -1]
  [ 4  2 -1 -1]
  [ 5  3 -1 -1]
  [ 6  4 -1 -1]
  [ 7  5 -1 -1]
  [-1  6 -1 -1]]]
'''</span>
</code></pre> </li></ul> 
<p><img src="https://images2.imgbox.com/1d/da/6OHckdB2_o.png" alt="在这里插入图片描述"></p> 
<p>代表当前层级父子层级的后两个维度依旧为<code>-1</code>，但是轮廓全部都提取出来了。</p> 
<ul><li> <p><code>RETR_CCOMP</code>：仅仅两层关系，是否为内层或者是否为外层，而且这个内层一定是这个外层的洞，这个洞的定义指内外层组合构成一片<strong>白色区域</strong>。如下图代码测试</p> <pre><code class="prism language-python"><span class="token comment"># RETR_CCOMP:全部轮廓，只有两种层级关系</span>
contours<span class="token punctuation">,</span> hierarchy <span class="token operator">=</span> cv2<span class="token punctuation">.</span>findContours<span class="token punctuation">(</span>bin_img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>RETR_CCOMP<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>CHAIN_APPROX_SIMPLE<span class="token punctuation">)</span>

img_show <span class="token operator">=</span> img<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>contours<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>hierarchy<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        cv2<span class="token punctuation">.</span>drawContours<span class="token punctuation">(</span>img_show<span class="token punctuation">,</span>contours<span class="token punctuation">,</span>i<span class="token punctuation">,</span>colormap<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
        cv2<span class="token punctuation">.</span>drawContours<span class="token punctuation">(</span>img_show<span class="token punctuation">,</span>contours<span class="token punctuation">,</span>hierarchy<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>colormap<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img_show<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>hierarchy<span class="token punctuation">)</span>
<span class="token comment"># 红:0  橙;1  黄:2  绿:3  青:4  蓝:5  紫:6  灰:7</span>
<span class="token triple-quoted-string string">'''
[[ 1 -1 -1 -1]
  [ 2  0 -1 -1]
  [ 4  1  3 -1]
  [-1 -1 -1  2]
  [ 6  2  5 -1]
  [-1 -1 -1  4]
  [ 7  4 -1 -1]
  [-1  6 -1 -1]]]
'''</span>
</code></pre> <p>上述代码表示将当前轮廓与其父轮廓用同色画出来：</p> </li></ul> 
<p><img src="https://images2.imgbox.com/bc/c9/qWDdeV0G_o.png" alt="在这里插入图片描述"></p> 
<p>可以发现四个轮廓组成的两个白色区域被显示出来，绿色区域为3号轮廓，从<code>hierarchy</code>中找到3号轮廓的结构为<code>[-1 -1 -1 2]</code>，自行可视化可以发现这个3号轮廓是白色区域中最内层的那个轮廓，而其父亲索引为2，轮廓2的结构为<code>[ 4 1 3 -1]</code>，可以发现它的第一个孩子是3，而由于是外轮廓(不管是否为最外圈)，所以父亲索引为-1。其余轮廓同理分析。</p> 
<p>【注】这个轮廓结构有点绕，但是只需要记住<strong>只有内、外轮廓，只要当前轮廓有内轮廓一起组成白色区域，那么这个轮廓就是外轮廓，不管它在不在其它轮廓内部</strong></p> 
<p>可视化时候本来用当前轮廓和子轮廓来显示，但是想到<code>hierarchy</code>只记录第一个子轮廓，当时差点以为组成“洞”的只可能有两个轮廓，也就是一个轮廓有且只可能有一个子轮廓，但是发现问题，一个轮廓可能会有两个子轮廓，所以必须用当前轮廓与父轮廓可视化，而不是当前轮廓和子轮廓可视化，比如下面这个图，及其对应的轮廓图和层级关系：</p> 
<p><img src="https://images2.imgbox.com/12/ab/J4mGipZp_o.png" alt="在这里插入图片描述"></p> 
<p>轮廓对应顺序分别是红、橙、黄，其<code>CCOMP</code>层级关系为：</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">-</span><span class="token number">1</span>  <span class="token number">1</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span> <span class="token number">2</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">-</span><span class="token number">1</span>  <span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span>  <span class="token number">1</span> <span class="token operator">-</span><span class="token number">1</span>  <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre> 
<p>可以发现，内部两个轮廓的父亲都是0，证明这个<code>洞</code>是由三个轮廓组成的。</p> 
<ul><li> <p><code>RETR_TREE</code>：这个是非常严谨的表达轮廓间层级关系的参数<br> 直接输出<code>hierarchy</code>看看：</p> <pre><code class="prism language-python">contours<span class="token punctuation">,</span> hierarchy <span class="token operator">=</span> cv2<span class="token punctuation">.</span>findContours<span class="token punctuation">(</span>bin_img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>RETR_TREE<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>CHAIN_APPROX_SIMPLE<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>hierarchy<span class="token punctuation">)</span>
<span class="token comment"># 红:0  橙;1  黄:2  绿:3  青:4  蓝:5  紫:6  灰:7</span>
<span class="token triple-quoted-string string">'''
[[[ 6 -1  1 -1]
  [-1 -1  2  0]
  [-1 -1  3  1]
  [-1 -1  4  2]
  [ 5 -1 -1  3]
  [-1  4 -1  3]
  [ 7  0 -1 -1]
  [-1  6 -1 -1]]]
'''</span>
</code></pre> <p>真正的由外向内，一层一层的编号；是<code>CCOMP</code>的更进一步细化，如果<code>CCOMP</code>中构成<code>洞</code>的两个轮廓的外轮廓在其它轮廓内部，那么就是从其它轮廓编号继续编号，即<code>洞</code>的外轮廓的父亲是包含它的紧邻着的轮廓编号。</p> <p>通过判断父亲是否相同，将轮廓按照层级画出来</p> <pre><code class="prism language-python">img_show <span class="token operator">=</span> img<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>contours<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    cv2<span class="token punctuation">.</span>drawContours<span class="token punctuation">(</span>img_show<span class="token punctuation">,</span>contours<span class="token punctuation">,</span>i<span class="token punctuation">,</span>colormap<span class="token punctuation">[</span>hierarchy<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img_show<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>
</code></pre> </li></ul> 
<p><img src="https://images2.imgbox.com/94/ef/MYz04CWq_o.png" alt="在这里插入图片描述"></p> 
<p>可以发现，红色部分就是最外圈轮廓，父亲为-1；而最内部的青色(菱形、六角星)的孩子是-1，父亲是绿色的轮廓3。</p> 
<h3><a id="_275"></a>存储方法</h3> 
<p><code>CHAIN_APPROX_NONE</code>和<code>CHAIN_APPROX_SIMPLE</code>的区别就在于轮廓为线段的部分，是否仅存储端点坐标。</p> 
<p>比如上述图片的最外层的矩形轮廓，分别使用两种存储参数去存储轮廓点的值：</p> 
<p>使用<code>SIMPLE</code>只保存端点</p> 
<pre><code class="prism language-python">contours<span class="token punctuation">,</span> hierarchy <span class="token operator">=</span> cv2<span class="token punctuation">.</span>findContours<span class="token punctuation">(</span>bin_img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>RETR_TREE<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>CHAIN_APPROX_SIMPLE<span class="token punctuation">)</span>
img_show <span class="token operator">=</span> img<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
cnt_idx <span class="token operator">=</span> <span class="token number">0</span>
cnt <span class="token operator">=</span> contours<span class="token punctuation">[</span>cnt_idx<span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>cnt<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>img_show<span class="token punctuation">,</span><span class="token punctuation">(</span>cnt<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>cnt<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img_show<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e3/f3/2sym3dqp_o.png" alt="在这里插入图片描述"></p> 
<p>使用<code>NONE</code>按像素保存</p> 
<pre><code class="prism language-python">contours<span class="token punctuation">,</span> hierarchy <span class="token operator">=</span> cv2<span class="token punctuation">.</span>findContours<span class="token punctuation">(</span>bin_img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>RETR_TREE<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>CHAIN_APPROX_NONE<span class="token punctuation">)</span>
img_show <span class="token operator">=</span> img<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
cnt_idx <span class="token operator">=</span> <span class="token number">0</span>
cnt <span class="token operator">=</span> contours<span class="token punctuation">[</span>cnt_idx<span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>cnt<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>img_show<span class="token punctuation">,</span><span class="token punctuation">(</span>cnt<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>cnt<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img_show<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/7a/bd/S4HmSkhr_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_311"></a>轮廓的其它特征和属性</h2> 
<p>包括轮廓的图像矩、面积、周长、多边形逼近、外接凸多边形、凸性判断、外接矩形、外接圆、外接椭圆、直线拟合。</p> 
<h3><a id="_315"></a>图像矩</h3> 
<p>维基百科中的解释是：指图像的某些特定像素灰度的加权平均值，或者是图像具有类似功能或意义的属性。可以通过图像的矩来获得图像的部分性质，包括面积(或总体亮度)，以及有关几何中心和方向的信息。它可以被用来获得相对于特定变换的不变性(平移、缩放、旋转不变性) 。具体可查阅维基百科中<a href="https://zh.wikipedia.org/wiki/%E7%9F%A9_%28%E5%9B%BE%E5%83%8F%29" rel="nofollow">图像矩</a>的描述，这里列一下矩的计算方法：</p> 
<ul><li> <p>对于二维连续函数<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           f 
          
         
           ( 
          
         
           x 
          
         
           , 
          
         
           y 
          
         
           ) 
          
         
        
          f(x,y) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span></span></span></span></span>，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ( 
          
         
           p 
          
         
           + 
          
         
           q 
          
         
           ) 
          
         
        
          (p+q) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">q</span><span class="mclose">)</span></span></span></span></span>阶的矩被定义为：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             M 
            
            
            
              p 
             
            
              q 
             
            
           
          
            = 
           
           
           
             ∫ 
            
            
            
              − 
             
            
              ∞ 
             
            
           
             ∞ 
            
           
           
           
             ∫ 
            
            
            
              − 
             
            
              ∞ 
             
            
           
             ∞ 
            
           
           
           
             x 
            
           
             p 
            
           
           
           
             y 
            
           
             q 
            
           
          
            f 
           
          
            ( 
           
          
            x 
           
          
            , 
           
          
            y 
           
          
            ) 
           
          
            d 
           
          
            x 
           
          
            d 
           
          
            y 
           
          
         
           M_{pq}=\int_{-\infty}^{\infty}\int_{-\infty}^{\infty}x^py^qf(x,y)dxdy 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.969438em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">q</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.38457em; vertical-align: -0.970281em;"></span><span class="mop"><span class="mop op-symbol large-op" style="margin-right: 0.44445em; position: relative; top: -0.001125em;">∫</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.41429em;"><span class="" style="top: -1.78805em; margin-left: -0.44445em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">∞</span></span></span></span><span class="" style="top: -3.8129em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∞</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.970281em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mop op-symbol large-op" style="margin-right: 0.44445em; position: relative; top: -0.001125em;">∫</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.41429em;"><span class="" style="top: -1.78805em; margin-left: -0.44445em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">∞</span></span></span></span><span class="" style="top: -3.8129em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∞</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.970281em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.714392em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.714392em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">q</span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span><span class="mord mathdefault">d</span><span class="mord mathdefault">x</span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span></span></span></span></span></span></p> </li><li> <p>对于灰度图像的像素强度<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           I 
          
         
           ( 
          
         
           x 
          
         
           , 
          
         
           y 
          
         
           ) 
          
         
        
          I(x,y) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.07847em;">I</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span></span></span></span></span>，原始图像的矩<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            M 
           
           
           
             i 
            
           
             j 
            
           
          
         
        
          M_{ij} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.969438em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right: 0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span></span>计算方法：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             M 
            
            
            
              i 
             
            
              j 
             
            
           
          
            = 
           
           
           
             ∑ 
            
           
             x 
            
           
           
           
             ∑ 
            
           
             y 
            
           
           
           
             x 
            
           
             i 
            
           
           
           
             y 
            
           
             i 
            
           
          
            I 
           
          
            ( 
           
          
            x 
           
          
            , 
           
          
            y 
           
          
            ) 
           
          
         
           M_{ij}=\sum_x\sum_yx^iy^iI(x,y) 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.969438em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right: 0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.43612em; vertical-align: -1.38611em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.89999em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.25001em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.89999em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.38611em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.874664em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.874664em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right: 0.07847em;">I</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mclose">)</span></span></span></span></span></span></p> </li><li> <p>原始矩包含以下的一些的有关原始图像属性的信息：</p> 
  <ul><li>二值图像的面积或灰度图像的像素总和，可以表示为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             M 
            
           
             00 
            
           
          
         
           M_{00} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span></li><li>图像的几何中心可以表示为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            { 
           
           
           
             x 
            
           
             ˉ 
            
           
          
            , 
           
           
           
             y 
            
           
             ˉ 
            
           
          
            } 
           
          
            = 
           
          
            { 
           
           
            
            
              M 
             
            
              10 
             
            
            
            
              M 
             
            
              00 
             
            
           
          
            , 
           
           
            
            
              M 
             
            
              01 
             
            
            
            
              M 
             
            
              00 
             
            
           
          
            } 
           
          
         
           \{\bar x,\bar y\}= \{\frac{M_{10}}{M_{00}},\frac{M_{01}}{M_{00}}\} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">{<!-- --></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.56778em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathdefault">x</span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.22222em;">ˉ</span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.56778em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.19444em;">ˉ</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span><span class="mclose">}</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.33353em; vertical-align: -0.4451em;"></span><span class="mopen">{<!-- --></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.888431em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: -0.10903em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: -0.10903em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.888431em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: -0.10903em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: -0.10903em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4451em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">}</span></span></span></span></span></li></ul> </li></ul> 
<p>在<code>OpenCV</code>中的表示为：</p> 
<pre><code class="prism language-python">cnt <span class="token operator">=</span> contours<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
M <span class="token operator">=</span> cv<span class="token punctuation">.</span>moments<span class="token punctuation">(</span>cnt<span class="token punctuation">)</span>
</code></pre> 
<p>中心为：</p> 
<pre><code class="prism language-python">cx <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>M<span class="token punctuation">[</span><span class="token string">'m10'</span><span class="token punctuation">]</span><span class="token operator">/</span>M<span class="token punctuation">[</span><span class="token string">'m00'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
cy <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>M<span class="token punctuation">[</span><span class="token string">'m01'</span><span class="token punctuation">]</span><span class="token operator">/</span>M<span class="token punctuation">[</span><span class="token string">'m00'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_348"></a>轮廓面积和周长</h3> 
<p>获取指定轮廓所包含的面积</p> 
<pre><code class="prism language-python">area <span class="token operator">=</span> cv<span class="token punctuation">.</span>contourArea<span class="token punctuation">(</span>cnt<span class="token punctuation">)</span>
</code></pre> 
<p>获取指定轮廓所包含的周长，第二个参数指示当前输入为闭合轮廓(true)还是非闭合曲线(false)</p> 
<pre><code class="prism language-python">perimeter <span class="token operator">=</span> cv<span class="token punctuation">.</span>arcLength<span class="token punctuation">(</span>cnt<span class="token punctuation">,</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_362"></a>轮廓多边形逼近</h3> 
<p>通过具有更少轮廓点的形状在允许误差范围内逼近指定轮廓，比如你提取一个矩形，但是有锯齿导致轮廓不是矩形，可以使用此功能将矩形近似逼近出来</p> 
<pre><code class="prism language-python">epsilon <span class="token operator">=</span> <span class="token number">0.1</span><span class="token operator">*</span>cv<span class="token punctuation">.</span>arcLength<span class="token punctuation">(</span>cnt<span class="token punctuation">,</span><span class="token boolean">True</span><span class="token punctuation">)</span>
approx <span class="token operator">=</span> cv<span class="token punctuation">.</span>approxPolyDP<span class="token punctuation">(</span>cnt<span class="token punctuation">,</span>epsilon<span class="token punctuation">,</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<p>这个意思就是新的轮廓的周长和原始轮廓周长的误差范围在原周长的十分之一以内。</p> 
<p>比如最开始的例子中，最内部的六角星的轮廓点并不是规整的五角星轮廓，也就是说使用<code>SIMPLE</code>存储的时候不是存的每条边的端点。</p> 
<p>下图就是使用这个逼近函数去找到端点的结果：</p> 
<pre><code class="prism language-python">contours<span class="token punctuation">,</span> hierarchy <span class="token operator">=</span> cv2<span class="token punctuation">.</span>findContours<span class="token punctuation">(</span>bin_img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>RETR_TREE<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>CHAIN_APPROX_SIMPLE<span class="token punctuation">)</span>
img_show <span class="token operator">=</span> img<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
cnt_idx <span class="token operator">=</span> <span class="token number">4</span>
cnt <span class="token operator">=</span> contours<span class="token punctuation">[</span>cnt_idx<span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>cnt<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>img_show<span class="token punctuation">,</span><span class="token punctuation">(</span>cnt<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>cnt<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>

epsilon <span class="token operator">=</span> <span class="token number">0.1</span><span class="token operator">*</span>cv2<span class="token punctuation">.</span>arcLength<span class="token punctuation">(</span>cnt<span class="token punctuation">,</span><span class="token boolean">True</span><span class="token punctuation">)</span>
approx <span class="token operator">=</span> cv2<span class="token punctuation">.</span>approxPolyDP<span class="token punctuation">(</span>cnt<span class="token punctuation">,</span>epsilon<span class="token punctuation">,</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>approx<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>img_show<span class="token punctuation">,</span><span class="token punctuation">(</span>approx<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>approx<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img_show<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/3b/d4/9u3jA6d4_o.png" alt="在这里插入图片描述"></p> 
<p>绿色为原始轮廓点，红色为逼近后的轮廓点，可以发现六角星的所有边的顶点都保存了</p> 
<h3><a id="_399"></a>轮廓凸多边形逼近</h3> 
<p>上面的多边形逼近不管简化的轮廓是否为凸的，所以又提供了一个检测凸多边形逼近的函数</p> 
<pre><code class="prism language-python">hull <span class="token operator">=</span> cv<span class="token punctuation">.</span>convexHull<span class="token punctuation">(</span>points<span class="token punctuation">[</span><span class="token punctuation">,</span> hull<span class="token punctuation">[</span><span class="token punctuation">,</span> clockwise<span class="token punctuation">[</span><span class="token punctuation">,</span> returnPoints<span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre> 
<p>输入分别为：轮廓点、输出(不管这个参数)、顺时针(true)/逆时针(false)、返回多边形坐标在原轮廓点序中的索引(False)/直接返回坐标(true)</p> 
<p>还是那个六角星：</p> 
<pre><code class="prism language-python">contours<span class="token punctuation">,</span> hierarchy <span class="token operator">=</span> cv2<span class="token punctuation">.</span>findContours<span class="token punctuation">(</span>bin_img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>RETR_TREE<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>CHAIN_APPROX_SIMPLE<span class="token punctuation">)</span>
img_show <span class="token operator">=</span> img<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
cnt_idx <span class="token operator">=</span> <span class="token number">4</span>
cnt <span class="token operator">=</span> contours<span class="token punctuation">[</span>cnt_idx<span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>cnt<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>img_show<span class="token punctuation">,</span><span class="token punctuation">(</span>cnt<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>cnt<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>

approx <span class="token operator">=</span> cv2<span class="token punctuation">.</span>convexHull<span class="token punctuation">(</span>cnt<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>approx<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>img_show<span class="token punctuation">,</span><span class="token punctuation">(</span>approx<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>approx<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img_show<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/88/4d/RIVjzW1R_o.png" alt="在这里插入图片描述"></p> 
<p>绿色为原始轮廓点，红色为凸多边形逼近后的轮廓点，可以发现比多边形逼近函数的结果少了内凹角顶点。</p> 
<h3><a id="_432"></a>凸性检测</h3> 
<p>如何判断一个轮廓是否为凸的，有一个函数<code>k = cv.isContourConvex(cnt)</code>，返回<code>true</code>就是凸的。</p> 
<p><code>OpenCV</code>对这个凸多边形还提供了提取更详细信息的函数<code>convexityDefects</code>，用于获取凸多边形和轮廓之间的关系：</p> 
<pre><code class="prism language-python">void convexityDefects<span class="token punctuation">(</span>InputArray contour<span class="token punctuation">,</span> InputArray convexhull<span class="token punctuation">,</span> OutputArrayconvexityDefects<span class="token punctuation">)</span>
</code></pre> 
<p>输入：原始轮廓点、凸多边形顶点对应原轮廓中的索引、输出(不管)</p> 
<p>所以针对那个五角星的调用方法是：</p> 
<pre><code class="prism language-python">contours<span class="token punctuation">,</span> hierarchy <span class="token operator">=</span> cv2<span class="token punctuation">.</span>findContours<span class="token punctuation">(</span>bin_img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>RETR_TREE<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>CHAIN_APPROX_NONE<span class="token punctuation">)</span>
cnt_idx <span class="token operator">=</span> <span class="token number">4</span>
cnt <span class="token operator">=</span> contours<span class="token punctuation">[</span>cnt_idx<span class="token punctuation">]</span>
approx <span class="token operator">=</span> cv2<span class="token punctuation">.</span>convexHull<span class="token punctuation">(</span>cnt<span class="token punctuation">,</span>returnPoints<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token comment">#使用false获取多边形顶点索引</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>convexityDefects<span class="token punctuation">(</span>cnt<span class="token punctuation">,</span>approx<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
[[[ 321    0  357 4403]]
 [[   0   67   31 4403]]
 [[  67  128   96 4230]]
 [[ 128  194  163 4223]]
 [[ 194  260  225 4223]]
 [[ 260  321  292 4230]]]
'''</span>
</code></pre> 
<p>得到了和多边形逼近线段个数相同行的列为4的矩阵，分别代表：起始点索引、结束点索引、当前线段截取的轮廓点中距离线段最远的点索引、这个最远点与当前线段的距离</p> 
<p>验证一下，把第三个维度，也就是距离每条边最远的轮廓点画出来：</p> 
<p><img src="https://images2.imgbox.com/d2/f5/h67xbwHj_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_470"></a>边界框</h3> 
<p>分为矩形、圆形边界</p> 
<ul><li> <p><strong>矩形</strong>：不考虑形状的旋转，获取直边界矩形</p> <pre><code class="prism language-python">x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>w<span class="token punctuation">,</span>h <span class="token operator">=</span> cv2<span class="token punctuation">.</span>boundingRect<span class="token punctuation">(</span>cnt<span class="token punctuation">)</span>
</code></pre> </li><li> <p><strong>矩形</strong>考虑旋转，获取最小的外接矩形</p> <pre><code class="prism language-python">rect <span class="token operator">=</span> cv2<span class="token punctuation">.</span>minAreaRect<span class="token punctuation">(</span>cnt<span class="token punctuation">)</span>
box <span class="token operator">=</span> cv2<span class="token punctuation">.</span>boxPoints<span class="token punctuation">(</span>rect<span class="token punctuation">)</span>
box <span class="token operator">=</span> np<span class="token punctuation">.</span>int0<span class="token punctuation">(</span>box<span class="token punctuation">)</span>
</code></pre> </li></ul> 
<p>画图看看区别，直边界用绿色，最小外接矩形用红色</p> 
<pre><code class="prism language-python">img_show <span class="token operator">=</span> img<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#无旋转矩形</span>
cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>img_show<span class="token punctuation">,</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>x<span class="token operator">+</span>w<span class="token punctuation">,</span>y<span class="token operator">+</span>h<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token comment">#有旋转矩形</span>
cv2<span class="token punctuation">.</span>drawContours<span class="token punctuation">(</span>img_show<span class="token punctuation">,</span><span class="token punctuation">[</span>box<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img_show<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f5/9e/ZxGo2HM5_o.png" alt="在这里插入图片描述"></p> 
<p><strong>外接圆</strong>：<code>minEnclosingCircle</code></p> 
<pre><code># 最小外接圆
(x,y),radius = cv2.minEnclosingCircle(cnt)
center = (int(x),int(y))
radius = int(radius)

img_show = img.copy()
cv2.circle(img,center,radius,(0,255,0),10)
plt.imshow(img_show[...,::-1])
plt.axis('off')
</code></pre> 
<p><img src="https://images2.imgbox.com/92/0b/4Vk2xcSq_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_521"></a>形状拟合</h3> 
<p>包括椭圆、直线拟合</p> 
<p>椭圆拟合：<code>fitEllipse</code>，将里面的那个菱形拟合</p> 
<pre><code class="prism language-python"><span class="token comment"># 椭圆拟合</span>
ellipse <span class="token operator">=</span> cv2<span class="token punctuation">.</span>fitEllipse<span class="token punctuation">(</span>contours<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

img_show <span class="token operator">=</span> img<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>ellipse<span class="token punctuation">(</span>img_show<span class="token punctuation">,</span>ellipse<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img_show<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/96/98/FZ0LTSid_o.png" alt="在这里插入图片描述"></p> 
<p><strong>直线拟合</strong>：<code>fitLine</code>，使得当前轮廓所有点与直线距离和最短</p> 
<pre><code class="prism language-python">rows<span class="token punctuation">,</span>cols <span class="token operator">=</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>vx<span class="token punctuation">,</span>vy<span class="token punctuation">,</span>x<span class="token punctuation">,</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> cv2<span class="token punctuation">.</span>fitLine<span class="token punctuation">(</span>cnt<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>DIST_L2<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0.01</span><span class="token punctuation">,</span><span class="token number">0.01</span><span class="token punctuation">)</span>
lefty <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span>x<span class="token operator">*</span>vy<span class="token operator">/</span>vx<span class="token punctuation">)</span> <span class="token operator">+</span> y<span class="token punctuation">)</span>
righty <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>cols<span class="token operator">-</span>x<span class="token punctuation">)</span><span class="token operator">*</span>vy<span class="token operator">/</span>vx<span class="token punctuation">)</span><span class="token operator">+</span>y<span class="token punctuation">)</span>

img_show <span class="token operator">=</span> img<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>line<span class="token punctuation">(</span>img_show<span class="token punctuation">,</span><span class="token punctuation">(</span>cols<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>righty<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>lefty<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img_show<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_554"></a>点与轮廓的关系</h3> 
<p>通过<code>pointPolygonTest</code>函数判断某个点是否在轮廓内部后者外部，然后返回距离轮廓的最短距离</p> 
<pre><code class="prism language-python">retval<span class="token operator">=</span>cv<span class="token punctuation">.</span>pointPolygonTest<span class="token punctuation">(</span>contour<span class="token punctuation">,</span>pt<span class="token punctuation">,</span>measureDist<span class="token punctuation">)</span>
</code></pre> 
<p>输入分别为：轮廓、某个点、是否返回距离；如果仅仅需要判断点是否再轮廓内部，第三个参数设置<code>False</code>，在内部为+1，外部为-1，在轮廓上为0。</p> 
<h3><a id="_564"></a>形状匹配</h3> 
<p>可以利用<code>matchShapes</code>输入两个轮廓，计算相似度，得分越低越相似</p> 
<pre><code class="prism language-python">retval	<span class="token operator">=</span>	cv<span class="token punctuation">.</span>matchShapes<span class="token punctuation">(</span>	contour1<span class="token punctuation">,</span> contour2<span class="token punctuation">,</span> method<span class="token punctuation">,</span> parameter	<span class="token punctuation">)</span>
</code></pre> 
<p>输入为：第一个形状的轮廓、第二给形状的轮廓、匹配算法、参数(暂不支持，不管)</p> 
<p>匹配算法是基于图像的Hu矩，计算方法为：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           m 
          
         
           i 
          
         
        
          = 
         
        
          s 
         
        
          i 
         
        
          g 
         
        
          n 
         
        
          ( 
         
         
         
           h 
          
         
           i 
          
         
        
          ) 
         
        
          ⋅ 
         
        
          log 
         
        
          ⁡ 
         
         
         
           h 
          
         
           i 
          
         
        
       
         m_i = sign(h_i)\cdot \log h_i 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right: 0.03588em;">g</span><span class="mord mathdefault">n</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mop">lo<span style="margin-right: 0.01389em;">g</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span><br> 其中<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          h 
         
        
          i 
         
        
       
      
        h_i 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>代表Hu矩。</p> 
<p>匹配算法分为：</p> 
<p><img src="https://images2.imgbox.com/e9/9a/k8DwRxsT_o.png" alt="在这里插入图片描述"></p> 
<p>使用案例，先构建一些图像，然后计算相似度：</p> 
<pre><code class="prism language-python">img1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'shape1.png'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
img2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'shape2.png'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
img3 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'shape3.png'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
ret<span class="token punctuation">,</span> thresh <span class="token operator">=</span> cv2<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
ret<span class="token punctuation">,</span> thresh2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>img2<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
ret<span class="token punctuation">,</span> thresh3 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>img3<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
contours<span class="token punctuation">,</span>hierarchy <span class="token operator">=</span> cv2<span class="token punctuation">.</span>findContours<span class="token punctuation">(</span>thresh<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
cnt1 <span class="token operator">=</span> contours<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
contours<span class="token punctuation">,</span>hierarchy <span class="token operator">=</span> cv2<span class="token punctuation">.</span>findContours<span class="token punctuation">(</span>thresh2<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
cnt2 <span class="token operator">=</span> contours<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
contours<span class="token punctuation">,</span>hierarchy <span class="token operator">=</span> cv2<span class="token punctuation">.</span>findContours<span class="token punctuation">(</span>thresh3<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
cnt3 <span class="token operator">=</span> contours<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
ret1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>matchShapes<span class="token punctuation">(</span>cnt1<span class="token punctuation">,</span>cnt2<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span>
ret2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>matchShapes<span class="token punctuation">(</span>cnt1<span class="token punctuation">,</span>cnt3<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span> ret1<span class="token punctuation">,</span>ret2 <span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">131</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img1<span class="token punctuation">,</span>cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">132</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img2<span class="token punctuation">,</span>cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">133</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img3<span class="token punctuation">,</span>cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
0.14475720763533126 0.3168697153308031
'''</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/04/e3/8C01VHin_o.png" alt="在这里插入图片描述"></p> 
<p>可以发现形状1和2的非常接近，一个四角星一个五角星，他俩得分很低，越相似。</p> 
<h3><a id="_622"></a>其它属性</h3> 
<ul><li> <p>获取掩膜(<code>mask</code>)</p> <pre><code class="prism language-python">mask <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>gray_img<span class="token punctuation">.</span>shape<span class="token punctuation">,</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>drawContours<span class="token punctuation">(</span>mask<span class="token punctuation">,</span><span class="token punctuation">[</span>cnt<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
pixelpoints <span class="token operator">=</span> np<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span>np<span class="token punctuation">.</span>nonzero<span class="token punctuation">(</span>mask<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#pixelpoints = cv.findNonZero(mask)</span>
plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>mask<span class="token punctuation">,</span>cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
</code></pre> </li></ul> 
<p><img src="https://images2.imgbox.com/9d/d8/PVAbMJae_o.png" alt="在这里插入图片描述"></p> 
<p>注意使用可以使用<code>numpy</code>或者<code>OpenCV</code>去查找到掩膜内所有像素坐标，但是他俩的位置不一样，因此<code>numpy</code>的坐标需要转置才能与<code>OpenCV</code>保持一致，列是<code>x</code>，行是<code>y</code></p> 
<ul><li> <p>获取局部最大值、最小值级它们的位置</p> <pre><code class="prism language-python">min_val<span class="token punctuation">,</span> max_val<span class="token punctuation">,</span> min_loc<span class="token punctuation">,</span> max_loc <span class="token operator">=</span> cv<span class="token punctuation">.</span>minMaxLoc<span class="token punctuation">(</span>imgray<span class="token punctuation">,</span>mask <span class="token operator">=</span> mask<span class="token punctuation">)</span>
</code></pre> <p>注意第一个参数必须是单通道的图，第二个参数可有可无，用于选择特定区域。</p> <p>这个在<code>Openpose</code>中，从每个关节的特征图中提取关节坐标用到过，具体可看之前<a href="https://mp.weixin.qq.com/s?__biz=MzU1NzU2MzcyMw==&amp;mid=2247483921&amp;idx=1&amp;sn=69912cd2dce6272f2d0f3ac9c3773f90&amp;chksm=fc32a835cb452123fde26faccb56421cf6d4945c5d3a16be85fae5e5d95ac5d784e577eedf29&amp;token=1989799049&amp;lang=zh_CN#rd" rel="nofollow">解析<code>OpenPose</code>的文章</a>。</p> </li><li> <p>均值：通道分开</p> <pre><code class="prism language-python">mean_val <span class="token operator">=</span> cv<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>im<span class="token punctuation">,</span>mask <span class="token operator">=</span> mask<span class="token punctuation">)</span>
</code></pre> </li></ul> 
<h2><a id="_655"></a>后记</h2> 
<p>图像处理经常遇到轮廓相关的问题，比如二维码检测定位之类的大都是用二维码四个角的定位符和矫正符的比例特征来定位。这里对官方的教程做了简单的综合整理。</p> 
<p><strong>完整的<code>python</code>脚本实现放在微信公众号的简介中描述的github中</strong>，有兴趣可以去找找，同时文章也同步到微信公众号中，有疑问或者兴趣欢迎公众号私信。</p> 
<p><img src="https://images2.imgbox.com/c5/36/P5SCW1jM_o.jpg" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/02fac0c712655f789ca0ab3f2823f2b7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java 获取list中的两两组合，给定一个数组，获取排列组合</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/07d282cc46ec406c115d4f089d81ad00/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python是c语言写的吗-python是用c写的吗</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>