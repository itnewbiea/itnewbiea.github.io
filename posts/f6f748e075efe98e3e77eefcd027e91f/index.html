<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>16.Flink开发笔记一 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="16.Flink开发笔记一" />
<meta property="og:description" content="Flink开发笔记 1. pom.xml2. 并行度优先级问题3. wordcount再standalone结点（默认配置）提交资源不足的问题4. 集群提交常用命令5. 执行图6. slot共享组7. 自定义Source8. KeyedStream9. SplitStream（Please use side outputs instead of split/select）10. ConnectedStreams11. 富函数12. Broadcast流 1. pom.xml &lt;properties&gt; &lt;maven.compiler.source&gt;8&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;8&lt;/maven.compiler.target&gt; &lt;flink.version&gt;1.11.3&lt;/flink.version&gt; &lt;scala.binary.version&gt;2.11&lt;/scala.binary.version&gt; &lt;/properties&gt; &lt;!--在idea中调试flink程序--&gt; &lt;dependency&gt; &lt;groupId&gt;org.scala-lang&lt;/groupId&gt; &lt;artifactId&gt;scala-library&lt;/artifactId&gt; &lt;version&gt;2.11.8&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-clients_2.11&lt;/artifactId&gt; &lt;version&gt;${flink.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--重点1--&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-scala_2.11&lt;/artifactId&gt; &lt;version&gt;${flink.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--重点2--&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-streaming-scala_2.11&lt;/artifactId&gt; &lt;version&gt;${flink.version}&lt;/version&gt; &lt;/dependency&gt; &lt;build&gt; &lt;!--注意maven版本太低导致的问题，当前用的3.6.3--&gt; &lt;plugins&gt; &lt;!--重点3--&gt; &lt;!--该插件用于将scala代码编译成class文件--&gt; &lt;plugin&gt; &lt;groupId&gt;net.alchim31.maven&lt;/groupId&gt; &lt;artifactId&gt;scala-maven-plugin&lt;/artifactId&gt; &lt;version&gt;4.4.0&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;goals&gt; &lt;goal&gt;compile&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;!--重点1--&gt; &lt;!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/f6f748e075efe98e3e77eefcd027e91f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-16T18:53:52+08:00" />
<meta property="article:modified_time" content="2021-04-16T18:53:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">16.Flink开发笔记一</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Flink开发笔记</h4> 
 <ul><li><a href="#1_pomxml_1" rel="nofollow">1. pom.xml</a></li><li><a href="#2__79" rel="nofollow">2. 并行度优先级问题</a></li><li><a href="#3_wordcountstandalone_81" rel="nofollow">3. wordcount再standalone结点（默认配置）提交资源不足的问题</a></li><li><a href="#4__90" rel="nofollow">4. 集群提交常用命令</a></li><li><a href="#5__111" rel="nofollow">5. 执行图</a></li><li><a href="#6_slot_113" rel="nofollow">6. slot共享组</a></li><li><a href="#7_Source_123" rel="nofollow">7. 自定义Source</a></li><li><a href="#8_KeyedStream_186" rel="nofollow">8. KeyedStream</a></li><li><a href="#9_SplitStreamPlease_use_side_outputs_instead_of_splitselect_211" rel="nofollow">9. SplitStream（Please use side outputs instead of split/select）</a></li><li><a href="#10_ConnectedStreams_224" rel="nofollow">10. ConnectedStreams</a></li><li><a href="#11__246" rel="nofollow">11. 富函数</a></li><li><a href="#12_Broadcast_248" rel="nofollow">12. Broadcast流</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1_pomxml_1"></a>1. pom.xml</h2> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flink.version</span><span class="token punctuation">&gt;</span></span>1.11.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>flink.version</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scala.binary.version</span><span class="token punctuation">&gt;</span></span>2.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scala.binary.version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--在idea中调试flink程序--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.scala-lang<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>scala-library<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.11.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-clients_2.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--重点1--&gt;</span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-scala_2.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

 <span class="token comment">&lt;!--重点2--&gt;</span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-streaming-scala_2.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
   <span class="token comment">&lt;!--注意maven版本太低导致的问题，当前用的3.6.3--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--重点3--&gt;</span>
        <span class="token comment">&lt;!--该插件用于将scala代码编译成class文件--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>net.alchim31.maven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>scala-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.4.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>compile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--重点1--&gt;</span>
        <span class="token comment">&lt;!--打fat包插件--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-assembly-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>descriptorRefs</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>descriptorRef</span><span class="token punctuation">&gt;</span></span>jar-with-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>descriptorRef</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>descriptorRefs</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>make-assembly<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase</span><span class="token punctuation">&gt;</span></span>package<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phase</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>single<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h2><a id="2__79"></a>2. 并行度优先级问题</h2> 
<p><img src="https://images2.imgbox.com/ab/22/zenn8Gp0_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="3_wordcountstandalone_81"></a>3. wordcount再standalone结点（默认配置）提交资源不足的问题</h2> 
<p><img src="https://images2.imgbox.com/39/b6/grL2e3aF_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/4a/d4/rj8Csa3S_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/ea/01/ue7QThqj_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/7e/01/bgbZBV3R_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/04/a6/nsQPQMil_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/86/2a/ju9W3Rqs_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="4__90"></a>4. 集群提交常用命令</h2> 
<ul><li> <p>bin/flink list</p> </li><li> <p>bin/flink cancel</p> </li><li> <p>bin/flink run -c com.xiaofan.wc.StreamWordCount -p 2 /home/hadoop/fanjh/jar/FlinkTutorial-1.0-jar-with-dependencies.jar --host 192.168.1.27 --port 9999</p> </li><li> <p>yarn application -list</p> </li><li> <p>yarn application -kill application_1617758450736_0066</p> </li><li> <p>bin/flink run -m yarn-cluster -c com.xiaofan.wc.StreamWordCount -p 2 /home/hadoop/fanjh/jar/FlinkTurorial1.12.2-1.0-SNAPSHOT-jar-with-dependencies.jar --host 192.168.1.27 --port 9999</p> </li><li> <p>bin/flink run-application -t yarn-application <br> -c com.xiaofan.wc.StreamWordCount <br> -Denv.hadoop.conf.dir=/home/hadoop/app/hadoop/etc/hadoop <br> -Dyarn.application.queue=“flink” <br> -Djobmanager.memory.process.size=1024m <br> -Dtaskmanager.memory.process.size=1024m <br> -Dtaskmanager.numberOfTaskSlots=4 <br> -Dparallelism.default=4 <br> -Dyarn.application-attempts=4 <br> -Dyarn.application.name=“test” <br> hdfs://cluster/flink-1.12/jar/FlinkTurorial1.12.2-1.0-SNAPSHOT-jar-with-dependencies.jar --host 192.168.1.27 --port 9999</p> </li></ul> 
<h2><a id="5__111"></a>5. 执行图</h2> 
<p><img src="https://images2.imgbox.com/46/2a/lLjpni43_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="6_slot_113"></a>6. slot共享组</h2> 
<pre><code class="prism language-scala">env<span class="token punctuation">.</span>disableOperatorChaining<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 全局禁用链条</span>
<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>_<span class="token punctuation">.</span>nonEmpty<span class="token punctuation">)</span><span class="token punctuation">.</span>disableChaining<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 断开前后的chain链条</span>
<span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>startNewChain<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">// 重新开启一个chain链条,断开前面的</span>
断开链条的最终目的：不想共用slot，但是有可能再次共用了
<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>_<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>slotSharingGroup<span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span> <span class="token comment">// slot共享组</span>
</code></pre> 
<h2><a id="7_Source_123"></a>7. 自定义Source</h2> 
<pre><code class="prism language-scala"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaofan<span class="token punctuation">.</span>apitest<span class="token punctuation">.</span>source

<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>functions<span class="token punctuation">.</span>source<span class="token punctuation">.</span>SourceFunction
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>scala<span class="token punctuation">.</span>_

<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Random


<span class="token keyword">case</span> <span class="token keyword">class</span> SensorReading<span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> timestamp<span class="token operator">:</span> <span class="token builtin">Long</span><span class="token punctuation">,</span> temperature<span class="token operator">:</span> <span class="token builtin">Double</span><span class="token punctuation">)</span>

<span class="token comment">/**
 * 自定义 SourceFunction
 */</span>
<span class="token keyword">object</span> CustomSourceTest <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">val</span> env<span class="token operator">:</span> StreamExecutionEnvironment <span class="token operator">=</span> StreamExecutionEnvironment<span class="token punctuation">.</span>getExecutionEnvironment
    <span class="token comment">// env.setParallelism(1)</span>

    <span class="token keyword">val</span> data<span class="token operator">:</span> DataStream<span class="token punctuation">[</span>SensorReading<span class="token punctuation">]</span> <span class="token operator">=</span> env<span class="token punctuation">.</span>addSource<span class="token punctuation">(</span><span class="token keyword">new</span> MySensorSourceFunction<span class="token punctuation">)</span>
    data<span class="token punctuation">.</span>print<span class="token punctuation">(</span><span class="token punctuation">)</span>

    env<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"custom source test"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> MySensorSourceFunction <span class="token keyword">extends</span> SourceFunction<span class="token punctuation">[</span>SensorReading<span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span>

  <span class="token comment">// 定义一个标识为flag，用来表示数据源是否正常发送数据</span>
  <span class="token keyword">var</span> running<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> <span class="token boolean">true</span>

  <span class="token keyword">override</span> <span class="token keyword">def</span> run<span class="token punctuation">(</span>ctx<span class="token operator">:</span> SourceFunction<span class="token punctuation">.</span>SourceContext<span class="token punctuation">[</span>SensorReading<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">val</span> rand <span class="token operator">=</span> <span class="token keyword">new</span> Random<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// 随机生成一组（10个）传感器的初始温度：(id, temperature)</span>
    <span class="token keyword">var</span> curTemp <span class="token operator">=</span> <span class="token number">1.</span>to<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span>i <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span><span class="token string">"sensor_"</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> rand<span class="token punctuation">.</span>nextDouble<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">// 定义无限循环，不停的产生数据，除非被 cancel</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>running<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 在上次数据的基础上微调，更新温度值（高斯分布）</span>
      curTemp <span class="token operator">=</span> curTemp<span class="token punctuation">.</span>map<span class="token punctuation">(</span>
        data <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>_1<span class="token punctuation">,</span> data<span class="token punctuation">.</span>_2 <span class="token operator">+</span> rand<span class="token punctuation">.</span>nextGaussian<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>

      <span class="token comment">// 获取当前时间戳，加入到数据中</span>
      <span class="token keyword">val</span> curTime<span class="token operator">:</span> <span class="token builtin">Long</span> <span class="token operator">=</span> System<span class="token punctuation">.</span>currentTimeMillis<span class="token punctuation">(</span><span class="token punctuation">)</span>

      curTemp<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>
        data <span class="token keyword">=&gt;</span> ctx<span class="token punctuation">.</span>collect<span class="token punctuation">(</span>SensorReading<span class="token punctuation">(</span>data<span class="token punctuation">.</span>_1<span class="token punctuation">,</span> curTime<span class="token punctuation">,</span> data<span class="token punctuation">.</span>_2<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>

      <span class="token comment">// 间隔500ms</span>
      Thread<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">override</span> <span class="token keyword">def</span> cancel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> running <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="8_KeyedStream_186"></a>8. KeyedStream</h2> 
<pre><code class="prism language-scala"><span class="token comment">/*
      min: 取相同key的第一条元素的值
      minBy: 取相同key的最小的元素的所有信息
      reduce：自定义聚合函数，取最小的温度，同时取最新的时间
     */</span>

    <span class="token comment">// 1. 分组聚合，输出每个传感器当前的最小值，时间戳是这条数据对应的时间</span>
    <span class="token keyword">val</span> aggStream<span class="token operator">:</span> DataStream<span class="token punctuation">[</span>SensorReading<span class="token punctuation">]</span> <span class="token operator">=</span> dataStream
      <span class="token punctuation">.</span>keyBy<span class="token punctuation">(</span>_<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
      <span class="token punctuation">.</span>minBy<span class="token punctuation">(</span><span class="token string">"temperature"</span><span class="token punctuation">)</span>

    aggStream<span class="token punctuation">.</span>print<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// 2. 需要输出当前最小的温度值，以及最近的时间戳，要用reduce</span>
    <span class="token keyword">val</span> resultStream<span class="token operator">:</span> DataStream<span class="token punctuation">[</span>SensorReading<span class="token punctuation">]</span> <span class="token operator">=</span> dataStream
      <span class="token punctuation">.</span>keyBy<span class="token punctuation">(</span>_<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
      <span class="token punctuation">.</span>reduce<span class="token punctuation">(</span>
        <span class="token punctuation">(</span>curState<span class="token punctuation">,</span> newData<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          SensorReading<span class="token punctuation">(</span>curState<span class="token punctuation">.</span>id<span class="token punctuation">,</span> newData<span class="token punctuation">.</span>timestamp<span class="token punctuation">,</span> curState<span class="token punctuation">.</span>temperature<span class="token punctuation">.</span>min<span class="token punctuation">(</span>newData<span class="token punctuation">.</span>temperature<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">)</span>
</code></pre> 
<h2><a id="9_SplitStreamPlease_use_side_outputs_instead_of_splitselect_211"></a>9. SplitStream（Please use side outputs instead of split/select）</h2> 
<pre><code class="prism language-scala">    <span class="token comment">// 3.1. 分流：将传感器温度数据分成低温、高温两条流</span>
    <span class="token keyword">val</span> splitStream<span class="token operator">:</span> SplitStream<span class="token punctuation">[</span>SensorReading<span class="token punctuation">]</span> <span class="token operator">=</span> dataStream<span class="token punctuation">.</span>split<span class="token punctuation">(</span>
      data <span class="token keyword">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>temperature <span class="token operator">&gt;</span> <span class="token number">30.0</span><span class="token punctuation">)</span> Seq<span class="token punctuation">(</span><span class="token string">"high"</span><span class="token punctuation">)</span> <span class="token keyword">else</span> Seq<span class="token punctuation">(</span><span class="token string">"low"</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">val</span> highStream<span class="token operator">:</span> DataStream<span class="token punctuation">[</span>SensorReading<span class="token punctuation">]</span> <span class="token operator">=</span> splitStream<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">"high"</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> lowStream<span class="token operator">:</span> DataStream<span class="token punctuation">[</span>SensorReading<span class="token punctuation">]</span> <span class="token operator">=</span> splitStream<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">"low"</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="10_ConnectedStreams_224"></a>10. ConnectedStreams</h2> 
<p><img src="https://images2.imgbox.com/95/12/1ZknB9Ie_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-scala">    <span class="token comment">// 3.2. 合流 connect</span>
    <span class="token keyword">val</span> warningStream<span class="token operator">:</span> DataStream<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Double</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> highStream<span class="token punctuation">.</span>map <span class="token punctuation">{<!-- --></span> data <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>id<span class="token punctuation">,</span> data<span class="token punctuation">.</span>temperature<span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token keyword">val</span> connectedStream<span class="token operator">:</span> ConnectedStreams<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Double</span><span class="token punctuation">)</span><span class="token punctuation">,</span> SensorReading<span class="token punctuation">]</span> <span class="token operator">=</span> warningStream<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>lowStream<span class="token punctuation">)</span>

    <span class="token comment">// 用coMap对数据进行分别处理</span>
    <span class="token keyword">val</span> coMapResultStream<span class="token operator">:</span> DataStream<span class="token punctuation">[</span>Product<span class="token punctuation">]</span> <span class="token operator">=</span> connectedStream<span class="token punctuation">.</span>map<span class="token punctuation">(</span>
      warningData <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>warningData<span class="token punctuation">.</span>_1<span class="token punctuation">,</span> warningData<span class="token punctuation">.</span>_2<span class="token punctuation">,</span> <span class="token string">"warning!"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      lowTempData <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>lowTempData<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token string">"healthy~"</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    coMapResultStream<span class="token punctuation">.</span>print<span class="token punctuation">(</span><span class="token string">"coMapResultStream"</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-scala">    <span class="token comment">// 3.3. union 合流（注意和connect流的区别）</span>
    <span class="token keyword">val</span> unionStream<span class="token operator">:</span> DataStream<span class="token punctuation">[</span>SensorReading<span class="token punctuation">]</span> <span class="token operator">=</span> highStream<span class="token punctuation">.</span>union<span class="token punctuation">(</span>lowStream<span class="token punctuation">)</span>
</code></pre> 
<h2><a id="11__246"></a>11. 富函数</h2> 
<p><img src="https://images2.imgbox.com/be/13/RfQDRwUT_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="12_Broadcast_248"></a>12. Broadcast流</h2> 
<pre><code class="prism language-scala">
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span>state<span class="token punctuation">.</span>BroadcastState<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span>state<span class="token punctuation">.</span>MapStateDescriptor<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span>state<span class="token punctuation">.</span>ReadOnlyBroadcastState<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span>typeinfo<span class="token punctuation">.</span>Types<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span>BroadcastConnectedStream<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span>BroadcastStream<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span>DataStreamSource<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>environment<span class="token punctuation">.</span>StreamExecutionEnvironment<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>functions<span class="token punctuation">.</span>co<span class="token punctuation">.</span>BroadcastProcessFunction<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Collector<span class="token punctuation">;</span>


public <span class="token keyword">class</span> State_BroadcastState <span class="token punctuation">{<!-- --></span>
    public static void main<span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//控制流发送到普通流后，普通流会收到一个广播状态</span>
        <span class="token comment">//1.创建环境</span>
        StreamExecutionEnvironment env <span class="token operator">=</span> StreamExecutionEnvironment<span class="token punctuation">.</span>getExecutionEnvironment<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        env<span class="token punctuation">.</span>setParallelism<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        DataStreamSource<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> inputDS <span class="token operator">=</span> env<span class="token punctuation">.</span>socketTextStream<span class="token punctuation">(</span><span class="token string">"192.168.1.27"</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        DataStreamSource<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> controlDS <span class="token operator">=</span> env<span class="token punctuation">.</span>socketTextStream<span class="token punctuation">(</span><span class="token string">"192.168.1.27"</span><span class="token punctuation">,</span> <span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//TODO 1.把其中一条流(控制流) 广播出去</span>
        <span class="token comment">//定义一个Map状态描述器,控制流会把这个状态广播出去</span>
        MapStateDescriptor<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> broadcast <span class="token operator">=</span> <span class="token keyword">new</span> MapStateDescriptor<span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">"boradcast-state"</span><span class="token punctuation">,</span> Types<span class="token punctuation">.</span>STRING<span class="token punctuation">,</span> Types<span class="token punctuation">.</span>STRING<span class="token punctuation">)</span><span class="token punctuation">;</span>
        BroadcastStream<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> contrlBS <span class="token operator">=</span> controlDS<span class="token punctuation">.</span>broadcast<span class="token punctuation">(</span>broadcast<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//TODO 2.把另一条流和广播流关联起来</span>
        BroadcastConnectedStream<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> inputBCS <span class="token operator">=</span> inputDS<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>contrlBS<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//TODO 3.调用Process</span>

        inputBCS<span class="token punctuation">.</span>process<span class="token punctuation">(</span>
                <span class="token keyword">new</span> BroadcastProcessFunction<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">/*
                        获取广播状态，获取数据进行处理
                     */</span>
                    <span class="token annotation punctuation">@Override</span>
                    public void processElement<span class="token punctuation">(</span><span class="token builtin">String</span> value<span class="token punctuation">,</span> ReadOnlyContext ctx<span class="token punctuation">,</span> Collector<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> out<span class="token punctuation">)</span> throws Exception <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">//TODO 5.通过上下文获取广播状态，取出里面的值</span>
                        ReadOnlyBroadcastState<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> broadcastState <span class="token operator">=</span> ctx<span class="token punctuation">.</span>getBroadcastState<span class="token punctuation">(</span>broadcast<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token builtin">String</span> aSwitch <span class="token operator">=</span> broadcastState<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"switch"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">.</span>equals<span class="token punctuation">(</span>aSwitch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            out<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token string">"切换到1的逻辑"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">.</span>equals<span class="token punctuation">(</span>aSwitch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            out<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token string">"切换到2的逻辑"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>


                    <span class="token punctuation">}</span>

                    <span class="token comment">/**
                     * 处理广播流的数据：这里主要定义，什么数据往广播状态存
                     * @param value
                     * @param ctx
                     * @param out
                     * @throws Exception
                     */</span>
                    <span class="token annotation punctuation">@Override</span>
                    public void processBroadcastElement<span class="token punctuation">(</span><span class="token builtin">String</span> value<span class="token punctuation">,</span> Context ctx<span class="token punctuation">,</span> Collector<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> out<span class="token punctuation">)</span> throws Exception <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">// TODO 4.通过上下文获取广播状态,并往广播状态里存数据</span>
                        BroadcastState<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> broadcastState <span class="token operator">=</span> ctx<span class="token punctuation">.</span>getBroadcastState<span class="token punctuation">(</span>broadcast<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        broadcastState<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">"switch"</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">.</span>print<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//提交任务</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            env<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span>printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>




</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/408f44baa51c7b7230c62f32b2acadc2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Altium Dsigner 16,自己画的封装连不上线，手动连线焊盘处变绿——分析解决全过程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/583324ab3ac82d65cf86cb5f00553b8c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">使用EPPlus实现Excel导出</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>