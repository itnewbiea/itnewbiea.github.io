<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Androidx和Android support库共存问题解决 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Androidx和Android support库共存问题解决" />
<meta property="og:description" content="1、AndroidX简介 点击查看Android文档中对androidx的简介
按照官方文档说明 androidx 是对 android.support.xxx 包的整理后产物。由于之前的support包过于混乱，所以，google推出了 androidX。
由于在后续版本中，会逐步放弃对support 的升级和维护，所以，我们必须迁移到 androidX.对此，官方描述如下：
Existing packages, such as the Android Support Library, are being refactored into AndroidX. Although Support Library versions 27 and lower are still available on Google Maven, all new development will be included in only AndroidX versions 1.0.0 and higher. 2、迁移步骤 2.1 修改gradle.properties android.useAndroidX=true android.enableJetifier=true 其中：
android.useAndroidX=true 表示当前项目启用 androidx android.enableJetifier=true 表示将依赖包也迁移到androidx 。如果取值为false,表示不迁移依赖包到androidx，但在使用依赖包中的内容时可能会出现问题，当然了，如果你的项目中没有使用任何三方依赖，那么，此项可以设置为false 2.2 如何迁移（提前做好备份——在点击“Migrate to AndroidX ” 的时候也会提醒你备份） 点击查看官方迁移指南" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/d7aa6496cdeaf96f8e4a628bd7f13999/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-01-25T16:11:01+08:00" />
<meta property="article:modified_time" content="2019-01-25T16:11:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Androidx和Android support库共存问题解决</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3>1、AndroidX简介</h3> 
<p><a href="https://developer.android.com/topic/libraries/support-library/androidx-overview" rel="nofollow noopener noreferrer" target="_blank">点击查看Android文档中对androidx的简介</a></p> 
<p>按照官方文档说明 androidx 是对 android.support.xxx 包的整理后产物。由于之前的support包过于混乱，所以，google推出了 androidX。</p> 
<p>由于在后续版本中，会逐步放弃对support 的升级和维护，所以，我们必须迁移到 androidX.对此，官方描述如下：</p> 
<pre><code class="language-php"><code class="php">Existing packages, such <span class="hljs-keyword">as</span> the Android Support Library, are being refactored into AndroidX.
Although Support Library versions <span class="hljs-number">27</span> <span class="hljs-keyword">and</span> lower are still available on Google Maven,
all <span class="hljs-keyword">new</span> development will be included in only AndroidX versions <span class="hljs-number">1.0</span><span class="hljs-number">.0</span> <span class="hljs-keyword">and</span> higher.
</code></code></pre> 
<h3>2、迁移步骤</h3> 
<h4>2.1 修改gradle.properties</h4> 
<pre><code>android.useAndroidX=true
android.enableJetifier=true
</code></pre> 
<p>其中：</p> 
<ul><li> <code>android.useAndroidX=true</code> 表示当前项目启用 androidx</li><li> <code>android.enableJetifier=true</code> 表示将依赖包也迁移到androidx 。如果取值为false,表示不迁移依赖包到androidx，但在使用依赖包中的内容时可能会出现问题，当然了，如果你的项目中没有使用任何三方依赖，那么，此项可以设置为false</li></ul> 
<h4>2.2 如何迁移（提前做好备份——在点击“Migrate to AndroidX ” 的时候也会提醒你备份）</h4> 
<p><a href="https://developer.android.com/topic/libraries/support-library/refactor#migrate" rel="nofollow noopener noreferrer" target="_blank">点击查看官方迁移指南</a></p> 
<p>在AndroidStudio 3.2 或更高版本（目前最新正式版为3.2，其他更高版为alpha版）中执行如下操作：</p> 
<p><img src="https://images2.imgbox.com/31/99/QV9BPCRj_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>在执行该操作时会提醒我们是否将当前项目打包备份。如果你提前已经做好了备份，可以忽略；如果没有备份，则先备份。</p> 
</blockquote> 
<h3>3 迁移后续</h3> 
<h4>3.1 手动修改错误包名</h4> 
<p>由于 <code>Migrate to AndroidX</code> 执行之后，部分控件的包名/路径名转换的有问题，所以还需要我们手动调整（包括修改xml布局文件和.java/.kt 文件）。</p> 
<p>如：ViewPager,RecyclerView 等，这些内容在迁移完成之后，包名是 <code>androidx.core.weight.xxxx</code>,这是一个错误的包名，我们必须手动修改，否则，无法正常编译——点击绿色 Run(运行) 按钮时会详细报出哪里有错误。</p> 
<blockquote> 
 <p><strong>此处需要注意，在 AndroidStudio 的 build 选项卡中一次最多只会报 50条错误！！</strong> 所以，可能在你修完第一批之后，后面还有N个50。此处要保持一个平静的?。</p> 
</blockquote> 
<h4>3.2 修复DataBinding中的错误（重名id错误）</h4> 
<p>在 AndroidStudio3.2 + androidx 环境下，对错误的检查和处理更为严格。如果同一个xml布局文件中存在同名id，在之前的版本中，我们可以正常编译和运行，但是，在新的环境下， 必然会报错，错误信息如下：</p> 
<p><img src="https://images2.imgbox.com/64/02/JBneytVA_o.png" alt="在这里插入图片描述"></p> 
<p>在上图的错误信息中，我们以 DecibelBinding 为例，简述修复过程。</p> 
<ul><li><p>如上图，<code>无法将xxxBinding 构造器中的xxxBinding应用到指定类型</code>指明了出错的 Binding类 为 DecibelBinding</p></li><li><p>按照DataBinding类名的生成规则，我们可以知道，DecibelBinding 对应的xml文件名应该是 decibel.xml (如果你在xml中通过 class="xxxBinding" 指定了DataBinding的生成类名，那么就全局搜索吧)</p></li><li><p>在确定了xml之后，我们还需要知道到底哪里出了错误，那么，就继续看图中的 <code>错误：找不到符号 符号：变量 xxx</code>.这个变量就是控件的id名称。</p></li><li><p>DataBinding转换控件id名的规则是：去除下划线连接符，然后将原下划线后面的第一个字母大写。所以，图中的 fragmentDiscoverGridItemRelativeLayout1 对应的控件id应该是：<code>@+id/fragment_discover_grid_item_relative_layout</code>,后面之所以有一个1 ，是因为重复了。然后，我们在对应的xml文件中搜索这个控件名，然后删除重复即可。</p></li></ul> 
<h4>3.3 去除 attr.xml 中重复的属性名称</h4> 
<p>在迁移到 androidX 之前，我们为自定义控件编写自定义属性时，可以与android已有的属性重名，但是，在AndroidX环境下不行了，如果存在重名的情况， 必然会报错——会提示你重复定义（详细错误信息没截图，但翻译过来就是重复定义了attr/xxx）。</p> 
<ul><li>错误示例：</li></ul> 
<pre class="hljs xml"><code class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">declare-styleable</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"RoundImageView"</span>&gt;</span>
    ...
    <span class="hljs-tag">&lt;<span class="hljs-name">!-在迁移到androidx之前，这样写虽然不规范，但是能用，不报错-</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"textSize"</span> <span class="hljs-attr">format</span>=<span class="hljs-string">"Integer"</span> /&gt;</span>
    ...
<span class="hljs-tag">&lt;/<span class="hljs-name">declare-styleable</span>&gt;</span>
</code></pre> 
<ul><li>正确示例</li></ul> 
<pre class="hljs xml"><code class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">declare-styleable</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"RoundImageView"</span>&gt;</span>
    ...
    <span class="hljs-tag">&lt;<span class="hljs-name">!-迁移到androidX之后，必须使用android:xxx</span> 属性，不能定义<span class="hljs-attr">android</span>已有的属性<span class="hljs-attr">-</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"android:textSize"</span> /&gt;</span>
    ...    
<span class="hljs-tag">&lt;/<span class="hljs-name">declare-styleable</span>&gt;</span>
</code></pre> 
<blockquote> 
 <p>关于重名属性，在 androidX 中不知道哪个控件中包含了一个 <strong>mode</strong> 属性，所以，如果之前你的自定义控件中有 <strong>attr/mode</strong>，需要手动改成其他。</p> 
</blockquote> 
<h4>3.4 Glide中的注解不兼容androidX</h4> 
<p>迁移到 androidX 之后，Glide中使用的 <code>android.support.annotation.CheckResult</code> 和 <code>android.support.annotation.NonNull</code>这两个注解无法迁移。之前有用户在Glide中提过issue: <a href="https://github.com/bumptech/glide/issues/3185" target="_blank" rel="nofollow noopener noreferrer">https://github.com/bumptech/glide/issues/3185</a></p> 
<p>在上述issue 中有用户表示，将Glide升级到 4.8.0 之后，可以正常迁移。但是，我这边并不行。然后，我先升级了Glide ,又在 gralde文件中增加了support.annotation ，这样才能正常编译通过。貌似在后续Glide 5.x 版本中会完成对 androidx的完全兼容。</p> 
<p>我的临时解决方案：</p> 
<pre><code class="language-php"><code class="php"> <span class="hljs-comment">//图片加载——Glide</span>
implementation <span class="hljs-string">"com.github.bumptech.glide:glide:4.8.0
annotationProcessor "</span>com.github.bumptech.glide:compiler:<span class="hljs-number">4.8</span><span class="hljs-number">.0</span>
</code></code></pre> 
<p><span class="hljs-comment">//CnPeng 2018/9/26 下午8:38 这两行是为了解决 <a href="https://github.com/bumptech/glide/issues/3185">https://github.com/bumptech/glide/issues/3185</a> ——Glide 中的注解还没有完全兼容androidx</span><br> implementation <span class="hljs-string">“com.android.support:support-annotations:28.0.0-alpha3”</span><br> annotationProcessor <span class="hljs-string">“com.android.support:support-annotations:28.0.0-alpha3”</span></p> 
<p></p> 
<h4>3.5 规范包名（即文件夹名）</h4> 
<p>这里所说的包名，指的是项目中的文件夹名称。在之前版本中，我们命名包名时可能会出现大写字母，虽然这并不符合Java命名规范，但起码能正常编译和运行。然而，升级到 AndroidStudio3.2 + androidX 环境后，必须严格遵守命名规范，否则，可能报错，从而导致不能正常编译和运行。</p> 
<p>错误示例：</p> 
<pre><code>loginDemo
</code></pre> 
<p>正确示例：</p> 
<pre><code>login_demo
</code></pre> 
<p>对于包名的命名规范，好像要求并非十分严格。因为我发现，部分包含大写字母的报名在编译时会报错，部分不报错。但是，遵守规范总会更好一点！</p> 
<h4>3.6 修改未自动迁移的三方库</h4> 虽然我们从gradle中配置了迁移三方库的参数，但是，由于三方库的版本更新问题，也可能会迁移失败。在三方库迁移失败时，如果使用了数据绑定，通常会报如下错误： 
<p>碰到上述错误之后，我们可以按下列步骤处理：</p> 
<ul><li>1、在gradle文件中，将可升级的三方库升级（通常情况下，可升级的三方库会有黄色提示）</li><li>2、如果gradle中可升级的库都升级之后依旧报上述错误，那么，可以新建一个项目，然后将gradle中的依赖库逐个拷贝到新项目中，没拷贝一个编译一次，这样可以确认是哪个三方库有问题。（实际操作时可以使用二分法的方式进行，每次拷贝一半的依赖库，然后编译）。然后就可以有针对性的处理了</li></ul>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bad3bec58dd389b6958f9cff2608e743/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">An exisiting Android SDK was detected</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d1b245f94a4269145c134125b4e847b2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">曼彻斯特编码，差分曼彻斯特编码和NRZI编码</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>