<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>FFmpeg工具（一） --- ffmpeg视频处理命令行大全 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="FFmpeg工具（一） --- ffmpeg视频处理命令行大全" />
<meta property="og:description" content="FFmpeg是视频处理最常用的开源软件。FFmpeg中常用的工具主要是ffmpeg，ffprobe，ffplay，它们分别用作多媒体的编解码工具，内容分析工具和播放器。
FFmpeg工具（一） — ffmpeg视频处理命令行大全
FFmpeg工具（二） — ffprobe常用命令
FFmpeg工具（三） — ffplay常用命令
本篇主要介绍ffmpeg视频处理命令。它功能强大，用途广泛，大量用于视频网站，也是许多音视频格式的标准编解码实现。
ffmpeg的使用格式 ffmpeg的命令行参数非常多，可以分成五个部分。
$ ffmpeg {1} {2} -i {3} {4} {5} $ ffmpeg [全局参数] [输入文件参数] -i [输入文件] [输出文件参数] [输出文件] 上面命令中，参数依次为1.全局参数，2.输入文件参数，3.输入文件，4.输出文件参数，5.输出文件。
比如：
$ ffmpeg \ -y \ # 全局参数 -c:a libfdk_aac -c:v libx264 \ # 输入文件参数 -i input.mp4 \ # 输入文件 -c:v libvpx-vp9 -c:a libvorbis \ # 输出文件参数 output.webm # 输出文件 上面的命令将 mp4 文件转成 webm 文件，这两个都是容器格式。输入的 mp4 文件的音频编码格式是 aac，视频编码格式是 H.264；输出的 webm 文件的视频编码格式是 VP9，音频格式是 Vorbis。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/21b66bbd95cbe8084afe240f33910978/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-09-28T17:32:09+08:00" />
<meta property="article:modified_time" content="2020-09-28T17:32:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">FFmpeg工具（一） --- ffmpeg视频处理命令行大全</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>FFmpeg是视频处理最常用的开源软件。FFmpeg中常用的工具主要是ffmpeg，ffprobe，ffplay，它们分别用作多媒体的编解码工具，内容分析工具和播放器。<br> <a href="https://blog.csdn.net/weixin_39432879/article/details/108851039">FFmpeg工具（一） — ffmpeg视频处理命令行大全</a><br> <a href="https://blog.csdn.net/weixin_39432879/article/details/109058836">FFmpeg工具（二） — ffprobe常用命令</a><br> <a href="https://blog.csdn.net/weixin_39432879/article/details/109068602">FFmpeg工具（三） — ffplay常用命令</a><br> 本篇主要介绍ffmpeg视频处理命令。它功能强大，用途广泛，大量用于视频网站，也是许多音视频格式的标准编解码实现。</p> 
<h3><a id="ffmpeg_5"></a>ffmpeg的使用格式</h3> 
<p>ffmpeg的命令行参数非常多，可以分成五个部分。</p> 
<pre><code>$ ffmpeg {1} {2} -i {3} {4} {5}
$ ffmpeg [全局参数]  [输入文件参数]  -i [输入文件]  [输出文件参数]  [输出文件]
</code></pre> 
<p>上面命令中，参数依次为1.全局参数，2.输入文件参数，3.输入文件，4.输出文件参数，5.输出文件。<br> 比如：</p> 
<pre><code>$ ffmpeg \
-y \ # 全局参数
-c:a libfdk_aac -c:v libx264 \ # 输入文件参数
-i input.mp4 \ # 输入文件
-c:v libvpx-vp9 -c:a libvorbis \ # 输出文件参数
output.webm # 输出文件
</code></pre> 
<p>上面的命令将 mp4 文件转成 webm 文件，这两个都是容器格式。输入的 mp4 文件的音频编码格式是 aac，视频编码格式是 H.264；输出的 webm 文件的视频编码格式是 VP9，音频格式是 Vorbis。<br> 如果不指明编码格式，FFmpeg 会自己判断输入文件的编码。因此，上面的命令可以简单写成下面的样子。</p> 
<pre><code>$ ffmpeg -i input.avi output.mp4
</code></pre> 
<h3><a id="_26"></a>常用命令行参数</h3> 
<pre><code>-c：指定编码器
-c copy：直接复制，不经过重新编码（这样比较快）  eg： ffmpeg -i input.mp4 -c copy output.webm 将视频从一种容器转到另一个容器
-c:v：指定视频编码器  	eg:  ffmpeg -i [input.file] -c:v libx265 output.mp4  转成 H.265 编码
-c:a：指定音频编码器  
-i：指定输入文件  		eg： ffmpeg -i input.mp4 查看文件信息
-an：去除音频流
-vn： 去除视频流   eg: $ ffmpeg -i input.mp4 -vn -c:a copy output.aac 从视频中提取音频；-vn去掉视频，-c:a copy表示不改变音频编码，直接拷贝。
-preset：指定输出的视频质量，会影响文件的生成速度，有以下几个可用的值 ultrafast, superfast, veryfast, faster, fast, medium, slow, slower, veryslow。
-y：不经过确认，输出时直接覆盖同名文件。
-vf scale=480*360 改变分辨率  eg:ffmpeg -i input.mp4 -vf scale=320*240 output.mp4
-s 设置视频分辨率 		eg:ffmpeg -i input,mp4 -s 320x240 output.mp4
-vframes 1 指定只截取一帧  
-q:v 2表示输出的图片质量，一般为1到5(1代表质量最高)
-ss 开始时间
-t 持续时间
-to 结束时间
-loop 1 表示图片无限循环
-shortest 表示音频文件结束
-r fps 设置帧率 		eg: ffmpeg -i input.mp4 -r 24 output.mp4 设置帧率为24
-b 设置码率 		eg: ffmpeg -i input.avi -b 1.5M output.mp4
-b:a 音频 -b:v 视频
-fs (file size首字母缩写)控制输出文件大小 		eg: ffmpeg -i input.avi -fs 1024K output.mp4
-ar   指定音频采样率 比如48000
-channels  指定音频通道数 比如双通道为2
-profile:a  指定音频编码格式 比如AAC_LC

</code></pre> 
<p>1、 添加音轨<br> 添加音轨（muxing）指的是，将外部音频加入视频，比如添加背景音乐或旁白。</p> 
<pre><code>$ ffmpeg  -i input.aac -i input.mp4  output.mp4
</code></pre> 
<p>上面例子中，有音频和视频两个输入文件，FFmpeg 会将它们合成为一个文件。</p> 
<p>2、截图<br> 下面的例子是从指定时间开始，连续对1秒钟的视频进行截图。</p> 
<pre><code>$ ffmpeg  -y  -i input.mp4  -ss 00:01:24 -t 00:00:01  output_%3d.jpg
</code></pre> 
<p>如果只需要截一张图，可以指定只截取一帧。</p> 
<pre><code>$ ffmpeg -ss 01:23:45  -i input  -vframes 1 -q:v 2  output.jpg
</code></pre> 
<p>上面例子中，-vframes 1指定只截取一帧，-q:v 2表示输出的图片质量。<br> 3、裁剪<br> 裁剪（cutting）指的是，截取原始视频里面的一个片段，输出为一个新视频。可以指定开始时间（start）和持续时间（duration），也可以指定结束时间（end）。</p> 
<pre><code>$ ffmpeg -ss [start] -i [input] -t [duration] -c copy [output]
$ ffmpeg -ss [start] -i [input] -to [end] -c copy [output]
</code></pre> 
<p>下面是实际的例子。</p> 
<pre><code>$ ffmpeg -ss 00:01:50 -i [input] -t 10.5 -c copy [output]
$ ffmpeg -ss 2.5 -i [input] -to 10 -c copy [output]
</code></pre> 
<p>上面例子中，-c copy表示不改变音频和视频的编码格式，直接拷贝，这样会快很多。<br> 4、为音频添加封面<br> 有些视频网站只允许上传视频文件。如果要上传音频文件，必须为音频添加封面，将其转为视频，然后上传。<br> 下面命令可以将音频文件，转为带封面的视频文件。</p> 
<pre><code>$ ffmpeg  -loop 1  -i cover.jpg -i input.mp3  -c:v libx264 -c:a aac -b:a 192k -shortest output.mp4
</code></pre> 
<p>上面命令中，有两个输入文件，一个是封面图片cover.jpg，另一个是音频文件input.mp3。-loop 1参数表示图片无限循环，-shortest参数表示音频文件结束，输出视频就结束。<br> 5、调整码率<br> 调整码率（transrating）指的是，改变编码的比特率，一般用来将视频文件的体积变小。下面的例子指定码率最小为964K，最大为3856K，缓冲区大小为 2000K。</p> 
<pre><code>$ ffmpeg  -i input.mp4  -minrate 964K -maxrate 3856K -bufsize 2000K output.mp4
</code></pre> 
<p>6、裁剪视频crop filter<br> 从输入文件中选取你想要的矩形区域到输出文件中,常见用来去视频黑边。<br> 裁剪输入视频的左三分之一，中间三分之一，右三分之一:</p> 
<pre><code>ffmpeg -i input -vf crop=iw/3:ih :0:0 output
ffmpeg -i input -vf crop=iw/3:ih :iw/3:0 output
ffmpeg -i input -vf crop=iw/3:ih :iw/3*2:0 output
</code></pre> 
<p>裁剪帧的中心<br> 当我们想裁剪区域在帧的中间时，裁剪filter可以跳过输入x和y值，他们的默认值是</p> 
<pre><code>Xdefault = ( input width - output width)/2
Ydefault = ( input height - output height)/2
ffmpeg -i input_file -v crop=w:h output_file
</code></pre> 
<p>裁剪中间一半区域：</p> 
<pre><code>ffmpeg -i input.avi -vf crop=iw/2:ih/2 output.avi
</code></pre> 
<p>比较裁剪后的视频和源视频比较</p> 
<pre><code>ffplay -i jidu.mp4 -vf split[a][b];[a]drawbox=x=(iw-300)/2:(ih-300)/2:w=300:h=300:c=yellow[A];[A]pad=2iw[C];[b]crop=300:300:(iw-300)/2:(ih-300)/2[B];[C][B]overlay=w2.4:40
</code></pre> 
<p>7、自动检测裁剪区域<br> cropdetect filter 自动检测黑边区域</p> 
<pre><code>ffplay input.mp4 -vf cropdetect
</code></pre> 
<p>然后拿到crop值，用检测到的值来裁剪视频</p> 
<pre><code>ffplay input.mp4 –vf crop=544:960:0:0
</code></pre> 
<p>8、视频提取h264码流</p> 
<pre><code>ffmpeg -i input.mp4 -pix_fmt yuv420p output.h264
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4b3d7b7593756941fc6212013e9e5f31/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">sql查询某个字段内容长度/获取指定字段内容长度的数据</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7299aef43ed436cd406cd3af2fc8dd3e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">asp版最新的阿里云短信SDK asp版阿里云短信SDK</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>