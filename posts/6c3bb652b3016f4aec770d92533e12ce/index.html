<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>八、Lua脚本详解—— 超详细操作演示！ - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="八、Lua脚本详解—— 超详细操作演示！" />
<meta property="og:description" content="八、Lua脚本详解 —— 超详细操作演示！ 八、Lua脚本详解8.1 Lua 简介8.2 Linux 系统的Lua8.2.1 Lua 下载8.2.2 Lua 安装8.2.3 Hello World 8.3 Win 系统的Lua8.4 Lua 脚本基础8.4.1 注释8.4.2 数据类型8.4.3 标识符8.4.4 运算符8.4.5 函数8.4.6 流程控制语句8.4.7 循环控制语句 8.5 Lua 语法进阶8.5.1 table8.5.2 迭代器8.5.3 模块8.5.4 元表和元方法8.5.5 面向对象8.5.6 协同线程与协同函数8.5.7 文件IO 九、分布式锁9.1 分布式锁的工作原理9.2 问题引入9.3 setnx 实现方式9.4 为锁添加过期时间9.5 为锁添加标识9.6 添加 Lua 脚本9.7 Redisson 可重入锁9.8 Redisson 红锁9.9 分段锁9.10 Redisson 详解 数据库系列文章：
关系型数据库:
MySQL —— 基础语法大全MySQL —— 进阶 非关系型数据库:
一、Redis 的安装与配置二、Redis 基本命令（上）三、Redis 基本命令（下）四、Redis 持久化五、Redis 主从集群六、Redis 分布式系统七、Redis 缓存 八、Lua脚本详解 8." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/6c3bb652b3016f4aec770d92533e12ce/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-04T23:14:35+08:00" />
<meta property="article:modified_time" content="2024-01-04T23:14:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">八、Lua脚本详解—— 超详细操作演示！</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>八、Lua脚本详解 —— 超详细操作演示！</h4> 
 <ul><li><ul><li><a href="#Lua_17" rel="nofollow">八、Lua脚本详解</a></li><li><ul><li><a href="#81_Lua__18" rel="nofollow">8.1 Lua 简介</a></li><li><a href="#82_Linux_Lua_26" rel="nofollow">8.2 Linux 系统的Lua</a></li><li><ul><li><ul><li><a href="#821_Lua__27" rel="nofollow">8.2.1 Lua 下载</a></li><li><a href="#822_Lua__32" rel="nofollow">8.2.2 Lua 安装</a></li><li><a href="#823_Hello_World_82" rel="nofollow">8.2.3 Hello World</a></li></ul> 
    </li></ul> 
    </li><li><a href="#83_Win_Lua_147" rel="nofollow">8.3 Win 系统的Lua</a></li><li><a href="#84_Lua__160" rel="nofollow">8.4 Lua 脚本基础</a></li><li><ul><li><ul><li><a href="#841__161" rel="nofollow">8.4.1 注释</a></li><li><a href="#842__180" rel="nofollow">8.4.2 数据类型</a></li><li><a href="#843__208" rel="nofollow">8.4.3 标识符</a></li><li><a href="#844__256" rel="nofollow">8.4.4 运算符</a></li><li><a href="#845__301" rel="nofollow">8.4.5 函数</a></li><li><a href="#846__401" rel="nofollow">8.4.6 流程控制语句</a></li><li><a href="#847__437" rel="nofollow">8.4.7 循环控制语句</a></li></ul> 
    </li></ul> 
    </li><li><a href="#85_Lua__552" rel="nofollow">8.5 Lua 语法进阶</a></li><li><ul><li><ul><li><a href="#851_table_553" rel="nofollow">8.5.1 table</a></li><li><a href="#852__765" rel="nofollow">8.5.2 迭代器</a></li><li><a href="#853__800" rel="nofollow">8.5.3 模块</a></li><li><a href="#854__883" rel="nofollow">8.5.4 元表和元方法</a></li><li><a href="#855__900" rel="nofollow">8.5.5 面向对象</a></li><li><a href="#856__904" rel="nofollow">8.5.6 协同线程与协同函数</a></li><li><a href="#857_IO_908" rel="nofollow">8.5.7 文件IO</a></li></ul> 
    </li></ul> 
   </li></ul> 
   </li><li><a href="#_965" rel="nofollow">九、分布式锁</a></li><li><ul><li><a href="#91__966" rel="nofollow">9.1 分布式锁的工作原理</a></li><li><a href="#92__967" rel="nofollow">9.2 问题引入</a></li><li><a href="#93_setnx__968" rel="nofollow">9.3 setnx 实现方式</a></li><li><a href="#94__969" rel="nofollow">9.4 为锁添加过期时间</a></li><li><a href="#95__970" rel="nofollow">9.5 为锁添加标识</a></li><li><a href="#96__Lua__971" rel="nofollow">9.6 添加 Lua 脚本</a></li><li><a href="#97_Redisson__972" rel="nofollow">9.7 Redisson 可重入锁</a></li><li><a href="#98_Redisson__973" rel="nofollow">9.8 Redisson 红锁</a></li><li><a href="#99__974" rel="nofollow">9.9 分段锁</a></li><li><a href="#910_Redisson__975" rel="nofollow">9.10 Redisson 详解</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<blockquote> 
 <p><font color="red"><strong>数据库系列文章：</strong></font><br> <br> <strong>关系型数据库</strong>:</p> 
 <ul><li><a href="https://blog.csdn.net/weixin_43412762/article/details/132051493">MySQL —— 基础语法大全</a></li><li><a href="https://blog.csdn.net/weixin_43412762/article/details/132631240">MySQL —— 进阶</a></li></ul> 
 <p><br> <strong>非关系型数据库</strong>:</p> 
 <ul><li><a href="https://blog.csdn.net/weixin_43412762/article/details/133688635">一、Redis 的安装与配置</a></li><li><a href="https://blog.csdn.net/weixin_43412762/article/details/133934585">二、Redis 基本命令（上）</a></li><li><a href="https://blog.csdn.net/weixin_43412762/article/details/134104962">三、Redis 基本命令（下）</a></li><li><a href="https://blog.csdn.net/weixin_43412762/article/details/134795648">四、Redis 持久化</a></li><li><a href="https://blog.csdn.net/weixin_43412762/article/details/134946683">五、Redis 主从集群</a></li><li><a href="https://blog.csdn.net/weixin_43412762/article/details/135181954">六、Redis 分布式系统</a></li><li><a href="https://blog.csdn.net/weixin_43412762/article/details/135297873">七、Redis 缓存</a></li></ul> 
</blockquote> 
<h3><a id="Lua_17"></a>八、Lua脚本详解</h3> 
<h4><a id="81_Lua__18"></a>8.1 Lua 简介</h4> 
<p>    <strong>Lua</strong> 是一个由标准 <strong>C</strong> 语言 开发的、开源的、<strong>可扩展的</strong>、<strong>轻量级的</strong>、<strong>弱类型的</strong>、<strong>解释型脚本语言</strong>， 是 于 1993 年由 巴西里约热内卢天主教大学的三人研究小组使用标准 C 语言开发。</p> 
<p>    <strong>Lua 的官网</strong> 为： <a href="https://www.lua.org/" rel="nofollow">https://www.lua.org/</a></p> 
<blockquote> 
 <p><strong>Lua</strong> 是一门 <strong>脚本语言</strong>，和 <strong>Shell</strong>、<strong>Python</strong> 是同一种类型。<br> <br> 用的最多的是 <strong>Unity</strong> 手游，做 <strong>热更新</strong> 方案；<strong>Nginx</strong> 也有应用。</p> 
</blockquote> 
<h4><a id="82_Linux_Lua_26"></a>8.2 Linux 系统的Lua</h4> 
<h6><a id="821_Lua__27"></a>8.2.1 Lua 下载</h6> 
<p>    若要使用 Lua 则需要先从官网下载其源码并安装。</p> 
<p><img src="https://images2.imgbox.com/e9/d3/sF7JSqRN_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="822_Lua__32"></a>8.2.2 Lua 安装</h6> 
<p>    先将下载好的 Lua 源码上传到 Linux ，然后再进行安装。</p> 
<p><strong>⭐️（1）解压</strong></p> 
<p>    将Lua 源码解压到 /opt/apps 目录。</p> 
<pre><code class="prism language-bash"><span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> lua-5.4.6.tar.gz <span class="token parameter variable">-C</span> /opt/apps/
</code></pre> 
<p><img src="https://images2.imgbox.com/a9/ee/anxMhsij_o.png" alt="在这里插入图片描述"></p> 
<p>    进入到 <code>/opt/apps</code> 下的 <strong>lua</strong> 目录可以看到编译用的 <code>Makefile</code> 文件 及 <strong>源码目录</strong> <code>src</code> 。</p> 
<p><img src="https://images2.imgbox.com/53/ab/ks36IfJr_o.png" alt="在这里插入图片描述"></p> 
<p><strong>⭐️（2）安装gcc</strong></p> 
<p>    由于 Lua 是由 C/C++ 语言编写的，所以对其进行 <strong>编译</strong> 就必须要使用相关编译器。对于 C/C++ 语言的编译器，使用最多的是 <code>gcc</code> 。</p> 
<pre><code class="prism language-bash">yum <span class="token parameter variable">-y</span> <span class="token function">install</span> gcc gcc-c++
</code></pre> 
<p><img src="https://images2.imgbox.com/b6/e9/fMaaVH5g_o.png" alt="在这里插入图片描述"></p> 
<p><strong>⭐️（3）编译</strong></p> 
<p>    执行编译命令 <code>make linux test</code> 。</p> 
<pre><code class="prism language-bash"><span class="token comment"># test 测试输出版本号</span>
<span class="token function">make</span> linux <span class="token builtin class-name">test</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/38/ae/x883ogx6_o.png" alt=""></p> 
<p><strong>⭐️（4）安装</strong></p> 
<pre><code class="prism language-bash"><span class="token function">make</span> <span class="token function">install</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/1d/7b/ft1XcE8l_o.png" alt="在这里插入图片描述"></p> 
<p>    安装完毕后，可以通过 <code>lua -v</code> 查看版本号，与前面 <code>make linux test</code> 中最后显示的结果是相同的。</p> 
<p><img src="https://images2.imgbox.com/36/be/znJ7GrZj_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>如果 <code>lua -v</code> 显示的还是老版本，<code>reboot</code> 重启一下 Linux 系统就好了。</p> 
</blockquote> 
<h6><a id="823_Hello_World_82"></a>8.2.3 Hello World</h6> 
<p><strong>⭐️（1）两种交互模式</strong></p> 
<p>    Lua 为用户提供了两种交互模式：<strong>命令行模式</strong> 与 <strong>脚本文件模式</strong>。</p> 
<p><strong>A、命令行模式</strong></p> 
<p>    该模式是，直接在<strong>命令行</strong>中输入语句，回车即可看到运行结果。</p> 
<p><img src="https://images2.imgbox.com/e3/3c/6ddJtHSm_o.png" alt="在这里插入图片描述"></p> 
<p>    在任意目录下使用 <code>lua</code> 命令进入 <code>lua 命令行模式</code>，在其中输入语句后回车即可运行显示出结果。使用 <code>Ctrl</code> + <code>C</code> 退出模式。</p> 
<p>    需要注意， lua 对语句后的 <strong>分号要求 <mark>不是</mark> 强制性的，有没有都行</strong>。</p> 
<p><strong>B、脚本文件模式</strong></p> 
<p>    该模式是先要编写<strong>脚本文件</strong>，然后再使用 <code>lua 命令</code> 来<strong>运行</strong>文件。</p> 
<p>    例如直接创建一个名称为 <code>hello.lua</code> 的文件，文件中就写一名 <code>print()</code> 语句即可。</p> 
<p><img src="https://images2.imgbox.com/42/b4/2usaIxIl_o.png" alt="在这里插入图片描述"></p> 
<p>    然后 <strong>直接运行</strong>“ <code>lua 脚本文件</code>” 即可看到结果。</p> 
<pre><code class="prism language-bash">lua hello.lua
</code></pre> 
<p><img src="https://images2.imgbox.com/f1/ea/TbLUfbxX_o.png" alt="在这里插入图片描述"></p> 
<p><strong>⭐️（2）两种脚本运行方式</strong></p> 
<p>    对于脚本文件的运行有两种方式。</p> 
<ul><li>一种是上面的 <code>lua 命令</code> 方式，</li><li>还有一种是 <code>可执行文件</code> 方式。可执行文件方式是，将 <strong>lua 脚本</strong>文件直接修改为 <strong>可执行文件</strong> 运行。</li></ul> 
<p>    下面就使用第二种方式来运行。</p> 
<p><strong>A、修改脚本文件内容</strong></p> 
<p>    在脚本文件第一行增加 <code>#!/usr/bin/lua</code> ，表示当前文件将使用 <code>/usr/bin/lua</code> 命令来运行。</p> 
<pre><code class="prism language-bash"><span class="token shebang important">#!/usr/bin/lua</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/45/90/bmfm5xJG_o.png" alt="在这里插入图片描述"></p> 
<p><strong>B、修改脚本文件权限</strong></p> 
<pre><code class="prism language-bash"><span class="token function">chmod</span> <span class="token number">755</span> hello.lua
</code></pre> 
<p>    为脚本文件赋予 <strong>可执行权限</strong>。</p> 
<p><strong>C、运行</strong></p> 
<p>    直接使用文件名即可运行。<br> <img src="https://images2.imgbox.com/18/61/64dxzbub_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="83_Win_Lua_147"></a>8.3 Win 系统的Lua</h4> 
<p>    这里要安装的是在 Windows 系统中 Lua 的运行环境。最常用的为 <strong>SciTE</strong> 。</p> 
<p>    <strong>SciTE</strong> 是一款 Lua 脚本 <strong>测试编辑器</strong>，提供 Lua 的编辑运行环境。其官方下载地址为： <a href="https://github.com/rjpcomputing/luaforwindows/releases%5D">https://github.com/rjpcomputing/luaforwindows/releases</a> 。 下载完直接运行 <code>exe</code> 文件安装。<br> <img src="https://images2.imgbox.com/f7/0e/kp8LSQNW_o.png" alt="在这里插入图片描述"></p> 
<p>    <strong>SciTE</strong> 提供了两种运行方式：<strong>命令行窗口</strong>运行方式 与 Lua 脚本的<strong>编辑运行环境</strong>。</p> 
<p><img src="https://images2.imgbox.com/88/c2/1jGq9rM5_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/e9/45/MAYlQWUE_o.png" alt="在这里插入图片描述"></p> 
<p>    除了<strong>SciTE</strong> ，还有像 <strong>LuaDist</strong> 、 <strong>LuaRocks</strong> 等。</p> 
<h4><a id="84_Lua__160"></a>8.4 Lua 脚本基础</h4> 
<h6><a id="841__161"></a>8.4.1 注释</h6> 
<p>    <strong>Lua</strong> 的 <font color="blue"><strong>行注释</strong></font> 为两个<strong>连续的减号</strong>， <font color="blue"><strong>段注释</strong></font> 以<code>--[[</code> <strong>开头</strong>，以 <code>--]]</code> <strong>结尾</strong>。</p> 
<p>    不过，在 <strong>调试过程</strong> 中如果想 <code>临时取消</code> <strong>段注释</strong>，而直接将其标识删除，这样做其实并不好。因为有可能还需要再添加上。而段注释的写法相对较麻烦。</p> 
<ul><li>所以， Lua 给出了一种简单处理方式：在开头的 <code>--[[</code> 前<strong>再加一个减号</strong>，即可使段注释不起作用。其实就是使两个段注释标识变为了两个行注释。</li></ul> 
<pre><code class="prism language-lua"><span class="token comment">--~ 行注释，(快捷键为 Ctr + Q)</span>
<span class="token comment">-- 行注释，(波浪号 ~ ，为快捷键自动生成的)</span>

<span class="token comment">--[[段注释
print("Hello, Lua")
--]]</span>

<span class="token comment">---[[取消段注释</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Hello, Lua"</span><span class="token punctuation">)</span>
<span class="token comment">--]]</span>
</code></pre> 
<h6><a id="842__180"></a>8.4.2 数据类型</h6> 
<p>    <strong>Lua</strong> 中有 8 种 类型，分别为： <code>nil</code> 、 <code>boolean</code> 、 <code>number</code> 、 <code>string</code> 、 <code>userdata</code> 、 <code>function</code> 、 <code>thread</code> 和 <code>table</code> 。</p> 
<ul><li>通过 <code>type()</code> 函数可以查看一个<strong>数据的类型</strong>，例如， <code>type(nil)</code> 的结果为 <code>nil</code>， <code>type(123)</code> 的结果为 <code>number</code> 。</li></ul> 
<p><img src="https://images2.imgbox.com/20/06/iMcfsqib_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-lua"><span class="token comment">-- string 演示</span>
str1 <span class="token operator">=</span> <span class="token string">"中国"</span>
str2 <span class="token operator">=</span> <span class="token string">'北京'</span>
str3 <span class="token operator">=</span> <span class="token string">[[深圳
广州
上海]]</span>

<span class="token function">print</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span> 
<span class="token function">print</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>str3<span class="token punctuation">)</span>

<span class="token comment">--[[输出:
中国
北京
深圳
广州
上海
--]]</span>
</code></pre> 
<h6><a id="843__208"></a>8.4.3 标识符</h6> 
<p>    程序设计语言中的<strong>标识符</strong>主要包含 <strong>保留字、变量、常量、方法名、函数名、类名</strong> 等。Lua 的标识符由 <font color="red"><strong>字母、数字 与 下划线</strong></font> 组成，但 <strong><font color="red"> 不能以数字开头</font></strong> 。 <strong>Lua</strong> 是 <mark><strong>大小写</strong>敏感的</mark>。</p> 
<p><strong>⭐️（1）保留字</strong></p> 
<p>    Lua 常见的<strong>保留字</strong>共有 <code>22</code> 个。不过，除了这 22 个外， Lua 中还定义了很多的 <font color="red"><strong>内置全局变量</strong></font> ，这些内置全局变量的一个共同特征是，以<font color="red"><strong>下划线开头后跟全大写字母</strong></font> 。所以我们在定义自己的标识符时<mark>不能</mark>与这些保留字、内置全局变量<mark>重复</mark>。</p> 
<p><img src="https://images2.imgbox.com/98/8b/3xrH17PS_o.png" alt="在这里插入图片描述"></p> 
<p><strong>⭐️（2）变量</strong></p> 
<p>    <strong>Lua 是弱类型语言</strong>，<strong>变量</strong> <strong>无需类型声明</strong> 即 <strong>可直接使用</strong>。变量分为 <strong>全局变量</strong> 与 <strong>局部变量</strong>。Lua 中的变量 <mark>默认都是<strong>全局变量</strong></mark>，即使声明在语句块或函数里。全局变量一旦声明，在当前文件中的（<strong><em>声明后</em>）任何地方</strong> 都可访问。<strong>局部变量</strong> <code>local</code> 相当于 Java 中的 <code>private</code> 变量，只能在<strong>声明的语句块中</strong>使用。</p> 
<pre><code class="prism language-lua"><span class="token comment">-- 局部变量</span>
<span class="token keyword">local</span> x <span class="token operator">=</span> <span class="token number">3</span>

<span class="token comment">-- 定义一个函数</span>
<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">-- 全局变量</span>
	y <span class="token operator">=</span> <span class="token number">5</span>
	<span class="token comment">-- 再定义一个局部变量</span>
	<span class="token keyword">local</span> z <span class="token operator">=</span> <span class="token number">8</span>
	<span class="token comment">-- 访问局部变量</span>
	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"x = "</span><span class="token operator">..</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span>

<span class="token comment">-- 访问函数</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 				 <span class="token comment">-- 输出 x = 3</span>
<span class="token comment">-- 访问全局变量</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"y = "</span><span class="token operator">..</span>y<span class="token punctuation">)</span>	 <span class="token comment">-- 输出 y = 5</span>
<span class="token comment">-- 访问局部变量</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"z = "</span><span class="token operator">..</span>z<span class="token punctuation">)</span>	 <span class="token comment">-- 报错，z 为局部变量</span>
</code></pre> 
<p><strong>⭐️（3）动态类型</strong></p> 
<p>    Lua 是 <strong>动态类型语言</strong>，<strong>变量的类型</strong> <mark>可以随时改变，<strong>无需</strong>声明</mark>。</p> 
<pre><code class="prism language-lua">y <span class="token operator">=</span> <span class="token number">5</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"y = "</span><span class="token operator">..</span>y<span class="token punctuation">)</span>	 <span class="token comment">-- 输出 y = 5</span>
y <span class="token operator">=</span> <span class="token string">"北京"</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"y = "</span><span class="token operator">..</span>y<span class="token punctuation">)</span>	 <span class="token comment">-- 输出 y = 北京</span>
</code></pre> 
<h6><a id="844__256"></a>8.4.4 运算符</h6> 
<p>    <strong>运算符</strong>是一个特殊的符号，用于告诉解释器执行特定的 <strong>数学</strong> 或 <strong>逻辑运算</strong>。Lua 提供了以下几种运算符类型：</p> 
<ul><li>算术运算符</li><li>关系运算符</li><li>逻辑运算符</li><li>其他运算符</li></ul> 
<p><strong>⭐️（1）算术运算符</strong></p> 
<p>    下表列出了 Lua 语言中的常用算术运算符，设定 <code>A</code> 的值为 <code>10</code>， <code>B</code> 的值为 <code>20</code>：</p> 
<p><img src="https://images2.imgbox.com/cc/d5/tsR1tSTg_o.png" alt="在这里插入图片描述"></p> 
<p>注意，</p> 
<ul><li><strong>SciTE</strong> 对 Lua 支持的目前最高版本为 <strong>5.1</strong> ，而整除运算符 <code>//</code> 需要在 <strong>Lua5.3</strong> 版本以上，所以当前 SciTE 中无法看到效果。</li><li>在 <strong>命令行模式</strong> 中，<strong>直接输入变量名</strong> 回车，即相当于 <code>print()</code> 函数输出该变量。</li></ul> 
<p><strong>⭐️（2）关系运算符</strong></p> 
<p>    下表列出了 Lua 语言中的常用<strong>关系运算符</strong>，设定 <code>A</code> 的值为 <code>10</code>， <code>B</code> 的值为 <code>20</code>：</p> 
<p><img src="https://images2.imgbox.com/65/86/0BbElSG7_o.png" alt="在这里插入图片描述"></p> 
<p><strong>⭐️（3）逻辑运算符</strong></p> 
<p>    注意， Lua 系统将 <code>false</code> 与 <code>nil</code> 作为 <strong>假</strong>，将 <code>true</code> 与 <code>非nil</code> 作为 <strong>真</strong>，<mark>即使是 <code>0</code> 也是<strong>真</strong></mark>。</p> 
<p>    下表列出了Lua 语言中的常用 <strong>逻辑运算符</strong>，设定 <code>A</code> 的值为 <code>true</code>， <code>B</code> 的值为 <code>false</code>：</p> 
<p><img src="https://images2.imgbox.com/5f/90/TfJEsKyS_o.png" alt="在这里插入图片描述"></p> 
<p><strong>⭐️（4）其他运算符</strong></p> 
<p>    下表列出了 <strong>Lua</strong> 语言中的 <strong>连接运算符</strong> 与 <strong>计算</strong> <code>表</code> 或 <code>字符串</code> <strong>长度</strong> 的运算符：</p> 
<p><img src="https://images2.imgbox.com/59/8d/5Q6V7ZXD_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-lua">str <span class="token operator">=</span> <span class="token string">"abcdefg"</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token operator">#</span>str<span class="token punctuation">)</span> 	 <span class="token comment">-- 输出 7</span>
</code></pre> 
<h6><a id="845__301"></a>8.4.5 函数</h6> 
<p>    Lua 中函数的定义是以 <code>function</code> 开头，后跟 <strong>函数名</strong> 与 <strong>参数列表</strong>，以 <code>end</code> <strong>结尾</strong>。其 <mark>可以<strong>没有</strong>返回值，也可以一次<strong>返回多个值</strong></mark>。</p> 
<p><strong>⭐️（1）固定参函数</strong></p> 
<p>    Lua 中的<strong>函数在调用时</strong>与 Java 语言中方法的调用是不同的，其 <mark><strong>不要求</strong>实参的个数必须与函数中形参的个数相同</mark>。</p> 
<ul><li>如果<strong>实参</strong>个数少于<strong>形参</strong>个数，则系统自动使用 <code>nil</code> 填充；</li><li>如果<strong>实参</strong>个数多于<strong>形参</strong>个数，多出的将被系统 <strong>自动忽略</strong>。</li></ul> 
<pre><code class="prism language-lua"><span class="token comment">-- 定义一个普通函数，包含两个形参</span>
<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
	<span class="token function">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-- 无实参传递</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>					<span class="token comment">-- 输出：nil	nil</span>

<span class="token comment">-- 传递一个实参</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>				<span class="token comment">-- 输出：10 	nil</span>

<span class="token comment">-- 传递两个实参</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>			<span class="token comment">-- 输出：10 	20</span>

<span class="token comment">-- 传递三个实参</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>		<span class="token comment">-- 输出：10 	20</span>
</code></pre> 
<p><strong>⭐️（2）可变参函数</strong></p> 
<p>    在函数定义时不给出具体形参的个数，而是使用 <mark><strong>三个连续的点号</strong></mark>。在函数调用时就可以向该函数传递<strong>任意个数的参数</strong>，函数可以全部接收。</p> 
<pre><code class="prism language-lua"><span class="token comment">-- 定义一个可变参函数</span>
<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">...</span><span class="token punctuation">)</span>
	<span class="token keyword">local</span> a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d <span class="token operator">=</span> <span class="token punctuation">...</span>
	<span class="token function">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">)</span>
	<span class="token comment">--print(...) 	-- 可以全部输出</span>
<span class="token keyword">end</span>

<span class="token comment">-- 传递三个实参</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>					<span class="token comment">-- 输出：10 20	30	nil</span>

<span class="token comment">-- 传递四个实参</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span>				<span class="token comment">-- 输出：10	20	30	40</span>

<span class="token comment">-- 传递五个实参</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>			<span class="token comment">-- 输出：10	20	30	40</span>
</code></pre> 
<p><strong>⭐️（3）可返回多个值</strong></p> 
<p>    Lua 中的函数<mark>一次可以返回多个值</mark>，但<strong>需要有多个变量来同时接收</strong>。</p> 
<pre><code class="prism language-lua"><span class="token comment">-- 定义一个普通函数，返回两个值</span>
<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
	<span class="token keyword">local</span> sum <span class="token operator">=</span> a <span class="token operator">+</span> b
	<span class="token keyword">local</span> mul <span class="token operator">=</span> a <span class="token operator">*</span> b
	<span class="token keyword">return</span> sum<span class="token punctuation">,</span> mul<span class="token punctuation">;</span>
<span class="token keyword">end</span>

<span class="token comment">-- 一次性接收两个值</span>
m<span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> n<span class="token punctuation">)</span>					<span class="token comment">-- 输出：8 15</span>
</code></pre> 
<p><strong>⭐️（4）函数作为参数</strong></p> 
<p>    Lua 的函数中，允许 <strong>函数</strong> 作为参数。而作为参数的函数，可以是已经定义好的 <code>普通函数</code>，也可以是<code>匿名函数</code>。</p> 
<pre><code class="prism language-lua"><span class="token comment">-- 定义两个普通函数</span>
<span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
	<span class="token keyword">return</span> a <span class="token operator">+</span> b
<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">mul</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
	<span class="token keyword">return</span> a <span class="token operator">*</span> b
<span class="token keyword">end</span>

<span class="token comment">-- 定义一个函数，其参数为另一个参数</span>
<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> n<span class="token punctuation">,</span> fun<span class="token punctuation">)</span>
	<span class="token keyword">local</span> result <span class="token operator">=</span> <span class="token function">fun</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
	<span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-- 调用</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span>					<span class="token comment">-- 输出：8</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> mul<span class="token punctuation">)</span>					<span class="token comment">-- 输出：15</span>

<span class="token comment">-- 匿名函数调用</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
			<span class="token keyword">return</span> b <span class="token operator">-</span> a<span class="token punctuation">;</span>
		<span class="token keyword">end</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>								<span class="token comment">-- 输出：2</span>
</code></pre> 
<h6><a id="846__401"></a>8.4.6 流程控制语句</h6> 
<p>    Lua 提供了 <code>if</code> 作为 <strong>流程控制语句</strong>。</p> 
<p><strong>⭐️（1）if 语句</strong></p> 
<p>    Lua 提供了 <code>if...then</code> 用于表示<strong>条件判断</strong>，其中 <code>if</code> 的判断条件可以是 <strong>任意表达式</strong>。 Lua 系统将 <code>false</code> 与 <code>nil</code> 作为<strong>假</strong>，将 <code>true</code> 与 <code>非nil</code> 作为<strong>真</strong>，即使 <mark>是 <code>0</code> 也是<strong>真</strong></mark>。</p> 
<pre><code class="prism language-lua">a <span class="token operator">=</span> <span class="token number">5</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"num &gt; 0"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span>
	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"num &lt;= 0"</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-- 输出: num &gt; 0</span>
</code></pre> 
<p>    <mark>需要注意</mark>，Lua 中的 <code>if</code> 语句的判断条件 <strong>可以使用小括号</strong>括起来，<strong>也可以不使用</strong>。</p> 
<p><strong>⭐️（2）if 嵌套语句</strong></p> 
<p>    Lua 中提供了专门的关键字 <code>elseif</code> 来做 <code>if</code> <strong>嵌套语句</strong>。<mark>注意，<strong>不能使用</strong> <code>else</code> 与 <code>if</code> 两个关键字的联用形式 ，即不能使用 <code>else if</code> 来嵌套 <code>if</code> 语句。</mark></p> 
<pre><code class="prism language-lua">a <span class="token operator">=</span> <span class="token number">5</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"num &gt; 0"</span><span class="token punctuation">)</span>
<span class="token keyword">elseif</span> a <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">then</span>
	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"num = 0"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span>
	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"num &lt; 0"</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>
</code></pre> 
<h6><a id="847__437"></a>8.4.7 循环控制语句</h6> 
<p>    <strong>Lua</strong> 提供了<strong>四种循环控制语句</strong>： <code>while...do</code> 循环、 <code>repeat...until</code> 循环、<code>数值 for</code> 循环，及 <code>泛型 for</code> 循环。同时， <strong>Lua</strong> 还提供了 <code>break</code> 与 <code>goto</code> 两种<strong>循环流程控制语句</strong>。</p> 
<p><strong>⭐️（1）while … do</strong></p> 
<p>    只要 <code>while</code> 中的 <strong>条件成立</strong> 就一直<strong>循环</strong>。</p> 
<pre><code class="prism language-lua">a <span class="token operator">=</span> <span class="token number">3</span>
<span class="token keyword">while</span> a<span class="token operator">&gt;</span><span class="token number">0</span> <span class="token keyword">do</span>
	<span class="token function">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
	a <span class="token operator">=</span> a <span class="token operator">-</span> <span class="token number">1</span>    <span class="token comment">-- 注意：这里没有a--</span>
<span class="token keyword">end</span>
</code></pre> 
<blockquote> 
 <p>输出：<br> 3<br> 2<br> 1</p> 
</blockquote> 
<p><strong>⭐️（2）repeat … until</strong></p> 
<p>    <code>until</code> 中的 <strong>条件成立</strong>了，循环就要 <strong>停止</strong>。</p> 
<pre><code class="prism language-lua">a <span class="token operator">=</span> <span class="token number">3</span>
<span class="token keyword">repeat</span>
	<span class="token function">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
	a <span class="token operator">=</span> a <span class="token operator">-</span> <span class="token number">1</span>    <span class="token comment">-- 注意：这里没有a--</span>
<span class="token keyword">until</span> a <span class="token operator">&lt;=</span> <span class="token number">0</span>
</code></pre> 
<blockquote> 
 <p>输出：<br> 3<br> 2<br> 1</p> 
</blockquote> 
<p><strong>⭐️（3）数值 for</strong></p> 
<p>    这种 <code>for</code> 循环只参用于<strong>循环变量</strong>为 <strong>数值型</strong> 的情况。其语法格式为：</p> 
<pre><code class="prism language-lua"><span class="token keyword">for</span> var<span class="token operator">=</span>exp1<span class="token punctuation">,</span> exp2<span class="token punctuation">,</span> exp3 <span class="token keyword">do</span>
	循环体
<span class="token keyword">end</span>
</code></pre> 
<p>    <code>var</code> 为指定的 <strong>循环变量</strong>， <code>exp1</code> 为 循环 <strong>起始值</strong>， <code>exp2</code> 为 循环 <strong>结束值</strong>， <code>exp3</code> 为 循环 <strong>步长</strong>。</p> 
<ul><li>步长可省略不写，<strong>默认</strong>为 <code>1</code> 。</li><li>每循环一次，系统内部都会做一次当前循环变量 <code>var</code> 的值与 <code>exp2</code> 的比较，如果 <code>var</code> <strong>小于等于</strong> <code>exp2</code> 的值，则继续循环，否则结束循环。</li></ul> 
<p>例如：</p> 
<pre><code class="prism language-lua"><span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">20</span> <span class="token keyword">do</span>
	<span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token keyword">end</span>
</code></pre> 
<blockquote> 
 <p>输出：<br> 10<br> 30<br> 50</p> 
</blockquote> 
<p><strong>⭐️（4）泛型 for</strong></p> 
<p>    <code>泛型 for</code> 用于遍历 <code>table</code> 中的<strong>所有值</strong>，其需要与 Lua 的 <code>迭代器</code> 联合使用。后面 table 学习时再详解。</p> 
<p><strong>⭐️（5）break</strong></p> 
<p>    <code>break</code> 语句可以<strong>提前终止循环</strong>。其只能用于循环之中。</p> 
<pre><code class="prism language-lua"><span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">9</span> <span class="token keyword">do</span>
	<span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
	<span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">3</span> <span class="token keyword">then</span>
		<span class="token keyword">break</span>
	<span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> 
<blockquote> 
 <p>输出：<br> 1<br> 2<br> 3</p> 
</blockquote> 
<p><strong>⭐️（6）goto</strong> (<em>不建议使用，不然可能使代码杂乱无章</em>)</p> 
<p>    <code>goto</code> 语句可以将执行流程 <strong>无条件地跳转</strong> 到指定的标记语句处开始执行，注意，是<strong>开始执行</strong>，并非仅执行这一句，而是从这句开始后面的语句都会重新执行。当然，该标识语句在第一次经过时也是会执行的，并非是必须由 <code>goto</code> 跳转时才执行。</p> 
<p>    语句标记使用一对<strong>双冒号括起来</strong>，置于语句前面。<code>goto</code> 语句可以使用在循环之外。</p> 
<pre><code class="prism language-lua"><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
	<span class="token punctuation">::</span>flag<span class="token punctuation">::</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"========="</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> a <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token keyword">then</span>
		<span class="token function">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
		a <span class="token operator">=</span> a <span class="token operator">-</span> <span class="token number">1</span>
		<span class="token keyword">goto</span> flag
	<span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token function">f</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>输出：<br> =========<br> 5<br> =========<br> 4<br> =========<br> 3<br> =========<br> 2<br> =========</p> 
</blockquote> 
<p>    注意，<strong>Lua5.1</strong> 中 <mark>不支持</mark> <strong>双冒号</strong> 的语句标记。</p> 
<h4><a id="85_Lua__552"></a>8.5 Lua 语法进阶</h4> 
<h6><a id="851_table_553"></a>8.5.1 table</h6> 
<p><strong>⭐️（1）数组</strong></p> 
<p>    使用 <code>table</code> 可以定义 <strong>一维、二维、多维数组</strong>。不过，需要注意， <strong>Lua</strong> 中的数组索引是从 <code>1</code> 开始的，且 <mark>无需声明数组长度，可以<strong>随时增加</strong>元素</mark>。当然，同一数组中的 <mark>元素可以是<strong>任意类型</strong></mark>。</p> 
<pre><code class="prism language-lua"><span class="token comment">-- 定义一个一维数组</span>
cities <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"北京"</span><span class="token punctuation">,</span> <span class="token string">"上海"</span><span class="token punctuation">,</span> <span class="token string">"广州"</span><span class="token punctuation">}</span>
cities<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"深圳"</span>

<span class="token keyword">for</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token keyword">do</span>
	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"cities["</span><span class="token operator">..</span>i<span class="token operator">..</span><span class="token string">"]="</span><span class="token operator">..</span>cities<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>
</code></pre> 
<blockquote> 
 <p>输出：<br> cities[1]=北京<br> cities[2]=上海<br> cities[3]=广州<br> cities[4]=深圳</p> 
</blockquote> 
<pre><code class="prism language-lua"><span class="token comment">-- 声明一个二维数组</span>
arr <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> 			<span class="token comment">-- 必须声明空数组</span>
<span class="token keyword">for</span> i<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token keyword">do</span>
	arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>		<span class="token comment">-- 必须声明空数组</span>
	<span class="token keyword">for</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token keyword">do</span>
		arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">*</span> j
		<span class="token function">print</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> 
<blockquote> 
 <p>输出：<br> 1<br> 2<br> 2<br> 4<br> 3<br> 6</p> 
</blockquote> 
<p><strong>⭐️（2）map</strong></p> 
<p>    使用 <code>table</code> 也可以定义出类似 <code>map</code> 的 <code>key-value</code> 数据结构。其可以定义 <code>table</code> 时直接指定 <code>key-value</code> ，也可单独指定 <code>key-value</code> 。而访问时，一般都是通过 <code>table</code> 的 <code>key</code> <strong>直接访问</strong>，也可以数组<strong>索引方式</strong>来访问，此时的 <code>key</code> 即为<strong>索引</strong>。</p> 
<p>例 1 ：</p> 
<pre><code class="prism language-lua"><span class="token comment">-- 定义一个map</span>
emp  <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>name <span class="token operator">=</span> <span class="token string">"张三"</span><span class="token punctuation">,</span> age <span class="token operator">=</span> <span class="token string">"23"</span><span class="token punctuation">,</span> depart <span class="token operator">=</span> <span class="token string">"销售部"</span><span class="token punctuation">}</span>

<span class="token comment">-- 通过下标方式操作</span>
emp<span class="token punctuation">[</span><span class="token string">"gender"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"男"</span>
<span class="token function">print</span><span class="token punctuation">(</span>emp<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>				<span class="token comment">-- 输出：张三</span>
<span class="token function">print</span><span class="token punctuation">(</span>emp<span class="token punctuation">[</span><span class="token string">"gender"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>			<span class="token comment">-- 输出：男</span>

<span class="token comment">-- 点号方式操作 (推荐)</span>
emp<span class="token punctuation">.</span>office <span class="token operator">=</span> <span class="token string">"2nd floor"</span>
<span class="token function">print</span><span class="token punctuation">(</span>emp<span class="token punctuation">.</span>age<span class="token punctuation">)</span>					<span class="token comment">-- 输出：23</span>
<span class="token function">print</span><span class="token punctuation">(</span>emp<span class="token punctuation">.</span>office<span class="token punctuation">)</span>				<span class="token comment">-- 输出：2nd floor</span>
</code></pre> 
<p>例 2 ：</p> 
<pre><code class="prism language-lua">a <span class="token operator">=</span> <span class="token string">"xxx"</span>
b <span class="token operator">=</span> <span class="token number">3</span>
c <span class="token operator">=</span> <span class="token number">5</span>

<span class="token comment">-- 定义一个map，其key为表达式(需要用方括号括起来)</span>
arr <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">[</span><span class="token string">"emp_"</span><span class="token operator">..</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">,</span>
	<span class="token punctuation">[</span><span class="token string">"hi"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">,</span>
	<span class="token punctuation">[</span>b <span class="token operator">+</span> c<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">print</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span>emp_xxx<span class="token punctuation">)</span>				<span class="token comment">-- 输出：true</span>
<span class="token comment">-- print(arr.8)   -- 报错</span>
<span class="token function">print</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span>hi<span class="token punctuation">)</span>					<span class="token comment">-- 输出：123</span>
<span class="token function">print</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span>					<span class="token comment">-- 输出：hello</span>
</code></pre> 
<p><strong>⭐️（3）混合结构</strong></p> 
<p>    <strong>Lua</strong> 允许将数组与 <code>key-value</code> <strong>混合在同一个</strong> <code>table</code> 中进行定义。 <code>key-value</code> <mark>不会占用</mark>数组的<strong>数字索引值</strong>。</p> 
<pre><code class="prism language-lua">emp  <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"北京"</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">"张三"</span><span class="token punctuation">,</span> <span class="token string">"上海"</span><span class="token punctuation">,</span> age <span class="token operator">=</span> <span class="token string">"23"</span><span class="token punctuation">,</span> <span class="token string">"广州"</span><span class="token punctuation">,</span> depart <span class="token operator">=</span> <span class="token string">"销售部"</span><span class="token punctuation">,</span> <span class="token string">"深圳"</span><span class="token punctuation">}</span>

<span class="token function">print</span><span class="token punctuation">(</span>emp<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>					<span class="token comment">-- 输出：北京</span>
<span class="token function">print</span><span class="token punctuation">(</span>emp<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>					<span class="token comment">-- 输出：上海</span>
<span class="token function">print</span><span class="token punctuation">(</span>emp<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>					<span class="token comment">-- 输出：广州</span>
<span class="token function">print</span><span class="token punctuation">(</span>emp<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>					<span class="token comment">-- 输出：深圳</span>
</code></pre> 
<p>常见使用方法：</p> 
<pre><code class="prism language-lua"><span class="token comment">-- 定义一个数组，map 为混合结构</span>
emp <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">{<!-- --></span>name<span class="token operator">=</span><span class="token string">"张三"</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">23</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{<!-- --></span>name<span class="token operator">=</span><span class="token string">"李四"</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{<!-- --></span>name<span class="token operator">=</span><span class="token string">"王五"</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{<!-- --></span>name<span class="token operator">=</span><span class="token string">"赵六"</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">26</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token keyword">do</span>
	<span class="token function">print</span><span class="token punctuation">(</span>emp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token operator">..</span><span class="token string">" : "</span><span class="token operator">..</span>emp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>age<span class="token punctuation">)</span>
<span class="token keyword">end</span>
</code></pre> 
<blockquote> 
 <p>输出：<br> 张三 : 23<br> 李四 : 24<br> 王五 : 25<br> 赵六 : 26</p> 
</blockquote> 
<p><strong>⭐️（4）table 操作函数</strong></p> 
<p>    Lua 中提供了对 <code>table</code> 进行<a href="https://www.lua.org/manual/5.4/" rel="nofollow">操作的函数</a>。</p> 
<p><strong>A、table.concat()</strong></p> 
<p>【<strong>函数</strong>】<code>table.concat (table [, sep [, start [, end]]]):</code><br> 【<strong>解析</strong>】该函数用于将指定的 <code>table</code> <font color="red"><strong>数组元素</strong></font> 进行 <strong>字符串连接</strong>。连接从 <code>start</code> 索引位置到 <code>end</code> 索引位置的所有数组元素, 元素间使用指定的分隔符 <code>sep</code> 隔开。 如果 <code>table</code> 是一个混合结构，那么这个连接与 <code>key-value</code> 无关，<strong>仅是连接数组元素</strong>。</p> 
<pre><code class="prism language-lua">emp  <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"北京"</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">"张三"</span><span class="token punctuation">,</span> <span class="token string">"上海"</span><span class="token punctuation">,</span> age <span class="token operator">=</span> <span class="token string">"23"</span><span class="token punctuation">,</span> <span class="token string">"广州"</span><span class="token punctuation">,</span> depart <span class="token operator">=</span> <span class="token string">"销售部"</span><span class="token punctuation">,</span> <span class="token string">"深圳"</span><span class="token punctuation">}</span>

<span class="token function">print</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>emp<span class="token punctuation">,</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">-- 输出：北京,上海,广州,深圳</span>
<span class="token function">print</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>emp<span class="token punctuation">,</span> <span class="token string">","</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">-- 输出：上海,广州</span>
</code></pre> 
<p><strong>B、table.unpack()</strong></p> 
<p>【<strong>函数</strong>】<code>table.unpack (table [, i [, j]])</code><br> 【<strong>解析</strong>】<strong>拆包</strong>。该函数返回指定 <code>table</code> 的 <font color="red"><strong>数组</strong></font> 中的从第 <code>i</code> 个元素到第 <code>j</code> 个元素值。 <code>i</code> 与 <code>j</code> 是可选的，默认 <code>i</code> 为 <code>1</code>， <code>j</code> 为数组的最后一个元素。 <strong>Lua5.1</strong> 不支持该函数。</p> 
<pre><code class="prism language-lua">arr <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"bj"</span><span class="token punctuation">,</span> <span class="token string">"sh"</span><span class="token punctuation">,</span> <span class="token string">"gz"</span><span class="token punctuation">,</span> <span class="token string">"sz"</span><span class="token punctuation">}</span>

table<span class="token punctuation">.</span><span class="token function">unpack</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>  			 <span class="token comment">-- 输出：bj	sh	gz	sz</span>
table<span class="token punctuation">.</span><span class="token function">unpack</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> 	 <span class="token comment">-- 输出：sh	gz</span>

<span class="token comment">-- 也可以使用变量接收</span>
a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">unpack</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>
</code></pre> 
<p><strong>C、table.pack()</strong></p> 
<p>【<strong>函数</strong>】<code>table. pack (...)</code><br> 【<strong>解析</strong>】打包。该函数的参数是一个<strong>可变参</strong>，其可将指定的参数打包为一个 <code>table</code> 返回。这个返回的 <code>table</code> 中具有一个属性 <code>n</code> ，用于表示该 <code>table</code> 包含的 <strong>元素个数</strong>。 Lua5.1 不支持该函数。</p> 
<pre><code class="prism language-lua">t <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">pack</span><span class="token punctuation">(</span><span class="token string">"apple"</span><span class="token punctuation">,</span> <span class="token string">"banana"</span><span class="token punctuation">,</span> <span class="token string">"peach"</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">","</span><span class="token punctuation">)</span> 			<span class="token comment">-- 输出：apple,banana,peach</span>
</code></pre> 
<p><strong>D、table.maxn()</strong></p> 
<p>【<strong>函数</strong>】<code>table.maxn(table)</code><br> 【<strong>解析</strong>】该函数返回指定 <code>table</code> 的数组中的 <strong>最大索引值</strong>，即数组包含<strong>元素的个数</strong>。</p> 
<pre><code class="prism language-lua">emp  <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"北京"</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">"张三"</span><span class="token punctuation">,</span> <span class="token string">"上海"</span><span class="token punctuation">,</span> age <span class="token operator">=</span> <span class="token string">"23"</span><span class="token punctuation">,</span> <span class="token string">"广州"</span><span class="token punctuation">,</span> depart <span class="token operator">=</span> <span class="token string">"销售部"</span><span class="token punctuation">,</span> <span class="token string">"深圳"</span><span class="token punctuation">}</span>

<span class="token function">print</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>emp<span class="token punctuation">,</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">-- 输出：北京,上海,广州,深圳</span>

<span class="token function">print</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">maxn</span><span class="token punctuation">(</span>emp<span class="token punctuation">)</span><span class="token punctuation">)</span>		   <span class="token comment">-- 输出：4</span>
</code></pre> 
<p><strong>E、table.insert()</strong></p> 
<p>【<strong>函数</strong>】<code>table.insert (table, [pos,] value):</code><br> 【<strong>解析</strong>】该函数用于在指定 <code>table</code> 的数组部分指定位置 <code>pos</code> 插入值为 <code>value</code> 的一个<strong>元素</strong> 。 其后的元素会被后移 。 <code>pos</code> 参数可选 默认为数组部分末尾 。</p> 
<pre><code class="prism language-lua">cities <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"北京"</span><span class="token punctuation">,</span> <span class="token string">"上海"</span><span class="token punctuation">,</span> <span class="token string">"广州"</span><span class="token punctuation">}</span>

table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>cities<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"深圳"</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>cities<span class="token punctuation">,</span> <span class="token string">"天津"</span><span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>cities<span class="token punctuation">,</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 输出：北京,深圳,上海,广州,天津</span>
</code></pre> 
<p><strong>F、table.remove()</strong></p> 
<p>【<strong>函数</strong>】<code>table.remove (table [, pos])</code><br> 【<strong>解析</strong>】该函数用于 <strong>删除并返回</strong> 指定 <code>table</code> 中数组部分位于 <code>pos</code> 位置的元素 。 <mark>其后的元素会被前移</mark> 。 <code>pos</code> 参数可选<strong>默认</strong>删除数组中的<strong>最后一个元素</strong>。</p> 
<pre><code class="prism language-lua">cities <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"北京"</span><span class="token punctuation">,</span> <span class="token string">"上海"</span><span class="token punctuation">,</span> <span class="token string">"广州"</span><span class="token punctuation">,</span> <span class="token string">"深圳"</span><span class="token punctuation">,</span> <span class="token string">"天津"</span><span class="token punctuation">}</span>

table<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>cities<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>cities<span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>cities<span class="token punctuation">,</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 输出：北京,广州,深圳</span>
</code></pre> 
<p><strong>G、table.sort()</strong></p> 
<p>【<strong>函数</strong>】<code>table. sort(table [,fun(a,b)])</code><br> 【<strong>解析</strong>】该函数用于对指定的 <code>table</code> 的数组元素进行 <strong>默认</strong> <font color="red"><strong>升序排序</strong></font>，也可按照指定函数 <code>fun(a,b)</code> 中<strong>指定的规则</strong>进行排序。 <code>fun(a,b)</code> 是一个用于比较 <code>a</code> 与 <code>b</code> 的函数， <code>a</code> 与 <code>b</code> 分别代表数组中的两个相邻元素。</p> 
<pre><code class="prism language-lua">cities <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"bj北京"</span><span class="token punctuation">,</span> <span class="token string">"sh上海"</span><span class="token punctuation">,</span> <span class="token string">"gz广州"</span><span class="token punctuation">,</span> <span class="token string">"sz深圳"</span><span class="token punctuation">,</span> <span class="token string">"tj天津"</span><span class="token punctuation">}</span>

table<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>cities<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>     <span class="token comment">-- 降序</span>
						<span class="token keyword">return</span> a <span class="token operator">&gt;</span> b  <span class="token comment">-- 如果相邻的两个为真，保持原来的队形</span>
				   <span class="token keyword">end</span>
<span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>cities<span class="token punctuation">,</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 输出：tj天津,sz深圳,sh上海,gz广州,bj北京</span>
</code></pre> 
<blockquote> 
 <p><strong>注意</strong>：</p> 
 <ul><li>如果 <code>arr</code> 中的元素既有 <strong>字符串</strong> 又有 <strong>数值型</strong> ，那么对其进行排序会 <font color="red">报错</font>。</li><li>如果数组中多个元素相同，则其<strong>相同的多个元素</strong>的排序结果不确定，即这些元素的索引谁排前谁排后，<strong>不确定</strong>。</li><li>如果数组元素中包含 <code>nil</code> ，则排序会 <font color="red">报错</font>。</li></ul> 
</blockquote> 
<h6><a id="852__765"></a>8.5.2 迭代器</h6> 
<p>    Lua 提供了两个<strong>迭代器</strong> <code>pairs(table)</code> 与 <code>ipairs(table)</code> 。这两个迭代器通常会应用于 <code>泛型 for</code> 循环中，用于遍历指定的 <code>table</code> 。这两个迭代器的不同是：</p> 
<ul><li><code>ipairs(table) </code>：仅会迭代指定 table 中的 <font color="red"><strong>数组元素</strong></font>。</li><li><code>pairs(table)</code>：会迭代 <font color="red"><strong>整个 table 元素</strong></font> ，无论是 <strong>数组元素</strong>，还是 <code>key-value</code> 。</li></ul> 
<pre><code class="prism language-lua">emp  <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"北京"</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">"张三"</span><span class="token punctuation">,</span> <span class="token string">"上海"</span><span class="token punctuation">,</span> age <span class="token operator">=</span> <span class="token string">"23"</span><span class="token punctuation">,</span> <span class="token string">"广州"</span><span class="token punctuation">,</span> depart <span class="token operator">=</span> <span class="token string">"销售部"</span><span class="token punctuation">,</span> <span class="token string">"深圳"</span><span class="token punctuation">}</span>

<span class="token comment">-- 遍历emp中的所有数组元素</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>emp<span class="token punctuation">)</span> <span class="token keyword">do</span>
	<span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
<span class="token keyword">end</span>
<span class="token comment">--[[输出：
1	北京
2	上海
3	广州
4	深圳
--]]</span>

<span class="token comment">-- 遍历emp中的所有元素</span>
<span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>emp<span class="token punctuation">)</span> <span class="token keyword">do</span>
	<span class="token function">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
<span class="token keyword">end</span>
<span class="token comment">--[[输出：
1	北京
2	上海
3	广州
4	深圳
depart	销售部
name	张三
age	23
--]]</span>
</code></pre> 
<h6><a id="853__800"></a>8.5.3 模块</h6> 
<p>    模块是 Lua 中特有的一种数据结构。 从 Lua 5.1 开始， Lua 加入了标准的 <strong>模块管理机制</strong>，可以把一些公用的代码放在一个文件里，以 <strong>API 接口</strong> 的形式在其他地方调用，<mark>有利于代码的<strong>重用</strong>和<strong>降低代码耦合度</strong></mark>。</p> 
<p>    <strong>模块文件</strong>主要由 <code>table</code> 组成。在 <code>table </code>中添加相应的<strong>变量</strong>、<strong>函数</strong>，最后<strong>文件返回</strong>该 <code>table</code> 即可。如果其它文件中需要使用该模块，只需通过 <code>require</code> 将该 <strong>模块导入</strong> 即可。</p> 
<p><strong>⭐️（1）定义一个模块</strong></p> 
<p>    <strong>模块</strong> 是一个 <strong>lua 文件</strong>，其中会包含一个 <code>table</code> 。一般情况下该<strong>文件名</strong>与该 <code>table</code> <strong>名称相同</strong>，但其 <mark><strong>并不是</strong>必须的</mark>。</p> 
<p>例如： 定义<code>rectangle</code>模块， 创建一个<code>rectangle.lua</code> 文件</p> 
<pre><code class="prism language-lua"><span class="token comment">-- 声明一个模块</span>
rectangle <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token comment">-- 为模块添加一个变量</span>
rectangle<span class="token punctuation">.</span>pi <span class="token operator">=</span> <span class="token number">3.14</span>

<span class="token comment">-- 为模块添加函数（求周长）</span>
<span class="token keyword">function</span> rectangle<span class="token punctuation">.</span><span class="token function">perimeter</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span>
<span class="token keyword">end</span>

<span class="token comment">-- 以匿名函数方式为模块添加一个函数（求面积）</span>
rectangle<span class="token punctuation">.</span>area <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
	<span class="token keyword">return</span> a <span class="token operator">*</span> b
<span class="token keyword">end</span>


<span class="token comment">-- ================= 定义与模块无关的内容===============</span>
<span class="token comment">-- 定义一个全局变量</span>
goldenRatio <span class="token operator">=</span> <span class="token number">0.618</span>

<span class="token comment">-- 定义一个局部函数（求圆的面积）</span>
<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">circularArea</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
	<span class="token keyword">return</span> rectangle<span class="token punctuation">.</span>pi <span class="token operator">*</span> r <span class="token operator">*</span> r
<span class="token keyword">end</span>

<span class="token comment">-- 定义一个全局函数（求矩形中最大圆的面积）</span>
<span class="token keyword">function</span> <span class="token function">maxCircularArea</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
	<span class="token keyword">local</span> r <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token function">circularArea</span><span class="token punctuation">(</span>r <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token keyword">return</span> rectangle
</code></pre> 
<p><strong>⭐️（2）使用模块</strong></p> 
<p>    这里要用到一个函数 <code>require("文件路径"))</code>，其中文件名是 <mark><strong>不能写</strong> <code>.lua</code> 扩展名的</mark>。该函数可以将指定的 lua 文件<strong>静态导入</strong>（合并为一个文件）。不过需要注意的是，该函数的使用可以<strong>省略小括号</strong>，写为 <code>require"文件路径"</code>。</p> 
<pre><code class="prism language-lua"><span class="token comment">-- 导入一个模块</span>
require <span class="token string">"rectangle"</span>

<span class="token comment">-- 访问模块的属性，调用模块的函数</span>
<span class="token function">print</span><span class="token punctuation">(</span>rectangle<span class="token punctuation">.</span>pi<span class="token punctuation">)</span>						<span class="token comment">-- 输出：3.14</span>
<span class="token function">print</span><span class="token punctuation">(</span>rectangle<span class="token punctuation">.</span><span class="token function">perimeter</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>		<span class="token comment">-- 输出：16</span>
<span class="token function">print</span><span class="token punctuation">(</span>rectangle<span class="token punctuation">.</span><span class="token function">area</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>				<span class="token comment">-- 输出：15</span>
</code></pre> 
<p>    <code>require()</code> 函数是<strong>有返回值</strong>的，返回的就是模块文件最后 <code>return</code> 的 <code>table</code> 。可以使用一个变量接收该 <code>table</code> 值 <strong>作为模块的别名</strong>，就可以 <mark>使用 <strong>别名</strong> 来访问模块</mark>了。</p> 
<pre><code class="prism language-lua"><span class="token comment">-- 导入一个模块</span>
rect <span class="token operator">=</span> require <span class="token string">"rectangle"</span>

<span class="token comment">-- 访问模块的属性，调用模块的函数</span>
<span class="token function">print</span><span class="token punctuation">(</span>rect<span class="token punctuation">.</span>pi<span class="token punctuation">)</span>						<span class="token comment">-- 输出：3.14</span>
<span class="token function">print</span><span class="token punctuation">(</span>rect<span class="token punctuation">.</span><span class="token function">perimeter</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>			<span class="token comment">-- 输出：16</span>
<span class="token function">print</span><span class="token punctuation">(</span>rect<span class="token punctuation">.</span><span class="token function">area</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>				<span class="token comment">-- 输出：15</span>


<span class="token comment">-- 访问模块中与模块无关的内容</span>
<span class="token function">print</span><span class="token punctuation">(</span>goldenRatio<span class="token punctuation">)</span>						<span class="token comment">-- 输出：0.618</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">maxCircularArea</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>			<span class="token comment">-- 输出：12.56</span>
<span class="token comment">-- print(circularArea(2))	-- 报错，局部的不能访问</span>
</code></pre> 
<p><strong>⭐️（3）再看模块</strong></p> 
<p>    <strong>模块文件</strong>中一般定义的 <strong>变量</strong> 与 <strong>函数</strong> 都是模块 <code>table</code> 相关内容，但也可以定义其它与 <code>table</code> 无关的内容。这些 <strong>全局变量与函数</strong> 就是 <strong>普通的全局变量与函数</strong>，<mark>与模块无关</mark>，但会随着模块的导入而同时导入。所以在使用时可以直接使用，而无需也不能添加模块名称。</p> 
<h6><a id="854__883"></a>8.5.4 元表和元方法</h6> 
<p>    <strong>元表</strong>，即 Lua 中普通 <code>table</code> 的 <strong>元数据表</strong>，而 <strong>元方法</strong> 则是元表中定义的普通表的默认行为。Lua 中的每个普通 table 都可为其定义一个元表，用于扩展该普通 table 的行为功能。例如，</p> 
<ul><li>对于 table 与数值相加的行为， Lua 中是没有定义的，但用户可通过为其指定元表来扩展这种行为；</li><li>再如，用户访问不存在的 table 元素， Lua 默认返回的是 nil ，但用户可能并不知道发生了什么。此时可以通过为该 table 指定元表来扩展该行为：给用户提示信息，并返回用户指定的值。</li></ul> 
<p><strong>⭐️（1）重要函数</strong></p> 
<p>元表中有两个重要函数</p> 
<ul><li>setmetatable(table, metatable) 将 metatable 指定为普通表 table 的元表。</li><li>getmetatable(table) 获取指定普通表 table 的元表。</li></ul> 
<p><strong>⭐️（2）__index 元方法</strong><br> <strong>⭐️（3）__newindex 元方法</strong><br> <strong>⭐️（4）运算符 元方法</strong><br> <strong>⭐️（5）__tostring 元方法</strong><br> <strong>⭐️（6）__call 元方法</strong><br> <strong>⭐️（7）元表单独定义</strong></p> 
<h6><a id="855__900"></a>8.5.5 面向对象</h6> 
<p><strong>⭐️（1）简单对象的创建</strong><br> <strong>⭐️（2）类的创建</strong></p> 
<h6><a id="856__904"></a>8.5.6 协同线程与协同函数</h6> 
<p><strong>⭐️（1）协同线程</strong><br> <strong>⭐️（2）协同函数</strong></p> 
<h6><a id="857_IO_908"></a>8.5.7 文件IO</h6> 
<p><strong>⭐️（1）常用静态函数</strong></p> 
<p><strong>A、io.open()</strong></p> 
<p>【<strong>格式</strong>】<code>io.open (filename [, mode])</code><br> 【<strong>解析</strong>】以 <strong>指定模式 打开指定文件</strong>，返回要打开文件的 <font color="red"><strong>句柄</strong></font>，就是一个<strong>对象</strong>（后面会讲 Lua 中的<strong>对象</strong>）。其中模式 <code>mode</code> 有<strong>三种</strong>，但同时还可配合两个符号使用：</p> 
<ul><li><code>r</code> ：<strong>只读</strong>，默认模式</li><li><code>w</code> ：<strong>只写</strong>，写入内容会<strong>覆盖</strong>文件原有内容</li><li><code>a</code> ：<strong>只写</strong>，以<strong>追加方式</strong>写入内容</li><li><code>+</code>：<strong>增加符</strong>，在 <code>r+</code> 、 <code>w+</code> 、 <code>a+</code> 均变为了 <strong>读写</strong></li><li><code>b</code> ：<strong>二进制表示符</strong>。如果要操作的文件为二进制文件，则需要变为 <code>rb</code> 、 <code>wb</code> 、 <code>ab</code> 。</li></ul> 
<p><strong>B、io.input()</strong></p> 
<p>【<strong>格式</strong>】<code>io.input (file)</code><br> 【<strong>解析</strong>】指定要读取的文件。</p> 
<p><strong>C、io.outout()</strong></p> 
<p>【<strong>格式</strong>】<code>io.output (file)</code><br> 【<strong>解析</strong>】指定要写入的文件。</p> 
<p><strong>D、io.read()</strong></p> 
<p>【<strong>格式</strong>】<code>io.read([format])</code><br> 【<strong>解析</strong>】以<strong>指定格式</strong>读取 <code>io.input()</code> 中指定的输入文件。其中 <code>format</code> 格式有：</p> 
<ul><li><code>*l</code> ：从当前位置的 <strong>下一个位置</strong> 开始读取 <strong>整个行</strong>，<strong>默认格式</strong></li><li><code>*n</code> ：读取 <strong>下一个数字</strong>，其将作为<strong>浮点数</strong>或<strong>整数</strong></li><li><code>*a</code> ：从当前位置的 <strong>下一个位置</strong> 开始读取 <strong>整个文件</strong></li><li><code>number</code> ：这是一个<strong>数字</strong>，表示要 <strong>读取的字符的个数</strong></li></ul> 
<p><strong>E、io.write()</strong></p> 
<p>【<strong>格式</strong>】<code>io.write(data)</code><br> 【<strong>解析</strong>】将指定的数据 <code>data</code> 写入到 <code>io.output()</code> 中<strong>指定的输出文件</strong>。</p> 
<p><strong>⭐️（2）常用实例函数</strong></p> 
<p><strong>A、file:read()</strong></p> 
<p>这里的 <code>file</code> 使用的是 <code>io.open()</code> 函数返回的 <code>file</code> ，其实际就是 Lua 中的一个对象。其用法与 <code>io.read()</code> 的相同。</p> 
<p><strong>B、file:write()</strong></p> 
<p>用法与 <code>io.write()</code> 的相同。</p> 
<p><strong>C、file:seek()</strong></p> 
<p>【<strong>格式</strong>】<code>file:seek ([whence [, offset]])</code><br> 【<strong>解析</strong>】该函数用于获取或设置文件读写指针的当前位置。<br> 位置从 1 开始计数，除文件最后一行外，每行都有行结束符，其会占两个字符位置。位置 0 表示文件第一个位置的前面位置。<br> 当seek() 为无参时会返回读写指针的当前位置。参数 whence 的值有三种，表示将指针定位的不同位置。而 offset 则表示相对于 whence 指定位置的偏移量， offset 的默认值为 0 为正表示向后偏移，为负表示向前偏移。</p> 
<ul><li>set ：表示将指针定位到文件开头处，即 0 位置处</li><li>cur ：表示指针保持当前位置不变，默认值</li><li>end ：表示将指针定位到文件结尾处</li></ul> 
<h3><a id="_965"></a>九、分布式锁</h3> 
<h4><a id="91__966"></a>9.1 分布式锁的工作原理</h4> 
<h4><a id="92__967"></a>9.2 问题引入</h4> 
<h4><a id="93_setnx__968"></a>9.3 setnx 实现方式</h4> 
<h4><a id="94__969"></a>9.4 为锁添加过期时间</h4> 
<h4><a id="95__970"></a>9.5 为锁添加标识</h4> 
<h4><a id="96__Lua__971"></a>9.6 添加 Lua 脚本</h4> 
<h4><a id="97_Redisson__972"></a>9.7 Redisson 可重入锁</h4> 
<h4><a id="98_Redisson__973"></a>9.8 Redisson 红锁</h4> 
<h4><a id="99__974"></a>9.9 分段锁</h4> 
<h4><a id="910_Redisson__975"></a>9.10 Redisson 详解</h4>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f618fb30318f6a1a42d063c32e11ab99/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">题解 | #在二叉树中找到两个节点的最近公共祖先#</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/90543b414a120a9676e045cde842c490/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">React格式化规范</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>