<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>由浅入深理解C#中的事件 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="由浅入深理解C#中的事件" />
<meta property="og:description" content="目录 本文较长，给大家提供了目录，可以直接看自己感兴趣的部分。
前言 有关事件的概念 示例 ​ 简单示例 ​ 标准 .NET 事件模式 ​ 使用泛型版本的标准 .NET 事件模式 ​ 补充 总结 参考 前言 前面介绍了C#中的委托，事件的很多部分都与委托类似。实际上，事件就像是专门用于某种特殊用途的简单委托，事件包含了一个私有的委托，如下图所示：
有关事件的私有委托需要了解的重要事项如下：
1、事件提供了对它的私有控制委托的结构化访问。我们无法直接访问该委托。
2、事件中可用的操作比委托要少，对于事件我们只可以添加、删除或调用事件处理程序。
3、事件被触发时，它调用委托来依次调用调用列表中的方法。
有关事件的概念 发布者（Publisher）：发布某个事件的类或结构，其他类可以在该事件发生时得到通知。
订阅者（Subscriber）：注册并在事件发生时得到通知的类或结构。
事件处理程序（event handler）：由订阅者注册到事件的方法，在发布者触发事件时执行。
触发（raise）事件：调用（invoke）或触发（fire）事件的术语。当事件触发时，所有注册到它的方法都会被依次调用。
示例 简单示例 现在我们先来看一下最最原始的事件示例。其结构如下所示：
委托类型声明：事件和事件处理程序必须有共同的签名和返回类型，它们通过委托类型进行描述。
事件处理程序声明：订阅者类中会在事件触发时执行的方法声明。它们不一定有显示命名的方法，还可以是匿名方法或Lambda表达式。
事件声明：发布者类必须声明一个订阅者类可以注册的事件成员。当声明的事件为public时，称为发布了事件。
事件注册：订阅者必须订阅事件才能在它被触发时得到通知。
触发事件的代码：发布者类中”触发“事件并导致调用注册的所有事件处理程序的代码。
现在我们可以照着这个思路去写示例代码。
首先声明一个自定义的委托类型：
public delegate void MyDelegate(); 该委托类型没有参数也没有返回值。
然后再写一个发布者类：
public class Publisher { public event MyDelegate MyEvent; public void DoCount() { for(int i = 0; i &lt; 10; i&#43;&#43;) { Task.Delay(3000).Wait(); //确认有方法可以执行 if(MyEvent !" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/d423d73bbf5d21f4977dc81682bb60cd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-04T20:17:21+08:00" />
<meta property="article:modified_time" content="2024-01-04T20:17:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">由浅入深理解C#中的事件</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>目录</h3> 
<p>本文较长，给大家提供了目录，可以直接看自己感兴趣的部分。</p> 
<pre><code class="prism language-csharp">前言

有关事件的概念

示例

​   简单示例

​   标准 <span class="token punctuation">.</span>NET 事件模式

​   使用泛型版本的标准 <span class="token punctuation">.</span>NET 事件模式

​   补充

总结
参考
</code></pre> 
<h3><a id="_23"></a>前言</h3> 
<p>前面介绍了C#中的委托，事件的很多部分都与委托类似。实际上，事件就像是专门用于某种特殊用途的简单委托，事件包含了一个私有的委托，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/07/4e/V1V0Rczs_o.png" alt="image-20240102160538415"></p> 
<p>有关事件的私有委托需要了解的重要事项如下：</p> 
<p>1、事件提供了对它的私有控制委托的结构化访问。我们无法直接访问该委托。</p> 
<p>2、事件中可用的操作比委托要少，对于事件我们只可以添加、删除或调用事件处理程序。</p> 
<p>3、事件被触发时，它调用委托来依次调用调用列表中的方法。</p> 
<h3><a id="_37"></a>有关事件的概念</h3> 
<p><code>发布者（Publisher）</code>：发布某个事件的类或结构，其他类可以在该事件发生时得到通知。</p> 
<p><code>订阅者（Subscriber）</code>：注册并在事件发生时得到通知的类或结构。</p> 
<p><code>事件处理程序（event handler）</code>：由订阅者注册到事件的方法，在发布者触发事件时执行。</p> 
<p><code>触发（raise）事件</code>：调用（invoke）或触发（fire）事件的术语。当事件触发时，所有注册到它的方法都会被依次调用。</p> 
<h3><a id="_47"></a>示例</h3> 
<h4><a id="_49"></a>简单示例</h4> 
<p>现在我们先来看一下最最原始的事件示例。其结构如下所示：</p> 
<p><img src="https://images2.imgbox.com/54/a0/2OTKefJ7_o.png" alt="image-20240103101447689"></p> 
<p><code>委托类型声明</code>：事件和事件处理程序必须有共同的签名和返回类型，它们通过委托类型进行描述。</p> 
<p><code>事件处理程序声明</code>：订阅者类中会在事件触发时执行的方法声明。它们不一定有显示命名的方法，还可以是匿名方法或Lambda表达式。</p> 
<p><code>事件声明</code>：发布者类必须声明一个订阅者类可以注册的事件成员。当声明的事件为public时，称为发布了事件。</p> 
<p><code>事件注册</code>：订阅者必须订阅事件才能在它被触发时得到通知。</p> 
<p><code>触发事件的代码</code>：发布者类中”触发“事件并导致调用注册的所有事件处理程序的代码。</p> 
<p>现在我们可以照着这个思路去写示例代码。</p> 
<p>首先声明一个自定义的委托类型：</p> 
<pre><code class="prism language-csharp"> <span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">MyDelegate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>该委托类型没有参数也没有返回值。</p> 
<p>然后再写一个发布者类：</p> 
<pre><code class="prism language-csharp">   <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Publisher</span>
   <span class="token punctuation">{<!-- --></span>
       <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">MyDelegate</span> MyEvent<span class="token punctuation">;</span>
       <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DoCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">{<!-- --></span>
           <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> 
           <span class="token punctuation">{<!-- --></span> 
               Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            
                   
               <span class="token comment">//确认有方法可以执行</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span>MyEvent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
               <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">//触发事件</span>
                    <span class="token function">MyEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
               
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
</code></pre> 
<p>事件声明：</p> 
<pre><code class="prism language-csharp"> <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">MyDelegate</span> MyEvent<span class="token punctuation">;</span>
</code></pre> 
<p>事件声明在一个类中，它需要委托类型的名称，任何注册到事件的处理程序都必须与委托类型的签名和返回类型匹配。它声明为public，这样其他类和结构可以在它上面注册事件处理程序。不能使用对象创建表达式（new表达式）来创建它的对象。</p> 
<p>一个常见的误解就是把事件认为是类型，事件其实不是类型，它和方法、属性一样是类或结构的成员。</p> 
<p>由于事件是成员，所以我们不能在一段可执行的代码中声明事件，它必须声明在类或结构中，和其他成员一样。</p> 
<p>事件成员被隐式自动初始化为null。</p> 
<p>事件声明的图解如下所示：</p> 
<p><img src="https://images2.imgbox.com/ed/4a/p2VvEZMX_o.png" alt="image-20240103140544886"></p> 
<p>触发事件：</p> 
<pre><code class="prism language-csharp">              <span class="token comment">//确认有方法可以执行</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span>MyEvent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
               <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">//触发事件</span>
                    <span class="token function">MyEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
</code></pre> 
<p>也可以这样写：</p> 
<pre><code class="prism language-csharp">              <span class="token comment">//确认有方法可以执行</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span>MyEvent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
               <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">//触发事件</span>
                    <span class="token function">MyEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
</code></pre> 
<p>这两者是等效的，<code>MyEvent();</code>直接调用事件的委托，<code>MyEvent().Invoke()</code>使用显式调用委托的 <code>Invoke</code> 方法。</p> 
<p>现在再看看订阅者类：</p> 
<pre><code class="prism language-csharp">  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Subscriber</span>
  <span class="token punctuation">{<!-- --></span>          
      <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">EventHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">{<!-- --></span>
          Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">DateTime<span class="token punctuation">.</span>Now</span><span class="token punctuation">}</span></span><span class="token string">执行了事件处理程序"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> 
<p>订阅者类中有一个EventHandler方法，与前面定义的委托类型的签名与返回值类型一致。</p> 
<p>在看下主函数：</p> 
<pre><code class="prism language-csharp"> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
 <span class="token punctuation">{<!-- --></span>
   <span class="token class-name">Publisher</span> publisher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Publisher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">Subscriber</span> subscriber <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Subscriber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   
   <span class="token comment">//订阅事件</span>
   publisher<span class="token punctuation">.</span>MyEvent <span class="token operator">+=</span> subscriber<span class="token punctuation">.</span>EventHandler<span class="token punctuation">;</span>
   
   publisher<span class="token punctuation">.</span><span class="token function">DoCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-csharp"> publisher<span class="token punctuation">.</span>MyEvent <span class="token operator">+=</span> subscriber<span class="token punctuation">.</span>EventHandler<span class="token punctuation">;</span>
</code></pre> 
<p>就是在订阅事件，对应上面结构图中的事件注册，将subscriber类的EventHandler方法注册到publisher类的MyEvent事件上。</p> 
<p>也可以通过：</p> 
<pre><code class="prism language-csharp"> publisher<span class="token punctuation">.</span>MyEvent <span class="token operator">-=</span> subscriber<span class="token punctuation">.</span>EventHandler<span class="token punctuation">;</span>
</code></pre> 
<p>取消订阅事件。</p> 
<p>运行结果如下所示：</p> 
<p><img src="https://images2.imgbox.com/84/63/9shw1nfE_o.png" alt="image-20240103151109073"></p> 
<p>本示例全部代码如下所示：</p> 
<pre><code class="prism language-csharp"> <span class="token keyword">internal</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
 <span class="token punctuation">{<!-- --></span>
     <span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">MyDelegate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Publisher</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">MyDelegate</span> MyEvent<span class="token punctuation">;</span>
         <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DoCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> 
             <span class="token punctuation">{<!-- --></span> 
                 Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              
                 <span class="token comment">//确认有方法可以执行</span>
                 <span class="token keyword">if</span><span class="token punctuation">(</span>MyEvent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                 <span class="token punctuation">{<!-- --></span>
                     <span class="token comment">//触发事件</span>
                     <span class="token function">MyEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token punctuation">}</span>
                 
             <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Subscriber</span>
     <span class="token punctuation">{<!-- --></span>          
         <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">EventHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">DateTime<span class="token punctuation">.</span>Now</span><span class="token punctuation">}</span></span><span class="token string">执行了事件处理程序"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
       <span class="token class-name">Publisher</span> publisher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Publisher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">Subscriber</span> subscriber <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Subscriber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       
       <span class="token comment">//订阅事件</span>
       publisher<span class="token punctuation">.</span>MyEvent <span class="token operator">+=</span> subscriber<span class="token punctuation">.</span>EventHandler<span class="token punctuation">;</span>
       
       publisher<span class="token punctuation">.</span><span class="token function">DoCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre> 
<p>以上就根据上面的结构图写出了一个使用事件的示例，但是本示例还有需要改进的地方。</p> 
<p>上面我们触发事件检查空值是这样写的：</p> 
<pre><code class="prism language-csharp">                 <span class="token comment">//确认有方法可以执行</span>
                 <span class="token keyword">if</span><span class="token punctuation">(</span>MyEvent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                 <span class="token punctuation">{<!-- --></span>
                     <span class="token comment">//触发事件</span>
                     <span class="token function">MyEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token punctuation">}</span>
</code></pre> 
<p>C# 6.0 引入了空条件操作符之后，现在也可以这样做空值检查：</p> 
<pre><code class="prism language-csharp"> MyEvent<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>同时也不是一上来就检查空值，而是先将MyEvent赋给第二个委托变量localDelegate：</p> 
<pre><code class="prism language-csharp"> <span class="token class-name">MyDelegate</span> localDelegate <span class="token operator">=</span> MyEvent<span class="token punctuation">;</span>
 localDelegate<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这个简单的修改可确保在检查空值和发送通知之间，如果一个不同的线程移除了所有MyEvent订阅者，将不会引发NullReferenceException异常。</p> 
<h4><a id="_NET__263"></a>标准 .NET 事件模式</h4> 
<p>以上我们以一个简单的例子介绍了C#中的事件，但是大家可能会觉得有点模式，跟我们平常在winform中使用的事件好像不太一样，那是因为 .NET 框架提供了一个标准模式，接下来我将以winform中的button按钮点击事件为例进行介绍。</p> 
<p>页面很简单，只有一个button按钮：</p> 
<p><img src="https://images2.imgbox.com/f3/6f/b1dUiAZX_o.png" alt="image-20240104093125527"></p> 
<p>然后button按钮点击事件的代码如下：</p> 
<pre><code class="prism language-csharp"> <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">button1_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
 <span class="token punctuation">{<!-- --></span>
     MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> 
<p>现在我们再根据下面这张事件结构图，来看一看标准的 .NET 事件模式：</p> 
<p><img src="https://images2.imgbox.com/3a/55/Ev13x10j_o.png" alt="image-20240103101447689"></p> 
<h5><a id="_284"></a>事件注册</h5> 
<p>打开解决方案中的Form1.Designer.cs文件：</p> 
<p><img src="https://images2.imgbox.com/a6/9d/sVD5maXe_o.png" alt="image-20240104093502598"></p> 
<p>看到button1相关内容：</p> 
<p><img src="https://images2.imgbox.com/7c/7f/frKvlfx8_o.png" alt="image-20240104093620010"></p> 
<pre><code class="prism language-csharp">button1<span class="token punctuation">.</span>Click <span class="token operator">+=</span> button1_Click<span class="token punctuation">;</span>
</code></pre> 
<p>就是在订阅事件，对应上面图中的事件注册。</p> 
<h5><a id="_300"></a>委托类型声明</h5> 
<p>右键查看定义：</p> 
<pre><code class="prism language-csharp"> <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token return-type class-name">EventHandler<span class="token punctuation">?</span></span> Click
 <span class="token punctuation">{<!-- --></span>
     <span class="token keyword">add</span> <span class="token operator">=&gt;</span> Events<span class="token punctuation">.</span><span class="token function">AddHandler</span><span class="token punctuation">(</span>s_clickEvent<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">remove</span> <span class="token operator">=&gt;</span> Events<span class="token punctuation">.</span><span class="token function">RemoveHandler</span><span class="token punctuation">(</span>s_clickEvent<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> 
<p>发现Click事件中的委托类型是EventHandler，再查看EventHandler的定义：</p> 
<pre><code class="prism language-csharp"> <span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">EventHandler</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span><span class="token punctuation">?</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这一步对应上面事件结构图中的委托类型声明。</p> 
<p>EventHandler是 .NET中预定义的委托，专门用来表示不生成数据的事件的事件处理程序方法应有的签名与返回类型。</p> 
<p>第一个参数是sender，用来保存触发事件的对象的引用。由于是<code>object?</code>类型，所以可以匹配任何类型的实例。</p> 
<p>第二个参数是e，用于传递数据。但是<code>EventArgs</code>类表示包含事件数据的类的基类，并提供用于不包含事件数据的事件的值。也就是说<code>EventArgs</code>设计为不能传递任何数据。它用于不需要传递数据的事件处理程序，通常会被忽略。如果我们想要传递数据，必须声明一个派生自<code>EventArgs</code>的类，使用合适的字段来保存需要传递的数据。</p> 
<p>尽管<code>EventArgs</code>类实际上并不传递数据，但它是使用<code>EventHandler</code>委托模式的重要部分。不管参数使用的实际类型是什么，object类和EventArgs类总是基类，这样<code>EventHandler</code>就能提供一个对所有事件和事件处理器都通用的签名，只允许两个参数，而不是各自都有不同签名。</p> 
<h5><a id="_328"></a>事件声明</h5> 
<pre><code class="prism language-csharp"> <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token return-type class-name">EventHandler<span class="token punctuation">?</span></span> Click
 <span class="token punctuation">{<!-- --></span>
     <span class="token keyword">add</span> <span class="token operator">=&gt;</span> Events<span class="token punctuation">.</span><span class="token function">AddHandler</span><span class="token punctuation">(</span>s_clickEvent<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">remove</span> <span class="token operator">=&gt;</span> Events<span class="token punctuation">.</span><span class="token function">RemoveHandler</span><span class="token punctuation">(</span>s_clickEvent<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> 
<p><code>Click</code>事件在<code>Control</code>类中定义，<code>Button</code>类继承自<code>ButtonBase</code>类，而<code>ButtonBase</code>类继承自<code>Control</code>类。</p> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">EventHandler<span class="token punctuation">?</span></span> Click<span class="token punctuation">;</span>
</code></pre> 
<p>对应上面结构图中的事件声明。</p> 
<h5><a id="_346"></a>触发事件的代码</h5> 
<p>查看Button类的定义，找到OnClick方法的定义：</p> 
<pre><code class="prism language-csharp"> <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnClick</span><span class="token punctuation">(</span><span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
 <span class="token punctuation">{<!-- --></span>
     <span class="token class-name">Form<span class="token punctuation">?</span></span> form <span class="token operator">=</span> <span class="token function">FindForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>form <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         form<span class="token punctuation">.</span>DialogResult <span class="token operator">=</span> _dialogResult<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>

     <span class="token comment">// accessibility stuff</span>
     <span class="token function">AccessibilityNotifyClients</span><span class="token punctuation">(</span>AccessibleEvents<span class="token punctuation">.</span>StateChange<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">AccessibilityNotifyClients</span><span class="token punctuation">(</span>AccessibleEvents<span class="token punctuation">.</span>NameChange<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token comment">// UIA events:</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>IsAccessibilityObjectCreated<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         AccessibilityObject<span class="token punctuation">.</span><span class="token function">RaiseAutomationPropertyChangedEvent</span><span class="token punctuation">(</span>UiaCore<span class="token punctuation">.</span>UIA<span class="token punctuation">.</span>NamePropertyId<span class="token punctuation">,</span> Name<span class="token punctuation">,</span> Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
         AccessibilityObject<span class="token punctuation">.</span><span class="token function">RaiseAutomationEvent</span><span class="token punctuation">(</span>UiaCore<span class="token punctuation">.</span>UIA<span class="token punctuation">.</span>AutomationPropertyChangedEventId<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>

     <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnClick</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> 
<p>去掉无关部分，保留相关部分便于理解：</p> 
<pre><code class="prism language-csharp"> <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnClick</span><span class="token punctuation">(</span><span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
 <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnClick</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>    
</code></pre> 
<p>这里的base指的是<code>Button</code>类的基类<code>ButtonBase</code>类：</p> 
<p><img src="https://images2.imgbox.com/32/09/Yi68VLqB_o.png" alt="image-20240104103143021"></p> 
<p>再查看ButtonBase类中OnClick方法的定义:</p> 
<pre><code class="prism language-csharp"> <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnClick</span><span class="token punctuation">(</span><span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
 <span class="token punctuation">{<!-- --></span>
     <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnClick</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">OnRequestCommandExecute</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> 
<p>发现也有一个<code>base.OnClick(e);</code>，这里的base指的是<code>ButtonBase</code>类的基类<code>Control</code>：</p> 
<p><img src="https://images2.imgbox.com/5b/45/LwAjBvAt_o.png" alt="image-20240104103450257"></p> 
<p>再查看Control类中OnClick方法的定义:</p> 
<pre><code class="prism language-csharp"> <span class="token comment">/// &lt;summary&gt;</span>
 <span class="token comment">///  Raises the &lt;see cref="Click"/&gt;</span>
 <span class="token comment">///  event.</span>
 <span class="token comment">/// &lt;/summary&gt;</span>
 <span class="token punctuation">[</span><span class="token function">EditorBrowsable</span><span class="token punctuation">(</span>EditorBrowsableState<span class="token punctuation">.</span>Advanced<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnClick</span><span class="token punctuation">(</span><span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
 <span class="token punctuation">{<!-- --></span>
     <span class="token punctuation">(</span><span class="token punctuation">(</span>EventHandler<span class="token punctuation">?</span><span class="token punctuation">)</span>Events<span class="token punctuation">[</span>s_clickEvent<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> 
<p>终于找到了触发事件的代码。</p> 
<h5><a id="_417"></a>事件处理程序</h5> 
<p>这个想必大家并不陌生，双击button按钮就可以看到：</p> 
<pre><code class="prism language-csharp">  <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">button1_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
      MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> 
<p>这对应上面结构图中的事件处理程序。该事件处理程序方法的签名与返回值类型与EventHandler委托类型一致。</p> 
<h4><a id="_NET_430"></a>使用泛型版本的标准 .NET事件模式</h4> 
<p>接下来我会举一个例子，说明如何使用泛型版本的标准 .NET事件模式。</p> 
<p>第一步，自定义事件数据类，该类继承自<code>EventArgs</code>类：</p> 
<pre><code class="prism language-csharp">  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyEventArgs</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">EventArgs</span></span>
  <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> Message <span class="token punctuation">{<!-- --></span>  <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token keyword">public</span> <span class="token return-type class-name">DateTime<span class="token punctuation">?</span></span> Date <span class="token punctuation">{<!-- --></span>  <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> 
<p>拥有两个属性Message与Date。</p> 
<p>第二步，写发布者类：</p> 
<pre><code class="prism language-csharp">  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Publisher</span>
  <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">EventHandler<span class="token punctuation">&lt;</span>MyEventArgs<span class="token punctuation">&gt;</span><span class="token punctuation">?</span></span> SendMessageEvent<span class="token punctuation">;</span>
      <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SendMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
          <span class="token punctuation">{<!-- --></span>
              Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token class-name">MyEventArgs</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyEventArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              e<span class="token punctuation">.</span>Message <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"第</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">i<span class="token operator">+</span><span class="token number">1</span></span><span class="token punctuation">}</span></span><span class="token string">次触发事件"</span></span><span class="token punctuation">;</span>
              e<span class="token punctuation">.</span>Date <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span>
              <span class="token class-name">EventHandler<span class="token punctuation">&lt;</span>MyEventArgs<span class="token punctuation">&gt;</span><span class="token punctuation">?</span></span> localEventHandler <span class="token operator">=</span> SendMessageEvent<span class="token punctuation">;</span>
              localEventHandler<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">EventHandler<span class="token punctuation">&lt;</span>MyEventArgs<span class="token punctuation">&gt;</span><span class="token punctuation">?</span></span> SendMessageEvent<span class="token punctuation">;</span>
</code></pre> 
<p>声明了事件。</p> 
<pre><code class="prism language-csharp"> <span class="token class-name">EventHandler<span class="token punctuation">&lt;</span>MyEventArgs<span class="token punctuation">&gt;</span><span class="token punctuation">?</span></span> localEventHandler <span class="token operator">=</span> SendMessageEvent<span class="token punctuation">;</span>
 localEventHandler<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>触发了事件。</p> 
<p>第三步，写订阅者类：</p> 
<pre><code class="prism language-csharp"> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Subscriber</span>
 <span class="token punctuation">{<!-- --></span>
     <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">EventHandler</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span><span class="token punctuation">?</span></span> sender<span class="token punctuation">,</span><span class="token class-name">MyEventArgs</span> e<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Received Message:</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">e<span class="token punctuation">.</span>Message</span><span class="token punctuation">}</span></span><span class="token string"> at </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">e<span class="token punctuation">.</span>Date</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre> 
<p>包含事件处理程序，该方法与<code>EventHandler&lt;MyEventArgs&gt;</code>委托类型的签名与返回值类型一致。</p> 
<p>第四步，写主函数：</p> 
<pre><code class="prism language-csharp">  <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
     <span class="token class-name">Publisher</span> publisher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Publisher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">Subscriber</span> subscriber <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Subscriber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     publisher<span class="token punctuation">.</span>SendMessageEvent <span class="token operator">+=</span> subscriber<span class="token punctuation">.</span>EventHandler<span class="token punctuation">;</span>
     publisher<span class="token punctuation">.</span><span class="token function">SendMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-csharp"> publisher<span class="token punctuation">.</span>SendMessageEvent <span class="token operator">+=</span> subscriber<span class="token punctuation">.</span>EventHandler<span class="token punctuation">;</span>
</code></pre> 
<p>订阅事件。</p> 
<p>运行结果如下所示：</p> 
<p><img src="https://images2.imgbox.com/b5/8d/jsCuMyNJ_o.png" alt="image-20240104115222746"></p> 
<p>包含了我们自定义的事件数据。</p> 
<h4><a id="_518"></a>补充</h4> 
<p>上面说自定义的事件数据类要继承自<code>EventArgs</code>类，但其实在 .NET Core 的模式较为宽松。 在此版本中，<code>EventHandler&lt;TEventArgs&gt;</code> 定义不再要求 <code>TEventArgs</code> 必须是派生自 <code>System.EventArgs</code> 的类。</p> 
<p>因此我在.NET 8 版本的示例中去掉继承自<code>EventArgs</code>类，该示例依旧能正常运行。</p> 
<p>异步事件订阅者</p> 
<p>一个关于异步事件订阅者的例子如下：</p> 
<pre><code class="prism language-csharp"><span class="token comment">// 事件发布者</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EventPublisher</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 定义异步事件</span>
    <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> Task<span class="token punctuation">&gt;</span><span class="token punctuation">?</span></span> MyEvent<span class="token punctuation">;</span>

    <span class="token comment">// 触发事件的方法</span>
    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">RaiseEventAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> Task<span class="token punctuation">&gt;</span></span> localEvent <span class="token operator">=</span> MyEvent<span class="token punctuation">;</span>
        <span class="token keyword">await</span> localEvent<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 异步事件订阅者</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AsyncEventSubscriber</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 处理事件的异步方法</span>
    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">HandleEventAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Received event with message: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">message</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 异步操作，例如IO操作、网络请求等</span>
        <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Event handling complete."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 创建事件发布者</span>
        <span class="token class-name"><span class="token keyword">var</span></span> publisher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">EventPublisher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 创建异步事件订阅者</span>
        <span class="token class-name"><span class="token keyword">var</span></span> subscriber <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AsyncEventSubscriber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 订阅事件</span>
        publisher<span class="token punctuation">.</span>MyEvent <span class="token operator">+=</span> subscriber<span class="token punctuation">.</span>HandleEventAsync<span class="token punctuation">;</span>

        <span class="token comment">// 触发事件</span>
        <span class="token keyword">await</span> publisher<span class="token punctuation">.</span><span class="token function">RaiseEventAsync</span><span class="token punctuation">(</span><span class="token string">"Hello, world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行结果如下所示：</p> 
<p><img src="https://images2.imgbox.com/80/b2/7gP6Rug7_o.png" alt="image-20240104123351663"></p> 
<h3><a id="_583"></a>总结</h3> 
<p>本文先是介绍了一些C#中事件的相关概念，然后通过几个例子介绍了在C#中如何使用事件。</p> 
<h3><a id="_587"></a>参考</h3> 
<p>1、《C#图解教程》</p> 
<p>2、《C# 7.0 本质论》</p> 
<p>3、[C# 文档 - 入门、教程、参考。 | Microsoft Learn](</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/57701ec911603714cf978850c58dc048/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">在 Linux 中开启 Flask 项目持续运行</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9f187ef67145b6cdcabba9ae02e9e44a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C#设计模式之观察者模式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>