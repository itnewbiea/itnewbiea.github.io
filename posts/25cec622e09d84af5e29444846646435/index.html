<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>利用ShadowRoot 实现样式隔离 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="利用ShadowRoot 实现样式隔离" />
<meta property="og:description" content="ShadowRoot Shadow DOM API 的 ShadowRoot 接口是一个 DOM 子树的根节点，它与文档的主 DOM 树分开渲染。
ShadowRoot 的模式——可以是 open 或者 closed。这定义了 shadow root 的内部实现是否可被 JavaScript 访问及修改 — 也就是说
ShadowRoot的特性 图片来源：掘金（https://juejin.cn/post/6979489951108825095）
自定义的样式和布局：Shadow DOM可以创建一个私有的样式和布局环境，使得组件可以在自己的环境中独立地定义样式和布局，而不会影响到其他组件或页面的样式和布局。
隔离的DOM结构：Shadow DOM可以创建一个私有的DOM结构，使得组件可以在自己的环境中独立地定义DOM结构，而不会影响到其他组件或页面的DOM结构。
嵌套使用：Shadow DOM可以嵌套使用，一个Shadow DOM可以包含另一个Shadow DOM，从而实现更复杂的组件结构。
ShadoRoot 样式/组件隔离 由于Shadow Dom 是一个独立的节点，所以我们可以利用 Shadow Dom 实现样式隔和组件隔离。
ShadowRoot 内事件机制和正常的dom结构一致。但是不管是冒泡还是捕获事件，一旦达到边界ShadowHost的时候event.target就Shadow Host
利用ShadowRoot的特性对插件开发进行优化 (shadowroot使用场景) 在chrome插件开发过程之中，如果你使用了像tailwindcss之类的样式库，不难避免遇到样式冲突的问题。
在开发过程中，我们可以利用ShadowRoot的特性，将样式隔离到ShadowRoot中，从而避免样式冲突。
引入样式文件 import style from &#39;@/styles/main.css&#39; import popupStyle from &#39;@/styles/popup.scss&#39; 这里首先导入了组件依赖的样式文件： main.css和popup.scss。main.css为tailwindcss的样式，popup.scss为自定义的组件样式。
在Popup.vue中不必引入样式文件（因为打包之后样式文件是作用于全局的，无法在shadow root中使用）。
注入样式文件 mountEl 为创建的挂载节点
mountEl.attachShadow({ mode: &#39;open&#39; }): 给mountEl下面挂载了一个新创建的shadowRoot节点。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/25cec622e09d84af5e29444846646435/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-21T17:58:30+08:00" />
<meta property="article:modified_time" content="2023-11-21T17:58:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">利用ShadowRoot 实现样式隔离</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="ShadowRoot_1"></a>ShadowRoot</h3> 
<p>Shadow DOM API 的 ShadowRoot 接口是一个 DOM 子树的根节点，它与文档的主 DOM 树分开渲染。</p> 
<p>ShadowRoot 的模式——可以是 open 或者 closed。这定义了 shadow root 的内部实现是否可被 JavaScript 访问及修改 — 也就是说</p> 
<h4><a id="ShadowRoot_7"></a>ShadowRoot的特性</h4> 
<p><img src="https://images2.imgbox.com/76/96/NKc8NzLX_o.png" alt="https://juejin.cn/post/6979489951108825095"><br> 图片来源：掘金（https://juejin.cn/post/6979489951108825095）</p> 
<ol><li> <p>自定义的样式和布局：Shadow DOM可以创建一个私有的样式和布局环境，使得组件可以在自己的环境中独立地定义样式和布局，而不会影响到其他组件或页面的样式和布局。</p> </li><li> <p>隔离的DOM结构：Shadow DOM可以创建一个私有的DOM结构，使得组件可以在自己的环境中独立地定义DOM结构，而不会影响到其他组件或页面的DOM结构。</p> </li><li> <p>嵌套使用：Shadow DOM可以嵌套使用，一个Shadow DOM可以包含另一个Shadow DOM，从而实现更复杂的组件结构。</p> </li></ol> 
<h4><a id="ShadoRoot__17"></a>ShadoRoot 样式/组件隔离</h4> 
<p>由于Shadow Dom 是一个独立的节点，所以我们可以利用 Shadow Dom 实现样式隔和组件隔离。</p> 
<p>ShadowRoot 内事件机制和正常的dom结构一致。但是不管是冒泡还是捕获事件，一旦达到边界<code>ShadowHost</code>的时候<code>event.target</code>就<code>Shadow Host</code></p> 
<h3><a id="ShadowRoot_shadowroot_23"></a>利用ShadowRoot的特性对插件开发进行优化 (shadowroot使用场景)</h3> 
<p>在<code>chrome</code>插件开发过程之中，如果你使用了像tailwindcss之类的样式库，不难避免遇到样式冲突的问题。<br> 在开发过程中，我们可以利用ShadowRoot的特性，将样式隔离到ShadowRoot中，从而避免样式冲突。</p> 
<h4><a id="_28"></a>引入样式文件</h4> 
<pre><code class="prism language-js">
<span class="token keyword">import</span> style <span class="token keyword">from</span> <span class="token string">'@/styles/main.css'</span>

<span class="token keyword">import</span> popupStyle <span class="token keyword">from</span> <span class="token string">'@/styles/popup.scss'</span>

</code></pre> 
<p>这里首先导入了组件依赖的样式文件： <code>main.css</code>和<code>popup.scss</code>。<code>main.css</code>为tailwindcss的样式，<code>popup.scss</code>为自定义的组件样式。</p> 
<p>在<code>Popup.vue</code>中<strong>不必引入样式文件</strong>（因为打包之后样式文件是作用于全局的，无法在shadow root中使用）。</p> 
<h4><a id="_41"></a>注入样式文件</h4> 
<p><code>mountEl</code> 为创建的挂载节点</p> 
<p><code>mountEl.attachShadow({ mode: 'open' })</code>: 给<code>mountEl</code>下面挂载了一个新创建的<code>shadowRoot</code>节点。</p> 
<p><code> vm = createApp(Popup).mount(shadowEl);</code> 将<code>Popup</code>组件挂载到<code>shadowEl</code>中。</p> 
<p><code>mountEl.shadowRoot.appendChild(document.createElement('style'))</code>: 给<code>shadowRoot</code>中添加了一个<code>style</code></p> 
<p><code>shadowEl.querySelector('style').innerHTML = (style + popupStyle)</code>: 将<code>main.css</code>和<code>popup.scss</code>注入到<code>shadowRoot</code>中。</p> 
<p>这样样式就隔离到<code>shadowRoot</code>中了,不会影响到ShadowRoot之外的结构。</p> 
<p>完整<code>code</code></p> 
<pre><code class="prism language-js">
<span class="token keyword">import</span> style <span class="token keyword">from</span> <span class="token string">'@/styles/main.css'</span>

<span class="token keyword">import</span> popupStyle <span class="token keyword">from</span> <span class="token string">'@/styles/popup.scss'</span>

<span class="token keyword">import</span> Popup <span class="token keyword">from</span> <span class="token string">'@/Popup.vue'</span>

<span class="token keyword">const</span> <span class="token constant">MOUNT_EL_ID</span> <span class="token operator">=</span> <span class="token string">"oimi-auto-flow"</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> mountEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token constant">MOUNT_EL_ID</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>mountEl<span class="token punctuation">)</span> mountEl<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>

mountEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

mountEl<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token constant">MOUNT_EL_ID</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>mountEl<span class="token punctuation">)</span>

<span class="token comment">// create shadow root to isolation style</span>

<span class="token keyword">const</span> shadowEl <span class="token operator">=</span> mountEl<span class="token punctuation">.</span><span class="token function">attachShadow</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'open'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// mounted Popup vue component to shadow root</span>

vm <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>Popup<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span>shadowEl<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// add style to shadow root</span>

mountEl<span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// add popup style and tailwind style to shadow root</span>

shadowEl<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token punctuation">(</span>style <span class="token operator">+</span> popupStyle<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a6a21a25d7434ff085da94281e63c836/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">PyTorch多GPU训练时同步梯度是mean还是sum?</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/02b957bfc5f30c4fb9b5d5036d611a14/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【Ubuntu】Ubuntu arm64 部署 Blazor Server 应用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>