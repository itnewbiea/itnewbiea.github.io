<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>基于Node.js-http模块的Express框架 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="基于Node.js-http模块的Express框架" />
<meta property="og:description" content="初识Express Express简介 官方给出的概念: Express 是基于 Node.js 平台，快速、开放、极简的 Web 开发框架
通俗的理解: Express 的作用和 Node.js 内置的 http 模块类似，是专门用来创建 Web 服务器的
Express的本质:就是一个npm 上的第三方包，提供了快速创建Web 服务器的便捷方法
Express 的中文官网
Express 能做什么 对于前端程序员来说，最常见的两种服务器，分别是:
Web 网站服务器:专门对外提供 Web 网页资源的服务器API 接口服务器:专门对外提供API 接口的服务器 使用Express，我们可以方便、快速的创建 Web 网站的服务器或API 接口的服务器
Express 基本使用 Express 安装 初始化根目录 npm init -y安装express npm i express@4.17.1 创建基本的服务器 app.listen(端口号, 启动成功后的回调), 启动服务器
// 导入express const express = require(&#39;express&#39;) // 创建web服务器 const app = express() // 调用app.listen(端口号, 启动成功后的回调), 启动服务器 app.listen(8099, function () { console." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/a24ffe741c3dadbab3133f21c43245f6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-19T19:19:53+08:00" />
<meta property="article:modified_time" content="2022-12-19T19:19:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">基于Node.js-http模块的Express框架</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Express_2"></a>初识Express</h2> 
<h3><a id="Express_3"></a>Express简介</h3> 
<p>官方给出的概念: Express 是基于 Node.js 平台，快速、开放、极简的 Web 开发框架</p> 
<p>通俗的理解: Express 的作用和 Node.js 内置的 http 模块类似，是专门用来创建 Web 服务器的</p> 
<p>Express的本质:就是一个npm 上的第三方包，提供了快速创建Web 服务器的便捷方法</p> 
<p><a href="http://www.expressjs.com.cn/" rel="nofollow">Express 的中文官网</a></p> 
<h3><a id="Express__12"></a>Express 能做什么</h3> 
<p>对于前端程序员来说，最常见的两种服务器，分别是:</p> 
<ul><li>Web 网站服务器:专门对外提供 Web 网页资源的服务器</li><li>API 接口服务器:专门对外提供API 接口的服务器</li></ul> 
<p>使用Express，我们可以方便、快速的创建 Web 网站的服务器或API 接口的服务器</p> 
<h3><a id="Express__19"></a>Express 基本使用</h3> 
<h4><a id="Express__20"></a>Express 安装</h4> 
<ol><li>初始化根目录 <code>npm init -y</code></li><li>安装express <code>npm i express@4.17.1</code></li></ol> 
<h4><a id="_23"></a>创建基本的服务器</h4> 
<p><code>app.listen(端口号, 启动成功后的回调)</code>, 启动服务器</p> 
<pre><code class="prism language-javascript"><span class="token comment">// 导入express</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>

<span class="token comment">// 创建web服务器</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 调用app.listen(端口号, 启动成功后的回调), 启动服务器</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8099</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'express server running at http://127.0.0.1:8099'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_get__38"></a>监听 <code>get</code> 请求</h4> 
<ol><li>参数1: 客户端请的 <code>URL</code> 地址</li><li>参数2: 请求对应的处理函数 
  <ul><li><code>req</code>: 请求对象(包含了与请求相关的属性与方法)</li><li><code>resp</code>: 响应对象(包含了与响应相关的属性与方法)</li></ul> </li></ol> 
<pre><code class="prism language-javascript">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'请求URL'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">/*处理函数*/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_post__get__48"></a>监听 <code>post</code> 请求(和 <code>get</code> 请求类似)</h4> 
<h4><a id="_50"></a>把内容响应给客户端</h4> 
<p>通过 <code>resp.send()</code> 方法，法处理好的内容发送给客户端：</p> 
<pre><code class="prism language-javascript">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    
    <span class="token comment">//向客户端发送json对象</span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'xxx'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">19</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    
    <span class="token comment">//向客户端发送文本内容</span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'请求成功！'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_url__66"></a>获取 <code>url</code> 中携带的请求参数</h4> 
<p>通过 <code>req.query</code> 对象，可以访问到客户端通过查询字符串的形式，发送到服务器的参数：</p> 
<p><code>req.query</code> 默认是一个空对象</p> 
<p>客户端使用 <code>?name=zs&amp;age=20</code> 这种查询字符串形式，发送到服务器的参数</p> 
<p>可以通过 <code>req.query</code> 对象访问到，例如:</p> 
<p><code>req.query.name</code>, <code>req.query.age</code></p> 
<pre><code class="prism language-javascript">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">)</span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'请求成功'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_url__84"></a>获取 <code>url</code> 中的动态参数</h4> 
<p>通过 <code>req.params</code> 对象，可以访问到url中通过 :匹配到的动态参数：</p> 
<p>req.params 默认为一个空对象，里面存放着通过:动态匹配到的参数值</p> 
<pre><code class="prism language-javascript"><span class="token comment">// URL 地址中，可以通过:参数名 的形式，匹配动态参数值</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user/:id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">)</span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'请求成功'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_95"></a>托管静态资源</h3> 
<p>express 提供了一个非常好用的函数，叫做 <code>express.static(资源路径)</code></p> 
<p>通过它，我们可以非常方便地创建一个静态资源服务器</p> 
<p>例如，通过如下代码就可以将 public 目录下的图片、CSS 文件、JavaScript 文件对外开放访问了</p> 
<pre><code class="prism language-javascript"><span class="token comment">//调用express.static()方法，快速对外提供静态资源</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'../../public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>注意：</strong><br> Express在指定的静态目录中查找文件，并对外提供资源的访问路径</p> 
<p>因此，存放静态文件的目录名不会出现在 URL 中。</p> 
<p>托管多个静态资源文件夹，就调用多个<code>express.static(资源路径)</code><br> 查找资源时，会根据文件夹的调用顺序，顺序查找</p> 
<h4><a id="_115"></a>挂载路径前缀</h4> 
<p>如果希望在托管的静态资源访问路径之前，挂载路径前缀，则可以使用如下的方式:</p> 
<pre><code class="prism language-javascript">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/public'</span><span class="token punctuation">,</span> express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'../../public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>现在，你就可以通过带有 /public 前缀地址来访问 public 目录中的文件了</p> 
<h4><a id="_nodemon_122"></a>安装 <code>nodemon</code></h4> 
<p>在编写调试 Node.s 项目的时候，如果修改了项目的代码，则需要频繁的手动 close 掉</p> 
<p>然后再重新启动，非常繁琐现在，我们可以使用 nodemon (https://www.npmis.com/package/nodemon) 这个具</p> 
<p>它能够监听项目文件的变动，当代码被修改后，nodemon 会自动帮我们重启项目，极大方便了开发和调试</p> 
<p>安装：</p> 
<pre><code>npm i nodemon -g
</code></pre> 
<p>使用：</p> 
<pre><code>//之前：node app.js
//现在：
nodemon app.js
</code></pre> 
<h3><a id="Express__140"></a>Express 路由</h3> 
<h4><a id="_141"></a>路由的简单介绍和安装</h4> 
<p>一个路由分为三部分：请求方式、请求路径、请求的回调函数<br> <code>app.method('路径', function() {......})</code><br> 简单举例：</p> 
<pre><code class="prism language-javascript">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    
    <span class="token comment">//向客户端发送json对象</span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'xxx'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">19</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    
    <span class="token comment">//向客户端发送文本内容</span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'登录请求成功！'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_159"></a>路由的匹配过程</h4> 
<p>每当一个请求到达服务器之后，需要先经过路由的匹配，只有匹配成功之后，才会调用对应的处理函数。</p> 
<p>在匹配时，会按照路由的顺序进行匹配，如果请求类型和请求的 <code>URL</code> 同时匹配成功，则 <code>Express</code> 会将这次请求，转交给对应的function函数进行处理</p> 
<p>路由匹配的注意点:</p> 
<ol><li>按照定义的先后顺序进行匹配</li><li>请求类型和请求的 <code>URL</code> 同时匹配成功，才会调用对应的处理函数</li></ol> 
<h4><a id="_168"></a>路由的使用</h4> 
<h5><a id="_169"></a>创建路由模块</h5> 
<pre><code class="prism language-javascript"><span class="token comment">//这是路由模块</span>
<span class="token keyword">let</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>  <span class="token comment">//导入express</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//创建路由对象</span>

user<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

user<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">'jsl'</span><span class="token punctuation">,</span> <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">'123'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> user

</code></pre> 
<h5><a id="_187"></a>注册路由模块</h5> 
<p><code>app.use()</code> 函数的作用，就是用来注册全局中间件</p> 
<pre><code class="prism language-javascript"><span class="token comment">//导入express</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token comment">//创建APP对象</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//导入user路由模块</span>
<span class="token keyword">const</span> userRouter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./router/user'</span><span class="token punctuation">)</span>
<span class="token comment">//app.use()函数的作用，就是用来注册全局中间件</span>
<span class="token comment">//使用user路由模块</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>userRouter<span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8099</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'express server running at http://127.0.0.1:8099'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> 
<h5><a id="_206"></a>为路由模块添加前缀</h5> 
<p>类似于托管静态资源时，为静态资源统一挂载访问前缀一样，路由模块添加前缀的方式也非常简单</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> userRouter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./router/user'</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> userRouter<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="Express__213"></a>Express 中间件</h3> 
<h4><a id="_214"></a>中间件的概念</h4> 
<h5><a id="_215"></a>中间件的调用流程</h5> 
<p>当一个请求到达Express的服务器之后，可以连续调用多个中间件，从而对这次请求进行预处理<br> <img src="https://images2.imgbox.com/18/04/ECZThW01_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="Express__220"></a>Express 中间件的格式</h5> 
<p>Express 的中间件，本质上就是一个 function 处理函数，Express 中间件的格式如下<br> <img src="https://images2.imgbox.com/41/5b/YxcazQXE_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-zWTTfcwU-1670731370283)(img_1.png)]"></p> 
<p>注意:中间件函数的形参列表中，必须包含 next 参数。而路由处理函数中只包含 req 和res</p> 
<h4><a id="_227"></a>中间件初体验</h4> 
<h5><a id="_228"></a>定义一个中间件函数</h5> 
<p>可以通过如下的方式，定义一个最简单的中间件函数</p> 
<pre><code class="prism language-javascript"><span class="token comment">//常量mw所指向的，就是一个中间件</span>
<span class="token keyword">const</span> <span class="token function-variable function">mw</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'这是最简单的一个中间件'</span><span class="token punctuation">)</span>
    <span class="token comment">//注意：中间件业务逻辑处理完毕后，必须调用next()函数</span>
    <span class="token comment">//表示把流转关系转交给下一个中间件或路由</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_239"></a>全局生效的中间件</h5> 
<p>客户端发起的任何请求，到达服务器之后，都会触发的中间件，叫做全局生效的中间件</p> 
<p>通过调用 <code>app.use(中间件函数)</code>，即可定义一个全局生效的中间件，示例代码如下:</p> 
<pre><code class="prism language-javascript"><span class="token comment">//常量mw所指向的，就是一个中间件</span>
<span class="token keyword">const</span> <span class="token function-variable function">mw</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'这是最简单的一个中间件'</span><span class="token punctuation">)</span>
    <span class="token comment">//注意：中间件业务逻辑处理完毕后，必须调用next()函数</span>
    <span class="token comment">//表示把流转关系转交给下一个中间件或路由</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 将 mw 注册为全局生效的中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>mw<span class="token punctuation">)</span>

<span class="token string">'......'</span>
</code></pre> 
<h5><a id="_258"></a>中间件的作用</h5> 
<p>多个中间件之间，共享同一份 req 和 res。基于这样的特性，我们可以在上游的中间件中，统一为 reg 或 res 对象添加自定义的属性或方法，供下游的中间件或路由进行使用。<br> <img src="https://images2.imgbox.com/c2/fd/sdO515xM_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-zbGpEq0B-1670731370284)(img_2.png)]"></p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> moment <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'moment'</span><span class="token punctuation">)</span>
<span class="token comment">//创建APP对象</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token comment">//简化的中间件函数</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//获取到请求到达服务器的时间</span>
    <span class="token keyword">const</span> time <span class="token operator">=</span> <span class="token function">moment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'YYYY-MM-DD HH:mm:ss'</span><span class="token punctuation">)</span>
    <span class="token comment">//为req对象，挂载一个自定义属性，把时间共享给后面的所有路由</span>
    req<span class="token punctuation">.</span>startTime <span class="token operator">=</span> time
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'简化的一个中间件函数'</span><span class="token punctuation">)</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>startTime<span class="token punctuation">)</span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'请求成功'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>startTime<span class="token punctuation">)</span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">'jsl'</span><span class="token punctuation">,</span> <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">'123'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8099</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'express server running at http://127.0.0.1:8099'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> 
<h5><a id="_298"></a>局部中间件</h5> 
<p>不使用 app.use() 定义的中间件，叫做局部生效的中间件，示例代码如下:</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">mw</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'局部中间件'</span><span class="token punctuation">)</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> mw<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'请求成功'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/01'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'请求成功01'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8099</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'express server running at http://127.0.0.1:8099'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> 
<h5><a id="_323"></a>定义多个局部中间件</h5> 
<p>可以在路由中，通过如下两种等价的方式，使用多个局部中间件:</p> 
<pre><code class="prism language-javascript"><span class="token comment">//写法1</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> mw1<span class="token punctuation">,</span> mw2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'请求成功'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//写法2</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>mw1<span class="token punctuation">,</span> mw2<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'请求成功'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="5_335"></a>了解中间件的5个使用注意事项</h5> 
<ol><li>一定要在路由之前注册中间件</li><li>客户端发送过来的请求，可以连续调用多个中间件进行处理</li><li>执行完中间件的业务代码之后，不要忘记调用 <code>next()</code> 函数</li><li>为了防止代码逻辑混乱，调用 <code>next()</code> 函数后不要再写额外的代码</li><li>连续调用多个中间件时，多个中间件之间，共享 <code>req</code> 和 <code>res</code> 对象</li></ol> 
<h4><a id="_342"></a>中间件的分类</h4> 
<p>为了方便大家理解和记忆中间件的使用，Express 官方把常见的中间件用法，分成了 5 大类，分别是:</p> 
<ol><li>应用级别的中间件</li><li>路由级别的中间件</li><li>错误级别的中间件</li><li>Express 内置的中间件</li><li>第三方的中间件</li></ol> 
<h5><a id="_351"></a>应用级别的中间件</h5> 
<p>通过 app.use() 或 app.get() 或 app.post() ，绑定到 app 实例上的中间件，叫做应用级别的中间件，代码示例如下:</p> 
<pre><code class="prism language-javascript"><span class="token comment">// 应用级别的中间件(全局中间件)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 应用级别的中间件(局部中间件)</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> mw1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Home page'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="_363"></a>路由级别的中间件</h5> 
<p>绑定到 <code>express.Router()</code> 实例上的中间件，叫做路由级别的中间件。它的用法和应用级别中间件没有任何区别。<br> 只不过，应用级别中间件是绑定到 <code>app</code> 实例上，路由级别中间件绑定到 <code>router</code> 实例上，代码示例如下:</p> 
<pre><code class="prism language-javascript"><span class="token comment">//这是路由模块</span>
<span class="token keyword">let</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>  <span class="token comment">//导入express</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//创建路由对象</span>

user<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>startTime<span class="token punctuation">)</span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'请求成功'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

user<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>startTime<span class="token punctuation">)</span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">'jsl'</span><span class="token punctuation">,</span> <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">'123'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//对外暴露</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> user


</code></pre> 
<h5><a id="_389"></a>错误级别的中间件</h5> 
<p>错误级别中间件的作用:专门用来捕获整个项目中发生的异常错误，从而防止项目异常崩溃的问题</p> 
<p>格式:错误级别中间件的 function 处理函数中，必须有 4 个形参，形参顺序从前到后，分别是(err, req, res, next).</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//路由</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'服务器内发生了错误'</span><span class="token punctuation">)</span><span class="token comment">//抛出一个自定义的错误</span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'home page'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> resp<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//错误级别的中间件</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token comment">//向客户端响应错误内容</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8099</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'express server running at http://127.0.0.1:8099'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> 
<p>注意:错误级别的中间件必须注册在所有路由之后!</p> 
<h5><a id="Express_416"></a>Express内置的中间件</h5> 
<p>自<code>Express 4.16.0</code> 版本开始，<code>Express</code> 内置了3 个常用的中间件，极大地提高了 <code>Express</code> 项目的开发效率和体验:</p> 
<ol><li><code>express.static</code> 快速托管静态资源的内置中间件，例如: <code>HTML</code> 文件、图片、<code>CSS</code> 样式等(无兼容性)</li><li><code>express.json</code> 解析 <code>JSON</code> 格式的请求体数据 (有兼容性，仅在 <code>4.16.0+</code> 版本中可用)</li><li><code>express.urlencoded</code> 解析 <code>URL-encoded</code> 格式的请求体数据(有兼容性，仅在 <code>4.16.0+</code> 版本中可用)</li></ol> 
<pre><code class="prism language-javascript"><span class="token comment">// 配置解析 application/json 格式数据的内置中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 配置解析 application/x-ww-form-urlencoded 格式数据的内置中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="_430"></a>第三方的中间件</h5> 
<p>非 <code>Express</code> 官方内置的，而是由第三方开发出来的中间件，叫做第三方中间件。<br> 在项目中，大家可以按需下载并配置第三方中间件，从而提高项目的开发效率</p> 
<p>例如:在 <code>express@4.16.0</code> 之前的版本中，经常使用 <code>body-parser</code> 这个第三方中间件，来解析请求体数据。使用步骤如下:</p> 
<ol><li>运行 <code>npm install body-parser</code> 安装中间件</li><li>使用 <code>require</code> 导入中间件</li><li>用 <code>app.use()</code> 注册并使用中间件</li></ol> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// app.use(express.urlencoded({ extended: false }))</span>
<span class="token keyword">const</span> body_parser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>body_parser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//如果没有配置任何解析表单数据的中间件，则 req.body 默认为 undefined</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8099</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'express server running at http://127.0.0.1:8099'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> 
<p>Express内置的 <code>express.urlencoded</code> 中间件，就是基于 <code>body-parser</code> 这个第三方中间件进一步封装出来的。</p> 
<h3><a id="_Express__461"></a>使用 Express 写接口</h3> 
<h4><a id="get_462"></a>编写get接口</h4> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/get'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1.获取到客户端通过查询字符串，发送到服务器的数据</span>
    <span class="token keyword">const</span> query <span class="token operator">=</span> req<span class="token punctuation">.</span>query
    <span class="token comment">// 2.调用 res.send() 方法，把数据响应给客户端</span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token comment">// 状态，0 表示成功，1 表示失败</span>
        <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'get请求成功'</span><span class="token punctuation">,</span>  <span class="token comment">// 状态描述</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> query  <span class="token comment">// 需要响应给客户端的具体数据</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router


<span class="token comment">/*----------*/</span>

<span class="token comment">// 导入 express</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token comment">// 创建服务器实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> apiRouter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./apiRouter'</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span> apiRouter<span class="token punctuation">)</span>

<span class="token comment">// 启动服务器</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8099</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'express server running at http://127.0.0.1:8099'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> 
<h4><a id="post_499"></a>编写post接口</h4> 
<pre><code class="prism language-javascript">router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/post'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1.获取客户端通过请求体，发送到服务器的 URL-encoded 数据</span>
    <span class="token keyword">const</span> body <span class="token operator">=</span> req<span class="token punctuation">.</span>body
    <span class="token comment">// 2.调用 res.send() 方法，把数据响应给客户端</span>
    resp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token comment">// 状态，0 表示成功，1 表示失败</span>
        <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'post请求成功'</span><span class="token punctuation">,</span>  <span class="token comment">// 状态描述</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> body  <span class="token comment">// 需要响应给客户端的具体数据</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">/*----------*/</span>

<span class="token comment">// 导入 express</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token comment">// 创建服务器实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 配置解析表单数据的中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> apiRouter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./apiRouter'</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span> apiRouter<span class="token punctuation">)</span>

<span class="token comment">// 启动服务器</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8099</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'express server running at http://127.0.0.1:8099'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> 
<h4><a id="CORS__532"></a><code>CORS</code> 跨域资源共享</h4> 
<p>接口的跨域问题:</p> 
<p>上面编写的<code>GET</code>和<code>POST</code>接口，存在一个很严重的问题: 不支持跨域请求</p> 
<p>解决接口跨域问题的方案主要有两种:</p> 
<ol><li><code>CORS</code> (主流的解决方案，推荐使用)</li><li><code>JSONP</code>(有缺陷的解决方案:只支持 GET 请求)</li></ol> 
<h5><a id="_CORS_541"></a>什么是 <code>CORS</code></h5> 
<p>CORS (<code>Cross-Origin Resource Sharing</code>, 跨域资源共享)由一系列 <code>HTTP</code> 响应头组成，这些 <code>HTTP</code> 响应头决定浏览器是否阻止前端 <code>JS</code> 代码跨域获取资源</p> 
<p>浏览器的同源安全策略默认会阻止网页"跨域"获取源。但如果接口服务器配置了 <code>CORS</code> 相关的 <code>HTTP</code> 响应头就可以解除浏览器端的跨域访问限制<br> <img src="https://images2.imgbox.com/07/f8/vuZFXC9C_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_cors__547"></a>使用 <code>cors</code> 中间件解决跨域问题</h5> 
<p><code>cors</code> 是 <code>Express</code> 的一个第三方中间件。通过安装和配置<code>cors</code> 中间件，可以很方便地解决跨域问题使用步骤分为如下3步:</p> 
<ol><li>运行 <code>npm install cors</code> 安装中间件</li><li>使用 <code>const cors = require(cors)</code> 导入中间件</li><li>在路由之前调用 <code>app.use(cors())</code> 配置中间件</li></ol> 
<h5><a id="cors__553"></a>cors 跨域简单请求</h5> 
<p>同时满足以下两大条件的请求，就属于简单请求：</p> 
<ol><li>请求方式: <code>GET</code> 、 <code>POST</code> 、 <code>HEAD</code> 三者之一</li><li><code>HTTP</code> 头部信息不超过以下几种字段: 无自定义头部字段、<code>Accept、Accept-Language、 Content-Language、DPR、Downlink、Save-Data Viewport-Width、 Width</code>、<code>Content-Type</code> (只有三个值：<code>application/x-www-form-urlencoded、multipart/form-data、 text/plain</code>)</li></ol> 
<h5><a id="cors__558"></a>cors 跨域预检请求</h5> 
<p>只要符合以下任何一个条件的请求，都需要进行预检请求:</p> 
<ol><li>请求方式为 <code>GET、POST、HEAD</code> 之外的请求 <code>Method</code> 类型</li><li>请求头中包含自定义头部字段</li><li>向服务器发送了 <code>application/json</code> 格式的数据</li></ol> 
<p>在浏览器与服务器正式通信之前，浏览器会先发送 <code>OPTION</code> 请求进行预检，以获知服务器是否允许该实际请求，所以这一次的 <code>OPTION</code> 请求称为" 预检请求 "服务器成功响应预检请求后，才会发送真正请求，并且携带真实数据</p> 
<h5><a id="_566"></a>简单请求和预检请求的区别</h5> 
<ul><li>简单请求的特点: 客户端与服务器之间只会发生一次请求</li><li>预检请求的特点: 客户端与服务器之间会发生两次请求，OPTION 预检请求成功之后，才会发起真正的请求</li></ul> 
<h5><a id="JSONP__571"></a>JSONP 的概念与特点</h5> 
<p>概念:浏览器端通过</p> 
<ol><li>JSONP不属于真正的Ajax 请求，因为它没有使用XMLHttpRequest 这个对象</li><li>JSONP 仅支持 GET 请求，不支持 POST、PUT、DELETE 等请求</li></ol>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/66758ee8ac15d4f3c474f078c3b688f3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">mac 微信备份到外接硬盘方案（软链接）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ab2673e310fb15b39bf9e5b84778f81e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">InstructPix2Pix: 随口修图</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>