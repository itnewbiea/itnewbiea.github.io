<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>动态时间规整算法: 从DTW到FastDTW - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="动态时间规整算法: 从DTW到FastDTW" />
<meta property="og:description" content="目录 动态时间规整算法: 从DTW到FastDTW总结：简介[^1]DTW[^1]FastDTW：使用多级粗化的方法[^1]结果 动态时间规整算法: 从DTW到FastDTW 总结： FastDTW作者对DTW的改进点很巧妙！先通过举例说明在一些情况下目前现有的方法对DTW改进的缺陷，然后阐述自己的算法如何避免这些缺陷，最后还在三个数据集上证明在较长时间序列数据中取得线性复杂度。 说明在做算法时，在无法找到更低复杂度的方法的时候，可以考虑在牺牲一些可接受的准确度的情况下实现更低的复杂度算法！！！同时，必须通过实验证明准确度降低的程度，文中就使用正常复杂度算法和近似复杂度算法进行对比，从而计算出降低的准确率！！最后，可以吸取现有的一些改进的基础上，再进一步改进，就比在原始的DWT算法上改进的效果更好！！！！ 简介1 Dynamic time warping：动态时间扭曲 (DTW) 是一种在两个时间序列之间找到最佳对齐的技术，其中一个时间序列可以通过拉伸或收缩其时间轴来非线性地“扭曲”。 这种比对可用于找到对应的区域或确定两个时间序列之间的相似性。 DTW 经常用于语音识别，以确定两个波形是否代表相同的口语短语。 在语音波形中，每个语音的持续时间和声音之间的间隔是允许变化的，但整体语音波形必须相似。 DTW 还用于许多其他学科 ，包括数据挖掘、手势识别、机器人技术、制造和医学。 一个时间序列“扭曲”到一个示例如图 所示: FastDTW：动态时间规整 (DTW) 具有平方时间和空间复杂度，这限制了它在大时间序列中的使用。 后面有很多优化，本文主要解释 FastDTW，它是 DTW 的近似，具有线性时间和空间复杂度。 FastDTW 使用多级方法，从较粗的分辨率递归地投影计算并细化投影。 从理论上和经验上证明了 FastDTW 的线性时间和空间复杂度。FastDTW 与其他两种现有的近似 DTW 算法进行比较来分析 FastDTW 的准确性：约束（例如 Sakoe-Chiba Bands）和抽象。 与现有方法相比，准确性有了很大提高。使用的方法太过巧妙，如下所示： 1) 粗化——将时间序列缩小为更小的时间序列，以更少的数据点尽可能准确地表示相同的曲线。 2) 投影——在较低分辨率下找到最小距离扭曲路径，并将其用作更高分辨率最小距离扭曲路径的初始猜测。 3) 细化——通过局部调整扭曲路径来优化从较低分辨率投影的扭曲路径。
DTW1 动态时间扭曲 (DTW) 是一种在两个时间序列之间找到最佳对齐的技术，其中一个时间序列可以通过拉伸或收缩其时间轴来非线性地“扭曲”。最初的实现是使用动态规划，使用数学表达如下： D ( i , j ) = D i s t ( i , j ) &#43; m i n [ D ( i − 1 , j ) , D ( i , j − 1 ) , D ( i − 1 , j − 1 ) ] , 其中： i = 1 , 2 , ⋯ , x _ l e n &#43; 1 ; j = 1 , 2 , ⋯ , y _ l e n &#43; 1 D(i,j)=Dist(i,j)&#43;min[D(i-1,j),D(i,j-1),D(i-1,j-1)], \\其中：i=1,2,\cdots,x\_len&#43;1;j=1,2,\cdots,y\_len&#43;1 D(i,j)=Dist(i,j)&#43;min[D(i−1,j),D(i,j−1),D(i−1,j−1)],其中：i=1,2,⋯,x_len&#43;1;j=1,2,⋯,y_len&#43;1" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/afb0e83315fd6f09d34ca7cfc4460316/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-03T16:43:59+08:00" />
<meta property="article:modified_time" content="2022-09-03T16:43:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">动态时间规整算法: 从DTW到FastDTW</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#_DTWFastDTW_1" rel="nofollow">动态时间规整算法: 从DTW到FastDTW</a></li><li><ul><li><a href="#_2" rel="nofollow">总结：</a></li><li><a href="#1_12" rel="nofollow">简介[^1]</a></li><li><a href="#DTW1_29" rel="nofollow">DTW[^1]</a></li><li><a href="#FastDTW1_109" rel="nofollow">FastDTW：使用多级粗化的方法[^1]</a></li><li><a href="#_244" rel="nofollow">结果</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_DTWFastDTW_1"></a>动态时间规整算法: 从DTW到FastDTW</h2> 
<h3><a id="_2"></a>总结：</h3> 
<font size="4" face="楷体"> FastDTW作者对DTW的改进点很巧妙！先通过举例说明在一些情况下目前现有的方法对DTW改进的缺陷，然后阐述自己的算法如何避免这些缺陷，最后还在三个数据集上证明在较长时间序列数据中取得线性复杂度。 </font> 
<font size="4" face="楷体"> 说明在做算法时，在无法找到更低复杂度的方法的时候，可以考虑在牺牲一些可接受的准确度的情况下实现更低的复杂度算法！！！同时，必须通过实验证明准确度降低的程度，文中就使用正常复杂度算法和近似复杂度算法进行对比，从而计算出降低的准确率！！最后，可以吸取现有的一些改进的基础上，再进一步改进，就比在原始的DWT算法上改进的效果更好！！！！ </font> 
<h3><a id="1_12"></a>简介<sup class="footnote-ref"><a href="#fn1" rel="nofollow" id="fnref1">1</a></sup></h3> 
<font size="4" face="楷体"> Dynamic time warping：动态时间扭曲 (DTW) 是一种在两个时间序列之间找到最佳对齐的技术，其中一个时间序列可以通过拉伸或收缩其时间轴来非线性地“扭曲”。 这种比对可用于找到对应的区域或确定两个时间序列之间的相似性。 DTW 经常用于语音识别，以确定两个波形是否代表相同的口语短语。 在语音波形中，每个语音的持续时间和声音之间的间隔是允许变化的，但整体语音波形必须相似。 DTW 还用于许多其他学科 ，包括数据挖掘、手势识别、机器人技术、制造和医学。 一个时间序列“扭曲”到一个示例如图 所示: </font> 
<p><img src="https://images2.imgbox.com/49/39/VI5MV0nT_o.png" alt="在这里插入图片描述" height="350"></p> 
<font size="4" face="楷体"> FastDTW：动态时间规整 (DTW) 具有平方时间和空间复杂度，这限制了它在大时间序列中的使用。 后面有很多优化，本文主要解释 FastDTW，它是 DTW 的近似，具有线性时间和空间复杂度。 FastDTW 使用多级方法，从较粗的分辨率递归地投影计算并细化投影。 从理论上和经验上证明了 FastDTW 的线性时间和空间复杂度。FastDTW 与其他两种现有的近似 DTW 算法进行比较来分析 FastDTW 的准确性：约束（例如 Sakoe-Chiba Bands）和抽象。 与现有方法相比，准确性有了很大提高。使用的方法太过巧妙，如下所示： </font> 
<p><font face="楷体">1) 粗化——将时间序列缩小为更小的时间序列，以更少的数据点尽可能准确地表示相同的曲线。 </font></p> 
<p><font face="楷体">2) 投影——在较低分辨率下找到最小距离扭曲路径，并将其用作更高分辨率最小距离扭曲路径的初始猜测。 </font></p> 
<p><font face="楷体">3) 细化——通过局部调整扭曲路径来优化从较低分辨率投影的扭曲路径。</font></p> 
<h3><a id="DTW1_29"></a>DTW<sup class="footnote-ref"><a href="#fn1" rel="nofollow" id="fnref1:1">1</a></sup></h3> 
<font size="4" face="楷体"> 动态时间扭曲 (DTW) 是一种在两个时间序列之间找到最佳对齐的技术，其中一个时间序列可以通过拉伸或收缩其时间轴来非线性地“扭曲”。最初的实现是使用动态规划，使用数学表达如下： </font> 
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          D 
         
        
          ( 
         
        
          i 
         
        
          , 
         
        
          j 
         
        
          ) 
         
        
          = 
         
        
          D 
         
        
          i 
         
        
          s 
         
        
          t 
         
        
          ( 
         
        
          i 
         
        
          , 
         
        
          j 
         
        
          ) 
         
        
          + 
         
        
          m 
         
        
          i 
         
        
          n 
         
        
          [ 
         
        
          D 
         
        
          ( 
         
        
          i 
         
        
          − 
         
        
          1 
         
        
          , 
         
        
          j 
         
        
          ) 
         
        
          , 
         
        
          D 
         
        
          ( 
         
        
          i 
         
        
          , 
         
        
          j 
         
        
          − 
         
        
          1 
         
        
          ) 
         
        
          , 
         
        
          D 
         
        
          ( 
         
        
          i 
         
        
          − 
         
        
          1 
         
        
          , 
         
        
          j 
         
        
          − 
         
        
          1 
         
        
          ) 
         
        
          ] 
         
        
          , 
         
         
        
          其中： 
         
        
          i 
         
        
          = 
         
        
          1 
         
        
          , 
         
        
          2 
         
        
          , 
         
        
          ⋯ 
          
        
          , 
         
        
          x 
         
        
          _ 
         
        
          l 
         
        
          e 
         
        
          n 
         
        
          + 
         
        
          1 
         
        
          ; 
         
        
          j 
         
        
          = 
         
        
          1 
         
        
          , 
         
        
          2 
         
        
          , 
         
        
          ⋯ 
          
        
          , 
         
        
          y 
         
        
          _ 
         
        
          l 
         
        
          e 
         
        
          n 
         
        
          + 
         
        
          1 
         
        
       
         D(i,j)=Dist(i,j)+min[D(i-1,j),D(i,j-1),D(i-1,j-1)], \\其中：i=1,2,\cdots,x\_len+1;j=1,2,\cdots,y\_len+1 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0572em;">j</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0572em;">j</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">min</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0572em;">j</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0572em;">j</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.854em; vertical-align: -0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0572em;">j</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">)]</span><span class="mpunct">,</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord cjk_fallback">其中：</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.0044em; vertical-align: -0.31em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">x</span><span class="mord" style="margin-right: 0.0278em;">_</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.854em; vertical-align: -0.1944em;"></span><span class="mord">1</span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0572em;">j</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.0044em; vertical-align: -0.31em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="mord" style="margin-right: 0.0278em;">_</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">1</span></span></span></span></span></span><br> <font size="4" face="楷体">代码实现如下<sup class="footnote-ref"><a href="#fn2" rel="nofollow" id="fnref2">2</a></sup>：</font></p> 
<pre><code class="prism language-python"><span class="token comment">#参考：https://github.com/slaypni/fastdtw</span>
<span class="token keyword">import</span> numbers
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> collections <span class="token keyword">import</span> defaultdict
<span class="token keyword">from</span> scipy<span class="token punctuation">.</span>spatial<span class="token punctuation">.</span>distance <span class="token keyword">import</span> euclidean

<span class="token keyword">def</span> <span class="token function">dtw</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> window<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> dist<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    @param x 序列1，可以是向量，矩阵，不局限于一个数列，但是dist要匹配
    @param y 序列2，可以是向量，矩阵，不局限于一个数列，但是dist要匹配
    @param window 序列设置要走的范围，当使用Sakoe-Chiba Bands就需要自定义缩小的范围，这里默认None会矩阵全走一遍
    @param dist 自定义距离计算方法，可以是欧氏距离，汉明距离等等
    """</span>
    len_x<span class="token punctuation">,</span> len_y <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>
    <span class="token keyword">if</span> window <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        window <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>len_x<span class="token punctuation">)</span> <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>len_y<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token comment"># 相当于矩阵的索引 i=1,2,...len_x+1 j=1,2,...len_y+1  </span>
    window <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i<span class="token punctuation">,</span> j <span class="token keyword">in</span> window<span class="token punctuation">)</span>
    
    <span class="token comment"># 初始化矩阵中的其他元素inf和D[0, 0]=0；D使用元组记录矩阵的值和path的i,j</span>
    D <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span><span class="token keyword">lambda</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">'inf'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    D<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 按照公式进行规划计算</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> j <span class="token keyword">in</span> window<span class="token punctuation">:</span>
        dt <span class="token operator">=</span> dist<span class="token punctuation">(</span>x<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token punctuation">[</span>j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        D<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">(</span>D<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>dt<span class="token punctuation">,</span> i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>D<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>dt<span class="token punctuation">,</span> i<span class="token punctuation">,</span> j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">(</span>D<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>dt<span class="token punctuation">,</span> i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> a<span class="token punctuation">:</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 求解路径</span>
    path <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    i<span class="token punctuation">,</span> j <span class="token operator">=</span> len_x<span class="token punctuation">,</span> len_y
    <span class="token keyword">while</span> <span class="token keyword">not</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> j <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        path<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        i<span class="token punctuation">,</span> j <span class="token operator">=</span> D<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> D<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
    path<span class="token punctuation">.</span>reverse<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>D<span class="token punctuation">[</span>len_x<span class="token punctuation">,</span> len_y<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    x <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'float'</span><span class="token punctuation">)</span>
    y <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'float'</span><span class="token punctuation">)</span>
    distance<span class="token punctuation">,</span> path <span class="token operator">=</span> dtw<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> dist<span class="token operator">=</span>euclidean<span class="token punctuation">)</span>
</code></pre> 
<p><font size="4" face="楷体">FastDTW之前，后来主要有两种近似计算DWT的算法，损失一定准确率的前提下减少时间和空间复杂度：</font></p> 
<p><font size="4" face="楷体">1、约束 – 限制在成本矩阵中评估的单元数</font></p> 
<p><font size="4" face="楷体">典型有两种：constraints: Sakoe-Chiba Band (left) and Itakura Parallelogram (right)；很明显，缺点是当全局最优解不在band内时，就有误差。图中的阴影区域是成本矩阵的单元格，它们被填充由每个约束的 DTW 算法。每个阴影区域或窗口的宽度由参数指定。当使用约束时，DTW 会通过约束窗口找到最优的扭曲路径。但是，如果全局最优扭曲路径不完全在窗口内，则将无法找到它。使用约束以一个常数因子加速 DTW，但如果窗口大小是时间序列长度的函数，则 DTW 仍然是 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          O 
         
        
          ( 
         
         
         
           N 
          
         
           2 
          
         
        
          ) 
         
        
       
         O(N^2) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0641em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8141em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>。<strong>约束在时间序列的时间对齐只有很小差异的领域中效果很好，并且最佳扭曲路径预计接近线性扭曲并以相对直线对角线穿过成本矩阵。但是，如果时间序列是在完全不同的时间开始和停止的事件，则约束效果不佳</strong>。在这种情况下，warp 路径可能会偏离线性 warp 很远，并且必须评估几乎整个成本矩阵以找到最佳 warp 路径。</font></p> 
<p><img src="https://images2.imgbox.com/7f/b4/cNkmVJWL_o.png" alt="在这里插入图片描述" height="200"></p> 
<p><font size="4" face="楷体">下图描述了约束 DTW 不能很好地工作的情况的简化示例，必须评估整个成本矩阵以获得良好的结果。这可能发生在时间序列是受监控设备的应用程序中，这些设备以可预测的顺序发出命令（例如开/关），但命令之间的时间量（稳态条件）未指定。此类数据的示例包括航天飞机阀门特征。</font></p> 
<p><img src="https://images2.imgbox.com/80/32/zcwzdKDn_o.png" alt="在这里插入图片描述" height="100"></p> 
<p><font size="4" face="楷体">2、抽象——对数据的简化表示执行 DTW</font></p> 
<p><font size="4" face="楷体">这种方法作者在FastDTW中也用上，如图所示，就是在低分辨率的矩阵中求解，也会有误差，因为路径不够细化。抽象通过对数据的简化表示进行操作来加速 DTW 算法。这些算法包括 IDDTW 、PDTW 和 COW 。时间序列的大小被缩小以使成本矩阵更易于计算。为较低分辨率的时间序列找到了一个扭曲路径并被映射回到全分辨率。</font></p> 
<p><font size="4" face="楷体">由此产生的加速取决于使用了多少抽象。显然，计算出的翘曲路径随着抽象级别的增加，它变得越来越不准确。投影低分辨率扭曲全分辨率的路径通常会创建一个远非最佳的扭曲路径。这是因为即使如果最优扭曲路径通过低分辨率单元，则将扭曲路径投影到更高的分辨率忽略了扭曲路径中可能非常重要的局部变化。<strong>因此不适用于局部变化剧烈的序列。</strong></font></p> 
<p><img src="https://images2.imgbox.com/3a/8d/RzOVN40d_o.png" alt="在这里插入图片描述" height="150"></p> 
<h3><a id="FastDTW1_109"></a>FastDTW：使用多级粗化的方法<sup class="footnote-ref"><a href="#fn1" rel="nofollow" id="fnref1:2">1</a></sup></h3> 
<p><font size="4" face="楷体">FastDTW使用下面三种方法进行改进：</font></p> 
<p><font face="楷体">1) 粗化——将时间序列缩小为更小的时间序列，以更少的数据点尽可能准确地表示相同的曲线。 </font></p> 
<p><font face="楷体">2. 投影——在较低分辨率下找到最小距离扭曲路径，并将其用作更高分辨率最小距离扭曲路径的初始猜测。 </font></p> 
<p><font face="楷体">3. 细化——通过局部调整扭曲路径来优化从较低分辨率投影的扭曲路径。 </font></p> 
<p>总结： </p> 
<p><font size="4" face="楷体">1、FastDTW中的分级使用更高分辨率计算，弥补了之前的Abstract的方法，原来只使用一次降低分辨率； </font></p> 
<p><font size="4" face="楷体">2、FastDTW中的细化使用半径参数控制，弥补原来的Band的方法那种不灵活性，因为Band的方法需要依靠先验知识判断最优路径大概在那些位置；而半径参数只是作为分级粗化投影的一个补充。确实很巧妙！！！ </font></p> 
<p><img src="https://images2.imgbox.com/99/71/K96LJO55_o.png" alt="在这里插入图片描述" height="130"></p> 
<p><font size="4" face="楷体">如图所示具体如下：粗化通过平均相邻的点对来减少时间序列的长度（或分辨率）。生成的时间序列比原始时间序列小两倍。粗化运行多次以产生时间序列的不同分辨率。投影采用以较低分辨率计算的扭曲路径，并以较高的分辨率确定它通过的单元格。由于分辨率增加了两倍，因此低分辨率扭曲路径中的单个点将映射到更高分辨率的至少四个点（如果 |X| = |Y |，则可能 &gt; 4）。然后在细化过程中将此投影路径用作启发式方法，以找到更高分辨率的扭曲路径。细化在投影路径的邻域中找到最佳的扭曲路径，其中邻域的大小由半径参数控制。在我们的多级方法中，成本矩阵仅填充在从先前分辨率投影的路径的附近。由于扭曲路径的长度随着时间序列的长度线性增长，我们的多级方法是 O(N) 算法。 FastDTW 算法首先使用粗化来创建将被评估的所有分辨率。图中显示了一个时间序列上的例子在运行 FastDTW 算法时创建的四个分辨率（使用多少个分辨率的粗化矩阵按照实际序列长度确定）。 </font></p> 
<p><font size="4" face="楷体">在图 中，从 1/8 分辨率的扭曲路径的投影显示为 1/4 分辨率的重度阴影单元。为了细化投影路径，使用非常具体的约束运行受约束的 DTW 算法，即仅评估投影扭曲路径中的单元格。这将通过从较低分辨率投影的扭曲路径区域找到最佳扭曲路径。然而，全局最优扭曲路径可能不完全包含在投影路径中。为了增加找到全局最优解的可能性，有一个半径参数来控制投影路径每一侧上的额外单元数，这些单元格也将在优化扭曲路径时进行评估。在图 中，半径参数设置为 1。由于半径而在扭曲路径细化过程中包含的单元格被轻微着色。一旦以 1/4 分辨率细化扭曲路径，该扭曲路径将投影到 1/2 分辨率，扩大半径 1，然后再次细化。最后，将扭曲路径投影到图 中的全分辨率 (1/1) 矩阵。投影被半径扩展并最后一次细化。这个细化的扭曲路径是算法的输出。 FastDTW 在所有分辨率下评估了 4 + 16 + 44 + 100 = 164 个单元，而 DTW 评估了 256 (162) 个单元。对于这个小问题，效率的提高并不是很显着，尤其是考虑到创建所有四个分辨率的开销，在长序列有很大差距。然而，FastDTW 评估的单元数与时间序列的长度成线性关系，而经典的动态时间扭曲算法总是评估<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           N 
          
         
           2 
          
         
        
       
         N^2 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8141em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8141em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>个单元（如果两个时间序列的长度均为 N）。 </font></p> 
<p><font size="4" face="楷体">代码实现： </font></p> 
<p><img src="https://images2.imgbox.com/d5/d3/8i2PylKz_o.png" alt="在这里插入图片描述" height="550"></p> 
<p><font size="4" face="楷体">FastDTW的递归实现<sup class="footnote-ref"><a href="#fn2" rel="nofollow" id="fnref2:1">2</a></sup>： </font></p> 
<pre><code class="prism language-python"><span class="token comment">#参考：https://github.com/slaypni/fastdtw</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> absolute_import<span class="token punctuation">,</span> division
<span class="token keyword">import</span> numbers
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> collections <span class="token keyword">import</span> defaultdict
<span class="token keyword">from</span> scipy<span class="token punctuation">.</span>spatial<span class="token punctuation">.</span>distance <span class="token keyword">import</span> euclidean

<span class="token keyword">def</span> <span class="token function">dtw</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> window<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> dist<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    @param x 序列1，可以是向量，矩阵，不局限于一个数列，但是dist要匹配
    @param y 序列2，可以是向量，矩阵，不局限于一个数列，但是dist要匹配
    @param window 序列设置要走的范围，当使用Sakoe-Chiba Bands就需要自定义缩小的范围，这里默认None会矩阵全走一遍
    @param dist 自定义距离计算方法，可以是欧氏距离，汉明距离等等
    """</span>
    len_x<span class="token punctuation">,</span> len_y <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>
    <span class="token keyword">if</span> window <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        window <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>len_x<span class="token punctuation">)</span> <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>len_y<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token comment"># 相当于矩阵的索引 i=1,2,...len_x+1 j=1,2,...len_y+1  </span>
    window <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i<span class="token punctuation">,</span> j <span class="token keyword">in</span> window<span class="token punctuation">)</span>
    
    <span class="token comment"># 初始化矩阵中的其他元素inf和D[0, 0]=0；D使用元组记录矩阵的值和path的i,j</span>
    D <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span><span class="token keyword">lambda</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">'inf'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    D<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 按照公式进行规划计算</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> j <span class="token keyword">in</span> window<span class="token punctuation">:</span>
        dt <span class="token operator">=</span> dist<span class="token punctuation">(</span>x<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token punctuation">[</span>j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        D<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">(</span>D<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>dt<span class="token punctuation">,</span> i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>D<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>dt<span class="token punctuation">,</span> i<span class="token punctuation">,</span> j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">(</span>D<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>dt<span class="token punctuation">,</span> i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> a<span class="token punctuation">:</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 求解路径</span>
    path <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    i<span class="token punctuation">,</span> j <span class="token operator">=</span> len_x<span class="token punctuation">,</span> len_y
    <span class="token keyword">while</span> <span class="token keyword">not</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> j <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        path<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        i<span class="token punctuation">,</span> j <span class="token operator">=</span> D<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> D<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
    path<span class="token punctuation">.</span>reverse<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>D<span class="token punctuation">[</span>len_x<span class="token punctuation">,</span> len_y<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">reduce_by_half</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    分辨率减半，使用平均的方法
    """</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">+</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">expand_window</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> len_x<span class="token punctuation">,</span> len_y<span class="token punctuation">,</span> radius<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    计算radius下的时间窗
    """</span>
    path_ <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> j <span class="token keyword">in</span> path<span class="token punctuation">:</span>
        <span class="token keyword">for</span> a<span class="token punctuation">,</span> b <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">+</span> a<span class="token punctuation">,</span> j <span class="token operator">+</span> b<span class="token punctuation">)</span>
                     <span class="token keyword">for</span> a <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token operator">-</span>radius<span class="token punctuation">,</span> radius<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
                     <span class="token keyword">for</span> b <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token operator">-</span>radius<span class="token punctuation">,</span> radius<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            path_<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span>

    window_ <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> j <span class="token keyword">in</span> path_<span class="token punctuation">:</span>
        <span class="token keyword">for</span> a<span class="token punctuation">,</span> b <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> j <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> j <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                     <span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            window_<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span>

    window <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    start_j <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> len_x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        new_start_j <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>start_j<span class="token punctuation">,</span> len_y<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token keyword">in</span> window_<span class="token punctuation">:</span>
                window<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> new_start_j <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                    new_start_j <span class="token operator">=</span> j
            <span class="token keyword">elif</span> new_start_j <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                <span class="token keyword">break</span>
        start_j <span class="token operator">=</span> new_start_j
    <span class="token keyword">return</span> window


<span class="token keyword">def</span> <span class="token function">fastdtw</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> radius<span class="token punctuation">,</span> dist<span class="token punctuation">)</span><span class="token punctuation">:</span>
    min_time_size <span class="token operator">=</span> radius <span class="token operator">+</span> <span class="token number">2</span>

    <span class="token comment"># 长度小于min_time_size，直接使用DTW计算</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">&lt;</span> min_time_size <span class="token keyword">or</span> <span class="token builtin">len</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">&lt;</span> min_time_size<span class="token punctuation">:</span>
        <span class="token keyword">return</span> dtw<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> dist<span class="token operator">=</span>dist<span class="token punctuation">)</span>

    <span class="token comment"># 每次粗化一半，得到新的序列</span>
    x_shrinked <span class="token operator">=</span> reduce_by_half<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    y_shrinked <span class="token operator">=</span> reduce_by_half<span class="token punctuation">(</span>y<span class="token punctuation">)</span>
    
    <span class="token comment"># 递归计算，直到满足len(x) &lt; min_time_size or len(y) &lt; min_time_size则回溯</span>
    distance<span class="token punctuation">,</span> path <span class="token operator">=</span> fastdtw<span class="token punctuation">(</span>x_shrinked<span class="token punctuation">,</span> y_shrinked<span class="token punctuation">,</span> radius<span class="token operator">=</span>radius<span class="token punctuation">,</span> dist<span class="token operator">=</span>dist<span class="token punctuation">)</span>
    
    <span class="token comment"># 根据radius计算新的计算范围</span>
    window <span class="token operator">=</span> expand_window<span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> radius<span class="token punctuation">)</span>
    <span class="token keyword">return</span> dtw<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> window<span class="token punctuation">,</span> dist<span class="token operator">=</span>dist<span class="token punctuation">)</span>


</code></pre> 
<h3><a id="_244"></a>结果</h3> 
<p><font size="4" face="楷体">错误率计算：</font></p> 
<p><img src="https://images2.imgbox.com/3f/72/WcldpFsn_o.png" alt="在这里插入图片描述" height="50"></p> 
<p><font size="4" face="楷体">在准确度上：</font></p> 
<p><font size="4" face="楷体">相比Band和Abstraction的方法，错误率更低，而且随着radius的增加，错误率降低，后面已经很接近DTW算法；</font></p> 
<p><img src="https://images2.imgbox.com/8d/1d/joQDktYa_o.png" alt="在这里插入图片描述" height="200"></p> 
<p><font size="4" face="楷体">在时间上：</font></p> 
<p><font size="4" face="楷体">虽然在数列长度200以内体现不出区别，但是随着时间序列长度的增加，越来越接近线性时间复杂度。</font></p> 
<p><img src="https://images2.imgbox.com/b2/0e/JCu3XMDH_o.png" alt="在这里插入图片描述" height="220"></p> 
<p><font size="4" face="楷体">参考：</font></p> 
<hr class="footnotes-sep"> 
<section class="footnotes"> 
 <ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><font face="Times New Roman">Salvador S, Chan P. Toward accurate dynamic time warping in linear time and space[J]. Intelligent Data Analysis, 2007, 11(5): 561-580. <a href="#fnref1" rel="nofollow" class="footnote-backref">↩︎</a> <a href="#fnref1:1" rel="nofollow" class="footnote-backref">↩︎</a> <a href="#fnref1:2" rel="nofollow" class="footnote-backref">↩︎</a></font></p> </li><li id="fn2" class="footnote-item"><p><font face="Times New Roman"><a href="https://github.com/slaypni/fastdtw">GitHub - slaypni/fastdtw: A Python implementation of FastDTW</a> <a href="#fnref2" rel="nofollow" class="footnote-backref">↩︎</a> <a href="#fnref2:1" rel="nofollow" class="footnote-backref">↩︎</a></font></p> </li></ol> 
</section>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4305e5863cb032127e7206588103832a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">双连通与网络可靠性</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/70edee9e5e7c8fda6a0ed747de023d52/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">使用node加密excel文件</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>