<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>QT：只允许在自定义标题栏中鼠标拖动控制窗口位置 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="QT：只允许在自定义标题栏中鼠标拖动控制窗口位置" />
<meta property="og:description" content="目录
说明
效果展示
代码
说明 在使用了自定义的标题栏，想要实现鼠标只能在标题栏中拖动窗口，在其它地方拖动不了窗口的效果。
我们这里是在标题栏类的鼠标事件中处理拖动窗口的事情。
实现过程：标题栏类中的鼠标事件获取了拖动位置后，通过移动标题栏的父类部件，从而实现窗口拖动。
效果展示 代码 主窗口代码
#include &#34;widget.h&#34; #include &#34;ui_widget.h&#34; #include &lt;QLabel&gt; #include &lt;QLayout&gt; #include &#34;my_title_bar.h&#34; Widget::Widget(QWidget *parent) : QWidget(parent), ui(new Ui::Widget) { ui-&gt;setupUi(this); //标题栏 MyTitleBar* title_bar = new MyTitleBar(this); //设置背景色 title_bar-&gt;setStyleSheet(&#34;MyTitleBar{background-color: gray;}&#34;); //设置窗口属性和布局 this-&gt;setWindowFlags(Qt::FramelessWindowHint);//去除标题栏 QVBoxLayout* main_vlayout = new QVBoxLayout(this); this-&gt;setLayout(main_vlayout); main_vlayout-&gt;setMargin(0); main_vlayout-&gt;setSpacing(0); main_vlayout-&gt;addWidget(title_bar, 1); main_vlayout-&gt;addStretch(9); } Widget::~Widget() { delete ui; } 标题栏代码
#ifndef MYTITLEBAR_H #define MYTITLEBAR_H #include &lt;QLabel&gt; #include &lt;QMouseEvent&gt; class MyTitleBar : public QLabel { Q_OBJECT public: explicit MyTitleBar(QWidget *parent = 0) : QLabel(parent) { } protected: void mousePressEvent(QMouseEvent* ev) override { QWidget* parent_widget = this-&gt;parentWidget(); start_move_pos_ = ev-&gt;globalPos() - parent_widget -&gt;frameGeometry()." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/eb39aaf4ac696eac08ec9ed9a75615f7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-05-31T17:48:24+08:00" />
<meta property="article:modified_time" content="2021-05-31T17:48:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">QT：只允许在自定义标题栏中鼠标拖动控制窗口位置</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E8%AF%B4%E6%98%8E-toc" style="margin-left:80px;"><a href="#%E8%AF%B4%E6%98%8E" rel="nofollow">说明</a></p> 
<p id="%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA-toc" style="margin-left:80px;"><a href="#%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA" rel="nofollow">效果展示</a></p> 
<p id="%E4%BB%A3%E7%A0%81-toc" style="margin-left:80px;"><a href="#%E4%BB%A3%E7%A0%81" rel="nofollow">代码</a></p> 
<hr id="hr-toc"> 
<h4 id="%E8%AF%B4%E6%98%8E">说明</h4> 
<p>在使用了自定义的标题栏，想要实现鼠标只能在标题栏中拖动窗口，在其它地方拖动不了窗口的效果。</p> 
<p>我们这里是在标题栏类的鼠标事件中处理拖动窗口的事情。</p> 
<p><strong>实现过程：</strong>标题栏类中的鼠标事件获取了拖动位置后，通过移动标题栏的父类部件，从而实现窗口拖动。</p> 
<p> </p> 
<h4 id="%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA">效果展示</h4> 
<p><img alt="" height="439" src="https://images2.imgbox.com/c1/7a/Von9OsnX_o.gif" width="773"></p> 
<p> </p> 
<h4 id="%E4%BB%A3%E7%A0%81">代码</h4> 
<p><strong>主窗口代码</strong></p> 
<pre><code class="language-cpp">#include "widget.h"
#include "ui_widget.h"

#include &lt;QLabel&gt;
#include &lt;QLayout&gt;
#include "my_title_bar.h"

Widget::Widget(QWidget *parent) :
    QWidget(parent),
    ui(new Ui::Widget)
{
    ui-&gt;setupUi(this);

    //标题栏
    MyTitleBar* title_bar = new MyTitleBar(this);

    //设置背景色
    title_bar-&gt;setStyleSheet("MyTitleBar{background-color: gray;}");

    //设置窗口属性和布局
    this-&gt;setWindowFlags(Qt::FramelessWindowHint);//去除标题栏
    QVBoxLayout* main_vlayout = new QVBoxLayout(this);
    this-&gt;setLayout(main_vlayout);
    main_vlayout-&gt;setMargin(0);
    main_vlayout-&gt;setSpacing(0);
    main_vlayout-&gt;addWidget(title_bar, 1);
    main_vlayout-&gt;addStretch(9);

}

Widget::~Widget()
{
    delete ui;
}</code></pre> 
<p> </p> 
<p><strong>标题栏代码</strong></p> 
<pre><code class="language-cpp">#ifndef MYTITLEBAR_H
#define MYTITLEBAR_H

#include &lt;QLabel&gt;
#include &lt;QMouseEvent&gt;

class MyTitleBar : public QLabel
{
    Q_OBJECT
public:
    explicit MyTitleBar(QWidget *parent = 0)
        : QLabel(parent)
    {

    }

protected:
    void mousePressEvent(QMouseEvent* ev) override
    {
        QWidget* parent_widget = this-&gt;parentWidget();
        start_move_pos_ = ev-&gt;globalPos() - parent_widget -&gt;frameGeometry().topLeft();
    }
    void mouseMoveEvent(QMouseEvent* ev) override
    {
        //移动父部件位置
        QWidget* parent_widget = this-&gt;parentWidget();
        parentWidget-&gt;move(parent_widget-&gt;mapToGlobal(ev-&gt;pos() - start_move_pos_));
    }

private:
    QPoint      start_move_pos_;
};

#endif // MYTITLEBAR_H</code></pre> 
<p> </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e06a423884ef75e7652365c5c4829074/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">无线网络数据传输的相关知识</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a721674bf50f21c912acabd2f4a745ce/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ROS避坑报错E: Unable to correct problems, you have held broken</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>