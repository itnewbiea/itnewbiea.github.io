<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Docker】完整的搭建和发布过程 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【Docker】完整的搭建和发布过程" />
<meta property="og:description" content="【Docker】完整的搭建和发布过程 【一】Mac版虚拟机CentOS搭建【1】shell和ftp工具选择【2】linux 命令 ip a / ip addr / ifconfig 不显示ip问题（1）如果没有 ifcfg-ens33文件 修改 ifcfg-eth0（2）重启网关服务器 【二】Docker安装【1】Docker的安装（1）查看系统的内核版本（2）yum更新到最新版本（3）安装Docker所需的依赖包（4）设置Docker的yum的源（5）更新yum软件包索引（6）查看仓库所有Docker版本（7）安装Docker（8）启动Docker并添加开机自启动（9）查看Docker版本（10）测试（11）卸载Docker（12）Docker常用命令（13）如何创建自启动的容器 【2】阿里云镜像加速（1）获取阿里云加速器地址（2）创建文件夹并执行脚本（3）重新加载配置文件（4）重新启动docker（5）查看 daemon.json 是否已经生效了 【三】环境容器的搭建【1】安装Portainer（1）拉取最新的Portainer镜像（2）运行镜像（9000）（3）访问Portainer可视化界面（4）一些问题的解决 【2】安装JDK8【3】安装redis（1）拉取redis镜像（2）在宿主机下新建目录/app/redis（3）启动redis（6379）（4）查看Portainer的页面（5）使用本地RDM链接redis（6）使用redis容器的终端链接redis（7）运维命令 【5】安装redis集群（1）面试题（2）搭建三主三从redis集群（3）主从容错切换迁移案例（4）主从扩容案例（5）主从缩容案例 【6】安装kafka（1）下载镜像（2）启动zookeeper（2181）（3）启动kafka（9092）（4）防火墙设置（5）kafka日志（6）Kafka 控制台操作（7）待补充 【7】安装mysql（3306）【8】安装mysql主从复制（1）新建主服务器容器实例3307（2）进入/mydata/mysql-master/conf目录下新建my.cnf（3）修改完配置后重启master实例（4）进入mysql-master容器（5）master容器实例内创建数据同步用户（6）新建从服务器容器实例3308（7）进入/mydata/mysql-master/conf目录下新建my.cnf（8）修改完配置后重启slave实例（9）在主数据库中查看主从同步状态（10）进入mysql-slave容器（11）在从数据库中配置主从复制（12）在从数据库中查看主从同步状态（13）在从数据库中开启主从同步（14）查看从数据库状态发现已经同步（15）主从复制测试 【9】安装xxl-job（1）导入sql（2）安装xxl-job（7397）（3）配置任务（4）工程配置xxl-job（5）测试验证（待补充） 【10】安装nacos（8848）【11】安装Elasticsearch（9200）【12】安装Kibana（5601）【13】安装canal（待补充）【14】安装nginx（80）（1）下载Nginx镜像（下面两种选择一个）（2）创建Nginx配置文件（3）创建Nginx容器并运行（4）结果检测（5）修改nginx配置 【四】总结上面案例中的概念和常用的Docker命令【1】常用的概念【2】镜像命令【3】容器命令【4】镜像构建（1）介绍（2）docker commit构建镜像 【五】挂载是怎么个事【六】网络是怎么个事【七】Dockerfile【1】介绍【2】Dockerfile的基础知识【3】Dockerfile 常用指令【4】Dockerfile指令的使用案例（1）先拉取一个centos的镜像（2）启动centos（3）阻塞操作系统，启动的一刹那就进入操作系统（4）测试FROM指令（5）构建镜像（6）一点优化（7）测试RUN指令（8）测试EXPOSE指令（9）测试WORKDIR指令（10）测试ADD指令（11）测试COPY指令（12）测试ENV指令（13）测试VOLUME指令（14）测试CMD命令（15）测试ENTRYPOINT指令 【3】构建镜像【4】Dockerfile 实践【5】镜像仓库 【六】用dockerfile完成项目部署的案例【1】案例一：自己创建一个增删改查的项目并用Dockerfile部署（1）创建一个springboot项目（2）docker创建网络（3）把项目打成jar包（4）创建Dockerfile文件，并上传jar包（5）用dockerfile构建镜像（6）使用镜像创建容器（7）本地测试 【2】案例二：部署包括mysql和Redis的springboot项目war包（1）准备项目代码进行本地测试（2）修改项目代码的配置（3）项目打成war包（4）启动各个容器（5）导入项目的数据到mysql（6）上传springboot项目到服务器，防火墙开放端口（7）编写dockerfile文件（8）用dockerfile构建镜像（9）使用镜像创建容器（10）本地测试 【3】案例三：用Dockerfile构建一个自定义镜像 【七】docker-compose【1】介绍（docker容器太多了如何管理）【2】举例说明【3】docker-compose.yml 文件详解（1）介绍（2）version 版本信息（3）services 定义服务（4）image 镜像名称标签（5）dockerfile 构建镜像（6）container_name 容器名称（7）depends_on 容器依赖（8）ports 暴露端口（9）expose 接受端口范围（10）restart 重启策略（11）environment 环境变量（12）command 执行命令（13）volumes 目录挂载（14）network_mode 网络模式（15）networks（16）aliases 【4】compose的概念和常用命令 【八】compose的安装【1】在线安装【2】离线安装 【九】用Docker-compose完成项目部署的案例【2】ruoyi系统的容器化部署过程（1）安装Nacos（2）安装Nginx（3）安装Mysql8（4）安装redis（5）下载若依系统（6）修改bootstrap.yml配置文件（7）打包（8）操作项目文件里的文件/docker/ruoyi（9）操作docker/mysql（10）操作docker/nacos（11）操作docker\nginx\conf（12）操作docker\nginx\html\dist这个文件（13）操作docker下docker-compose.yml文件（14）将docker文件夹上传至linux（15）运行服务（16）检查一下启动结果（17）修改完配置后再次启动（18）启动出现问题 【十】基于Docker&#43;Jenkins&#43;Git的发布环境搭建【十】k8s学习笔记 【一】Mac版虚拟机CentOS搭建 【1】shell和ftp工具选择 选择是的mac版termius
【2】linux 命令 ip a / ip addr / ifconfig 不显示ip问题 原因：CentOS 7.x 默认不开启网卡" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/8791f37beaea296b7d813dcb632e3f98/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-20T12:20:12+08:00" />
<meta property="article:modified_time" content="2023-08-20T12:20:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Docker】完整的搭建和发布过程</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>【Docker】完整的搭建和发布过程</h4> 
 <ul><li><a href="#MacCentOS_3" rel="nofollow">【一】Mac版虚拟机CentOS搭建</a></li><li><ul><li><a href="#1shellftp_4" rel="nofollow">【1】shell和ftp工具选择</a></li><li><a href="#2linux___ip_a__ip_addr__ifconfig_ip_7" rel="nofollow">【2】linux 命令 ip a / ip addr / ifconfig 不显示ip问题</a></li><li><ul><li><a href="#1_ifcfgens33__ifcfgeth0_12" rel="nofollow">（1）如果没有 ifcfg-ens33文件 修改 ifcfg-eth0</a></li><li><a href="#2_23" rel="nofollow">（2）重启网关服务器</a></li></ul> 
  </li></ul> 
  </li><li><a href="#Docker_30" rel="nofollow">【二】Docker安装</a></li><li><ul><li><a href="#1Docker_32" rel="nofollow">【1】Docker的安装</a></li><li><ul><li><a href="#1_34" rel="nofollow">（1）查看系统的内核版本</a></li><li><a href="#2yum_42" rel="nofollow">（2）yum更新到最新版本</a></li><li><a href="#3Docker_56" rel="nofollow">（3）安装Docker所需的依赖包</a></li><li><a href="#4Dockeryum_64" rel="nofollow">（4）设置Docker的yum的源</a></li><li><a href="#5yum_71" rel="nofollow">（5）更新yum软件包索引</a></li><li><a href="#6Docker_77" rel="nofollow">（6）查看仓库所有Docker版本</a></li><li><a href="#7Docker_83" rel="nofollow">（7）安装Docker</a></li><li><a href="#8Docker_90" rel="nofollow">（8）启动Docker并添加开机自启动</a></li><li><a href="#9Docker_116" rel="nofollow">（9）查看Docker版本</a></li><li><a href="#10_122" rel="nofollow">（10）测试</a></li><li><a href="#11Docker_130" rel="nofollow">（11）卸载Docker</a></li><li><a href="#12Docker_139" rel="nofollow">（12）Docker常用命令</a></li><li><a href="#13_155" rel="nofollow">（13）如何创建自启动的容器</a></li></ul> 
   </li><li><a href="#2_172" rel="nofollow">【2】阿里云镜像加速</a></li><li><ul><li><a href="#1_174" rel="nofollow">（1）获取阿里云加速器地址</a></li><li><a href="#2_186" rel="nofollow">（2）创建文件夹并执行脚本</a></li><li><a href="#3_200" rel="nofollow">（3）重新加载配置文件</a></li><li><a href="#4docker_204" rel="nofollow">（4）重新启动docker</a></li><li><a href="#5_daemonjson__208" rel="nofollow">（5）查看 daemon.json 是否已经生效了</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_215" rel="nofollow">【三】环境容器的搭建</a></li><li><ul><li><a href="#1Portainer_217" rel="nofollow">【1】安装Portainer</a></li><li><ul><li><a href="#1Portainer_219" rel="nofollow">（1）拉取最新的Portainer镜像</a></li><li><a href="#29000_225" rel="nofollow">（2）运行镜像（9000）</a></li><li><a href="#3Portainer_248" rel="nofollow">（3）访问Portainer可视化界面</a></li><li><a href="#4_263" rel="nofollow">（4）一些问题的解决</a></li></ul> 
   </li><li><a href="#2JDK8_280" rel="nofollow">【2】安装JDK8</a></li><li><a href="#3redis_340" rel="nofollow">【3】安装redis</a></li><li><ul><li><a href="#1redis_342" rel="nofollow">（1）拉取redis镜像</a></li><li><a href="#2appredis_347" rel="nofollow">（2）在宿主机下新建目录/app/redis</a></li><li><a href="#3redis6379_376" rel="nofollow">（3）启动redis（6379）</a></li><li><a href="#4Portainer_410" rel="nofollow">（4）查看Portainer的页面</a></li><li><a href="#5RDMredis_412" rel="nofollow">（5）使用本地RDM链接redis</a></li><li><a href="#6redisredis_426" rel="nofollow">（6）使用redis容器的终端链接redis</a></li><li><a href="#7_432" rel="nofollow">（7）运维命令</a></li></ul> 
   </li><li><a href="#5redis_443" rel="nofollow">【5】安装redis集群</a></li><li><ul><li><a href="#1_444" rel="nofollow">（1）面试题</a></li><li><a href="#2redis_454" rel="nofollow">（2）搭建三主三从redis集群</a></li><li><a href="#3_500" rel="nofollow">（3）主从容错切换迁移案例</a></li><li><a href="#4_530" rel="nofollow">（4）主从扩容案例</a></li><li><a href="#5_586" rel="nofollow">（5）主从缩容案例</a></li></ul> 
   </li><li><a href="#6kafka_631" rel="nofollow">【6】安装kafka</a></li><li><ul><li><a href="#1_633" rel="nofollow">（1）下载镜像</a></li><li><a href="#2zookeeper2181_641" rel="nofollow">（2）启动zookeeper（2181）</a></li><li><a href="#3kafka9092_647" rel="nofollow">（3）启动kafka（9092）</a></li><li><a href="#4_661" rel="nofollow">（4）防火墙设置</a></li><li><a href="#5kafka_667" rel="nofollow">（5）kafka日志</a></li><li><a href="#6Kafka__670" rel="nofollow">（6）Kafka 控制台操作</a></li><li><a href="#7_686" rel="nofollow">（7）待补充</a></li></ul> 
   </li><li><a href="#7mysql3306_690" rel="nofollow">【7】安装mysql（3306）</a></li><li><a href="#8mysql_750" rel="nofollow">【8】安装mysql主从复制</a></li><li><ul><li><a href="#13307_751" rel="nofollow">（1）新建主服务器容器实例3307</a></li><li><a href="#2mydatamysqlmasterconfmycnf_756" rel="nofollow">（2）进入/mydata/mysql-master/conf目录下新建my.cnf</a></li><li><a href="#3master_777" rel="nofollow">（3）修改完配置后重启master实例</a></li><li><a href="#4mysqlmaster_782" rel="nofollow">（4）进入mysql-master容器</a></li><li><a href="#5master_789" rel="nofollow">（5）master容器实例内创建数据同步用户</a></li><li><a href="#63308_797" rel="nofollow">（6）新建从服务器容器实例3308</a></li><li><a href="#7mydatamysqlmasterconfmycnf_802" rel="nofollow">（7）进入/mydata/mysql-master/conf目录下新建my.cnf</a></li><li><a href="#8slave_831" rel="nofollow">（8）修改完配置后重启slave实例</a></li><li><a href="#9_837" rel="nofollow">（9）在主数据库中查看主从同步状态</a></li><li><a href="#10mysqlslave_842" rel="nofollow">（10）进入mysql-slave容器</a></li><li><a href="#11_849" rel="nofollow">（11）在从数据库中配置主从复制</a></li><li><a href="#12_854" rel="nofollow">（12）在从数据库中查看主从同步状态</a></li><li><a href="#13_860" rel="nofollow">（13）在从数据库中开启主从同步</a></li><li><a href="#14_865" rel="nofollow">（14）查看从数据库状态发现已经同步</a></li><li><a href="#15_866" rel="nofollow">（15）主从复制测试</a></li></ul> 
   </li><li><a href="#9xxljob_881" rel="nofollow">【9】安装xxl-job</a></li><li><ul><li><a href="#1sql_883" rel="nofollow">（1）导入sql</a></li><li><a href="#2xxljob7397_1120" rel="nofollow">（2）安装xxl-job（7397）</a></li><li><a href="#3_1129" rel="nofollow">（3）配置任务</a></li><li><a href="#4xxljob_1140" rel="nofollow">（4）工程配置xxl-job</a></li><li><a href="#5_1173" rel="nofollow">（5）测试验证（待补充）</a></li></ul> 
   </li><li><a href="#10nacos8848_1176" rel="nofollow">【10】安装nacos（8848）</a></li><li><a href="#11Elasticsearch9200_1193" rel="nofollow">【11】安装Elasticsearch（9200）</a></li><li><a href="#12Kibana5601_1210" rel="nofollow">【12】安装Kibana（5601）</a></li><li><a href="#13canal_1242" rel="nofollow">【13】安装canal（待补充）</a></li><li><a href="#14nginx80_1250" rel="nofollow">【14】安装nginx（80）</a></li><li><ul><li><a href="#1Nginx_1252" rel="nofollow">（1）下载Nginx镜像（下面两种选择一个）</a></li><li><a href="#2Nginx_1257" rel="nofollow">（2）创建Nginx配置文件</a></li><li><a href="#3Nginx_1279" rel="nofollow">（3）创建Nginx容器并运行</a></li><li><a href="#4_1327" rel="nofollow">（4）结果检测</a></li><li><a href="#5nginx_1332" rel="nofollow">（5）修改nginx配置</a></li></ul> 
  </li></ul> 
  </li><li><a href="#Docker_1337" rel="nofollow">【四】总结上面案例中的概念和常用的Docker命令</a></li><li><ul><li><a href="#1_1339" rel="nofollow">【1】常用的概念</a></li><li><a href="#2_1377" rel="nofollow">【2】镜像命令</a></li><li><a href="#3_1390" rel="nofollow">【3】容器命令</a></li><li><a href="#4_1497" rel="nofollow">【4】镜像构建</a></li><li><ul><li><a href="#1_1499" rel="nofollow">（1）介绍</a></li><li><a href="#2docker_commit_1509" rel="nofollow">（2）docker commit构建镜像</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_1600" rel="nofollow">【五】挂载是怎么个事</a></li><li><a href="#_1602" rel="nofollow">【六】网络是怎么个事</a></li><li><a href="#Dockerfile_1604" rel="nofollow">【七】Dockerfile</a></li><li><ul><li><a href="#1_1606" rel="nofollow">【1】介绍</a></li><li><a href="#2Dockerfile_1616" rel="nofollow">【2】Dockerfile的基础知识</a></li><li><a href="#3Dockerfile__1625" rel="nofollow">【3】Dockerfile 常用指令</a></li><li><a href="#4Dockerfile_1677" rel="nofollow">【4】Dockerfile指令的使用案例</a></li><li><ul><li><a href="#1centos_1679" rel="nofollow">（1）先拉取一个centos的镜像</a></li><li><a href="#2centos_1685" rel="nofollow">（2）启动centos</a></li><li><a href="#3_1700" rel="nofollow">（3）阻塞操作系统，启动的一刹那就进入操作系统</a></li><li><a href="#4FROM_1709" rel="nofollow">（4）测试FROM指令</a></li><li><a href="#5_1723" rel="nofollow">（5）构建镜像</a></li><li><a href="#6_1731" rel="nofollow">（6）一点优化</a></li><li><a href="#7RUN_1735" rel="nofollow">（7）测试RUN指令</a></li><li><a href="#8EXPOSE_1781" rel="nofollow">（8）测试EXPOSE指令</a></li><li><a href="#9WORKDIR_1792" rel="nofollow">（9）测试WORKDIR指令</a></li><li><a href="#10ADD_1808" rel="nofollow">（10）测试ADD指令</a></li><li><a href="#11COPY_1823" rel="nofollow">（11）测试COPY指令</a></li><li><a href="#12ENV_1844" rel="nofollow">（12）测试ENV指令</a></li><li><a href="#13VOLUME_1858" rel="nofollow">（13）测试VOLUME指令</a></li><li><a href="#14CMD_1888" rel="nofollow">（14）测试CMD命令</a></li><li><a href="#15ENTRYPOINT_1912" rel="nofollow">（15）测试ENTRYPOINT指令</a></li></ul> 
   </li><li><a href="#3_1971" rel="nofollow">【3】构建镜像</a></li><li><a href="#4Dockerfile__1987" rel="nofollow">【4】Dockerfile 实践</a></li><li><a href="#5_2044" rel="nofollow">【5】镜像仓库</a></li></ul> 
  </li><li><a href="#dockerfile_2075" rel="nofollow">【六】用dockerfile完成项目部署的案例</a></li><li><ul><li><a href="#1Dockerfile_2077" rel="nofollow">【1】案例一：自己创建一个增删改查的项目并用Dockerfile部署</a></li><li><ul><li><a href="#1springboot_2078" rel="nofollow">（1）创建一个springboot项目</a></li><li><a href="#2docker_2160" rel="nofollow">（2）docker创建网络</a></li><li><a href="#3jar_2184" rel="nofollow">（3）把项目打成jar包</a></li><li><a href="#4Dockerfilejar_2194" rel="nofollow">（4）创建Dockerfile文件，并上传jar包</a></li><li><a href="#5dockerfile_2208" rel="nofollow">（5）用dockerfile构建镜像</a></li><li><a href="#6_2225" rel="nofollow">（6）使用镜像创建容器</a></li><li><a href="#7_2278" rel="nofollow">（7）本地测试</a></li></ul> 
   </li><li><a href="#2mysqlRedisspringbootwar_2287" rel="nofollow">【2】案例二：部署包括mysql和Redis的springboot项目war包</a></li><li><ul><li><a href="#1_2290" rel="nofollow">（1）准备项目代码进行本地测试</a></li><li><a href="#2_2295" rel="nofollow">（2）修改项目代码的配置</a></li><li><a href="#3war_2299" rel="nofollow">（3）项目打成war包</a></li><li><a href="#4_2314" rel="nofollow">（4）启动各个容器</a></li><li><a href="#5mysql_2322" rel="nofollow">（5）导入项目的数据到mysql</a></li><li><a href="#6springboot_2327" rel="nofollow">（6）上传springboot项目到服务器，防火墙开放端口</a></li><li><a href="#7dockerfile_2335" rel="nofollow">（7）编写dockerfile文件</a></li><li><a href="#8dockerfile_2372" rel="nofollow">（8）用dockerfile构建镜像</a></li><li><a href="#9_2387" rel="nofollow">（9）使用镜像创建容器</a></li><li><a href="#10_2406" rel="nofollow">（10）本地测试</a></li></ul> 
   </li><li><a href="#3Dockerfile_2417" rel="nofollow">【3】案例三：用Dockerfile构建一个自定义镜像</a></li></ul> 
  </li><li><a href="#dockercompose_2492" rel="nofollow">【七】docker-compose</a></li><li><ul><li><a href="#1docker_2494" rel="nofollow">【1】介绍（docker容器太多了如何管理）</a></li><li><a href="#2_2503" rel="nofollow">【2】举例说明</a></li><li><a href="#3dockercomposeyml__2507" rel="nofollow">【3】docker-compose.yml 文件详解</a></li><li><ul><li><a href="#1_2509" rel="nofollow">（1）介绍</a></li><li><a href="#2version__2554" rel="nofollow">（2）version 版本信息</a></li><li><a href="#3services__2558" rel="nofollow">（3）services 定义服务</a></li><li><a href="#4image__2585" rel="nofollow">（4）image 镜像名称标签</a></li><li><a href="#5dockerfile__2595" rel="nofollow">（5）dockerfile 构建镜像</a></li><li><a href="#6container_name__2610" rel="nofollow">（6）container_name 容器名称</a></li><li><a href="#7depends_on__2622" rel="nofollow">（7）depends_on 容器依赖</a></li><li><a href="#8ports__2642" rel="nofollow">（8）ports 暴露端口</a></li><li><a href="#9expose__2651" rel="nofollow">（9）expose 接受端口范围</a></li><li><a href="#10restart__2661" rel="nofollow">（10）restart 重启策略</a></li><li><a href="#11environment__2679" rel="nofollow">（11）environment 环境变量</a></li><li><a href="#12command__2708" rel="nofollow">（12）command 执行命令</a></li><li><a href="#13volumes__2720" rel="nofollow">（13）volumes 目录挂载</a></li><li><a href="#14network_mode__2756" rel="nofollow">（14）network_mode 网络模式</a></li><li><a href="#15networks_2767" rel="nofollow">（15）networks</a></li><li><a href="#16aliases_2785" rel="nofollow">（16）aliases</a></li></ul> 
   </li><li><a href="#4compose_2804" rel="nofollow">【4】compose的概念和常用命令</a></li></ul> 
  </li><li><a href="#compose_3013" rel="nofollow">【八】compose的安装</a></li><li><ul><li><a href="#1_3014" rel="nofollow">【1】在线安装</a></li><li><a href="#2_3024" rel="nofollow">【2】离线安装</a></li></ul> 
  </li><li><a href="#Dockercompose_3043" rel="nofollow">【九】用Docker-compose完成项目部署的案例</a></li><li><ul><li><a href="#2ruoyi_3048" rel="nofollow">【2】ruoyi系统的容器化部署过程</a></li><li><ul><li><a href="#1Nacos_3050" rel="nofollow">（1）安装Nacos</a></li><li><a href="#2Nginx_3065" rel="nofollow">（2）安装Nginx</a></li><li><a href="#3Mysql8_3098" rel="nofollow">（3）安装Mysql8</a></li><li><a href="#4redis_3134" rel="nofollow">（4）安装redis</a></li><li><a href="#5_3150" rel="nofollow">（5）下载若依系统</a></li><li><a href="#6bootstrapyml_3155" rel="nofollow">（6）修改bootstrap.yml配置文件</a></li><li><a href="#7_3164" rel="nofollow">（7）打包</a></li><li><a href="#8dockerruoyi_3173" rel="nofollow">（8）操作项目文件里的文件/docker/ruoyi</a></li><li><a href="#9dockermysql_3180" rel="nofollow">（9）操作docker/mysql</a></li><li><a href="#10dockernacos_3188" rel="nofollow">（10）操作docker/nacos</a></li><li><a href="#11dockernginxconf_3192" rel="nofollow">（11）操作docker\nginx\conf</a></li><li><a href="#12dockernginxhtmldist_3199" rel="nofollow">（12）操作docker\nginx\html\dist这个文件</a></li><li><a href="#13dockerdockercomposeyml_3209" rel="nofollow">（13）操作docker下docker-compose.yml文件</a></li><li><a href="#14dockerlinux_3215" rel="nofollow">（14）将docker文件夹上传至linux</a></li><li><a href="#15_3218" rel="nofollow">（15）运行服务</a></li><li><a href="#16_3272" rel="nofollow">（16）检查一下启动结果</a></li><li><a href="#17_3293" rel="nofollow">（17）修改完配置后再次启动</a></li><li><a href="#18_3314" rel="nofollow">（18）启动出现问题</a></li></ul> 
  </li></ul> 
  </li><li><a href="#DockerJenkinsGit_3329" rel="nofollow">【十】基于Docker+Jenkins+Git的发布环境搭建</a></li><li><a href="#k8s_3332" rel="nofollow">【十】k8s学习笔记</a></li></ul> 
</div> 
<p></p> 
<h2><a id="MacCentOS_3"></a>【一】Mac版虚拟机CentOS搭建</h2> 
<h3><a id="1shellftp_4"></a>【1】shell和ftp工具选择</h3> 
<p>选择是的mac版termius</p> 
<h3><a id="2linux___ip_a__ip_addr__ifconfig_ip_7"></a>【2】linux 命令 ip a / ip addr / ifconfig 不显示ip问题</h3> 
<p>原因：CentOS 7.x 默认不开启网卡</p> 
<p>解决：修改ens33网卡配置文件</p> 
<h4><a id="1_ifcfgens33__ifcfgeth0_12"></a>（1）如果没有 ifcfg-ens33文件 修改 ifcfg-eth0</h4> 
<pre><code class="prism language-powershell">cd etc/sysconfig/network-scripts/

vi ifcfg-ens33
</code></pre> 
<p>vi ifcf-ens33 修改（ONBOOT=no）-&gt; （ONBOOT=yes）</p> 
<p><img src="https://images2.imgbox.com/3e/0b/fH1ZeQ88_o.png" alt="在这里插入图片描述">保存文件</p> 
<h4><a id="2_23"></a>（2）重启网关服务器</h4> 
<p>命令：systemctl restart network<br> 就可以了<br> <img src="https://images2.imgbox.com/8f/6a/zJI6RVLQ_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="Docker_30"></a>【二】Docker安装</h2> 
<h3><a id="1Docker_32"></a>【1】Docker的安装</h3> 
<h4><a id="1_34"></a>（1）查看系统的内核版本</h4> 
<pre><code class="prism language-powershell">uname <span class="token operator">-</span>r 4<span class="token punctuation">.</span>18<span class="token punctuation">.</span>0-80<span class="token punctuation">.</span>11<span class="token punctuation">.</span>2<span class="token punctuation">.</span>el8_0<span class="token punctuation">.</span>x86_64
</code></pre> 
<p>执行命令：uname -r<br> 注意：x86 64位系统，如果是32位是不能安装 docker 的</p> 
<h4><a id="2yum_42"></a>（2）yum更新到最新版本</h4> 
<pre><code class="prism language-powershell">sudo yum <span class="token operator">-</span>y update
</code></pre> 
<p>执行命令：sudo yum update<br> 注意：看到显示 Complete 就代表完成了，整个过程需要 5-10 分钟左右</p> 
<p>更新gcc（C语言的编译环境）</p> 
<pre><code class="prism language-powershell">yum <span class="token operator">-</span>y install gcc
yum <span class="token operator">-</span>y install gcc-c+<span class="token operator">+</span>
</code></pre> 
<h4><a id="3Docker_56"></a>（3）安装Docker所需的依赖包</h4> 
<pre><code class="prism language-powershell">sudo yum install <span class="token operator">-</span>y yum-utils device-mapper-persistent-<span class="token keyword">data</span> lvm2
</code></pre> 
<p>执行命令：sudo yum install -y yum-utils device-mapper-persistent-data lvm2<br> 注意：看到显示 Complete 就代表完成了，整个过程需要 1-3 分钟左右</p> 
<h4><a id="4Dockeryum_64"></a>（4）设置Docker的yum的源</h4> 
<pre><code class="prism language-powershell">yum-config-manager <span class="token operator">--</span><span class="token function">add-repo</span> http:<span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com/docker-ce/linux/centos/docker-ce<span class="token punctuation">.</span>repo
</code></pre> 
<h4><a id="5yum_71"></a>（5）更新yum软件包索引</h4> 
<pre><code class="prism language-powershell">yum makecache fast
</code></pre> 
<h4><a id="6Docker_77"></a>（6）查看仓库所有Docker版本</h4> 
<pre><code class="prism language-powershell">yum list docker-ce <span class="token operator">--</span>showduplicates <span class="token punctuation">|</span> <span class="token function">sort</span> <span class="token operator">-</span>r
</code></pre> 
<h4><a id="7Docker_83"></a>（7）安装Docker</h4> 
<p>安装默认最新版本的Docker</p> 
<pre><code class="prism language-powershell">yum <span class="token operator">-</span>y install docker-ce docker-ce-<span class="token function">cli</span> containerd<span class="token punctuation">.</span>io
</code></pre> 
<h4><a id="8Docker_90"></a>（8）启动Docker并添加开机自启动</h4> 
<p>启动Docker</p> 
<pre><code class="prism language-powershell">sudo systemctl <span class="token function">start</span> docker
</code></pre> 
<p>设置开机启动Docker</p> 
<pre><code class="prism language-powershell">systemctl enable docker
</code></pre> 
<p>重启docker</p> 
<pre><code class="prism language-powershell">systemctl restart docker
</code></pre> 
<p>停止docker</p> 
<pre><code class="prism language-powershell">systemctl stop docker
</code></pre> 
<h4><a id="9Docker_116"></a>（9）查看Docker版本</h4> 
<pre><code class="prism language-powershell">docker <span class="token operator">--</span>version
</code></pre> 
<h4><a id="10_122"></a>（10）测试</h4> 
<pre><code class="prism language-powershell"><span class="token function">ps</span> <span class="token operator">-</span>ef<span class="token punctuation">|</span>grep docker
</code></pre> 
<pre><code class="prism language-powershell">docker version
</code></pre> 
<h4><a id="11Docker_130"></a>（11）卸载Docker</h4> 
<pre><code class="prism language-powershell">systemctl stop docker
yum remove docker-ce docker-ce-<span class="token function">cli</span> containerd<span class="token punctuation">.</span>io
<span class="token function">rm</span> <span class="token operator">-</span>rf <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib/docker
<span class="token function">rm</span> <span class="token operator">-</span>rf <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib/containerd
</code></pre> 
<h4><a id="12Docker_139"></a>（12）Docker常用命令</h4> 
<pre><code class="prism language-powershell"><span class="token namespace">[root@CodeGuide ~]</span><span class="token comment"># docker --help				#Docker帮助</span>
<span class="token namespace">[root@CodeGuide ~]</span><span class="token comment"># docker --version			#查看Docker版本</span>
<span class="token namespace">[root@CodeGuide ~]</span><span class="token comment"># docker search &lt;image&gt;		#搜索镜像文件，如：docker search mysql</span>
<span class="token namespace">[root@CodeGuide ~]</span><span class="token comment"># docker pull &lt;image&gt;		#拉取镜像文件， 如：docker pull mysql</span>
<span class="token namespace">[root@CodeGuide ~]</span><span class="token comment"># docker images				#查看已经拉取下来的所以镜像文件</span>
<span class="token namespace">[root@CodeGuide ~]</span><span class="token comment"># docker rmi &lt;image&gt;		#删除指定镜像文件</span>
<span class="token namespace">[root@CodeGuide ~]</span><span class="token comment"># docker run --name &lt;name&gt; -p 80:8080 -d &lt;image&gt;		#发布指定镜像文件</span>
<span class="token namespace">[root@CodeGuide ~]</span><span class="token comment"># docker ps					#查看正在运行的所有镜像</span>
<span class="token namespace">[root@CodeGuide ~]</span><span class="token comment"># docker ps -a				#查看所有发布的镜像</span>
<span class="token namespace">[root@CodeGuide ~]</span><span class="token comment"># docker rm &lt;image&gt;			#删除执行已发布的镜像</span>
</code></pre> 
<h4><a id="13_155"></a>（13）如何创建自启动的容器</h4> 
<p>（1）还没run创建容器的<br> 使用 docker run 命令运行时，增加 --restart=always 参数即可</p> 
<p>（2）已运行的容器修改其自启动策略<br> 执行命令：<br> docker update --restart=always 容器名或容器ID<br> docker container update --restart=【容器策略】 容器名称</p> 
<pre><code class="prism language-powershell"><span class="token comment"># no 容器退出时不重启容器</span>
<span class="token comment"># on-failure 只有在非零状态退出时才重新启动容器</span>
<span class="token operator">--</span>restart=on-failure:【重启次数】
<span class="token comment"># always 无论退出状态如何都</span>
</code></pre> 
<h3><a id="2_172"></a>【2】阿里云镜像加速</h3> 
<h4><a id="1_174"></a>（1）获取阿里云加速器地址</h4> 
<p>登陆阿里云，点击控制台，然后点击菜单，找到“容器镜像服务”<br> <img src="https://images2.imgbox.com/72/32/Kn9Eh5TY_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-YRAD3MdN-1672584376343)(evernotecid://9B99E324-7852-4A64-95A3-727CD2F9CB64/appyinxiangcom/12234224/ENResource/p1677)]"></p> 
<p>创建个人容器镜像托管服务</p> 
<p>然后点击镜像工具，进入镜像加速器，即可看到阿里云加速器地址，把这个加速器地址配置到docker容器里<br> <img src="https://images2.imgbox.com/b9/e5/8avkjszj_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2_186"></a>（2）创建文件夹并执行脚本</h4> 
<p>先创建文件夹</p> 
<pre><code class="prism language-powershell">mkdir <span class="token operator">-</span>p <span class="token operator">/</span>etc/docker
</code></pre> 
<p>执行脚本</p> 
<pre><code class="prism language-powershell"><span class="token function">tee</span> <span class="token operator">/</span>etc/docker/daemon<span class="token punctuation">.</span>json &lt;&lt;<span class="token operator">-</span><span class="token string">'EOF'</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"registry-mirrors"</span>: <span class="token punctuation">[</span><span class="token string">"https://xqybwad5.mirror.aliyuncs.com"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
EOF
</code></pre> 
<h4><a id="3_200"></a>（3）重新加载配置文件</h4> 
<pre><code class="prism language-powershell">systemctl daemon-reload
</code></pre> 
<h4><a id="4docker_204"></a>（4）重新启动docker</h4> 
<pre><code class="prism language-powershell">systemctl restart docker
</code></pre> 
<h4><a id="5_daemonjson__208"></a>（5）查看 daemon.json 是否已经生效了</h4> 
<pre><code class="prism language-powershell">tail <span class="token operator">/</span>etc/docker/daemon<span class="token punctuation">.</span>json
</code></pre> 
<p><img src="https://images2.imgbox.com/ce/4e/BtAs5IXc_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-w2MT66LX-1672584376344)(evernotecid://9B99E324-7852-4A64-95A3-727CD2F9CB64/appyinxiangcom/12234224/ENResource/p1679)]"></p> 
<h2><a id="_215"></a>【三】环境容器的搭建</h2> 
<h3><a id="1Portainer_217"></a>【1】安装Portainer</h3> 
<h4><a id="1Portainer_219"></a>（1）拉取最新的Portainer镜像</h4> 
<pre><code class="prism language-powershell">docker pull portainer/portainer
</code></pre> 
<h4><a id="29000_225"></a>（2）运行镜像（9000）</h4> 
<pre><code class="prism language-powershell">docker run <span class="token operator">-</span>d <span class="token operator">-</span>p 9000:9000 <span class="token operator">-</span>v <span class="token operator">/</span>root/portainer:<span class="token operator">/</span><span class="token keyword">data</span> <span class="token operator">-</span>v <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>run/docker<span class="token punctuation">.</span>sock:<span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>run/docker<span class="token punctuation">.</span>sock <span class="token operator">--</span>name dev-portainer portainer/portainer
</code></pre> 
<p>或者</p> 
<pre><code class="prism language-powershell">docker run <span class="token operator">-</span>d <span class="token operator">--</span>restart=always <span class="token operator">--</span>name portainer <span class="token operator">-</span>p 9000:9000 <span class="token operator">-</span>v <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>run/docker<span class="token punctuation">.</span>sock:<span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>run/docker<span class="token punctuation">.</span>sock portainer/portainer
</code></pre> 
<p>参数说明：</p> 
<blockquote> 
 <p>-d #容器在后台运行<br> -p 9000:9000 # 宿主机9000端口映射容器中的9000端口<br> -v /var/run/docker.sock:/var/run/docker.sock # 把宿主机的Docker守护进程(docker daemon)默认监听的Unix域套接字挂载到容器中<br> -v /root/portainer:/data # 把宿主机目录 /root/portainer 挂载到容器 /data 目录；<br> –name dev-portainer # 指定运行容器的名称</p> 
</blockquote> 
<p>注意：在启动容器时必须挂载本地 /var/run/docker.socker与容器内的/var/run/docker.socker连接。</p> 
<h4><a id="3Portainer_248"></a>（3）访问Portainer可视化界面</h4> 
<p>（1）浏览器中输入：服务器的ip地址:9000，访问portainer可视化界面<br> 第一次会弹出安装界面，配置账号密码、选择是本地Docker还是远程Docker，一般我们选择本地Docker，也就是local，可以查看宿主机配置信息、查看容器、镜像、网络、卷等相关信息。</p> 
<p><img src="https://images2.imgbox.com/19/0f/3HWlq1s5_o.png" alt="在这里插入图片描述"><br> （2）创建登录账号和密码<br> <img src="https://images2.imgbox.com/c5/c4/85KG5sy8_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/4a/8a/sefw0DHf_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/7f/99/RW9Qnjmf_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="4_263"></a>（4）一些问题的解决</h4> 
<p>（1）镜像错误，停掉&amp;删除&amp;重新创建<br> docker ps 查看正在运行的镜像<br> docker stop 镜像id 停止正在运行的镜像<br> docker rm 镜像id 停止正在运行的镜像<br> （2）9000端口访问不到，测试是否启动成功，以及关闭防火墙<br> 在主机上访问映射了Portainer容器的端口，看容器是否正常运行<br> curl localhost:9000</p> 
<p>由图可知能通过curl命令正常访问8088端口</p> 
<p>关闭所有防火墙<br> service firewalld status<br> service firewalld stop<br> （3）</p> 
<h3><a id="2JDK8_280"></a>【2】安装JDK8</h3> 
<p>（1）查找JDK</p> 
<pre><code class="prism language-powershell">docker search jdk
</code></pre> 
<p><img src="https://images2.imgbox.com/97/51/F71CBdH3_o.png" alt="在这里插入图片描述"><br> （2）拉取JDK1.8镜像<br> 从上面列表里选取一个拉取</p> 
<pre><code class="prism language-powershell">docker pull java
</code></pre> 
<p>（3）查看下载的镜像</p> 
<pre><code class="prism language-powershell">docker images
</code></pre> 
<p><img src="https://images2.imgbox.com/f7/1c/LC4R3pEW_o.png" alt="在这里插入图片描述"><br> （4）启动JDK镜像</p> 
<pre><code class="prism language-powershell">docker run <span class="token operator">-</span>di <span class="token operator">--</span>name=jdk8 java
</code></pre> 
<p>（5）查看镜像运行情况</p> 
<pre><code class="prism language-powershell">docker <span class="token function">ps</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/bb/97/5XcJ5Ovh_o.png" alt="在这里插入图片描述"><br> （6）进入镜像</p> 
<pre><code class="prism language-powershell">docker exec <span class="token operator">-</span>it jdk8 <span class="token operator">/</span>bin/bash
</code></pre> 
<p>查看jdk版本<br> <img src="https://images2.imgbox.com/c1/8d/N2k0vkZv_o.png" alt="在这里插入图片描述"><br> 退出镜像</p> 
<pre><code class="prism language-powershell"><span class="token keyword">exit</span>
</code></pre> 
<p>（7）镜像的运维<br> 停止镜像：docker stop jdk8<br> 启动镜像：docker start jdk8<br> 重启镜像：docker restart jdk8<br> 删除容器：</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 1.查看历史所有容器</span>
docker <span class="token function">ps</span> <span class="token operator">-</span>a
<span class="token comment"># 2.删除容器</span>
docker <span class="token function">rm</span> 容器id
</code></pre> 
<h3><a id="3redis_340"></a>【3】安装redis</h3> 
<h4><a id="1redis_342"></a>（1）拉取redis镜像</h4> 
<pre><code class="prism language-powershell">docker pull redis:6<span class="token punctuation">.</span>0<span class="token punctuation">.</span>8
</code></pre> 
<h4><a id="2appredis_347"></a>（2）在宿主机下新建目录/app/redis</h4> 
<p>在 SFTP 工具链接的云服务器中创建文件夹 /data/redis、/data/redis/data 你也可以在云服务器的控制台使用命令进行创建</p> 
<pre><code class="prism language-powershell">sudo mkdir <span class="token operator">-</span>p <span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>redis
sudo mkdir <span class="token operator">-</span>p <span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>redis/<span class="token keyword">data</span>
</code></pre> 
<p>把修改后的 redis.conf 文件通过 SFTP 上传到 /data/redis 文件夹下<br> <img src="https://images2.imgbox.com/29/24/1L314inr_o.png" alt="在这里插入图片描述"><br> 新建一个redis.conf</p> 
<pre><code class="prism language-powershell">touch redis<span class="token punctuation">.</span>conf
</code></pre> 
<p>也可以复制一个进去，下载地址：<a href="https://gitcode.net/KnowledgePlanet/Lottery/-/blob/master/doc/assets/redis/redis.conf" rel="nofollow">redis.conf</a></p> 
<p>注意的是redis.conf里的内容要修改<br> 【必须】bind 127.0.0.1 把#号注释掉这部分，使redis可以外部访问<br> 【必须】daemonize 修改为no 用守护线程的方式启动<br> 【必须】requirepass 设置你的Redis链接密码（也可以不设置）<br> 【必须】appendonly 修改为yes，redis持久化　　默认是no<br> 【可选】tcp-keepalive 300 防止出现远程主机强迫关闭了一个现有的连接的错误 默认是300</p> 
<pre><code class="prism language-powershell"><span class="token comment">#关闭保护，用于测试</span>
protected-mode no
port 6379
</code></pre> 
<h4><a id="3redis6379_376"></a>（3）启动redis（6379）</h4> 
<pre><code class="prism language-powershell">docker run <span class="token operator">-</span>p 6379:6379 <span class="token operator">--</span>name redis6 <span class="token operator">-</span>v <span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>redis/redis<span class="token punctuation">.</span>conf:<span class="token operator">/</span>etc/redis/redis<span class="token punctuation">.</span>conf  <span class="token operator">-</span>v <span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>redis/<span class="token keyword">data</span>:<span class="token operator">/</span><span class="token keyword">data</span> <span class="token operator">-</span>d redis:6<span class="token punctuation">.</span>0<span class="token punctuation">.</span>8 redis-server <span class="token operator">/</span>etc/redis/redis<span class="token punctuation">.</span>conf <span class="token operator">--</span>appendonly yes
</code></pre> 
<p>解释</p> 
<pre><code class="prism language-powershell"><span class="token operator">-</span>p 6379:6379:把容器内的6379端口映射到宿主机6379端口
<span class="token operator">-</span>v <span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>redis/redis<span class="token punctuation">.</span>conf:<span class="token operator">/</span>etc/redis/redis<span class="token punctuation">.</span>conf：把宿主机配置好的redis<span class="token punctuation">.</span>conf放到容器内的这个位置中
<span class="token operator">-</span>v <span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>redis/<span class="token keyword">data</span>:<span class="token operator">/</span><span class="token keyword">data</span>：把redis持久化的数据在宿主机内显示，做数据备份
redis-server <span class="token operator">/</span>etc/redis/redis<span class="token punctuation">.</span>conf：这个是关键配置，让redis不是无配置启动，而是按照这个redis<span class="token punctuation">.</span>conf的配置启动
–appendonly yes：redis启动后数据持久化
</code></pre> 
<p>查看</p> 
<pre><code class="prism language-powershell">sudo docker <span class="token function">ps</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/47/6a/xXoM8ixY_o.png" alt="在这里插入图片描述"></p> 
<p>查看日志</p> 
<pre><code class="prism language-powershell">sudo docker logs redis6
</code></pre> 
<p><img src="https://images2.imgbox.com/9e/a1/pS6SrMfU_o.png" alt="在这里插入图片描述"><br> 没有报错，启动成功</p> 
<h4><a id="4Portainer_410"></a>（4）查看Portainer的页面</h4> 
<p><img src="https://images2.imgbox.com/b7/17/W1R64CoI_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="5RDMredis_412"></a>（5）使用本地RDM链接redis</h4> 
<p>这个时候你可能还是链接不上云服务器中的 Redis 服务，那么需要设置下防火墙，默认情况下可能你的防火墙并没有开启，需要手动执行：<br> 1-启动防火墙 systemctl start firewalld<br> 2-设置Redis 6379 端口：firewall-cmd --zone=public --add-port=6379/tcp --permanent<br> 3-设置Portainer 9000 端口：firewall-cmd --zone=public --add-port=9000/tcp --permanent<br> 4-重新加载：firewall-cmd --reload</p> 
<p>配置redis<br> <img src="https://images2.imgbox.com/70/a9/lOro4VHs_o.png" alt="在这里插入图片描述"><br> 测试redis<br> <img src="https://images2.imgbox.com/3b/73/VUy8tbtr_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="6redisredis_426"></a>（6）使用redis容器的终端链接redis</h4> 
<pre><code class="prism language-powershell">docker exec <span class="token operator">-</span>it redis6 <span class="token operator">/</span>bin/bash
</code></pre> 
<p><img src="https://images2.imgbox.com/dc/a8/WXYbVWBi_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="7_432"></a>（7）运维命令</h4> 
<p>（1）删除已经启动的镜像（假如多启动了一个名字为redis）<br> 停止镜像：docker stop redis<br> 删除镜像：docker rm -rf 镜像id<br> 删除容器：docker rmi 镜像id</p> 
<p>（2）启动redis：docker start redis6<br> （3）重启redis：docker restart redis6</p> 
<h3><a id="5redis_443"></a>【5】安装redis集群</h3> 
<h4><a id="1_444"></a>（1）面试题</h4> 
<p>1-2亿条数据需要缓存，请问如何设计这个存储案例？<br> 单机单台100%不可能，肯定是分布式存储，用redis如何落地？既然是分布式，那么一个数据落在哪一台服务器上？能不能保证下次读的时候也是从那一台服务器上读出来？</p> 
<p>2亿条记录就是2亿个k-v，我们单机不行，必须要分布式多机，假设有3台机器构成一个集群，用户每次读写操作都是根据公式：hash(key)%N个机器台数，计算出哈希值，用来决定数据映射到哪一个节点上。</p> 
<p>（1）哈希取余分区<br> <img src="https://images2.imgbox.com/43/c8/cuGB5NCk_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/73/51/1f1TVZ40_o.png" alt="在这里插入图片描述">（2）一致性哈希算法分区<br> <img src="https://images2.imgbox.com/19/c9/0xes01cl_o.png" alt="在这里插入图片描述">（3）哈希槽分区</p> 
<h4><a id="2redis_454"></a>（2）搭建三主三从redis集群</h4> 
<p>（1）新建6个docker容器实例</p> 
<pre><code class="prism language-powershell">docker run <span class="token operator">-</span>d <span class="token operator">--</span>name redis-node-1 <span class="token operator">--</span>net host <span class="token operator">--</span>privileged=true <span class="token operator">-</span>v <span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>redis/share/redis-node-1:<span class="token operator">/</span><span class="token keyword">data</span> redis:6<span class="token punctuation">.</span>0<span class="token punctuation">.</span>8 <span class="token operator">--</span>cluster-enabled yes <span class="token operator">--</span>appendonly yes <span class="token operator">--</span>port 6381

docker run <span class="token operator">-</span>d <span class="token operator">--</span>name redis-node-2 <span class="token operator">--</span>net host <span class="token operator">--</span>privileged=true <span class="token operator">-</span>v <span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>redis/share/redis-node-2:<span class="token operator">/</span><span class="token keyword">data</span> redis:6<span class="token punctuation">.</span>0<span class="token punctuation">.</span>8 <span class="token operator">--</span>cluster-enabled yes <span class="token operator">--</span>appendonly yes <span class="token operator">--</span>port 6382

docker run <span class="token operator">-</span>d <span class="token operator">--</span>name redis-node-3 <span class="token operator">--</span>net host <span class="token operator">--</span>privileged=true <span class="token operator">-</span>v <span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>redis/share/redis-node-3:<span class="token operator">/</span><span class="token keyword">data</span> redis:6<span class="token punctuation">.</span>0<span class="token punctuation">.</span>8 <span class="token operator">--</span>cluster-enabled yes <span class="token operator">--</span>appendonly yes <span class="token operator">--</span>port 6383

docker run <span class="token operator">-</span>d <span class="token operator">--</span>name redis-node-4 <span class="token operator">--</span>net host <span class="token operator">--</span>privileged=true <span class="token operator">-</span>v <span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>redis/share/redis-node-4:<span class="token operator">/</span><span class="token keyword">data</span> redis:6<span class="token punctuation">.</span>0<span class="token punctuation">.</span>8 <span class="token operator">--</span>cluster-enabled yes <span class="token operator">--</span>appendonly yes <span class="token operator">--</span>port 6384

docker run <span class="token operator">-</span>d <span class="token operator">--</span>name redis-node-5 <span class="token operator">--</span>net host <span class="token operator">--</span>privileged=true <span class="token operator">-</span>v <span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>redis/share/redis-node-5:<span class="token operator">/</span><span class="token keyword">data</span> redis:6<span class="token punctuation">.</span>0<span class="token punctuation">.</span>8 <span class="token operator">--</span>cluster-enabled yes <span class="token operator">--</span>appendonly yes <span class="token operator">--</span>port 6385

docker run <span class="token operator">-</span>d <span class="token operator">--</span>name redis-node-6 <span class="token operator">--</span>net host <span class="token operator">--</span>privileged=true <span class="token operator">-</span>v <span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>redis/share/redis-node-6:<span class="token operator">/</span><span class="token keyword">data</span> redis:6<span class="token punctuation">.</span>0<span class="token punctuation">.</span>8 <span class="token operator">--</span>cluster-enabled yes <span class="token operator">--</span>appendonly yes <span class="token operator">--</span>port 6386
</code></pre> 
<p><img src="https://images2.imgbox.com/e2/3d/5z4MxnfG_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/1c/97/JOshnGLj_o.png" alt="在这里插入图片描述"><br> （2）进入容器redis-node-1并为6台机器构建集群关系</p> 
<pre><code class="prism language-powershell">docker exec <span class="token operator">-</span>it redis-node-1 <span class="token operator">/</span>bin/bash
</code></pre> 
<pre><code class="prism language-powershell">redis-<span class="token function">cli</span> <span class="token operator">--</span>cluster create 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>19<span class="token punctuation">.</span>11:6381 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>19<span class="token punctuation">.</span>11:6382 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>19<span class="token punctuation">.</span>11:6383 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>19<span class="token punctuation">.</span>11:6384 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>19<span class="token punctuation">.</span>11:6385 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>19<span class="token punctuation">.</span>11:6386 <span class="token operator">--</span>cluster-replicas 1
</code></pre> 
<p>–cluster-replicas 1 表示为每个master创建一个slave节点</p> 
<p><img src="https://images2.imgbox.com/d0/a6/wOmS3JhJ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/bd/6c/FgoFIkuV_o.png" alt="在这里插入图片描述"><br> （3）链接进入6381作为切入点，查看节点状态</p> 
<pre><code class="prism language-powershell">redis-<span class="token function">cli</span> <span class="token operator">-</span>p 6381
</code></pre> 
<pre><code class="prism language-powershell">cluster info
</code></pre> 
<p><img src="https://images2.imgbox.com/05/fe/KSULdk3U_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/98/0e/aBa64KgJ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/0a/a2/Bi7DO0l4_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="3_500"></a>（3）主从容错切换迁移案例</h4> 
<p>（1）数据读写存储<br> 首先进入6381，尝试存储数据，发现有的数据槽位超过了6381分配的槽位，那么就会报错</p> 
<pre><code class="prism language-powershell">docker exec <span class="token operator">-</span>it redis-node-1 <span class="token operator">/</span>bin/bash
</code></pre> 
<p>单机模式连接</p> 
<pre><code class="prism language-powershell">redis-<span class="token function">cli</span> <span class="token operator">-</span>p 6381
</code></pre> 
<p><img src="https://images2.imgbox.com/e3/d6/c1LvATbX_o.png" alt="在这里插入图片描述">改成用集群方式连接，优化路由</p> 
<pre><code class="prism language-powershell">redis-<span class="token function">cli</span> <span class="token operator">-</span>p 6381 <span class="token operator">-</span>c
</code></pre> 
<p><img src="https://images2.imgbox.com/7d/ab/YvQxbzNJ_o.png" alt="在这里插入图片描述">（2）容错切换迁移（测试主从切换）<br> 首先在6381主机中查看集群信息<br> <img src="https://images2.imgbox.com/a4/5d/RQ17gGsF_o.png" alt="在这里插入图片描述">停掉6381主机<br> <img src="https://images2.imgbox.com/32/be/fWL1096a_o.png" alt="在这里插入图片描述">重新进入6382</p> 
<pre><code class="prism language-powershell">docker exec <span class="token operator">-</span>it redis-node-2 <span class="token operator">/</span>bin/bash
redis-<span class="token function">cli</span> <span class="token operator">-</span>p 6382 <span class="token operator">-</span>c
</code></pre> 
<p>查看集群信息，可以看到原来的6386从机已经变成了主机<br> <img src="https://images2.imgbox.com/7f/62/6A6iz44U_o.png" alt="在这里插入图片描述">把6381启动以后，6381变成了新的从机，要想把6381重新变为主机，可以把现在6386停掉再重启</p> 
<h4><a id="4_530"></a>（4）主从扩容案例</h4> 
<p>（1）新建6387、6388两个节点，新建后启动，查看是否是8个节点</p> 
<pre><code class="prism language-powershell">docker run <span class="token operator">-</span>d <span class="token operator">--</span>name redis-node-7 <span class="token operator">--</span>net host <span class="token operator">--</span>privileged=true <span class="token operator">-</span>v <span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>redis/share/redis-node-7:<span class="token operator">/</span><span class="token keyword">data</span> redis:6<span class="token punctuation">.</span>0<span class="token punctuation">.</span>8 <span class="token operator">--</span>cluster-enabled yes <span class="token operator">--</span>appendonly yes <span class="token operator">--</span>port 6387

docker run <span class="token operator">-</span>d <span class="token operator">--</span>name redis-node-8 <span class="token operator">--</span>net host <span class="token operator">--</span>privileged=true <span class="token operator">-</span>v <span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>redis/share/redis-node-8:<span class="token operator">/</span><span class="token keyword">data</span> redis:6<span class="token punctuation">.</span>0<span class="token punctuation">.</span>8 <span class="token operator">--</span>cluster-enabled yes <span class="token operator">--</span>appendonly yes <span class="token operator">--</span>port 6388

docker <span class="token function">ps</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/30/f4/as5eYp03_o.png" alt="在这里插入图片描述"><br> （2）进入6387容器实例内部</p> 
<pre><code class="prism language-powershell">docker exec <span class="token operator">-</span>it redis-node-7 <span class="token operator">/</span>bin/bash
</code></pre> 
<p>（3）把新增的6387节点（空槽位）作为master节点加入原集群<br> 把新增的6387作为master节点加入集群，6381就是原来集群节点里面的领路人，相当于6387拜拜6381的码头从而找到组织加入集群</p> 
<pre><code class="prism language-powershell">redis-<span class="token function">cli</span> <span class="token operator">--</span>cluster <span class="token function">add-node</span> 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>19<span class="token punctuation">.</span>11:6387 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>19<span class="token punctuation">.</span>11:6381
</code></pre> 
<p><img src="https://images2.imgbox.com/9f/72/aWxG3RSV_o.png" alt="在这里插入图片描述">（4）第1次检查集群情况</p> 
<pre><code class="prism language-powershell">redis-<span class="token function">cli</span> <span class="token operator">--</span>cluster check 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>19<span class="token punctuation">.</span>11:6381
</code></pre> 
<p><img src="https://images2.imgbox.com/86/67/nAl4LfFh_o.png" alt="在这里插入图片描述"><br> （5）重新分派槽号给6387</p> 
<pre><code class="prism language-powershell">redis-<span class="token function">cli</span> <span class="token operator">--</span>cluster reshard 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>19<span class="token punctuation">.</span>11:6387
</code></pre> 
<p>给新分配4096个槽位<br> <img src="https://images2.imgbox.com/da/3a/19mFUMDx_o.png" alt="在这里插入图片描述">然后输入all，从每一个槽位上取一些过来</p> 
<p>（6）第2次检查集群情况</p> 
<pre><code class="prism language-powershell">redis-<span class="token function">cli</span> <span class="token operator">--</span>cluster check 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>19<span class="token punctuation">.</span>11:6381
</code></pre> 
<p><img src="https://images2.imgbox.com/43/d8/ZHfvBWjl_o.png" alt="在这里插入图片描述"><br> （7）为主节点6387分配从节点6388<br> 最后的编号是6387的编号</p> 
<pre><code class="prism language-powershell">redis-<span class="token function">cli</span> <span class="token operator">--</span>cluster <span class="token function">add-node</span> 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>19<span class="token punctuation">.</span>11:6388 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>19<span class="token punctuation">.</span>11:6387 <span class="token operator">--</span>cluster-slave <span class="token operator">--</span>cluster-master-id 9322efd4b8f57d0c01fccc2d2ba310021781f74f
</code></pre> 
<p>（8）第3次检查集群情况</p> 
<pre><code class="prism language-powershell">redis-<span class="token function">cli</span> <span class="token operator">--</span>cluster check 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>19<span class="token punctuation">.</span>11:6381
</code></pre> 
<p><img src="https://images2.imgbox.com/16/d2/qdaZuD0x_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="5_586"></a>（5）主从缩容案例</h4> 
<p>（1）检查集群情况1获取6388的节点ID</p> 
<pre><code>redis-cli --cluster check 192.168.19.11:6382
</code></pre> 
<p>（2）把6388删除，从集群中把4号从节点6388删除<br> 最后跟的节点ID就是6388的节点ID</p> 
<pre><code>redis-cli --cluster del-node 192.168.19.11:6388 2e4ec79d0731b36c01a8d3739e30c67551b76eeb
</code></pre> 
<p>（3）把6387的槽号清空，重新分配，本例把清出来的槽号都给6381</p> 
<pre><code>redis-cli --cluster reshard 192.168.19.11:6381
</code></pre> 
<p><img src="https://images2.imgbox.com/50/2b/blyPqxcp_o.png" alt="在这里插入图片描述"><br> 然后输出done表示结束<br> <img src="https://images2.imgbox.com/24/9e/Zdgmdvaw_o.png" alt="在这里插入图片描述"><br> （4）第2次检查集群情况</p> 
<pre><code>redis-cli --cluster check 192.168.19.11:6382
</code></pre> 
<p><img src="https://images2.imgbox.com/5f/d9/M9lYCoOT_o.png" alt="在这里插入图片描述">（5）把6387删除<br> 最后跟的节点ID就是6387的节点ID</p> 
<pre><code>redis-cli --cluster del-node 192.168.19.11:6387 9322efd4b8f57d0c01fccc2d2ba310021781f74f
</code></pre> 
<p>（6）第3次检查集群情况</p> 
<pre><code>redis-cli --cluster check 192.168.19.11:6382
</code></pre> 
<p>可以看到没有6387的节点了</p> 
<p><img src="https://images2.imgbox.com/f6/21/61AL5C0o_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="6kafka_631"></a>【6】安装kafka</h3> 
<h4><a id="1_633"></a>（1）下载镜像</h4> 
<pre><code class="prism language-powershell">docker pull wurstmeister/kafka
docker pull wurstmeister/zookeeper
</code></pre> 
<h4><a id="2zookeeper2181_641"></a>（2）启动zookeeper（2181）</h4> 
<pre><code class="prism language-powershell">docker run <span class="token operator">-</span>d <span class="token operator">--</span>name zookeeper <span class="token operator">-</span>p 2181:2181 <span class="token operator">-</span>t wurstmeister/zookeeper
</code></pre> 
<h4><a id="3kafka9092_647"></a>（3）启动kafka（9092）</h4> 
<pre><code class="prism language-powershell">docker run <span class="token operator">-</span>d <span class="token operator">--</span>name kafka \
<span class="token operator">-</span>p 9092:9092 \
<span class="token operator">-</span>e KAFKA_BROKER_ID=0 \
<span class="token operator">-</span>e KAFKA_ZOOKEEPER_CONNECT=换成你的服务器IP:2181 \
<span class="token operator">-</span>e KAFKA_ADVERTISED_LISTENERS=PLAINTEXT:<span class="token operator">/</span><span class="token operator">/</span>换成你的服务器IP:9092 \
<span class="token operator">-</span>e KAFKA_LISTENERS=PLAINTEXT:<span class="token operator">/</span><span class="token operator">/</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0:9092 wurstmeister/kafka
</code></pre> 
<p>把这个整体命令复制到后台运行，运行前要把服务器IP换成你的</p> 
<h4><a id="4_661"></a>（4）防火墙设置</h4> 
<p>这里我们需要把 Zookeeper、Kafka 的端口对外开放；<br> 1-设置zk 2181 端口：firewall-cmd --zone=public --add-port=2181/tcp --permanent<br> 2-设置Kafka 9092 端口：firewall-cmd --zone=public --add-port=9092/tcp --permanent<br> 3-重新加载：firewall-cmd --reload</p> 
<h4><a id="5kafka_667"></a>（5）kafka日志</h4> 
<p><img src="https://images2.imgbox.com/36/9c/ixaLM1YE_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/dd/f8/rbhaMjDE_o.png" alt="在这里插入图片描述">在 Docker 容器中可以点击 Kafka 进入日志查看和控制台操作</p> 
<h4><a id="6Kafka__670"></a>（6）Kafka 控制台操作</h4> 
<p><img src="https://images2.imgbox.com/d1/ce/SeORCkAb_o.png" alt="在这里插入图片描述"><br> 在 Kafka 控制台可以操作配置文件，查看日志，添加Topic</p> 
<p>创建topic lottery_activity_partake</p> 
<pre><code class="prism language-powershell">in/kafka-topics<span class="token punctuation">.</span>sh <span class="token operator">--</span>create <span class="token operator">--</span>zookeeper 172<span class="token punctuation">.</span>17<span class="token punctuation">.</span>0<span class="token punctuation">.</span>3:2181 <span class="token operator">--</span>replication-factor 1 <span class="token operator">--</span>partitions 1 <span class="token operator">--</span>topic lottery_activity_partake
</code></pre> 
<p>创建topic lottery_invoice</p> 
<pre><code class="prism language-powershell">bin/kafka-topics<span class="token punctuation">.</span>sh <span class="token operator">--</span>create <span class="token operator">--</span>zookeeper 172<span class="token punctuation">.</span>17<span class="token punctuation">.</span>0<span class="token punctuation">.</span>3:2181 <span class="token operator">--</span>replication-factor 1 <span class="token operator">--</span>partitions 1 <span class="token operator">--</span>topic lottery_invoice
</code></pre> 
<p>创建Topic的时候，地址需要换成自己zookeeper的地址</p> 
<h4><a id="7_686"></a>（7）待补充</h4> 
<p>客户端操作<br> 图形化管理工具</p> 
<h3><a id="7mysql3306_690"></a>【7】安装mysql（3306）</h3> 
<p>（1）拉取镜像：docker pull mysql:5.7<br> （2）查看本地镜像：docker images<br> （3）创建一个mysql容器，首先在根目录下创建好一个文件夹allenuse<br> <img src="https://images2.imgbox.com/8c/d3/aQ6ZROpA_o.png" alt="在这里插入图片描述"></p> 
<p>（4）运行容器：docker run -d -p 3306:3306 --privileged=true -v /allenuse/mysql/log:/var/log/mysql -v /allenuse/mysql/data:/var/lib/mysql -v /allenuse/mysql/conf:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=123456 --name mysql5 mysql:5.7</p> 
<p>如果报错的话，可能是端口3306被占用了，就用下面的命令解决<br> 1-先查看当前占用端口：netstat -tanlp<br> 2-杀死对应的进程：kill 1330<br> <img src="https://images2.imgbox.com/37/87/X6ByF0Mg_o.png" alt="在这里插入图片描述">（5）查看是否创建成功<br> 1-查看容器：docker ps 或者 docker ps -a<br> 2-查看启动日志：docker logs mysql5</p> 
<p>（6）新建my.cnf，通过容器卷同步给mysql容器实例（解决中文乱码问题）</p> 
<pre><code class="prism language-powershell">cd <span class="token operator">/</span>allenuse/mysql/conf/

vi my<span class="token punctuation">.</span>cnf
</code></pre> 
<p><img src="https://images2.imgbox.com/4b/12/S5lduF08_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-powershell"><span class="token namespace">[client]</span>
default_character_set=utf8
<span class="token namespace">[mysqld]</span>
collation_server = utf8_general_ci
character_set_server = utf8
</code></pre> 
<p>（7）重启mysql容器实例，再重新进入并查看字符编码<br> 1-重启：docker restart mysql5<br> 2-查看字符编码：docker exec -it mysql5 /bin/bash</p> 
<p><img src="https://images2.imgbox.com/3b/5a/jnrMjqBD_o.png" alt="在这里插入图片描述">（8）新建库新建表再插入中文测试</p> 
<p>（9）如果不小心把mysql的容器删除了如何恢复<br> 之前已经配置了容器卷，mysql的数据已经在本地存储了，只需要重新执行创建容器的命令就行了</p> 
<pre><code class="prism language-powershell">docker run <span class="token operator">-</span>d <span class="token operator">-</span>p 3306:3306 <span class="token operator">--</span>privileged=true <span class="token operator">-</span>v <span class="token operator">/</span>allenuse/mysql/log:<span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>log/mysql <span class="token operator">-</span>v <span class="token operator">/</span>allenuse/mysql/<span class="token keyword">data</span>:<span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib/mysql <span class="token operator">-</span>v <span class="token operator">/</span>allenuse/mysql/conf:<span class="token operator">/</span>etc/mysql/conf<span class="token punctuation">.</span>d <span class="token operator">-</span>e MYSQL_ROOT_PASSWORD=123456 <span class="token operator">--</span>name mysql5 mysql:5<span class="token punctuation">.</span>7
</code></pre> 
<p>（10）防火墙设置<br> 1-设置mysql 3306 端口：firewall-cmd --zone=public --add-port=3306/tcp --permanent<br> 2-重新加载：firewall-cmd --reload</p> 
<p>（11）本地连接<br> <img src="https://images2.imgbox.com/6a/b0/ZePpcx2s_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/80/9a/HzWG2HAG_o.png" alt="在这里插入图片描述"><br> （12）如果3306端口被占用了怎么处理<br> 1-先查看当前占用端口：netstat -tanlp<br> 2-杀死对应的进程：kill 1330</p> 
<h3><a id="8mysql_750"></a>【8】安装mysql主从复制</h3> 
<h4><a id="13307_751"></a>（1）新建主服务器容器实例3307</h4> 
<pre><code>docker run -p 3307:3306 --name mysql-master -v /mydata/mysql-master/log:/var/log/mysql -v /mydata/mysql-master/data:/var/lib/mysql -v /mydata/mysql-master/conf:/etc/mysql -e MYSQL_ROOT_PASSWORD=root -d mysql:5.7
</code></pre> 
<p><img src="https://images2.imgbox.com/4c/f6/1wnr672r_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2mydatamysqlmasterconfmycnf_756"></a>（2）进入/mydata/mysql-master/conf目录下新建my.cnf</h4> 
<p><img src="https://images2.imgbox.com/57/8a/xUxD0sKB_o.png" alt="在这里插入图片描述"></p> 
<pre><code>[mysqld]
##设置server-id，同一局域网中需要唯一
server_id=101
##指定不需要同步的数据库名称
binlog-ignore-db=mysql
##开启二进制日志功能
log-bin=mall-mysql-bin
##设置二进制日志使用内存大小（事务）
binlog_cache_size=1M
##设置使用的二进制日志格式（mixed，statement，row）
binlog_format=mixed
##二进制日志过期清理时间。默认值为0，表示不自动清理
expire_logs_days=7
##跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断
##如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致
slave_skip_errors=1062
</code></pre> 
<h4><a id="3master_777"></a>（3）修改完配置后重启master实例</h4> 
<pre><code>docker restart mysql-master
</code></pre> 
<p><img src="https://images2.imgbox.com/6e/7b/ggljQF9M_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="4mysqlmaster_782"></a>（4）进入mysql-master容器</h4> 
<pre><code>docker exec -it mysql-master /bin/bash

mysql -uroot -proot
</code></pre> 
<h4><a id="5master_789"></a>（5）master容器实例内创建数据同步用户</h4> 
<pre><code>CREATE USER 'slave'@'%' IDENTIFIED BY '123456';

GRANT REPLICATION SLAVE,REPLICATION CLIENT ON *.* TO 'slave'@'%';
</code></pre> 
<h4><a id="63308_797"></a>（6）新建从服务器容器实例3308</h4> 
<pre><code>docker run -p 3308:3306 --name mysql-slave -v /mydata/mysql-slave/log:/var/log/mysql -v /mydata/mysql-slave/data:/var/lib/mysql -v /mydata/mysql-slave/conf:/etc/mysql -e MYSQL_ROOT_PASSWORD=root -d mysql:5.7
</code></pre> 
<p><img src="https://images2.imgbox.com/74/2f/zoI7trDZ_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="7mydatamysqlmasterconfmycnf_802"></a>（7）进入/mydata/mysql-master/conf目录下新建my.cnf</h4> 
<p><img src="https://images2.imgbox.com/03/0a/bMU46DzN_o.png" alt="在这里插入图片描述"></p> 
<pre><code>[mysqld]
##设置server-id，同一局域网中需要唯一
server_id=102
##指定不需要同步的数据库名称
binlog-ignore-db=mysql
##开启二进制日志功能
log-bin=mall-mysql-bin
##设置二进制日志使用内存大小（事务）
binlog_cache_size=1M
##设置使用的二进制日志格式（mixed，statement，row）
binlog_format=mixed
##二进制日志过期清理时间。默认值为0，表示不自动清理
expire_logs_days=7
##跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断
##如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致
slave_skip_errors=1062
##relay_log配置中继日志
relay_log=mall-mysql-relay-bin
##log_slave_updates表示slave将复制事件写进自己的二进制日志
log_slave_updates=1
##slave设置为只读（具有super权限的用户除外）
read_only=1
</code></pre> 
<h4><a id="8slave_831"></a>（8）修改完配置后重启slave实例</h4> 
<pre><code>docker restart mysql-slave
</code></pre> 
<h4><a id="9_837"></a>（9）在主数据库中查看主从同步状态</h4> 
<pre><code>show master status;
</code></pre> 
<p><img src="https://images2.imgbox.com/66/f7/759Mo5lb_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="10mysqlslave_842"></a>（10）进入mysql-slave容器</h4> 
<pre><code>docker exec -it mysql-slave /bin/bash

mysql -uroot -proot
</code></pre> 
<h4><a id="11_849"></a>（11）在从数据库中配置主从复制</h4> 
<pre><code>change master to master_host='192.168.19.11',master_user='slave',master_password='123456',master_port=3307,master_log_file='mall-mysql-bin.000001',master_log_pos=617,master_connect_retry=30;
</code></pre> 
<h4><a id="12_854"></a>（12）在从数据库中查看主从同步状态</h4> 
<pre><code>show slave status \G;
</code></pre> 
<p><img src="https://images2.imgbox.com/be/29/RQbJLaxt_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="13_860"></a>（13）在从数据库中开启主从同步</h4> 
<pre><code>start slave;
</code></pre> 
<p><img src="https://images2.imgbox.com/b1/b7/5G5sNr7l_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="14_865"></a>（14）查看从数据库状态发现已经同步</h4> 
<h4><a id="15_866"></a>（15）主从复制测试</h4> 
<p>在主库执行以下sql</p> 
<pre><code>create database testslave;

use testslave;

CREATE TABLE hero ( id int(11) AUTO_INCREMENT, name varchar(30) , hp float , damage int(11) , PRIMARY KEY (id) )  DEFAULT CHARSET=utf8;

insert into hero values (null, '盖伦', 616, 100);
</code></pre> 
<p>在从库进行查询，查询成功。</p> 
<h3><a id="9xxljob_881"></a>【9】安装xxl-job</h3> 
<h4><a id="1sql_883"></a>（1）导入sql</h4> 
<p>在 Docker 容器中部署 xxl-job，在部署之前我们需要一个 Mysql 的环境，这个环境我们已经在上一章节中安装完成。</p> 
<p>本章节下载了 xxl-job 2.1.2 对应 SQL 文件已经存放到这里，你可以直接打开使用</p> 
<pre><code class="prism language-sql"><span class="token comment">/*
 Navicat Premium Data Transfer

 Source Server         : localhost
 Source Server Type    : MySQL
 Source Server Version : 50639
 Source Host           : localhost:3306
 Source Schema         : xxl_job

 Target Server Type    : MySQL
 Target Server Version : 50639
 File Encoding         : 65001

 Date: 04/12/2021 16:28:12
*/</span>

<span class="token keyword">create</span> <span class="token keyword">database</span> xxl_job<span class="token punctuation">;</span>

<span class="token keyword">USE</span> xxl_job<span class="token punctuation">;</span>

<span class="token keyword">SET</span> NAMES utf8mb4<span class="token punctuation">;</span>
<span class="token keyword">SET</span> FOREIGN_KEY_CHECKS <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for xxl_job_group</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_group<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_group<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>app_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'执行器AppName'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>title<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'执行器名称'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>address_type<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'执行器地址类型：0=自动注册、1=手动录入'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>address_list<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token keyword">COMMENT</span> <span class="token string">'执行器地址列表，多地址逗号分隔'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>update_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">3</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Records of xxl_job_group</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_group<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'xxl-job-executor-sample'</span><span class="token punctuation">,</span> <span class="token string">'示例执行器'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token string">'2021-11-20 20:28:29'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_group<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'lottery-job'</span><span class="token punctuation">,</span> <span class="token string">'抽奖系统任务调度'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token string">'2021-11-20 20:28:29'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for xxl_job_info</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_info<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_info<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>job_group<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'执行器主键ID'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>job_desc<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>add_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>update_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>author<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'作者'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>alarm_email<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'报警邮件'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>schedule_type<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'NONE'</span> <span class="token keyword">COMMENT</span> <span class="token string">'调度类型'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>schedule_conf<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'调度配置，值含义取决于调度类型'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>misfire_strategy<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'DO_NOTHING'</span> <span class="token keyword">COMMENT</span> <span class="token string">'调度过期策略'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>executor_route_strategy<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'执行器路由策略'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>executor_handler<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'执行器任务handler'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>executor_param<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'执行器任务参数'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>executor_block_strategy<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'阻塞处理策略'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>executor_timeout<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'任务执行超时时间，单位秒'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>executor_fail_retry_count<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'失败重试次数'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>glue_type<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'GLUE类型'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>glue_source<span class="token punctuation">`</span></span> <span class="token keyword">mediumtext</span> <span class="token keyword">COMMENT</span> <span class="token string">'GLUE源代码'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>glue_remark<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'GLUE备注'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>glue_updatetime<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'GLUE更新时间'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>child_jobid<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'子任务ID，多个逗号分隔'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>trigger_status<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'调度状态：0-停止，1-运行'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>trigger_last_time<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'上次调度时间'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>trigger_next_time<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'下次调度时间'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">4</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Records of xxl_job_info</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_info<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'测试任务1'</span><span class="token punctuation">,</span> <span class="token string">'2018-11-03 22:21:31'</span><span class="token punctuation">,</span> <span class="token string">'2021-11-06 14:54:29'</span><span class="token punctuation">,</span> <span class="token string">'XXL'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'CRON'</span><span class="token punctuation">,</span> <span class="token string">'0/1 * * * * ?'</span><span class="token punctuation">,</span> <span class="token string">'DO_NOTHING'</span><span class="token punctuation">,</span> <span class="token string">'FIRST'</span><span class="token punctuation">,</span> <span class="token string">'demoJobHandler'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'SERIAL_EXECUTION'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'BEAN'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'GLUE代码初始化'</span><span class="token punctuation">,</span> <span class="token string">'2018-11-03 22:21:31'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1637411338000</span><span class="token punctuation">,</span> <span class="token number">1637411339000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_info<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'活动状态扫描'</span><span class="token punctuation">,</span> <span class="token string">'2021-11-06 11:43:49'</span><span class="token punctuation">,</span> <span class="token string">'2021-11-13 10:19:56'</span><span class="token punctuation">,</span> <span class="token string">'小傅哥'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'CRON'</span><span class="token punctuation">,</span> <span class="token string">'0/1 * * * * ?'</span><span class="token punctuation">,</span> <span class="token string">'DO_NOTHING'</span><span class="token punctuation">,</span> <span class="token string">'FIRST'</span><span class="token punctuation">,</span> <span class="token string">'lotteryActivityStateJobHandler'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'SERIAL_EXECUTION'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'BEAN'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'GLUE代码初始化'</span><span class="token punctuation">,</span> <span class="token string">'2021-11-06 11:43:49'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_info<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'扫描用户抽奖奖品发放MQ状态补偿'</span><span class="token punctuation">,</span> <span class="token string">'2021-11-13 10:23:59'</span><span class="token punctuation">,</span> <span class="token string">'2021-11-13 13:47:26'</span><span class="token punctuation">,</span> <span class="token string">'小傅哥'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'CRON'</span><span class="token punctuation">,</span> <span class="token string">'0/5 * * * * ?'</span><span class="token punctuation">,</span> <span class="token string">'DO_NOTHING'</span><span class="token punctuation">,</span> <span class="token string">'FIRST'</span><span class="token punctuation">,</span> <span class="token string">'lotteryOrderMQStateJobHandler'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'SERIAL_EXECUTION'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'BEAN'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'GLUE代码初始化'</span><span class="token punctuation">,</span> <span class="token string">'2021-11-13 10:23:59'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for xxl_job_lock</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_lock<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_lock<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>lock_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'锁名称'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>lock_name<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Records of xxl_job_lock</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_lock<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'schedule_lock'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for xxl_job_log</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_log<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_log<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>job_group<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'执行器主键ID'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>job_id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'任务，主键ID'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>executor_address<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'执行器地址，本次执行的地址'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>executor_handler<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'执行器任务handler'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>executor_param<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'执行器任务参数'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>executor_sharding_param<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'执行器任务分片参数，格式如 1/2'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>executor_fail_retry_count<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'失败重试次数'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>trigger_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'调度-时间'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>trigger_code<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'调度-结果'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>trigger_msg<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token keyword">COMMENT</span> <span class="token string">'调度-日志'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>handle_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'执行-时间'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>handle_code<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'执行-状态'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>handle_msg<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token keyword">COMMENT</span> <span class="token string">'执行-日志'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>alarm_status<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'告警状态：0-默认、1-无需告警、2-告警成功、3-告警失败'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>I_trigger_time<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>trigger_time<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>I_handle_code<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>handle_code<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">56303</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Records of xxl_job_log</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for xxl_job_log_report</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_log_report<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_log_report<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>trigger_day<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'调度-时间'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>running_count<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'运行中-日志数量'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>suc_count<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'执行成功-日志数量'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>fail_count<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'执行失败-日志数量'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>update_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>i_trigger_day<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>trigger_day<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">10</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Records of xxl_job_log_report</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_log_report<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'2021-11-06 00:00:00'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">133</span><span class="token punctuation">,</span> <span class="token number">17686</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_log_report<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'2021-11-05 00:00:00'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_log_report<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'2021-11-04 00:00:00'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_log_report<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'2021-11-13 00:00:00'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">13177</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_log_report<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'2021-11-12 00:00:00'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_log_report<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">'2021-11-11 00:00:00'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_log_report<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">'2021-11-20 00:00:00'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">25195</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_log_report<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'2021-11-19 00:00:00'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_log_report<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">'2021-11-18 00:00:00'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for xxl_job_logglue</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_logglue<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_logglue<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>job_id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'任务，主键ID'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>glue_type<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'GLUE类型'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>glue_source<span class="token punctuation">`</span></span> <span class="token keyword">mediumtext</span> <span class="token keyword">COMMENT</span> <span class="token string">'GLUE源代码'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>glue_remark<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'GLUE备注'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>add_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>update_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Records of xxl_job_logglue</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for xxl_job_registry</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_registry<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_registry<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>registry_group<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>registry_key<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>registry_value<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>update_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>i_g_k_v<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>registry_group<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>registry_key<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token number">191</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>registry_value<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token number">191</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Records of xxl_job_registry</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for xxl_job_user</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_user<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_user<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'账号'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>password<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'密码'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>role<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'角色：0-普通用户、1-管理员'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>permission<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'权限：执行器ID列表，多个逗号分割'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>i_username<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Records of xxl_job_user</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>xxl_job_user<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token string">'e10adc3949ba59abbe56e057f20f883e'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>

<span class="token keyword">SET</span> FOREIGN_KEY_CHECKS <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

</code></pre> 
<p>我们使用本地 SQL 链接工具，并创建 xxl-job 库已经导入 xxl-job.sql 文件<br> <img src="https://images2.imgbox.com/e2/12/0jCSsl8z_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2xxljob7397_1120"></a>（2）安装xxl-job（7397）</h4> 
<p>（1）拉取镜像：docker pull xuxueli/xxl-job-admin:2.3.0<br> （2）部署（修改成你的数据库服务器IP、账号、密码、accessToken）：docker run -e PARAMS=" --server.port=7397 --spring.datasource.url=jdbc:mysql://172.17.0.6:3306/xxl_job?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=GMT%2B8 --spring.datasource.username=root --spring.datasource.password=123456 --xxl.job.accessToken=xdsl3ewi3al1oehxmo68pqxer" -p 7397:7397 -v /logs/xxl-job:/data/applogs --name xxl-job-admin --restart=always -d xuxueli/xxl-job-admin:2.3.0<br> （3）查看日志<br> <img src="https://images2.imgbox.com/5a/4e/NdoYGF9T_o.png" alt="在这里插入图片描述"><br> （4）打开xxl-job的后台<br> http://你的ip:7397/xxl-job-admin/<br> <img src="https://images2.imgbox.com/80/a5/japH4cQP_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="3_1129"></a>（3）配置任务</h4> 
<p>（1）打开上面的xxl-job的后台：http://你的ip:7397/xxl-job-admin/<br> （2）添加xxl-job执行器，一个执行器也就是一个应用实例<br> 设置执行器的AppName，注册方式为自动注入，创建一个执行器，这里的名字要对应上，不能错。<br> <img src="https://images2.imgbox.com/de/7b/xc9dzjoK_o.png" alt="在这里插入图片描述"><br> （3）添加job<br> 在任务管理里，选择执行器，创建新的任务，指定负责人和报警邮件，调度类型选择Cron，编写Cron命令为【0/5 * * * * ?】表示5秒执行一次。另外JobHandler为lotteryOrderMQStateJobHandler，运行模式为bean<br> 然后就是在执行器下创建任务<br> <img src="https://images2.imgbox.com/72/18/rqaOHNRj_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="4xxljob_1140"></a>（4）工程配置xxl-job</h4> 
<p>（1）查看xxl-job启动参数<br> <img src="https://images2.imgbox.com/70/a7/CtA1TJpS_o.png" alt="在这里插入图片描述"><br> （2）配置启动参数，在yml配置文件中加上配置信息<br> 1-xxl-job的启动地址和端口号，这个端口号是启动的端口号（注意这里是虚拟机或者服务器的ip和端口号）<br> 2-执行器的名称，也就是执行器的AppName，还有端口号，这个端口号是执行器自动注册的端口号<br> 3-指定日志路径（这个路径要提前创建好，在我们的虚拟机或者服务器上要提前创建）<br> 4-日志清除周期</p> 
<pre><code class="prism language-yml"><span class="token comment"># http://39.96.73.167:7397/xxl-job-admin</span>
<span class="token comment"># 账号：admin</span>
<span class="token comment"># 密码：123456</span>
<span class="token key atrule">xxl</span><span class="token punctuation">:</span>
  <span class="token key atrule">job</span><span class="token punctuation">:</span>
    <span class="token key atrule">admin</span><span class="token punctuation">:</span>
      <span class="token comment">### 调度中心部署跟地址 [选填]：如调度中心集群部署存在多个地址则用逗号分隔。执行器将会使用该地址进行"执行器心跳注册"和"任务结果回调"；为空则关闭自动注册；</span>
      <span class="token key atrule">addresses</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//39.96.73.167<span class="token punctuation">:</span>7397/xxl<span class="token punctuation">-</span>job<span class="token punctuation">-</span>admin
    <span class="token key atrule">executor</span><span class="token punctuation">:</span>
      <span class="token comment">### 执行器AppName [选填]：执行器心跳注册分组依据；为空则关闭自动注册</span>
      <span class="token key atrule">appname</span><span class="token punctuation">:</span> lottery<span class="token punctuation">-</span>job
      <span class="token comment">### 执行器注册 [选填]：优先使用该配置作为注册地址，为空时使用内嵌服务 ”IP:PORT“ 作为注册地址。从而更灵活的支持容器类型执行器动态IP和动态映射端口问题。</span>
      <span class="token key atrule">address</span><span class="token punctuation">:</span>
      <span class="token comment">### 执行器IP [选填]：默认为空表示自动获取IP，多网卡时可手动设置指定IP，该IP不会绑定Host仅作为通讯实用；地址信息用于 "执行器注册" 和 "调度中心请求并触发任务"；</span>
      <span class="token key atrule">ip</span><span class="token punctuation">:</span> 3e62f9.natappfree.cc
      <span class="token comment">### 执行器端口号 [选填]：小于等于0则自动获取；默认端口为9999，单机部署多个执行器时，注意要配置不同执行器端口；</span>
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9999</span>
      <span class="token key atrule">logpath</span><span class="token punctuation">:</span> /Users/fuzhengwei/itstack/data/applogs/xxl<span class="token punctuation">-</span>job/jobhandler
      <span class="token key atrule">logretentiondays</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">accessToken</span><span class="token punctuation">:</span> xdsl3ewi3al1oehxmo68pqxer
</code></pre> 
<h4><a id="5_1173"></a>（5）测试验证（待补充）</h4> 
<h3><a id="10nacos8848_1176"></a>【10】安装nacos（8848）</h3> 
<p>（1）拉取镜像：docker pull nacos/nacos-server<br> （2）安装部署：docker run -d -p 8848:8848 --env MODE=standalone --name nacos nacos/nacos-server</p> 
<p>（3）打开链接：http://服务器IP:8848/nacos/ - 账号：nacos 密码：nacos<br> <img src="https://images2.imgbox.com/03/74/jxd9ZqzG_o.png" alt="在这里插入图片描述"><br> （4）访问出现问题<br> [root@allen02 conf]# curl http://192.168.19.22:8848/nacos/#/login<br> curl: (7) Failed connect to 192.168.19.22:8848; Connection refused</p> 
<p>防火墙已经关了，重启docker，过了一会又好了</p> 
<p>（5）本地配置（待补充）</p> 
<h3><a id="11Elasticsearch9200_1193"></a>【11】安装Elasticsearch（9200）</h3> 
<p>（1）拉取镜像：docker pull elasticsearch:7.6.2<br> （2）执行安装：docker run --name elasticsearch -d -e ES_JAVA_OPTS=“-Xms128m -Xmx256m” -e “discovery.type=single-node” -p 9200:9200 -p 9300:9300 elasticsearch:7.6.2</p> 
<pre><code class="prism language-powershell"><span class="token operator">--</span>name表示镜像启动后的容器名称
<span class="token operator">-</span>d: 后台运行容器，并返回容器ID；
<span class="token operator">-</span>e: 指定容器内的环境变量
<span class="token operator">-</span>p: 指定端口映射，格式为：主机<span class="token punctuation">(</span>宿主<span class="token punctuation">)</span>端口:容器端口
</code></pre> 
<p>（3）检查portainer<br> <img src="https://images2.imgbox.com/f7/a9/eD72AdNq_o.png" alt="在这里插入图片描述"><br> （4）启动<br> http://39.96.73.167:9200<br> <img src="https://images2.imgbox.com/0c/5e/52BMNVLH_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="12Kibana5601_1210"></a>【12】安装Kibana（5601）</h3> 
<p>（1）拉取镜像：docker pull kibana:7.6.2<br> （2）添加配置：kibana.yml<br> 1-创建/data/kibana/config文件夹，编辑kibana.yml<br> 2-覆盖配置文件，如下</p> 
<pre><code class="prism language-yml"><span class="token comment">#</span>
<span class="token comment"># ** THIS IS AN AUTO-GENERATED FILE **</span>
<span class="token comment">#</span>

<span class="token comment"># Default Kibana configuration for docker target</span>
<span class="token key atrule">server.name</span><span class="token punctuation">:</span> kibana
<span class="token key atrule">server.host</span><span class="token punctuation">:</span> <span class="token string">"0"</span>
<span class="token key atrule">elasticsearch.hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">"http://39.96.73.167:9200"</span> <span class="token punctuation">]</span>
<span class="token key atrule">xpack.monitoring.ui.container.elasticsearch.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token comment"># 设置中文显示</span>
<span class="token key atrule">i18n.locale</span><span class="token punctuation">:</span> <span class="token string">"zh-CN"</span>
</code></pre> 
<p>配置 elasticsearch 地址<br> 配置 zh-CN 中文显示</p> 
<p>（3）执行安装：<br> docker run -d <br> –name=kibana <br> –restart=always <br> -p 5601:5601 <br> -v /data/kibana/config/kibana.yml:/usr/share/kibana/config/kibana.yml <br> kibana:7.6.2</p> 
<p>（4）访问验证：http://39.96.73.167:5601/app/kibana#/home<br> <img src="https://images2.imgbox.com/38/8f/6mIhNR5n_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="13canal_1242"></a>【13】安装canal（待补充）</h3> 
<p>（1）canal介绍<br> canal 是一款 阿里巴巴 MySQL binlog 增量订阅&amp;消费组件，模拟 MySQL slave 的交互协议，伪装自己为 MySQL slave ，向 MySQL master 发送dump 协议。MySQL master 收到 dump 请求，开始推送 binary log 给 slave (即 canal )，canal 解析 binary log 对象(原始为 byte 流)，之后把数据转存到其他需要保存的服务中。文档：https://github.com/alibaba/canal/wiki</p> 
<p>我们会在 docker 环境，把 Mysql 数据库中抽奖系统的分库分表数据使用 canal 同步到 ES 文件系统中</p> 
<h3><a id="14nginx80_1250"></a>【14】安装nginx（80）</h3> 
<h4><a id="1Nginx_1252"></a>（1）下载Nginx镜像（下面两种选择一个）</h4> 
<p>docker pull nginx：下载最新版Nginx镜像 (其实此命令就等同于 : docker pull nginx:latest )<br> docker pull nginx:xxx：下载指定版本的Nginx镜像 (xxx指具体版本号)</p> 
<p><img src="https://images2.imgbox.com/d1/87/tbdKuBhF_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2Nginx_1257"></a>（2）创建Nginx配置文件</h4> 
<p>启动前需要先创建Nginx外部挂载的配置文件（/home/nginx/conf/nginx.conf），之所以要先创建，是因为Nginx本身容器只存在/etc/nginx目录，本身就不创建nginx.conf文件，当前服务器和容器都不存在nginx.conf文件时，执行启动命令的时候docker会把nginx.conf作为目录创建，这不是我们想要的结果</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 创建挂载目录</span>
mkdir <span class="token operator">-</span>p <span class="token operator">/</span>home/nginx/conf
mkdir <span class="token operator">-</span>p <span class="token operator">/</span>home/nginx/log
mkdir <span class="token operator">-</span>p <span class="token operator">/</span>home/nginx/html
</code></pre> 
<p>容器中的nginx.conf文件和conf.d文件夹复制到宿主机</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 生成容器，会创建下面需要的那些文件</span>
docker run <span class="token operator">--</span>name nginx <span class="token operator">-</span>p 9001:80 <span class="token operator">-</span>d nginx
<span class="token comment"># 将容器nginx.conf文件复制到宿主机</span>
docker <span class="token function">cp</span> nginx:<span class="token operator">/</span>etc/nginx/nginx<span class="token punctuation">.</span>conf <span class="token operator">/</span>home/nginx/conf/nginx<span class="token punctuation">.</span>conf
<span class="token comment"># 将容器conf.d文件夹下内容复制到宿主机</span>
docker <span class="token function">cp</span> nginx:<span class="token operator">/</span>etc/nginx/conf<span class="token punctuation">.</span>d <span class="token operator">/</span>home/nginx/conf/conf<span class="token punctuation">.</span>d
<span class="token comment"># 将容器中的html文件夹复制到宿主机</span>
docker <span class="token function">cp</span> nginx:<span class="token operator">/</span>usr/share/nginx/html <span class="token operator">/</span>home/nginx/
</code></pre> 
<p><img src="https://images2.imgbox.com/76/46/QyjZZWOE_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="3Nginx_1279"></a>（3）创建Nginx容器并运行</h4> 
<p>先停掉并删除正在运行的Nginx容器</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 直接执行docker rm nginx或者以容器id方式关闭容器</span>
<span class="token comment"># 找到nginx对应的容器id</span>
docker <span class="token function">ps</span> <span class="token operator">-</span>a
<span class="token comment"># 关闭该容器</span>
docker stop nginx
<span class="token comment"># 删除该容器</span>
docker <span class="token function">rm</span> nginx
 
<span class="token comment"># 删除正在运行的nginx容器</span>
docker <span class="token function">rm</span> <span class="token operator">-</span>f nginx
</code></pre> 
<p>创建容器</p> 
<pre><code class="prism language-powershell">docker run \
<span class="token operator">-</span>p 9002:80 \
<span class="token operator">--</span>name nginx \
<span class="token operator">--</span>restart=always \
<span class="token operator">-</span>v <span class="token operator">/</span>home/nginx/conf/nginx<span class="token punctuation">.</span>conf:<span class="token operator">/</span>etc/nginx/nginx<span class="token punctuation">.</span>conf \
<span class="token operator">-</span>v <span class="token operator">/</span>home/nginx/conf/conf<span class="token punctuation">.</span>d:<span class="token operator">/</span>etc/nginx/conf<span class="token punctuation">.</span>d \
<span class="token operator">-</span>v <span class="token operator">/</span>home/nginx/log:<span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>log/nginx \
<span class="token operator">-</span>v <span class="token operator">/</span>home/nginx/html:<span class="token operator">/</span>usr/share/nginx/html \
<span class="token operator">-</span>d nginx:latest
</code></pre> 
<p>命令分析<br> –name nginx：启动容器的名字<br> –restart=always：当docker启动的时候，容器自启动<br> -d：后台运行<br> -p 9002:80：将容器的 9002(后面那个) 端口映射到主机的 80(前面那个) 端口<br> -v /home/nginx/conf/nginx.conf:/etc/nginx/nginx.conf：挂载nginx.conf配置文件<br> -v /home/nginx/conf/conf.d:/etc/nginx/conf.d：挂载nginx配置文件<br> -v /home/nginx/log:/var/log/nginx：挂载nginx日志文件<br> -v /home/nginx/html:/usr/share/nginx/html：挂载nginx内容<br> nginx:latest：本地运行的版本<br> \：shell命令换行（注意的时候换行前有个空格）</p> 
<p>单行模式</p> 
<pre><code class="prism language-powershell">docker run <span class="token operator">-</span>p 9002:80 <span class="token operator">--</span>name nginx <span class="token operator">--</span>restart=always <span class="token operator">-</span>v <span class="token operator">/</span>home/nginx/conf/nginx<span class="token punctuation">.</span>conf:<span class="token operator">/</span>etc/nginx/nginx<span class="token punctuation">.</span>conf <span class="token operator">-</span>v <span class="token operator">/</span>home/nginx/conf/conf<span class="token punctuation">.</span>d:<span class="token operator">/</span>etc/nginx/conf<span class="token punctuation">.</span>d <span class="token operator">-</span>v <span class="token operator">/</span>home/nginx/log:<span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>log/nginx <span class="token operator">-</span>v <span class="token operator">/</span>home/nginx/html:<span class="token operator">/</span>usr/share/nginx/html <span class="token operator">-</span>d nginx:latest
</code></pre> 
<h4><a id="4_1327"></a>（4）结果检测</h4> 
<p><img src="https://images2.imgbox.com/61/e7/V6dA82u9_o.png" alt="在这里插入图片描述"><br> 然后访问一下网址试试<br> <img src="https://images2.imgbox.com/09/99/jmJGiwl8_o.png" alt="在这里插入图片描述"><br> 成功</p> 
<h4><a id="5nginx_1332"></a>（5）修改nginx配置</h4> 
<h2><a id="Docker_1337"></a>【四】总结上面案例中的概念和常用的Docker命令</h2> 
<h3><a id="1_1339"></a>【1】常用的概念</h3> 
<p>（1）Client客户端<br> Docker是一个客户端-服务器（C/S）架构程序，Docker客户端只需要向Docker服务器或者守护进程发出请求，服务器或者守护进程将完成所有工作并返回结果。</p> 
<p>（2）Image镜像<br> 简单理解，Docker镜像就是一个Linux的文件系统，这个文件系统里面包含可以运行在Linux内核的程序以及相应的数据。</p> 
<p>通过镜像启动一个容器，一个镜像就是一个可执行的包，其中包括运行应用程序所需要的所有内容：包含代码，运行时间，库，环境变量和配置文件等。</p> 
<p>Docker把App文件打包成一个镜像，并且采用类似多次快照的存储技术，可以实现：<br> 1-多个App可以共用相同的底层镜像（初始的操作系统镜像）<br> 2-App运行时的IO操作和镜像文件隔离<br> 3-通过挂载包含不同配置/数据文件的目录或者卷（Volume），单个App镜像可以用来运行无数个不同业务的容器。</p> 
<p>（3）Container容器<br> 镜像和容器的关系，就像是面向对象程序设计中的类和实例一样，镜像是静态的定义，容器是镜像运行时的实体。容器可以被创建、启动、停止、删除、暂停等。</p> 
<p>（4）镜像分层<br> Docker支持通过扩展现有镜像，创建新的镜像。实际上，Docker Hub中99%的镜像都是通过在base镜像中安装和配置需要的软件构建出来的。<br> <img src="https://images2.imgbox.com/e4/37/aIJVaJqP_o.png" alt="在这里插入图片描述"><br> 从上图可以看到，新镜像是从base镜像一层一层叠加生成的。每安装一个软件，就在现有镜像的基础上增加一层。</p> 
<p>镜像分层最大的好处就是共享资源。比如说有多个镜像都从相同的base镜像构建而来，那么Docker Host只需在磁盘上保存一份base镜像，同时内存中也只需加载一份base镜像，就可以为所有容器服务了。而且镜像的每一层都可以被分享。</p> 
<p>如果多个容器共享一份基础镜像，当某个容器修改了基础镜像的内容，比如etc下的文件，这时其他容器的etc是不会被修改的，修改只会被限制子啊单个容器里，这就是容器copy-on-write特性</p> 
<p>（5）Volume数据卷<br> 实际上我们的容器就好像是一个简易版的操作系统，只不过系统中只安装了我们的程序运行所需要的环境，前边说到容器是可以删除的，那如果删除了，容器里的程序产生的需要持久化的数据怎么办呢？容器运行的时候我们可以进容器去查看，容器一旦删除就什么都没有了。</p> 
<p>所以数据卷就是来解决这个问题的，是用来将数据持久化到我们宿主机上，与容器间实现数据共享，简单的说就是将宿主机的目录映射到容器中的目录，应用程序在容器中的目录读写数据会同步到宿主机上，这样容器发生的数据就可以持久化了，比如我们的数据库容器，就可以把数据存储到我们宿主机上的真是磁盘里。</p> 
<p>（6）Registry注册中心<br> Docker用Registry来保存用户构建的镜像。Registry分为公共和私有两种。Docker公司运行公共的Registry叫做Docker Hub。用户可以在Docker Hub注册账号，分享并保存自己的镜像。一个Docker Registry中可以包含多个仓库Repository；每个仓库可以包含多个标签Tag，每个标签对一个镜像。</p> 
<p>通常，一个仓库会包含同一个软件不同版本的镜像，而标签对应该软件的各个版本。我们可以通过【仓库名：标签】的格式来指定具体是这个软件哪个版本的镜像。如果不给出标签，将以latest作为默认标签。</p> 
<h3><a id="2_1377"></a>【2】镜像命令</h3> 
<p>官方文档：https://docs.docker.com/reference</p> 
<p>（1）查看镜像：docker images<br> （2）搜索镜像：docker search 镜像名称<br> （3）拉取镜像：docker pull 镜像名称<br> （4）删除单个镜像：docker rmi 镜像ID<br> （5）删除多个镜像：docker rmi 镜像ID 镜像ID 镜像ID<br> （6）删除所有镜像：docker rmi docker images -q</p> 
<p>注意：如果通过某个镜像创建了容器，则该镜像无法删除。<br> 解决办法：先删除镜像中的容器，再删除该镜像。</p> 
<h3><a id="3_1390"></a>【3】容器命令</h3> 
<p>（1）查看容器：docker ps<br> （2）查看停止的容器：docker ps -f status=exited<br> （3）查看所有容器：docker ps -a<br> （4）查看最后一次运行的容器：docker ps -l<br> （5）列出最近创建的n个容器：docker ps -n 5</p> 
<p>（6）创建和启动容器：docker run [OPTIONS] IMAGE [COMMAND] [ARG…]<br> -i：表示运行容器；<br> -t：表示容器启动后会进入其命令行。加入这两个参数后，容器创建就能登录进去。即分配一个伪终端；<br> –name：为创建的容器命名；<br> -v：表示目录映射关系（前者是宿主机目录，后者是映射到宿主机上的目录），可以使用多个 -v 做多个目录或文件映射。注意：最好做目录映射，在宿主机上做修改，然后共享到容器上；<br> -d：在 run 后面加上 -d 参数，则会创建一个守护式容器在后台运行（这样创建容器后不会自动登录容器，如果只加 -i -t 两个参数，创建容器后就会自动进容器里）；<br> -p：表示端口映射，前者是宿主机端口，后者是容器内的映射端口。可以使用多个 -p 做多个端口映射。<br> -P：随机使用宿主机的可用端口与容器内暴露的端口映射。</p> 
<p>（7）创建并进入容器：docker run -it --name 容器名称 镜像名称:标签 /bin/bash<br> （8）退出当前容器：exit<br> （9）守护式方式创建容器：docker run -di --name 容器名称 镜像名称:标签<br> （10）登录守护式容器方式：docker exec -it 容器名称|容器ID /bin/bash<br> （11）停止容器：docker stop 容器名称|容器ID<br> （12）启动容器：docker start 容器名称|容器ID<br> （13）文件拷贝<br> 如果我们需要将文件拷贝到容器内可以使用cp命令：docker cp 需要拷贝的文件或目录 容器名称:容器目录<br> 也可以将文件从容器内拷贝出来：docker cp 容器名称:容器目录 需要拷贝的文件或目录<br> （14）目录挂载<br> 我们可以在创建容器的时候，将宿主机的目录与容器内的目录进行映射，这样我们就可以通过修改宿主机某个目录的文件从而去影响容器，而且这个操作是双向绑定的，也就是说容器内的操作也会影响到宿主机，实现备份功能。</p> 
<p>但是容器被删除的时候，宿主机的内容并不会被删除。如果多个容器挂载同一个目录，其中一个容器被删除，其他容器的内容也不会受到影响。</p> 
<p>创建容器添加-v参数，格式为宿主机目录:容器目录，例如：</p> 
<pre><code class="prism language-powershell">docker run <span class="token operator">-</span>di <span class="token operator">-</span>v <span class="token operator">/</span>home/ruoyi/<span class="token keyword">data</span>:<span class="token operator">/</span>usr/local/<span class="token keyword">data</span> <span class="token operator">--</span>name centos7-01 centos:7

<span class="token comment"># 多目录挂载</span>
docker run <span class="token operator">-</span>di <span class="token operator">-</span>v <span class="token operator">/</span>宿主机目录:<span class="token operator">/</span>容器目录 <span class="token operator">-</span>v <span class="token operator">/</span>宿主机目录2:<span class="token operator">/</span>容器目录2 镜像名
</code></pre> 
<p>目录挂载操作可能会出现权限不足的提示。这是因为CentOS7中的安全模块SELinux把权限禁掉了，在docker run时通过–privileged=true给该容器加权限来解决挂载的目录没有权限的问题。</p> 
<p>1-匿名挂载<br> 匿名挂载只需要写容器目录即可，容器外对应的目录会在/var/lib/docker/volumes中生成。</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 匿名挂载</span>
docker run <span class="token operator">-</span>di <span class="token operator">-</span>v <span class="token operator">/</span>usr/local/<span class="token keyword">data</span> <span class="token operator">--</span>name centos7-02 centos:7
<span class="token comment"># 查看 volume 数据卷信息</span>
docker volume <span class="token function">ls</span>
</code></pre> 
<p>2-具名挂载<br> 具名挂载就是给数据卷起了个名字，容器外对应的目录会在/var/lib/docker/volume中生成。</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 匿名挂载</span>
docker run <span class="token operator">-</span>di <span class="token operator">-</span>v docker_centos_data:<span class="token operator">/</span>usr/local/<span class="token keyword">data</span> <span class="token operator">--</span>name centos7-03 centos:7
<span class="token comment"># 查看 volume 数据卷信息</span>
docker volume <span class="token function">ls</span>
</code></pre> 
<p>3-指定目录挂载<br> 之前挂载方式就属于指定目录挂载，这种方式的挂载不会在/var/lib/docker/volume目录生成内容。</p> 
<pre><code class="prism language-powershell">docker run <span class="token operator">-</span>di <span class="token operator">-</span>v <span class="token operator">/</span>mydata/docker_centos/<span class="token keyword">data</span>:<span class="token operator">/</span>usr/local/<span class="token keyword">data</span> <span class="token operator">--</span>name centos7-01 centos:7
<span class="token comment"># 多目录挂载</span>
docker run <span class="token operator">-</span>di <span class="token operator">-</span>v <span class="token operator">/</span>宿主机目录:<span class="token operator">/</span>容器目录 <span class="token operator">-</span>v <span class="token operator">/</span>宿主机目录2:<span class="token operator">/</span>容器目录2 镜像名
</code></pre> 
<p>4-查看目录挂载关系<br> 通过docker volume inspect数据卷名称 可以查看该数据卷对应宿主机的目录地址。</p> 
<p>执行命令：docker volume inspect docker_centos_data</p> 
<p>通过docker inspect容器ID或名称 ，在返回的JSON节点中找到Mounts，可以查看详细的数据挂载信息。</p> 
<p>5-只读/读写</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 只读。只能通过修改宿主机内容实现对容器的数据管理。</span>
docker run <span class="token operator">-</span>it <span class="token operator">-</span>v <span class="token operator">/</span>宿主机目录:<span class="token operator">/</span>容器目录:ro 镜像名

<span class="token comment"># 读写，默认。宿主机和容器可以双向操作数据。</span>
docker run <span class="token operator">-</span>it <span class="token operator">-</span>v <span class="token operator">/</span>宿主机目录:<span class="token operator">/</span>容器目录:rw 镜像名
</code></pre> 
<p>（15）删除容器</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 删除指定容器</span>
docker <span class="token function">rm</span> 容器名称<span class="token punctuation">|</span>容器ID

<span class="token comment"># 删除多个容器</span>
docker <span class="token function">rm</span> 容器名称<span class="token punctuation">|</span>容器ID 容器名称<span class="token punctuation">|</span>容器ID
</code></pre> 
<p>（16）查看容器 IP 地址</p> 
<p>我们可以通过以下命令查看容器的元信息：docker inspect 容器名称|容器ID</p> 
<p>也可以直接执行下面的命令直接输出 IP 地址。</p> 
<pre><code class="prism language-powershell">docker inspect <span class="token operator">--</span>format=<span class="token string">'{<!-- -->{.NetworkSettings.IPAddress}}'</span> 容器名称<span class="token punctuation">|</span>容器ID
</code></pre> 
<h3><a id="4_1497"></a>【4】镜像构建</h3> 
<h4><a id="1_1499"></a>（1）介绍</h4> 
<p>我们可以通过公共仓库拉取镜像使用，但是，有些时候公共仓库拉取的镜像并不符合我们的需求。尽管已经从繁琐的部署工作中解放出来，但是实际开发时，我们可能希望镜像包含整个项目的完整环境，在其他机器上拉取打包完整的镜像，直接运行即可。</p> 
<p>Docker 支持自己构建镜像，还支持将自己构建的镜像上传至公共仓库，镜像构建可以通过以下两种方式来实现：</p> 
<p>（1）从容器创建一个新的镜像<br> docker commit<br> （2）配合Dockerfile文件创建镜像<br> docker build</p> 
<h4><a id="2docker_commit_1509"></a>（2）docker commit构建镜像</h4> 
<p>目标：接下来我们通过基础镜像centos:7，在该镜像中安装jdk和tomcat以后将其制作为一个新的镜像mycentos:7。</p> 
<p>（1）创建容器</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 拉取镜像</span>
docker pull centos:7

<span class="token comment"># 创建容器</span>
docker run <span class="token operator">-</span>di <span class="token operator">--</span>name centos7 centos:7
</code></pre> 
<p>（2）拷贝资源</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 将宿主机的 jdk 和 tomcat 拷贝至容器</span>
docker <span class="token function">cp</span> jdk-8u111-linux-x64<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz centos7:<span class="token operator">/</span>root

docker <span class="token function">cp</span> apache-tomcat-8<span class="token punctuation">.</span>5<span class="token punctuation">.</span>27<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz centos7:<span class="token operator">/</span>root
</code></pre> 
<p>（3）安装资源</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 进入容器</span>
docker exec <span class="token operator">-</span>it centos7 <span class="token operator">/</span>bin/bash

<span class="token comment"># 切换至 /root 目录</span>
cd root/

<span class="token comment"># 创建 java 和 tomcat 目录</span>
mkdir <span class="token operator">-</span>p <span class="token operator">/</span>usr/local/java
mkdir <span class="token operator">-</span>p <span class="token operator">/</span>usr/local/tomcat

<span class="token comment"># 将 jdk 和 tomcat 解压至容器 /usr/local/java 和 /usr/local/tomcat 目录中</span>
tar <span class="token operator">-</span>zxvf jdk-8u111-linux-x64<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz <span class="token operator">-</span>C <span class="token operator">/</span>usr/local/java/
tar <span class="token operator">-</span>zxvf apache-tomcat-8<span class="token punctuation">.</span>5<span class="token punctuation">.</span>27<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz <span class="token operator">-</span>C <span class="token operator">/</span>usr/local/tomcat/

<span class="token comment"># 配置 jdk 环境变量</span>
vi <span class="token operator">/</span>etc/profile

<span class="token comment"># 在环境变量文件中添加以下内容</span>
export JAVA_HOME=<span class="token operator">/</span>usr/local/java/jdk1<span class="token punctuation">.</span>8<span class="token punctuation">.</span>0_111/
export PATH=<span class="token variable">$PATH</span>:<span class="token variable">$JAVA_HOME</span><span class="token operator">/</span>bin

<span class="token comment"># 重新加载环境变量文件</span>
source <span class="token operator">/</span>etc/profile

<span class="token comment"># 测试环境变量是否配置成功</span>
java <span class="token operator">-</span>version

<span class="token comment"># 删除容器内 jdk 和 tomcat</span>
<span class="token function">rm</span> jdk-8u111-linux-x64<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz apache-tomcat-8<span class="token punctuation">.</span>5<span class="token punctuation">.</span>27<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz <span class="token operator">-</span>rf
</code></pre> 
<p>（4）构建镜像</p> 
<pre><code class="prism language-powershell">docker commit <span class="token namespace">[OPTIONS]</span> CONTAINER <span class="token namespace">[REPOSITORY[:TAG]]</span>
docker commit <span class="token operator">-</span>a=<span class="token string">"ruoyi"</span> <span class="token operator">-</span>m=<span class="token string">"jdk8 and tomcat8"</span> centos7 mycentos:7
</code></pre> 
<p>（5）参数介绍<br> -a：提交的镜像作者；<br> -c：使用 Dockerfile 指令来创建镜像；<br> -m：提交时的说明文字；<br> -p：在 commit 时，将容器暂停。</p> 
<p>（6）使用构建的镜像创建容器</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 创建容器</span>
docker run <span class="token operator">-</span>di <span class="token operator">--</span>name mycentos7 <span class="token operator">-</span>p 8080:8080 mycentos:7

<span class="token comment"># 进入容器</span>
docker exec <span class="token operator">-</span>it mycentos7 <span class="token operator">/</span>bin/bash

<span class="token comment"># 重新加载配置文件</span>
source <span class="token operator">/</span>etc/profile

<span class="token comment"># 测试 java 环境变量</span>
java <span class="token operator">-</span>version

<span class="token comment"># 启动 tomcat</span>
<span class="token operator">/</span>usr/local/tomcat/apache-tomcat-8<span class="token punctuation">.</span>5<span class="token punctuation">.</span>27/bin/startup<span class="token punctuation">.</span>sh
</code></pre> 
<p>访问http://{ip}:{port}，看到tomcat页面说明环境表示成功。</p> 
<h2><a id="_1600"></a>【五】挂载是怎么个事</h2> 
<h2><a id="_1602"></a>【六】网络是怎么个事</h2> 
<h2><a id="Dockerfile_1604"></a>【七】Dockerfile</h2> 
<h3><a id="1_1606"></a>【1】介绍</h3> 
<p>在Docker中构建镜像最常用的方式，就是使用Dockerfile。Dockerfile是一个用来构建镜像的文本文件，文本内容包含了一条条构建镜像所需的指令和说明。官方文档：https://docs.docker.com/engine/reference/builder</p> 
<p><img src="https://images2.imgbox.com/bb/d6/CborCu78_o.png" alt="在这里插入图片描述"><br> 通过架构图可以看出通过dockerfile可以直接构建一个属于自己的镜像。</p> 
<p>官方镜像确实足够好了，足够适用于大多数应用程序，但是如果我们想自己创建属于我们自己的业务镜像，这个时候必须自定义镜像。</p> 
<h3><a id="2Dockerfile_1616"></a>【2】Dockerfile的基础知识</h3> 
<p>（1）每条保留字指令都必须为大写，并且后面都要跟至少一个参数<br> （2）指令按照从上到下，顺序执行<br> （3）#表示注释<br> （4）每条指令都会创建一个新的镜像层并对镜像进行提交<br> （5）创建Dockerfile的时候可以直接在一个目录下面，使用vim Dockerfile来创建文件，然后直接编辑内容保存</p> 
<h3><a id="3Dockerfile__1625"></a>【3】Dockerfile 常用指令</h3> 
<p>（1）FROM<br> 当前镜像是基于哪个镜像的，第一个指令必须是FROM</p> 
<blockquote> 
 <p>FROM :<br> 指明构建的新镜像是来自于哪个基础镜像，如果没有选择tag，那么默认值为latest</p> 
</blockquote> 
<p>（2）MAINTAINER<br> MAINTAINER <br> 指明镜像维护者及其联系方式（一般是邮箱地址）。官方说明已过时，推荐使用LABEL</p> 
<p>（3）LABEL <br> LABEL = … <br> 功能是为镜像指定标签。也可以使用LABEL来指定镜像作者</p> 
<p>（4）RUN <br> RUN <br> 构建镜像时运行的Shell命令，比如构建的新镜像中我们想在/usr/local目录下创建一个java目录<br> （5）ADD <br> ADD … <br> 拷贝文件或目录到镜像中。src 可以是一个本地文件，还可以是一个url。然后自动下载和解压</p> 
<p>（6）COPY<br> COPY … <br> 拷贝文件或目录到镜像中。用法同 ADD，只是不支持自动下载和解压</p> 
<p>（7）EXPOSE <br> EXPOSE [/…] <br> 暴露容器运行时的监听端口给外部，可以指定端口是监听 TCP 还是 UDP，如果未指定协议，则默认为 TCP</p> 
<p>（8）ENV<br> ENV = … <br> 设置容器内环境变量</p> 
<p>（9）CMD<br> CMD [“executable”,“param1”,“param2”] <br> 启动容器时执行的Shell命令。在Dockerfile中只能有一条CMD指令。如果设置了多条CMD，只有最后一条会生效</p> 
<p>（10）ENTRYPOINT<br> ENTRYPOINT [“executable”, “param1”, “param2”]<br> 启动容器时执行的 Shell 命令，同 CMD 类似，不会被 docker run 命令行指定的参数所覆盖，如果设置了多条ENTRYPOINT，只有最后一条会生效</p> 
<p>（11）WORKDIR<br> WORKDIR param <br> 为 RUN、CMD、ENTRYPOINT 以及 COPY 和 AND 设置工作目录</p> 
<p>（12）VOLUME<br> VOLUME [“param”] <br> 指定容器挂载点到宿主机自动生成的目录或其他容器。一般的使用场景为需要持久化存储数据时</p> 
<h3><a id="4Dockerfile_1677"></a>【4】Dockerfile指令的使用案例</h3> 
<h4><a id="1centos_1679"></a>（1）先拉取一个centos的镜像</h4> 
<pre><code class="prism language-powershell">docker pull centos
</code></pre> 
<p><img src="https://images2.imgbox.com/84/6e/YDbOJqKS_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2centos_1685"></a>（2）启动centos</h4> 
<p>现在的centos里面是空的</p> 
<pre><code class="prism language-powershell">docker run centos:latest
</code></pre> 
<p>没有任何反应，只有一个空的操作系统，不会有其他服务阻塞操作系统</p> 
<p>然后使用后台启动</p> 
<pre><code class="prism language-powershell">docker run <span class="token operator">-</span>d centos:latest
</code></pre> 
<p>查看，还是没有任何运行的镜像，那是因为启动之后马上就关闭了<br> <img src="https://images2.imgbox.com/a8/b2/X3Ni5yz0_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="3_1700"></a>（3）阻塞操作系统，启动的一刹那就进入操作系统</h4> 
<pre><code class="prism language-powershell"><span class="token comment"># 等操作系统运行之后再进入</span>
docker exec <span class="token operator">-</span>it centos:latest
<span class="token comment"># 在操作系统启动的时候就进入</span>
docker run <span class="token operator">-</span>it centos:latest
</code></pre> 
<p><img src="https://images2.imgbox.com/e7/4b/L4TMOKsk_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="4FROM_1709"></a>（4）测试FROM指令</h4> 
<p>接下来在centos镜像的基础上构建我们自己的镜像<br> 直接在用户根目录下创建Dockerfile文件</p> 
<pre><code class="prism language-powershell">vim Dockerfile
</code></pre> 
<p>添加下面内容</p> 
<pre><code class="prism language-powershell"><span class="token keyword">FROM</span> centos:latest
</code></pre> 
<p>保存退出<br> <img src="https://images2.imgbox.com/09/7c/0EhPA2v9_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="5_1723"></a>（5）构建镜像</h4> 
<pre><code class="prism language-powershell">docker build <span class="token operator">-</span>t mycentos:01 <span class="token punctuation">.</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/45/e8/nn5mJr5p_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/f1/9d/GqorU2KB_o.png" alt="在这里插入图片描述"><br> 可以看到镜像已经创建成功了</p> 
<h4><a id="6_1731"></a>（6）一点优化</h4> 
<p>可以看到根目录下除了Dockerfile还有其他不相关的文件，例如anaconda-ks.cfg，在构建镜像的时候会把这些文件都发送给docker，但是这些我们是用不到的。所以平时可以新建一个docker文件夹，然后把用到的相关文件都放在这个文件夹下<br> <img src="https://images2.imgbox.com/af/fb/fpZtYl1i_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="7RUN_1735"></a>（7）测试RUN指令</h4> 
<p>原始的centos系统是没有安装vim的，我们要使用vim需要用yum下载<br> <img src="https://images2.imgbox.com/5d/33/AY7yp3wM_o.png" alt="在这里插入图片描述">我们希望镜像构建的时候自动安装好vim工具。</p> 
<p>RUN命令就是在上一步的命令基础上执行一些命令操作<br> <img src="https://images2.imgbox.com/81/81/bjDvKTYg_o.png" alt="在这里插入图片描述"><br> 修改Dockerfile文件如下<br> <img src="https://images2.imgbox.com/4b/49/FFRIoVwH_o.png" alt="在这里插入图片描述">保存退出以后，重新构建</p> 
<pre><code class="prism language-powershell">docker build <span class="token operator">-</span>t mycentos:02 <span class="token punctuation">.</span>
</code></pre> 
<p>发现报错了，报错内容如下<br> <img src="https://images2.imgbox.com/fd/f8/ByC1TrUK_o.png" alt="在这里插入图片描述"><br> 原因就是CentOS在2020 年 12 月 8 号，CentOS 官方宣布了停止维护 CentOS Linux 的计划，并推出了 CentOS Stream 项目，CentOS Linux 8 作为 RHEL 8 的复刻版本，生命周期缩短，于 2021 年 12 月 31 日停止更新并停止维护（EOL）。</p> 
<p>解决方法为更改镜像，需要将镜像从 mirror.centos.org 更改为 vault.centos.org</p> 
<p>修改Dockerfile，添加内容如下</p> 
<pre><code class="prism language-powershell">RUN cd <span class="token operator">/</span>etc/yum<span class="token punctuation">.</span>repos<span class="token punctuation">.</span>d/
RUN sed <span class="token operator">-</span>i <span class="token string">'s/mirrorlist/#mirrorlist/g'</span> <span class="token operator">/</span>etc/yum<span class="token punctuation">.</span>repos<span class="token punctuation">.</span>d/CentOS-<span class="token operator">*</span>
RUN sed <span class="token operator">-</span>i <span class="token string">'s|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g'</span> <span class="token operator">/</span>etc/yum<span class="token punctuation">.</span>repos<span class="token punctuation">.</span>d/CentOS-<span class="token operator">*</span>
RUN yum update <span class="token operator">-</span>y
RUN yum install <span class="token operator">-</span>y vim
</code></pre> 
<p><img src="https://images2.imgbox.com/82/11/yEQQ3Q3f_o.png" alt="在这里插入图片描述">然后再次构建镜像</p> 
<pre><code class="prism language-powershell">docker build <span class="token operator">-</span>t mycentos:02 <span class="token punctuation">.</span>
</code></pre> 
<p>执行结果，镜像构建成功，yum已经成功更新并安装了vim<br> <img src="https://images2.imgbox.com/50/e8/SGlhNyko_o.png" alt="在这里插入图片描述"><br> 运行镜像，并使用vim</p> 
<pre><code class="prism language-powershell">docker run <span class="token operator">-</span>it mycentos:02
</code></pre> 
<p><img src="https://images2.imgbox.com/b6/85/zYkienIw_o.png" alt="在这里插入图片描述"></p> 
<p>补充信息：RUN命令还可以使用数组的语法，例如【RUN [“yum”,“install”,“-y”,“vim”]】，这种数组的方式就不能使用缓存了</p> 
<h4><a id="8EXPOSE_1781"></a>（8）测试EXPOSE指令</h4> 
<p>当前容器对外暴露出的端口号，EXPOSE指令的作用只是声明，它只是方便描述端口暴露信息，即使这里不加，后面也可以启动的时候也可以通过-p命令指定端口</p> 
<p><img src="https://images2.imgbox.com/d4/1a/nK5vao6E_o.png" alt="在这里插入图片描述"><br> 构建，然后运行镜像</p> 
<pre><code class="prism language-powershell">docker build <span class="token operator">-</span>t mycentos:03 <span class="token punctuation">.</span>
docker run <span class="token operator">-</span>it mycentos:03
</code></pre> 
<h4><a id="9WORKDIR_1792"></a>（9）测试WORKDIR指令</h4> 
<p>指定在创建容器之后，终端默认登录进来的工作目录，一个落脚点。我们以前使用run命令启动一个容器以后，工作目录默认是跟根目录“/”<br> <img src="https://images2.imgbox.com/95/e2/kjwaZ2Tw_o.png" alt="在这里插入图片描述"><br> 而WORKDIR命令用来为Dockerfile中的任何RUN，CMD，ENTRPOINT，COPY和ADD指令设置工作目录，如果WORKDIR不存在，即使它没有在任何后续Dockerfile指令中使用，它也会被创建。</p> 
<p>WORKDIR指令可以在Dockerfile中多次使用，如果提供了相对路径，则该路径将与先前WORKDIR指令的路径相对</p> 
<p><img src="https://images2.imgbox.com/58/25/qsn9GQ4S_o.png" alt="在这里插入图片描述"><br> 然后创建并启动</p> 
<pre><code class="prism language-powershell">docker build <span class="token operator">-</span>t mycentos:04 <span class="token punctuation">.</span>
docker run <span class="token operator">-</span>it mycentos:04
</code></pre> 
<p>可以看到默认进入的是自定义的allen目录<br> <img src="https://images2.imgbox.com/fd/f2/oJG5ZFXB_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="10ADD_1808"></a>（10）测试ADD指令</h4> 
<p>我们以后创建镜像的时候，可能要把本地的jar包拷贝到镜像里面</p> 
<p>我们首先在本地docker文件夹里创建一个txt文件，然后尝试在构建镜像的时候把这个txt文件拷贝进去<br> <img src="https://images2.imgbox.com/7b/4f/nPdSTwd2_o.png" alt="在这里插入图片描述">这里已经指定了工作目录为/allen/data，然后添加宿主机当前目录下额xxx.txt文件到镜像的工作目录里，也就是放进/allen/data里。</p> 
<p>然后创建并启动</p> 
<pre><code class="prism language-powershell">docker build <span class="token operator">-</span>t mycentos:05 <span class="token punctuation">.</span>
docker run <span class="token operator">-</span>it mycentos:05
</code></pre> 
<p>可以看到默认进入的工作目录就是/allen/data，并且目录下有添加进来的xxx.txt文件<br> <img src="https://images2.imgbox.com/d8/4d/koGZk10O_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="11COPY_1823"></a>（11）测试COPY指令</h4> 
<p>其实跟ADD命令的使用方式和作用是一样的，那么ADD和COPY的区别到底是什么呢？</p> 
<p>COPY功能比较简单，它就只能拷贝文件到镜像里，不能做额外的操作，仅仅是一个复制的作用，而ADD相对有一点强大，ADD还能搭配URL使用，当ADD和URL使用时会自动通过URL进行下载</p> 
<p>例如我们通过URL直接下载一个tomcat，并且使用RUN执行解压等一系列操作<br> Tomcat下载地址：https://downloads.apache.org/tomcat/tomcat-8/v8.5.91/bin/apache-tomcat-8.5.91.tar.gz</p> 
<p><img src="https://images2.imgbox.com/6d/a6/n2KLFQhr_o.png" alt="在这里插入图片描述"></p> 
<p>然后创建并启动</p> 
<pre><code class="prism language-powershell">docker build <span class="token operator">-</span>t mycentos:06 <span class="token punctuation">.</span>
docker run <span class="token operator">-</span>it mycentos:06
</code></pre> 
<p><img src="https://images2.imgbox.com/ff/10/Uf8E78U8_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="12ENV_1844"></a>（12）测试ENV指令</h4> 
<p>上面我们在使用WORKDIR设置工作目录的时候，有时候要多次使用来切换RUN命令的工作目录，这个时候我们就可以用ENV来把常用目录设置成配置，方便统一修改和使用</p> 
<p><img src="https://images2.imgbox.com/b4/c6/fE7iDnAw_o.png" alt="在这里插入图片描述"></p> 
<p>然后创建并启动</p> 
<pre><code class="prism language-powershell">docker build <span class="token operator">-</span>t mycentos:07 <span class="token punctuation">.</span>
docker run <span class="token operator">-</span>it mycentos:07
</code></pre> 
<p>可以看到默认工作目录切换回了/allen/data<br> <img src="https://images2.imgbox.com/a0/01/N8rZrBBx_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="13VOLUME_1858"></a>（13）测试VOLUME指令</h4> 
<p>VOLUME指令和EXPOSE指令类似，都是声明指令，方便查看描述信息，不加的话也没关系，可以通过-v命令在启动的时候挂载数据卷</p> 
<p>如果我们不使用VOLUME命令，直接使用-v命令</p> 
<pre><code class="prism language-powershell">docker run <span class="token operator">-</span>v datas:<span class="token operator">/</span>allen mycentos:07
</code></pre> 
<p>启动成功以后查看数据卷列表</p> 
<pre><code class="prism language-powershell">docker volume <span class="token function">ls</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/73/56/MM6sgK2I_o.png" alt="在这里插入图片描述"><br> 进入数据卷查看</p> 
<pre><code class="prism language-powershell">docker inspect datas
</code></pre> 
<p><img src="https://images2.imgbox.com/26/6c/QE2RVhRI_o.png" alt="在这里插入图片描述"><br> 进入具体的目录里查看</p> 
<pre><code class="prism language-powershell">cd <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib/docker/volumes/datas/_data
</code></pre> 
<p><img src="https://images2.imgbox.com/0d/de/H2ymY19H_o.png" alt="在这里插入图片描述"><br> 如果是使用VOLUME的话<br> <img src="https://images2.imgbox.com/f1/c2/HqCuwFEt_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="14CMD_1888"></a>（14）测试CMD命令</h4> 
<p>指定一个容器启动时要运行的命令，Dockerfile中可以有多个CMD指令，但是只有最后一个才会生效，CMD会被docker run之后的参数替换</p> 
<p>例如我们在构建镜像的时候，要启动jar包，就会使用java -jar命令。</p> 
<p>使用语法：<br> （1）直接命令方式<br> java -jar ems.jar<br> （2）JSON数组方式（推荐）<br> [“java”,“-jar”,“ems.jar”]</p> 
<p>更推荐json数组的方式，因为json数组可以支持传参</p> 
<p>案例1：用CMD展示/allen/data下面的文件（ENTRYPOINT的用法相同）<br> <img src="https://images2.imgbox.com/44/28/7oP7zHTP_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-powershell">docker build <span class="token operator">-</span>t mycentos:08 <span class="token punctuation">.</span>
docker run mycentos:08
</code></pre> 
<p><img src="https://images2.imgbox.com/fc/81/fNKIqDaO_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="15ENTRYPOINT_1912"></a>（15）测试ENTRYPOINT指令</h4> 
<p>指定一个容器启动时要运行的命令，ENTRYPOINT的目的和CMD一样，都是在指定容器启动程序和参数</p> 
<p>首先我们把CMD和ENTRYPOINT都改成是json数组形式<br> <img src="https://images2.imgbox.com/9a/54/BALFjodO_o.png" alt="在这里插入图片描述"><br> （1）如果是CMD命令<br> 我们想要替换ls展示的目录，可以直接使用传参的方式来覆盖</p> 
<p>docker run 镜像:版本号 覆盖自己定义的命令</p> 
<pre><code class="prism language-powershell">docker run mycentos:08 <span class="token function">ls</span> <span class="token operator">/</span>apps
或者
docker run mycentos:08 <span class="token function">ls</span> <span class="token operator">/</span>
</code></pre> 
<p>CMD传参更方便</p> 
<p>（2）如果是ENTRYPOINT命令<br> docker run --entrypoint=覆盖命令 镜像:版本号 传递参数</p> 
<pre><code class="prism language-powershell">docker run <span class="token operator">--</span>entrypoint=<span class="token function">ls</span> mycentos:08 <span class="token operator">/</span>apps
</code></pre> 
<p>（3）如何搭配使用<br> 我们如果要执行一个jar包，可能会使用以下命令</p> 
<pre><code class="prism language-powershell">CMD java <span class="token operator">-</span>jar ems<span class="token punctuation">.</span>jar
ENTRYPOINT java <span class="token operator">-</span>jar ems<span class="token punctuation">.</span>jar
</code></pre> 
<p>java -jar这个指令是不会变的，可能变的是ems.jar这个变量，所以我们希望java -jar不可以通过传参修改，而ems.jar可以通过传参覆盖修改，于是我们可以把这两个指令搭配起来使用。</p> 
<p>使用ENTRYPOINT来写容器固定的指令，CMD来给ENTRYPOINT传递参数，注意的是配合使用时必须使用json数字语法才能传参覆盖</p> 
<pre><code class="prism language-powershell">ENTRYPOINT <span class="token punctuation">[</span><span class="token string">"java"</span><span class="token punctuation">,</span><span class="token string">"-jar"</span><span class="token punctuation">]</span>
CMD <span class="token punctuation">[</span><span class="token string">"ems.jar"</span><span class="token punctuation">]</span>
</code></pre> 
<p>前面的文件展示也可以改成下面这样</p> 
<pre><code class="prism language-powershell">ENTRYPOINT <span class="token punctuation">[</span><span class="token string">"ls"</span><span class="token punctuation">]</span>
CMD <span class="token punctuation">[</span><span class="token string">"/allen/data"</span><span class="token punctuation">]</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/20/56/K0V4Ui5h_o.png" alt="在这里插入图片描述"></p> 
<p>（4）创建镜像并启动</p> 
<pre><code class="prism language-powershell">docker build <span class="token operator">-</span>t mycentos:09 <span class="token punctuation">.</span>
docker run mycentos:09
</code></pre> 
<p><img src="https://images2.imgbox.com/58/db/vekfsv7c_o.png" alt="在这里插入图片描述">测试一下传参</p> 
<pre><code class="prism language-powershell">docker run mycentos:09 <span class="token operator">/</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ab/5c/CRQv4yxM_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_1971"></a>【3】构建镜像</h3> 
<p>Dockerfile文件编写好以后，真正构建镜像时需要通过docker build命令。</p> 
<p>docker build命令用于使用Dockerfile创建镜像，进入放置Dockerfile的文件夹，然后执行命令，或者在命令中指明Dockerfile的路径</p> 
<pre><code class="prism language-powershell"><span class="token comment"># .的意思就是使用当前目录的 Dockerfile 创建镜像</span>
docker build <span class="token operator">-</span>t mycentos:7 <span class="token punctuation">.</span>

<span class="token comment"># 通过 -f Dockerfile 文件的位置创建镜像</span>
docker build <span class="token operator">-</span>f <span class="token operator">/</span>home/ruoyi/docker/Dockerfile <span class="token operator">-</span>t mycentos:7 <span class="token punctuation">.</span>
</code></pre> 
<p>-f：指定要使用的 Dockerfile 路径；<br> –tag, -t：镜像的名字及标签，可以在一次构建中为一个镜像设置多个标签。</p> 
<h3><a id="4Dockerfile__1987"></a>【4】Dockerfile 实践</h3> 
<p>接下来我们通过基础镜像centos:7，在该镜像中安装jdk和tomcat以后将其制作为一个新的镜像mycentos:7</p> 
<p>（1）创建目录，编写Dockerfile文件</p> 
<pre><code class="prism language-powershell">mkdir <span class="token operator">-</span>p <span class="token operator">/</span>usr/local/`dockerfile`
</code></pre> 
<p>（2）执行命令：vi Dockerfile，写入信息。</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 指明构建的新镜像是来自于`centos:7`基础镜像</span>
<span class="token keyword">FROM</span> centos:7
<span class="token comment"># 通过镜像标签声明了作者信息</span>
LABEL maintainer=<span class="token string">"ruoyi.vip"</span>

<span class="token comment"># 设置工作目录</span>
WORKDIR <span class="token operator">/</span>usr/local
<span class="token comment"># 新镜像构建成功以后创建指定目录</span>
RUN mkdir <span class="token operator">-</span>p <span class="token operator">/</span>usr/local/java &amp;&amp; mkdir <span class="token operator">-</span>p <span class="token operator">/</span>usr/local/tomcat
<span class="token comment"># 拷贝文件到镜像中并解压</span>
ADD jdk-8u111-linux-x64<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz <span class="token operator">/</span>usr/local/java
ADD apache-tomcat-8<span class="token punctuation">.</span>5<span class="token punctuation">.</span>27<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz <span class="token operator">/</span>usr/local/tomcat
<span class="token comment"># 暴露容器运行时的 8080 监听端口给外部</span>
EXPOSE 8080
<span class="token comment"># 设置容器内 JAVA_HOME 环境变量</span>
ENV JAVA_HOME <span class="token operator">/</span>usr/local/java/jdk1<span class="token punctuation">.</span>8<span class="token punctuation">.</span>0_111
ENV PATH <span class="token variable">$PATH</span>:<span class="token variable">$JAVA_HOME</span><span class="token operator">/</span>bin
<span class="token comment"># 启动容器时启动 tomcat</span>
CMD <span class="token punctuation">[</span><span class="token string">"/usr/local/tomcat/apache-tomcat-8.5.27/bin/catalina.sh"</span><span class="token punctuation">,</span> <span class="token string">"run"</span><span class="token punctuation">]</span>
</code></pre> 
<p>（3）构建镜像</p> 
<pre><code class="prism language-powershell">docker build <span class="token operator">-</span>f <span class="token operator">/</span>home/ruoyi/docker/Dockerfile <span class="token operator">-</span>t mycentos:test <span class="token punctuation">.</span>
</code></pre> 
<p>（4）启动镜像</p> 
<pre><code class="prism language-powershell">docker run <span class="token operator">-</span>di <span class="token operator">--</span>name mycentos <span class="token operator">-</span>p 8080:8080 mycentos:test
</code></pre> 
<p>（5）进入容器</p> 
<pre><code class="prism language-powershell">docker exec <span class="token operator">-</span>it mycentos7 <span class="token operator">/</span>bin/bash
</code></pre> 
<p>（6）查看镜像构建历史</p> 
<pre><code class="prism language-powershell">docker history mycentos:7
docker history 镜像名称:标签<span class="token punctuation">|</span>ID
</code></pre> 
<h3><a id="5_2044"></a>【5】镜像仓库</h3> 
<p>（1）介绍<br> 我们使用的镜像都是从DockerHub公共仓库拉取的，我们也学习了如何制作自己的镜像，但是通过tar包的方式实现镜像的备份恢复迁移对于团队协作开发并不是特别友好，我们也可以将镜像推送至DockerHub仓库方便使用。</p> 
<p>温馨提示：如果构建的镜像内携带了项目数据，建议还是使用私有仓库比较好。</p> 
<p>（2）注册账号<br> 官网：https://hub.docker.com<br> <img src="https://images2.imgbox.com/a2/49/8eQPY7MS_o.png" alt="在这里插入图片描述"></p> 
<p>（3）登录账号<br> 通过docker login命令输入账号密码登录DockerHub<br> <img src="https://images2.imgbox.com/5d/bc/EsW17B4I_o.png" alt="在这里插入图片描述"><br> （4）推送镜像至仓库<br> 为了方便测试，我们将hello-world镜像拉取至本地，然后再上传至DockerHub仓库中。</p> 
<pre><code class="prism language-powershell">docker tag hello-world:latest ruoyivip/<span class="token function">test-hello</span><span class="token operator">-</span>world:1<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0
docker push ruoyivip/<span class="token function">test-hello</span><span class="token operator">-</span>world:1<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0
</code></pre> 
<p>（5）查看仓库<br> <img src="https://images2.imgbox.com/30/5d/KwSh91JO_o.png" alt="在这里插入图片描述"></p> 
<p>（6）拉取镜像<br> 通过docker pull ruoyivip/test-hello-world:1.0.0测试镜像是否可以拉取。</p> 
<p>（7）退出账号<br> 通过docker logout退出账号</p> 
<h2><a id="dockerfile_2075"></a>【六】用dockerfile完成项目部署的案例</h2> 
<h3><a id="1Dockerfile_2077"></a>【1】案例一：自己创建一个增删改查的项目并用Dockerfile部署</h3> 
<h4><a id="1springboot_2078"></a>（1）创建一个springboot项目</h4> 
<p>项目创建后，完成以下准备工作<br> （1）idea连接数据库<br> 首先启动mysql容器</p> 
<pre><code class="prism language-powershell">docker <span class="token function">start</span> mysql5
</code></pre> 
<p>然后idea连接mysql，跟上面Navicat连接的过程类似<br> <img src="https://images2.imgbox.com/89/b4/BcxT70w3_o.png" alt="在这里插入图片描述"><br> （2）添加相关的依赖<br> 确认一下springboot版本为2.5.2</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.49<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.19<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>compile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--domain.page--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-jpa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>（3）编写yml配置文件</p> 
<pre><code class="prism language-yml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8989</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
    <span class="token key atrule">context-path</span><span class="token punctuation">:</span> /docker_springboot
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/tmall_springboot<span class="token punctuation">?</span>characterEncoding=UTF<span class="token punctuation">-</span>8<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
<span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mapper/<span class="token important">*.xml</span>
  <span class="token key atrule">type-aliases-package</span><span class="token punctuation">:</span> com.allen.docker_springboot.entity
</code></pre> 
<p>（4）下载自动生成代码的插件easycode<br> （5）使用插件自动生成增删改查的代码<img src="https://images2.imgbox.com/88/4d/UChuu3aX_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/e7/d7/QMvVFdMi_o.png" alt="在这里插入图片描述"></p> 
<p>（6）查看代码的生成结果</p> 
<p><img src="https://images2.imgbox.com/a6/29/xFu5WGoJ_o.png" alt="在这里插入图片描述"><br> 修改启动类，加上扫描路径<br> <img src="https://images2.imgbox.com/1b/a6/4pICn4Te_o.png" alt="在这里插入图片描述"></p> 
<p>（7）启动项目，测试接口<br> 访问地址：http://localhost:8989/docker_springboot/category/64<br> <img src="https://images2.imgbox.com/19/4e/qYeNKgFY_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2docker_2160"></a>（2）docker创建网络</h4> 
<pre><code class="prism language-powershell">docker network create apps
</code></pre> 
<p>然后查看容器</p> 
<pre><code class="prism language-powershell">docker <span class="token function">ps</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/09/f4/kaybgcOT_o.png" alt="在这里插入图片描述"><br> 然后把mysql加到网络中去</p> 
<pre><code class="prism language-powershell">docker network connect apps e3
</code></pre> 
<p>最后查看一下网络</p> 
<pre><code class="prism language-powershell">docker inspect apps
</code></pre> 
<p><img src="https://images2.imgbox.com/e8/39/401ZSWHP_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="3jar_2184"></a>（3）把项目打成jar包</h4> 
<p>打成jar包之前，要把yml配置文件里的mysql的ip地址，端口号，密码等信息都换成服务器的，不能直接用localhost。</p> 
<p>我们可以直接把ip改成对应服务器的ip来替换localhost，还有另外一种方式，因为上面已经设置了网络，名称为mysql5，所以我们可以直接用mysql5<br> <img src="https://images2.imgbox.com/15/a9/2f9tzAdu_o.png" alt="在这里插入图片描述"></p> 
<p>然后开始打包</p> 
<p><img src="https://images2.imgbox.com/21/02/2eBnPhhr_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="4Dockerfilejar_2194"></a>（4）创建Dockerfile文件，并上传jar包</h4> 
<p>进入之前创建的专门放置docker文件的文件夹/docker，然后创建一个专属该项目的文件夹/docker_springboot，进入，然后vi Dockerfile创建Dockerfile文件，编辑输入以下内容</p> 
<pre><code class="prism language-powershell"><span class="token keyword">FROM</span> java:8
ENV APP_PATH=<span class="token operator">/</span>docker/docker_springboot
WORKDIR <span class="token variable">$APP_PATH</span>
ADD <span class="token punctuation">.</span><span class="token operator">/</span>docker_springboot-0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1-SNAPSHOT<span class="token punctuation">.</span>jar <span class="token variable">$APP_PATH</span><span class="token operator">/</span>app<span class="token punctuation">.</span>jar
EXPOSE 8989
ENTRYPOINT <span class="token punctuation">[</span><span class="token string">"java"</span><span class="token punctuation">,</span><span class="token string">"-jar"</span><span class="token punctuation">]</span>
CMD <span class="token punctuation">[</span><span class="token string">"app.jar"</span><span class="token punctuation">,</span><span class="token string">"-Dfile.encoding=GBK"</span><span class="token punctuation">,</span> <span class="token string">"--server.port=8989"</span><span class="token punctuation">]</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/3e/64/mIxk40sJ_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="5dockerfile_2208"></a>（5）用dockerfile构建镜像</h4> 
<p>进入存放Dockerfile的目录下面</p> 
<pre><code class="prism language-powershell">cd <span class="token operator">/</span>root/docker/docker_springboot

<span class="token comment">#docker build –f （dockerfile文件路径） –t 镜像名称:版本  .</span>
docker build <span class="token operator">-</span>t apps:1<span class="token punctuation">.</span>0 <span class="token punctuation">.</span>
</code></pre> 
<p>构建完毕<br> <img src="https://images2.imgbox.com/e0/d4/nrrbeJCV_o.png" alt="在这里插入图片描述">查看镜像，可以看到下面已经有镜像了</p> 
<pre><code class="prism language-powershell">docker images
</code></pre> 
<p><img src="https://images2.imgbox.com/97/42/xddMXTCV_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="6_2225"></a>（6）使用镜像创建容器</h4> 
<p>暴露的端口号是8989</p> 
<pre><code class="prism language-powershell"><span class="token comment">#这里可以使用【镜像id】，也可以使用名称+版本号【apps:1.0】</span>
docker run <span class="token operator">-</span>d <span class="token operator">-</span>p 8989:8989 <span class="token operator">--</span>name apps apps:1<span class="token punctuation">.</span>0
</code></pre> 
<blockquote> 
 <p>这一步我们可以使用–network直接加入网络，也可以在后面再加入，先使用上面的创建命令<br> docker run -d -p 8989:8989 --name apps --network apps apps:1.0</p> 
</blockquote> 
<p>下面开始加入网络</p> 
<pre><code class="prism language-powershell">docker network connect apps 容器id
</code></pre> 
<p>查看网络</p> 
<pre><code class="prism language-powershell">docker inspect apps
</code></pre> 
<p>查看运行的容器</p> 
<pre><code class="prism language-powershell">docker <span class="token function">ps</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ed/c2/5TQZWQE8_o.png" alt="在这里插入图片描述"><br> 通过【docker logs 容器ID】来查看springboot的日志，看看是不是真的启动成功了</p> 
<p>如果有报错，要删除容器和镜像，然后需要重新打包执行</p> 
<pre><code class="prism language-powershell">docker <span class="token function">ps</span>
停止运行的容器：docker stop 容器id
删除容器：docker <span class="token function">rm</span> 容器id
docker images
删除镜像：docker rmi <span class="token operator">-</span>f 镜像id
</code></pre> 
<p>或者可以使用下面这个命令启动，不用后台启动了，可以直接查看启动日志</p> 
<pre><code class="prism language-powershell"><span class="token comment">#docker run -p 8989:8989 镜像ID</span>
docker run <span class="token operator">-</span>p 8989:8989 镜像ID
</code></pre> 
<p>看到下面的日志说明启动成功了<br> <img src="https://images2.imgbox.com/8d/9f/C6oh4hwK_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="7_2278"></a>（7）本地测试</h4> 
<p>关闭所有防火墙<br> service firewalld status<br> service firewalld stop</p> 
<p>然后访问地址：http://192.168.19.7:8989/docker_springboot/category/64<br> <img src="https://images2.imgbox.com/42/9a/DIRQJoLb_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2mysqlRedisspringbootwar_2287"></a>【2】案例二：部署包括mysql和Redis的springboot项目war包</h3> 
<h4><a id="1_2290"></a>（1）准备项目代码进行本地测试</h4> 
<p>这里用的是how2j的一个付费项目：<a href="https://how2j.cn/k/tmall_springboot/tmall_springboot-1799/1799.html" rel="nofollow">天猫整站 Springboot </a></p> 
<h4><a id="2_2295"></a>（2）修改项目代码的配置</h4> 
<p>包括mysql和redis，连接信息的ip和端口等等要改成对应的数据</p> 
<h4><a id="3war_2299"></a>（3）项目打成war包</h4> 
<p>因为不是前后端分离的项目，如果打成jar包的话会报错找不到jsp文件<br> 所以把项目打成war包，需要修改pom.xml<br> <img src="https://images2.imgbox.com/41/d5/xkRx4Cbb_o.png" alt="在这里插入图片描述"></p> 
<p>然后使用maven执行clean+package<br> <img src="https://images2.imgbox.com/ff/86/zWdageBl_o.png" alt="在这里插入图片描述"><br> 找到war包的位置，package点击完后，控制台输出打包结果，复制路径找到war包</p> 
<p><img src="https://images2.imgbox.com/2a/21/0RZB2Msl_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="4_2314"></a>（4）启动各个容器</h4> 
<p>包括docker、mysql、redis<br> 这些镜像在上面已经拉取和创建了</p> 
<p>（1）启动docker：sudo systemctl start docker<br> （2）启动mysql：docker start mysql<br> （3）启动redis：docker start redis</p> 
<h4><a id="5mysql_2322"></a>（5）导入项目的数据到mysql</h4> 
<p>可以通过外网的工具navicat连接服务器的mysql，然后方便操作<br> <img src="https://images2.imgbox.com/e7/c3/ezXw4xzf_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="6springboot_2327"></a>（6）上传springboot项目到服务器，防火墙开放端口</h4> 
<p>在服务器中新建一个文件夹用来存放我们的项目文件，可以使用sftp工具实现往服务器上传文件</p> 
<pre><code class="prism language-powershell">mkdir <span class="token operator">-</span>p <span class="token operator">/</span>usr/local/docker
</code></pre> 
<h4><a id="7dockerfile_2335"></a>（7）编写dockerfile文件</h4> 
<p>（1）新建一个txt文件即可</p> 
<pre><code class="prism language-powershell">cd <span class="token operator">/</span>usr/local/docker

touch tmall_docker

vi tmall_docker
</code></pre> 
<p>标准的还是进入目录后，直接vim就行了</p> 
<pre><code class="prism language-powershell">cd <span class="token operator">/</span>usr/local/docker

vim Dockerfile
</code></pre> 
<p>（2）添加的内容如下：</p> 
<pre><code class="prism language-powershell"><span class="token comment">#定义父镜像</span>
<span class="token keyword">FROM</span> java:8
<span class="token comment">#定义作者信息</span>
MAINTAINER AllenSun&lt;&gt;
<span class="token comment">#VOLUME指定临时文件目录为tmp，在主机/var/lib/docker目录下创建了一个临时文件并链接到容器的/tmp</span>
VOLUME <span class="token operator">/</span>tmp
<span class="token comment">#ADD 将war包添加到容器中并更名为tmall_docker.war</span>
ADD <span class="token punctuation">.</span><span class="token operator">/</span>tmall_springboot_middle-0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1-SNAPSHOT<span class="token punctuation">.</span>war tmall_docker<span class="token punctuation">.</span>war
<span class="token comment">#暴露7777端口作为项目端口</span>
EXPOSE 7777
CMD <span class="token punctuation">[</span><span class="token string">"java"</span><span class="token punctuation">,</span><span class="token string">"-jar"</span><span class="token punctuation">,</span><span class="token string">"tmall_docker.war"</span><span class="token punctuation">,</span><span class="token string">"-Dfile.encoding=GBK"</span><span class="token punctuation">,</span> <span class="token string">"--server.port=7777"</span><span class="token punctuation">]</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/2b/99/kGycRhem_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="8dockerfile_2372"></a>（8）用dockerfile构建镜像</h4> 
<pre><code class="prism language-powershell"><span class="token comment">#docker build –f （dockerfile文件路径） –t 镜像名称:版本  .</span>
docker build <span class="token operator">-</span>f <span class="token punctuation">.</span><span class="token operator">/</span>tmall_docker <span class="token operator">-</span>t springboot_tmall:1<span class="token punctuation">.</span>6 <span class="token punctuation">.</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a4/32/BHzOU3GL_o.png" alt="在这里插入图片描述"></p> 
<p>docker image查看镜像是否创建成功</p> 
<p><img src="https://images2.imgbox.com/98/f6/XLW7N74W_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="9_2387"></a>（9）使用镜像创建容器</h4> 
<p>暴露的端口号是7777</p> 
<pre><code class="prism language-powershell"><span class="token comment">#docker run -d -p 7777:7777 镜像ID</span>
docker run <span class="token operator">-</span>d <span class="token operator">-</span>p 7777:7777 镜像ID
</code></pre> 
<p>报错了<br> <img src="https://images2.imgbox.com/42/f4/sFCLFJfG_o.png" alt="在这里插入图片描述"><br> 重启docker和jdk+redis+nysql，再执行上面的命令就可以了</p> 
<pre><code class="prism language-powershell">systemctl restart docker
docker <span class="token function">start</span> 镜像名
</code></pre> 
<h4><a id="10_2406"></a>（10）本地测试</h4> 
<p>首先通过【docker logs 容器ID】来查看springboot是不是真的启动成功了<br> <img src="https://images2.imgbox.com/4d/f1/Gb65amAQ_o.png" alt="在这里插入图片描述"><br> 然后访问网址链接：ip地址:7777/tmall_springboot/login</p> 
<p><img src="https://images2.imgbox.com/d1/90/KFOeMYHC_o.png" alt="在这里插入图片描述"><br> 如果使用的过程中有报错，那就用上面的命令看看日志内容。</p> 
<h3><a id="3Dockerfile_2417"></a>【3】案例三：用Dockerfile构建一个自定义镜像</h3> 
<p>我们可以通过公共仓库拉取镜像使用，但是，有些时候公共仓库拉取的镜像并不符合我们的需求。尽管已经从繁琐的部署工作中解放出来，但是实际开发时，我们可能希望镜像包含整个项目的完整环境，在其他机器上拉取打包完整的镜像，直接运行即可。</p> 
<p>接下来我们通过基础镜像centos:7，在该镜像中安装jdk和tomcat以后将其制作为一个新的镜像mycentos:7</p> 
<p>（1）编写Dockerfile文件</p> 
<pre><code class="prism language-powershell">mkdir <span class="token operator">-</span>p <span class="token operator">/</span>usr/local/`dockerfile`
</code></pre> 
<p>执行命令：vi Dockerfile，写入信息。</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 指明构建的新镜像是来自于`centos:7`基础镜像</span>
<span class="token keyword">FROM</span> centos:7
<span class="token comment"># 通过镜像标签声明了作者信息</span>
LABEL maintainer=<span class="token string">"ruoyi.vip"</span>

<span class="token comment"># 设置工作目录</span>
WORKDIR <span class="token operator">/</span>usr/local
<span class="token comment"># 新镜像构建成功以后创建指定目录</span>
RUN mkdir <span class="token operator">-</span>p <span class="token operator">/</span>usr/local/java &amp;&amp; mkdir <span class="token operator">-</span>p <span class="token operator">/</span>usr/local/tomcat
<span class="token comment"># 拷贝文件到镜像中并解压</span>
ADD jdk-8u111-linux-x64<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz <span class="token operator">/</span>usr/local/java
ADD apache-tomcat-8<span class="token punctuation">.</span>5<span class="token punctuation">.</span>27<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz <span class="token operator">/</span>usr/local/tomcat
<span class="token comment"># 暴露容器运行时的 8080 监听端口给外部</span>
EXPOSE 8080
<span class="token comment"># 设置容器内 JAVA_HOME 环境变量</span>
ENV JAVA_HOME <span class="token operator">/</span>usr/local/java/jdk1<span class="token punctuation">.</span>8<span class="token punctuation">.</span>0_111
ENV PATH <span class="token variable">$PATH</span>:<span class="token variable">$JAVA_HOME</span><span class="token operator">/</span>bin
<span class="token comment"># 启动容器时启动 tomcat</span>
CMD <span class="token punctuation">[</span><span class="token string">"/usr/local/tomcat/apache-tomcat-8.5.27/bin/catalina.sh"</span><span class="token punctuation">,</span> <span class="token string">"run"</span><span class="token punctuation">]</span>
</code></pre> 
<p>（2）构建镜像</p> 
<pre><code class="prism language-powershell">docker build <span class="token operator">-</span>f <span class="token operator">/</span>home/ruoyi/docker/Dockerfile <span class="token operator">-</span>t mycentos:test <span class="token punctuation">.</span>
</code></pre> 
<p>（3）启动镜像</p> 
<pre><code class="prism language-powershell">docker run <span class="token operator">-</span>di <span class="token operator">--</span>name mycentos <span class="token operator">-</span>p 8080:8080 mycentos:test
</code></pre> 
<p>（4）进入容器</p> 
<pre><code class="prism language-powershell">docker exec <span class="token operator">-</span>it mycentos7 <span class="token operator">/</span>bin/bash
</code></pre> 
<p>（5）使用镜像仓库<br> 我们使用的镜像都是从DockerHub公共仓库拉取的，我们也学习了如何制作自己的镜像，但是通过tar包的方式实现镜像的备份恢复迁移对于团队协作开发并不是特别友好，我们也可以将镜像推送至DockerHub仓库方便使用。</p> 
<p>温馨提示：如果构建的镜像内携带了项目数据，建议还是使用私有仓库比较好。</p> 
<p>（6）注册账号<br> 官网：https://hub.docker.com<br> 通过docker login命令输入账号密码登录DockerHub</p> 
<p><img src="https://images2.imgbox.com/af/17/n27ccRbs_o.png" alt="在这里插入图片描述">（7）推送镜像至仓库<br> 为了方便测试，我们将hello-world镜像拉取至本地，然后再上传至DockerHub仓库中。</p> 
<pre><code class="prism language-powershell">docker tag hello-world:latest ruoyivip/<span class="token function">test-hello</span><span class="token operator">-</span>world:1<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0
docker push ruoyivip/<span class="token function">test-hello</span><span class="token operator">-</span>world:1<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0
</code></pre> 
<p>（8）查看仓库<br> <img src="https://images2.imgbox.com/c0/33/7LjytdXA_o.png" alt="在这里插入图片描述">（9）拉取镜像<br> 通过docker pull ruoyivip/test-hello-world:1.0.0测试镜像是否可以拉取。</p> 
<h2><a id="dockercompose_2492"></a>【七】docker-compose</h2> 
<h3><a id="1docker_2494"></a>【1】介绍（docker容器太多了如何管理）</h3> 
<p>docker和docker compose是两个不同的工具。</p> 
<p>docker是一种开源容器化平台，可以把应用程序和它们的依赖项打包在一个可移植的容器里，以便在任何环境中快速部署。</p> 
<p>docker compose是一个用于定义和运行多容器docker应用程序的工具，使用compose可以使用yaml文件来配置应用程序的服务，并启动/停止/重新生成这些服务。<strong>你需要定义一个yaml格式的配置文件docker-compose.ymal，写好多个容器之间的调用关系。然后，只要一个命令，就能同时启动或者关闭这些容器。</strong></p> 
<p>使用一个dockerfile模板文件可以定义一个单独的应用容器，如果需要定义多个容器就需要服务编排，而compose允许用户在一个模板（ymal格式）中定义一组相关联的应用容器（被称为一个project，即项目），例如一个web服务再加上后端的数据库服务容器等。</p> 
<h3><a id="2_2503"></a>【2】举例说明</h3> 
<p>上面的流程中，已经创建了很多容器，例如mysql、nacos、xxl-job、kafka、zookeeper等等，为了操作方便还给这些容器加上了–restart-always命令让它们自启动。但是这些容器的启动顺序和加载条件我们如何来设置呢？例如我们要先启动mysql，然后启动nacos。我们要先启动zookeeper再启动kafka。除此以外，我们在部署微服务的时候，也会有多个容器的启动顺序问题，同样需要编排。</p> 
<h3><a id="3dockercomposeyml__2507"></a>【3】docker-compose.yml 文件详解</h3> 
<h4><a id="1_2509"></a>（1）介绍</h4> 
<p>Docker Compose允许用户通过docker-compose.yml文件（YAML 格式）来定义一组相关联的容器为一个工程（project）。一个工程包含多个服务（service），每个服务中定义了创建容器时所需的镜像、参数、依赖等。</p> 
<p>Docker Compose模板文件我们需要关注的顶级配置有version、services、networks、volumes几个部分，除version外，其他几个顶级配置下还有很多下级配置，后面也会详细给大家介绍，先来看看这几个顶级配置都什么意思：</p> 
<p>（1）version：描述Compose文件的版本信息，当前最新版本为3.8，对应的Docker版本为19.03.0+<br> （2）services：定义服务，可以多个，每个服务中定义了创建容器时所需的镜像、参数、依赖等<br> （3）networkds：定义网络，可以多个，根据DNS server让相同网络中的容器可以直接通过容器名称进行通信<br> （4）volumes：数据卷，用于实现目录挂载</p> 
<p>示例</p> 
<pre><code class="prism language-yaml"><span class="token comment"># 描述 Compose 文件的版本信息</span>
<span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3.8"</span>

<span class="token comment"># 定义服务，可以多个</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">nginx</span><span class="token punctuation">:</span> <span class="token comment"># 服务名称</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx <span class="token comment"># 创建容器时所需的镜像</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> mynginx <span class="token comment"># 容器名称，默认为"工程名称_服务条目名称_序号"</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span> <span class="token comment"># 宿主机与容器的端口映射关系</span>
      <span class="token punctuation">-</span> <span class="token string">"80:80"</span> <span class="token comment"># 左边宿主机端口:右边容器端口</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span> <span class="token comment"># 配置容器连接的网络，引用顶级 networks 下的条目</span>
      <span class="token punctuation">-</span> nginx<span class="token punctuation">-</span>net

<span class="token comment"># 定义网络，可以多个。如果不声明，默认会创建一个网络名称为"工程名称_default"的 bridge 网络</span>
<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">nginx-net</span><span class="token punctuation">:</span> <span class="token comment"># 一个具体网络的条目名称</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>net <span class="token comment"># 网络名称，默认为"工程名称_网络条目名称"</span>
    <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge <span class="token comment"># 网络模式，默认为 bridge</span>
</code></pre> 
<p>使用docker-compose up创建并启动所有服务。</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 前台启动</span>
docker-compose up

<span class="token comment"># 后台启动</span>
docker-compose up <span class="token operator">-</span>d
</code></pre> 
<p>使用docker-compose down可以停止并删除容器、网络。</p> 
<h4><a id="2version__2554"></a>（2）version 版本信息</h4> 
<p>描述Compose文件的版本信息，当前最新版本为3.8，对应的Docker版本为19.03.0+。关于每个版本的详细信息请参考：https://docs.docker.com/compose/compose-file/compose-versioning/</p> 
<h4><a id="3services__2558"></a>（3）services 定义服务</h4> 
<p>services用来定义服务，可以多个，每个服务中定义了创建容器时所需的镜像、参数、依赖等，就像将命令行参数传递给docker run一样。同样，网络和数据卷的定义也是一样的。</p> 
<p>比如，通过docker run命令构建一个MySQL应用容器的命令如下：</p> 
<pre><code class="prism language-powershell">docker run <span class="token operator">-</span>di <span class="token operator">--</span>name mysql8 <span class="token operator">-</span>p 3306:3306 <span class="token operator">-</span>v <span class="token operator">/</span>mydata/docker_mysql/conf:<span class="token operator">/</span>etc/mysql/conf<span class="token punctuation">.</span>d <span class="token operator">-</span>v <span class="token operator">/</span>mydata/docker_mysql/<span class="token keyword">data</span>:<span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib/mysql <span class="token operator">-</span>e MYSQL_ROOT_PASSWORD=1234 mysql:8
</code></pre> 
<p>使用docker-compose.yml以后则可以这样定义：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3.8"</span>
<span class="token comment"># 定义服务，可以多个</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">mysql</span><span class="token punctuation">:</span> <span class="token comment"># 服务名称</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">8</span> <span class="token comment"># 创建容器时所需的镜像</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> mysql8 <span class="token comment"># 容器名称，默认为"工程名称_服务条目名称_序号"</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span> <span class="token comment"># 宿主机与容器的端口映射关系</span>
      <span class="token punctuation">-</span> <span class="token string">"3306:3306"</span> <span class="token comment"># 左边宿主机端口:右边容器端口</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span> <span class="token comment"># 创建容器时所需的环境变量</span>
      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> <span class="token number">1234</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"/mydata/docker_mysql/conf:/etc/mysql/conf.d"</span>
      <span class="token punctuation">-</span> <span class="token string">"/mydata/docker_mysql/data:/var/lib/mysql"</span>
</code></pre> 
<h4><a id="4image__2585"></a>（4）image 镜像名称标签</h4> 
<p>指定创建容器时所需的镜像名称标签或者镜像ID。如果镜像在本地不存在，会去远程拉取。</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">web</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> hello<span class="token punctuation">-</span>world
</code></pre> 
<h4><a id="5dockerfile__2595"></a>（5）dockerfile 构建镜像</h4> 
<p>（1）build 构建容器：除了可以基于指定的镜像构建容器，还可以基于Dockerfile文件构建，在使用up命令时会执行构建任务。</p> 
<p>（2）context 文件路径：该选项可以是Dockerfile文件的绝对/相对路径，也可以是远程Git仓库的URL，当提供的值是相对路径时，相对当前docker-compose.yml文件所在目录。</p> 
<p>（3）构建镜像<br> 一般情况下，默认都基于文件名叫Dockerfile的文件构建镜像，当然也可以是自定义的文件名，使用dockerfile声明，不过这个选项只能声明文件名，文件所在路径还是要通过centext来声明。</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">build</span><span class="token punctuation">:</span>
  <span class="token key atrule">context</span><span class="token punctuation">:</span> . <span class="token comment"># 相对当前 docker-compose.yml 文件所在目录</span>
  <span class="token key atrule">dockerfile</span><span class="token punctuation">:</span> Dockerfile<span class="token punctuation">-</span>alternate <span class="token comment"># 基于名称为 Dockerfile-alternate 的文件构建镜像</span>
</code></pre> 
<h4><a id="6container_name__2610"></a>（6）container_name 容器名称</h4> 
<p>Compose创建的容器默认生成的名称格式为：工程名称_服务条目名称_序号。如果要使用自定义名称，使用container_name声明。</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">mycentos</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> .
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> mycentos7 <span class="token comment"># 容器名称，默认为"工程名称_服务条目名称_序号"</span>
</code></pre> 
<p>因为Docker容器名称必须是唯一的，所以如果指定了自定义名称，就不能将服务扩展至多个容器。这样做可能会导致错误。</p> 
<h4><a id="7depends_on__2622"></a>（7）depends_on 容器依赖</h4> 
<p>使用Compose最大的好处就是敲最少的命令做更多的事情，但一般项目容器启动的顺序是有要求的，如果直接从上到下启动容器，必然会因为容器依赖问题而启动失败。例如在没有启动数据库容器的情况下启动了Web应用容器，应用容器会因为找不到数据库而退出。depends_on就是用来解决容器依赖、启动先后问题的配置项。</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3.8"</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">web</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> .
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> db
      <span class="token punctuation">-</span> redis
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> redis
  <span class="token key atrule">db</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql
</code></pre> 
<p>上述YAML文件定义的容器会先启动db和redis两个服务，最后才启动web服务。</p> 
<h4><a id="8ports__2642"></a>（8）ports 暴露端口</h4> 
<p>容器对外暴露的端口，格式：左边宿主机端口:右边容器端口。</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">"80:80"</span>
  <span class="token punctuation">-</span> <span class="token string">"8080:8080"</span>
</code></pre> 
<h4><a id="9expose__2651"></a>（9）expose 接受端口范围</h4> 
<p>容器暴露的端口不映射到宿主机，只允许能被连接的服务访问。</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">expose</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">"80"</span>
  <span class="token punctuation">-</span> <span class="token string">"8080"</span>
</code></pre> 
<h4><a id="10restart__2661"></a>（10）restart 重启策略</h4> 
<p>容器重启策略，简单的理解就是Docker重启以后容器要不要一起启动</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">nginx</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> mynginx
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"80:80"</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
</code></pre> 
<p>（1）no：默认的重启策略，在任何情况下都不会重启容器；<br> （2）on-failure：容器非正常退出时，比如退出状态为非0(异常退出)，才会重启容器；<br> （3）always：容器总是重新启动，即使容器被手动停止了，当Docker重启时容器也还是会一起启动；<br> （4）unless-stopped：容器总是重新启动，除非容器被停止（手动或其他方式），那么Docker重启时容器则不会启动。</p> 
<h4><a id="11environment__2679"></a>（11）environment 环境变量</h4> 
<p>添加环境变量。可以使用数组也可以使用字典。布尔相关的值（true、false、yes、no）都需要用引号括起来，以确保 YML 解析器不会将它们转换为真或假。</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">environment</span><span class="token punctuation">:</span>
  <span class="token key atrule">RUOYI_ENV</span><span class="token punctuation">:</span> development
  <span class="token key atrule">SHOW</span><span class="token punctuation">:</span> <span class="token string">'true'</span>
  <span class="token key atrule">SESSION_SECRET</span><span class="token punctuation">:</span>
</code></pre> 
<p>或者以下格式</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">environment</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> RUOYI_ENV=development
  <span class="token punctuation">-</span> SHOW=true
  <span class="token punctuation">-</span> SESSION_SECRET
</code></pre> 
<p>env_file 文件获取环境变量，从文件中获取环境变量，可以指定一个或多个文件，其优先级低于environment指定的环境变量。</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">env_file</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> /opt/runtime_opts.env <span class="token comment"># 绝对路径</span>
  <span class="token punctuation">-</span> ./common.env <span class="token comment"># 相对路径，相对当前 docker-compose.yml 文件所在目录</span>
  <span class="token punctuation">-</span> ./apps/web.env <span class="token comment"># 相对路径，相对当前 docker-compose.yml 文件所在目录</span>
</code></pre> 
<p>注意：env 文件中的每一行需采用键=值格式。以#开头的行会被视为注释并被忽略。空行也会被忽略。</p> 
<h4><a id="12command__2708"></a>（12）command 执行命令</h4> 
<p>覆盖容器启动后默认执行的命令。</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">command</span><span class="token punctuation">:</span> echo "helloworld"
</code></pre> 
<p>该命令也可以是一个列表。</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"echo"</span><span class="token punctuation">,</span> <span class="token string">"helloworld"</span><span class="token punctuation">]</span>
</code></pre> 
<h4><a id="13volumes__2720"></a>（13）volumes 目录挂载</h4> 
<p>数据卷，用于实现目录挂载，支持指定目录挂载、匿名挂载、具名挂载。</p> 
<p>（1）指定目录挂载的格式为：左边宿主机目录:右边容器目录，或者左边宿主机目录:右边容器目录:读写权限；<br> （2）匿名挂载格式为：容器目录即可，或者容器目录即可:读写权限；<br> （3）具名挂载格式为：数据卷条目名称:容器目录，或者数据卷条目名称:容器目录:读写权限。</p> 
<pre><code class="prism language-yaml"><span class="token comment"># 描述 Compose 文件的版本信息</span>
<span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3.8"</span>

<span class="token comment"># 定义服务，可以多个</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">mysql</span><span class="token punctuation">:</span> <span class="token comment"># 服务名称</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">8</span> <span class="token comment"># 创建容器时所需的镜像</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> mysql8 <span class="token comment"># 容器名称，默认为"工程名称_服务条目名称_序号"</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span> <span class="token comment"># 宿主机与容器的端口映射关系</span>
      <span class="token punctuation">-</span> <span class="token string">"3306:3306"</span> <span class="token comment"># 左边宿主机端口:右边容器端口</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span> <span class="token comment"># 创建容器时所需的环境变量</span>
      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> <span class="token number">1234</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token comment"># 绝对路径</span>
      <span class="token punctuation">-</span> <span class="token string">"/mydata/docker_mysql/data:/var/lib/mysql"</span>
      <span class="token comment"># 相对路径，相对当前 docker-compose.yml 文件所在目录</span>
      <span class="token punctuation">-</span> “./conf<span class="token punctuation">:</span>/etc/mysql/conf.d“
      <span class="token comment"># 匿名挂载，匿名挂载只需要写容器目录即可，容器外对应的目录会在 /var/lib/docker/volume 中生成</span>
      <span class="token punctuation">-</span> <span class="token string">"/var/lib/mysql"</span>
      <span class="token comment"># 具名挂载，就是给数据卷起了个名字，容器外对应的目录会在 /var/lib/docker/volume 中生成</span>
      <span class="token punctuation">-</span> <span class="token string">"mysql-data-volume:/var/lib/mysql"</span>

<span class="token comment"># 定义数据卷，可以多个</span>
<span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token key atrule">mysql-data-volume</span><span class="token punctuation">:</span> <span class="token comment"># 一个具体数据卷的条目名称</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> mysql<span class="token punctuation">-</span>data<span class="token punctuation">-</span>volume <span class="token comment"># 数据卷名称，默认为"工程名称_数据卷条目名称"</span>
</code></pre> 
<h4><a id="14network_mode__2756"></a>（14）network_mode 网络模式</h4> 
<p>设置网络模式，类似 docker run 时添加的参数 --net host 或者 --network host 的用法</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">"bridge"</span>
<span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">"host"</span>
<span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">"none"</span>
<span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">"service:[service name]"</span>
<span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">"container:[container name/id]"</span>
</code></pre> 
<h4><a id="15networks_2767"></a>（15）networks</h4> 
<p>配置容器连接的网络，引用顶级 networks 下的条目。</p> 
<pre><code class="prism language-yaml"><span class="token comment"># 定义服务，可以多个</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">nginx</span><span class="token punctuation">:</span> <span class="token comment"># 服务名称</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span> <span class="token comment"># 配置容器连接的网络，引用顶级 networks 下的条目</span>
      <span class="token punctuation">-</span> nginx<span class="token punctuation">-</span>net <span class="token comment"># 一个具体网络的条目名称</span>

<span class="token comment"># 定义网络，可以多个。如果不声明，默认会创建一个网络名称为"工程名称_default"的 bridge 网络</span>
<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">nginx-net</span><span class="token punctuation">:</span> <span class="token comment"># 一个具体网络的条目名称</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>net <span class="token comment"># 网络名称，默认为"工程名称_网络条目名称"</span>
    <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge <span class="token comment"># 网络模式，默认为 bridge</span>
</code></pre> 
<h4><a id="16aliases_2785"></a>（16）aliases</h4> 
<p>网络上此服务的别名。同一网络上的其他容器可以使用服务名或此别名连接到服务容器。同一服务在不同的网络上可以具有不同的别名。</p> 
<pre><code class="prism language-yaml"><span class="token comment"># 定义服务，可以多个</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">nginx</span><span class="token punctuation">:</span> <span class="token comment"># 服务名称</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span> <span class="token comment"># 配置容器连接的网络，引用顶级 networks 下的条目</span>
      <span class="token key atrule">nginx-net</span><span class="token punctuation">:</span> <span class="token comment"># 一个具体网络的条目名称</span>
        <span class="token key atrule">aliases</span><span class="token punctuation">:</span> <span class="token comment"># 服务别名，可以多个</span>
          <span class="token punctuation">-</span> nginx1 <span class="token comment"># 同一网络上的其他容器可以使用服务名或此别名连接到服务容器</span>

<span class="token comment"># 定义网络，可以多个。如果不声明，默认会创建一个网络名称为"工程名称_default"的 bridge 网络</span>
<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">nginx-net</span><span class="token punctuation">:</span> <span class="token comment"># 一个具体网络的条目名称</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>net <span class="token comment"># 网络名称，默认为"工程名称_网络条目名称"</span>
    <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge <span class="token comment"># 网络模式，默认为 bridge</span>
</code></pre> 
<h3><a id="4compose_2804"></a>【4】compose的概念和常用命令</h3> 
<p>（1）部分命令选项<br> 1）-f，–file：指定使用的 Compose 模板文件，默认为 docker-compose.yml，可以多次指定，指定多个 yml；<br> 2）-p, --project-name：指定工程名称，默认使用 docker-compose.yml 文件所在目录的名称；<br> 3）-v：打印版本并退出；<br> 4）–log-level：定义日志等级（DEBUG, INFO, WARNING, ERROR, CRITICAL）。<br> #help</p> 
<p>（2）help<br> docker-compose -help查看帮助。</p> 
<p>（3）config<br> docker-compose config -q验证docker-compose.yml文件。当配置正确时，不输出任何内容，当配置错误时，输出错误信息。</p> 
<p>（4）pull<br> docker-compose pull拉取服务依赖的镜像。</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 拉取工程中所有服务依赖的镜像</span>
docker-compose pull
<span class="token comment"># 拉取工程中 nginx 服务依赖的镜像</span>
docker-compose pull nginx
<span class="token comment"># 拉取镜像过程中不打印拉取进度信息</span>
docker-compose pull <span class="token operator">-</span>q
</code></pre> 
<p>（5）up<br> docker-compose up创建并启动所有服务的容器。指定多个yml加-f选项。以守护进程模式运行加-d选项。</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 前台启动</span>
docker-compose up
<span class="token comment"># 后台启动</span>
docker-compose up <span class="token operator">-</span>d
<span class="token comment"># -f 指定使用的 Compose 模板文件，默认为 docker-compose.yml，可以多次指定，指定多个 yml</span>
docker-compose <span class="token operator">-</span>f docker-compose<span class="token punctuation">.</span>yml up <span class="token operator">-</span>d 
</code></pre> 
<p>（6）logs<br> docker-compose logs查看服务容器的输出日志。默认情况下，docker-compose将对不同的服务输出使用不同的颜色来区分。可以通过–no-color来关闭颜色。</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 输出日志，不同的服务输出使用不同的颜色来区分</span>
docker-compose logs
<span class="token comment"># 跟踪日志输出</span>
docker-compose logs <span class="token operator">-</span>f
<span class="token comment"># 关闭颜色</span>
docker-compose logs <span class="token operator">--</span>no-color
</code></pre> 
<p>（7）ps<br> docker-compose ps列出工程中所有服务的容器。</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 列出工程中所有服务的容器</span>
docker-compose <span class="token function">ps</span>
<span class="token comment"># 列出工程中指定服务的容器</span>
docker-compose <span class="token function">ps</span> nginx
</code></pre> 
<p>（8）run<br> docker-compose run在指定服务容器上执行一个命令。</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 在工程中指定服务的容器上执行 echo "helloworld"</span>
docker-compose run nginx <span class="token function">echo</span> <span class="token string">"helloworld"</span>
</code></pre> 
<p>（9）exec<br> docker-compose exec进入服务容器。</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 进入工程中指定服务的容器</span>
docker-compose exec nginx bash
<span class="token comment"># 当一个服务拥有多个容器时，可通过 --index 参数进入到该服务下的任何容器</span>
docker-compose exec <span class="token operator">--</span>index=1 nginx bash
</code></pre> 
<p>（10）pause<br> docker-compose pause暂停服务容器</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 暂停工程中所有服务的容器</span>
docker-compose pause
<span class="token comment"># 暂停工程中指定服务的容器</span>
docker-compose pause nginx
</code></pre> 
<p>（11）unpause<br> docker-compose unpause恢复服务容器。</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 恢复工程中所有服务的容器</span>
docker-compose unpause
<span class="token comment"># 恢复工程中指定服务的容器</span>
docker-compose unpause nginx
</code></pre> 
<p>（12）restart<br> docker-compose restart重启服务容器。</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 重启工程中所有服务的容器</span>
docker-compose restart
<span class="token comment"># 重启工程中指定服务的容器</span>
docker-compose restart nginx
</code></pre> 
<p>（13）start<br> docker-compose start启动服务容器。</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 启动工程中所有服务的容器</span>
docker-compose <span class="token function">start</span>
<span class="token comment"># 启动工程中指定服务的容器</span>
docker-compose <span class="token function">start</span> nginx
</code></pre> 
<p>（14）stop<br> docker-compose stop停止服务容器。</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 停止工程中所有服务的容器</span>
docker-compose stop
<span class="token comment"># 停止工程中指定服务的容器</span>
docker-compose stop nginx
</code></pre> 
<p>（15）kill<br> docker-compose kill通过发送SIGKILL信号停止指定服务的容器。</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 通过发送 SIGKILL 信号停止工程中指定服务的容器</span>
docker-compose <span class="token function">kill</span> nginx
</code></pre> 
<p>（16）rm<br> docker-compose rm 删除服务（停止状态）容器。</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 删除所有（停止状态）服务的容器</span>
docker-compose <span class="token function">rm</span>
<span class="token comment"># 先停止所有服务的容器，再删除所有服务的容器</span>
docker-compose <span class="token function">rm</span> <span class="token operator">-</span>s
<span class="token comment"># 不询问是否删除，直接删除</span>
docker-compose <span class="token function">rm</span> <span class="token operator">-</span>f
<span class="token comment"># 删除服务容器挂载的数据卷</span>
docker-compose <span class="token function">rm</span> <span class="token operator">-</span>v
<span class="token comment"># 删除工程中指定服务的容器</span>
docker-compose <span class="token function">rm</span> <span class="token operator">-</span><span class="token function">sv</span> nginx
</code></pre> 
<p>（17）down<br> 停止并删除所有服务的容器、网络、镜像、数据卷。</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 停止并删除工程中所有服务的容器、网络</span>
docker-compose stop
<span class="token comment"># 停止并删除工程中所有服务的容器、网络、镜像</span>
docker-compose down <span class="token operator">--</span>rmi all
<span class="token comment"># 停止并删除工程中所有服务的容器、网络、数据卷</span>
docker-compose down <span class="token operator">-</span>v
</code></pre> 
<p>（18）images<br> docker-compose images打印服务容器所对应的镜像。</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 打印所有服务的容器所对应的镜像</span>
docker-compose images
<span class="token comment"># 打印指定服务的容器所对应的镜像</span>
docker-compose images nginx
</code></pre> 
<p>（19）port<br> docker-compose port打印指定服务容器的某个端口所映射的宿主机端口。</p> 
<pre><code class="prism language-powershell">docker-compose port nginx 80
</code></pre> 
<p>（20）top<br> docker-compose top显示正在运行的进程。</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 显示工程中所有服务的容器正在运行的进程</span>
docker-compose top
<span class="token comment"># 显示工程中指定服务的容器正在运行的进程</span>
docker-compose top nginx
</code></pre> 
<p>（1）启动</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 前台启动</span>
docker-compose up
<span class="token comment"># 后台启动</span>
docker-compose up <span class="token operator">-</span>d
</code></pre> 
<p>（2）停止并删除容器、网络</p> 
<pre><code class="prism language-powershell">docker-compose down
</code></pre> 
<h2><a id="compose_3013"></a>【八】compose的安装</h2> 
<h3><a id="1_3014"></a>【1】在线安装</h3> 
<pre><code class="prism language-powershell"><span class="token comment"># 通过url下载</span>
sudo curl <span class="token operator">-</span>L <span class="token string">"https://github.com/docker/compose/releases/download/1.29.2/docker-compose-<span class="token function">$<span class="token punctuation">(</span>uname <span class="token operator">-</span>s<span class="token punctuation">)</span></span>-<span class="token function">$<span class="token punctuation">(</span>uname <span class="token operator">-</span>m<span class="token punctuation">)</span></span>"</span> <span class="token operator">-</span>o <span class="token operator">/</span>usr/local/bin/docker-compose

<span class="token comment"># 授权</span>
sudo chmod <span class="token operator">+</span>x <span class="token operator">/</span>usr/local/bin/docker-compose
</code></pre> 
<h3><a id="2_3024"></a>【2】离线安装</h3> 
<p>（1）下载地址<br> https://github.com/docker/compose/releases/download/v2.2.2/docker-compose-linux-x86_64</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 改名为docker-compose</span>
<span class="token function">mv</span> docker-compose-Linux-x86_64 docker-compose

chmod <span class="token operator">+</span>x <span class="token operator">/</span>usr/local/bin/docker-compose

docker-compose <span class="token operator">-</span>v
</code></pre> 
<p><img src="https://images2.imgbox.com/98/bf/gRhPbS6i_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="Dockercompose_3043"></a>【九】用Docker-compose完成项目部署的案例</h2> 
<h3><a id="2ruoyi_3048"></a>【2】ruoyi系统的容器化部署过程</h3> 
<h4><a id="1Nacos_3050"></a>（1）安装Nacos</h4> 
<p>拉取官方nacos镜像，目前若依微服务最新版本需要安装的是2.0.4版本，如需更改请根据实际情况修改拉取的版本号</p> 
<pre><code class="prism language-powershell">docker pull nacos/nacos-server
</code></pre> 
<p>启动nacos 需要暴露8848 9848 9849 端口</p> 
<pre><code class="prism language-powershell">docker run <span class="token operator">--</span>env MODE=standalone <span class="token operator">--</span>name nacos <span class="token operator">-</span>d <span class="token operator">-</span>p 8848:8848 <span class="token operator">-</span>p 9848:9848 <span class="token operator">-</span>p 9849:9849 nacos/nacos-server
</code></pre> 
<p>MODE=standalone表示单机启动</p> 
<h4><a id="2Nginx_3065"></a>（2）安装Nginx</h4> 
<p>拉取官方nginx镜像,默认拉取最新版本</p> 
<pre><code class="prism language-powershell">docker pull nginx
</code></pre> 
<p>创建Nginx容器。</p> 
<pre><code class="prism language-powershell">docker run <span class="token operator">-</span>di <span class="token operator">--</span>name nginx <span class="token operator">-</span>p 80:80 nginx
</code></pre> 
<p>将容器内的配置文件拷贝到指定目录（请先提前创建好目录）</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 创建目录</span>
mkdir <span class="token operator">-</span>p <span class="token operator">/</span>home/ruoyi/nginx

<span class="token comment"># 将容器内的配置文件拷贝到指定目录</span>
docker <span class="token function">cp</span> nginx:<span class="token operator">/</span>etc/nginx <span class="token operator">/</span>home/ruoyi/nginx/conf
</code></pre> 
<p>终止并删除容器 需要执行</p> 
<pre><code class="prism language-powershell">docker stop nginx
docker <span class="token function">rm</span> nginx
</code></pre> 
<p>创建Nginx容器，并将容器中的/etc/nginx目录和宿主机的/home/ruoyi/nginx/conf目录进行挂载。</p> 
<pre><code class="prism language-powershell">docker run <span class="token operator">-</span>di <span class="token operator">--</span>name nginx <span class="token operator">-</span>p 80:80 <span class="token operator">-</span>v <span class="token operator">/</span>home/ruoyi/nginx/conf:<span class="token operator">/</span>etc/nginx nginx
</code></pre> 
<h4><a id="3Mysql8_3098"></a>（3）安装Mysql8</h4> 
<p>（1）拉取官方mysql8.0镜像</p> 
<pre><code class="prism language-powershell">docker pull mysql:8<span class="token punctuation">.</span>0
</code></pre> 
<p>（2）在本地创建mysql的映射目录</p> 
<pre><code class="prism language-powershell">mkdir <span class="token operator">-</span>p <span class="token operator">/</span>home/mysql/<span class="token keyword">data</span> <span class="token operator">/</span>home/mysql/logs <span class="token operator">/</span>home/mysql/conf
</code></pre> 
<p>（3）创建容器，将数据、日志、配置文件映射到本机</p> 
<pre><code class="prism language-powershell"><span class="token comment">#此处的password为即将设置的数据库密码建议修改成为自己的密码</span>
docker run <span class="token operator">-</span>p 3306:3306 <span class="token operator">--</span>name mysql <span class="token operator">-</span>v <span class="token operator">/</span>home/mysql/conf:<span class="token operator">/</span>etc/mysql/conf<span class="token punctuation">.</span>d <span class="token operator">-</span>v <span class="token operator">/</span>home/mysql/logs:<span class="token operator">/</span>logs <span class="token operator">-</span>v <span class="token operator">/</span>home/mysql/<span class="token keyword">data</span>:<span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib/mysql <span class="token operator">-</span>e MYSQL_ROOT_PASSWORD=root <span class="token operator">-</span>d mysql:8<span class="token punctuation">.</span>0
</code></pre> 
<p>（4）进入容器/执行命令：docker exec -it mysql /bin/bash</p> 
<p>更改数据库密码</p> 
<pre><code class="prism language-powershell">docker exec <span class="token operator">-</span>it mysql <span class="token operator">/</span>bin/bash		<span class="token comment">#未挂载镜像时进入MySQL方式</span>
<span class="token operator">/</span><span class="token operator">/</span>docker exec <span class="token operator">-</span>it 122c297e7298 bash  <span class="token comment">#挂载后进入容器方式,容器id 使用此命令进入mysql需要先执行docker ps 找到mysql镜像id</span>
mysql <span class="token operator">-</span>uroot <span class="token operator">-</span>p
use mysql
flush privileges<span class="token punctuation">;</span>
ALTER USER <span class="token string">'root'</span>@<span class="token string">'localhost'</span> IDENTIFIED BY <span class="token string">'root'</span><span class="token punctuation">;</span>
flush privileges<span class="token punctuation">;</span>
<span class="token keyword">exit</span>
</code></pre> 
<h4><a id="4redis_3134"></a>（4）安装redis</h4> 
<p>拉取官方redis镜像</p> 
<pre><code class="prism language-powershell">docker pull redis
</code></pre> 
<p>创建容器</p> 
<pre><code class="prism language-powershell">docker run <span class="token operator">-</span>di <span class="token operator">--</span>name redis <span class="token operator">-</span>p 6379:6379 redis
</code></pre> 
<p>连接容器中的Redis时，只需要连接宿主机的IP + 指定的映射端口即可。</p> 
<h4><a id="5_3150"></a>（5）下载若依系统</h4> 
<p>git地址：https://gitee.com/y_project/RuoYi-Cloud<br> 项目提供了docker部署，只需要复制jar文件到对应的/docker/ruoyi目录下。</p> 
<h4><a id="6bootstrapyml_3155"></a>（6）修改bootstrap.yml配置文件</h4> 
<p><img src="https://images2.imgbox.com/86/65/64RTQeC9_o.png" alt="在这里插入图片描述"><br> 其他服务bootstrap.yml配置与auth保持一致</p> 
<p>ruoyi-gateway如不需要使用sentinel可以将此处注释<br> <img src="https://images2.imgbox.com/5f/2d/nZOBQiIt_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="7_3164"></a>（7）打包</h4> 
<p>（1）在运行代码正常无bug情况下开始打包操作，然后把所有服务都停止<br> <img src="https://images2.imgbox.com/a5/e5/T5nwbszn_o.png" alt="在这里插入图片描述"><br> （2）maven执行clean操作(请保证执行clean操作是在ruoyi(root)里进行操作)<br> <img src="https://images2.imgbox.com/ef/a5/EdyPUqdb_o.png" alt="在这里插入图片描述"><br> （3）将所有模块配置完成后进行maven打jar包操作(在模块未运行的情况下进行打包操作)<br> <img src="https://images2.imgbox.com/d2/f9/mkorDuZo_o.png" alt="在这里插入图片描述">执行完毕可以看到所在模块下已经生成target文件了<br> <img src="https://images2.imgbox.com/5f/46/Jrm8Zaqt_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="8dockerruoyi_3173"></a>（8）操作项目文件里的文件/docker/ruoyi</h4> 
<p>（1）将生成的jar包放入若依自带的docker文件夹指定目录<br> <img src="https://images2.imgbox.com/8f/0a/dIUdYhiX_o.png" alt="在这里插入图片描述"><br> （2）把生成的jar包复制到对应的文件里<br> 在docker文件夹下ruoyi目录的操作到此为止dockerfile文件无需进行操作</p> 
<h4><a id="9dockermysql_3180"></a>（9）操作docker/mysql</h4> 
<p>将项目里的SQL脚本文件放到此文件夹目录下<br> 【注意的是：项目里给的ry-cloud脚本里没有建库语句，需要自己加上。更简单的，还是自己使用navicat连上数据库以后，直接建库，然后执行建表脚本就行了】<br> <img src="https://images2.imgbox.com/99/62/lNCvXcR8_o.png" alt="在这里插入图片描述"></p> 
<p>因为我们在docker里面安装的是mysql8.0版本所以下面需要进行修改一下配置</p> 
<p><img src="https://images2.imgbox.com/cd/8e/Kq6icB5B_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="10dockernacos_3188"></a>（10）操作docker/nacos</h4> 
<p>进入此目录编辑nacos配置文件<br> <img src="https://images2.imgbox.com/b7/d5/sjhHJED5_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/6d/f5/fIpLEqcp_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="11dockernginxconf_3192"></a>（11）操作docker\nginx\conf</h4> 
<p>编辑这个文件<br> <img src="https://images2.imgbox.com/23/06/TWSq5M78_o.png" alt="在这里插入图片描述"><br> 建议使用默认配置<br> <img src="https://images2.imgbox.com/af/e2/LOfxhthG_o.png" alt="在这里插入图片描述"><br> 因为我们在docker中拉取的是nginx最新版本索引nginx的dockerfile不需要进行修改操作</p> 
<h4><a id="12dockernginxhtmldist_3199"></a>（12）操作docker\nginx\html\dist这个文件</h4> 
<p>此处将前端代码打包，只介绍在idea打包方式，前端项目打包可让前端进行打包<br> 进入ruoyi-ui目录<br> <img src="https://images2.imgbox.com/21/b1/rISRLCCD_o.png" alt="在这里插入图片描述"><br> 执行npm run build:prod命令【执行此命令前置操作下载前端依赖需执行npm install --registry=https://registry.npm.taobao.org命令】</p> 
<p><img src="https://images2.imgbox.com/98/2a/od1G9Gh4_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/30/b1/FAAb8ekb_o.png" alt="在这里插入图片描述"><br> docker/redis无需进行操作</p> 
<h4><a id="13dockerdockercomposeyml_3209"></a>（13）操作docker下docker-compose.yml文件</h4> 
<p>编辑此文件<br> 因为拉去的nacos镜像为2.0.4版本,mysql镜像为8.0版本索引进行以下操作<br> <img src="https://images2.imgbox.com/7a/4f/SpRklwz7_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/1f/8c/vrOgjHDR_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="14dockerlinux_3215"></a>（14）将docker文件夹上传至linux</h4> 
<p>把准备好的docker文件放到home文件夹下<br> <img src="https://images2.imgbox.com/75/f5/4KLcjfv9_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="15_3218"></a>（15）运行服务</h4> 
<p>（1）首先禁用防火墙</p> 
<pre><code class="prism language-powershell">systemctl status firewalld<span class="token punctuation">.</span>service
systemctl stop firewalld<span class="token punctuation">.</span>service
</code></pre> 
<p>也可永久关闭防火墙</p> 
<pre><code class="prism language-powershell">systemctl disable firewalld<span class="token punctuation">.</span>service
</code></pre> 
<p>（2）查看docker日志</p> 
<pre><code class="prism language-powershell"><span class="token comment"># 输出日志，不同的服务输出使用不同的颜色来区分</span>
docker-compose logs
<span class="token comment"># 跟踪日志输出</span>
docker-compose logs <span class="token operator">-</span>f
<span class="token comment"># 关闭颜色</span>
docker-compose logs <span class="token operator">--</span>no-color
</code></pre> 
<p>（3）查看所侦听的端口</p> 
<pre><code class="prism language-powershell">netstat <span class="token operator">-</span>luntp			<span class="token comment">#用于查看服务端口是否被侦听</span>
</code></pre> 
<p>（4）运行服务</p> 
<pre><code class="prism language-powershell">cd <span class="token operator">/</span>home/docker/		<span class="token comment">#进入docker文件所在目录</span>

<span class="token punctuation">.</span><span class="token operator">/</span>deploy<span class="token punctuation">.</span>sh port		<span class="token comment"># 开启所需端口	因为在之前已经关闭防火墙,此命令无需执行</span>
	
<span class="token comment">#注意执行完此命令后请执行	docker-compose logs -f 	#跟踪启动服务的日志打印 </span>
<span class="token comment">#如有报错说明配置有误,请先解决完报错保证nacos,mysql,redis启动成功</span>
<span class="token punctuation">.</span><span class="token operator">/</span>deploy<span class="token punctuation">.</span>sh base		<span class="token comment"># 启动基础环境（必须）</span>
</code></pre> 
<p>启动后发现报错<br> <img src="https://images2.imgbox.com/83/cf/NuyNlqwX_o.png" alt="在这里插入图片描述">这是因为在启动docker的时候防火墙做了策略，如果容器在运行中，停止防火墙，在操作容器就会报这个错误，我们可以重启docker解决此问题</p> 
<pre><code class="prism language-powershell">systemctl restart docker
</code></pre> 
<p>然后再执行</p> 
<pre><code class="prism language-powershell"><span class="token punctuation">.</span><span class="token operator">/</span>deploy<span class="token punctuation">.</span>sh base		<span class="token comment"># 启动基础环境（必须）</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/99/4a/fS5qZkK6_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="16_3272"></a>（16）检查一下启动结果</h4> 
<p>（1）连接nacos<br> IP地址为虚拟机IP地址</p> 
<pre><code class="prism language-powershell">http:<span class="token operator">/</span><span class="token operator">/</span>192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>136<span class="token punctuation">.</span>135:8848/nacos
</code></pre> 
<p>（2）编辑nacos配置<br> <img src="https://images2.imgbox.com/9a/b1/2csdLGDS_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ce/bc/uKmC26hM_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/47/a5/lWFxTK1F_o.png" alt="在这里插入图片描述"><br> 此处仅介绍system配置,其他配置参考system配置即可</p> 
<p>配置完成后执行下面命令保证修改后的配置能够被服务读取</p> 
<pre><code class="prism language-powershell"><span class="token punctuation">.</span><span class="token operator">/</span>deploy<span class="token punctuation">.</span>sh stop		<span class="token comment"># 关闭所有环境/模块		重启服务时执行此操作保证修改的配置被读取</span>

<span class="token punctuation">.</span><span class="token operator">/</span>deploy<span class="token punctuation">.</span>sh <span class="token function">rm</span>			<span class="token comment"># 删除所有环境/模块		重启服务时执行此操作保证修改的配置被读取</span>
</code></pre> 
<h4><a id="17_3293"></a>（17）修改完配置后再次启动</h4> 
<p>（1）执行完以上命令后再次执行以下命令</p> 
<pre><code class="prism language-powershell"><span class="token punctuation">.</span><span class="token operator">/</span>deploy<span class="token punctuation">.</span>sh base		<span class="token comment">#执行完此命令请等待两分钟保证nacos,mysql,redis成功启动后执行后续命令</span>
</code></pre> 
<p>执行完./deploy.sh base命令后在linux中查看正在运行的容器,以下为成功启动并运行<br> <img src="https://images2.imgbox.com/b2/99/FudjraGx_o.png" alt="在这里插入图片描述"><br> nacos启动有点慢，在portainer要看到下面结果才算启动完成<br> <img src="https://images2.imgbox.com/b1/23/nbrGIher_o.png" alt="在这里插入图片描述"></p> 
<p>（2）base命令成功启动完服务后执行此命令<br> 等到nacos页面能正常访问了，再执行</p> 
<pre><code class="prism language-powershell"><span class="token punctuation">.</span><span class="token operator">/</span>deploy<span class="token punctuation">.</span>sh modules		<span class="token comment"># 启动程序模块（必须）base命令成功启动完服务后执行此命令</span>
</code></pre> 
<p>执行后要等一会，等到服务启动成功，可以看nacos的服务列表，看看是不是都注册成功了，从而判断是否启动成功</p> 
<p>浏览器访问http://192.168.136.135 IP地址为虚拟机IP地址,默认访问80端口</p> 
<h4><a id="18_3314"></a>（18）启动出现问题</h4> 
<p>启动模块以后，使用docker-compose logs -f跟踪查看启动日志，发现gatewaye和auth都启动成功了，但是modules没有启动成功，在nacos的服务列表里也没有，报错内容如下<br> <img src="https://images2.imgbox.com/46/81/vuvN5clD_o.png" alt="在这里插入图片描述"><br> ruoyi-system模块报错:<br> Invalid bound statement (not found): com.ruoyi.system.mapper.SysConfigMapper.selectConfigList</p> 
<p>翻译：无效绑定，找不到selectConfigList方法<br> 1.出现此报错，普遍步骤查看xml --&gt;&gt; namespace + 方法id是否与mapper中对应<br> 2.如果对应仍然报错，则可能是未读取到xml，打包后看target中是否存在xml文件，如果不存在则需要看resource文件夹是否是资源目录或者在xml中指定包路径<br> 3.另外可能就是项目根本就没读取到nacos配置，需要我们在bootstrap.yml中设置</p> 
<p>本人是第三种情况</p> 
<h2><a id="DockerJenkinsGit_3329"></a>【十】基于Docker+Jenkins+Git的发布环境搭建</h2> 
<h2><a id="k8s_3332"></a>【十】k8s学习笔记</h2>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/deb6b2ec9406186bcce4d370059aa130/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">CSerialPort教程4.3.x (8) - CSerialPort调试模式的使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3af8bc6689b66ab02e8d838d88bae937/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Android开发环境搭建&#43;AS常用功能指导</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>