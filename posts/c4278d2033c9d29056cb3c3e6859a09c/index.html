<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>git pre-commit 钩子禁止commit大文件 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="git pre-commit 钩子禁止commit大文件" />
<meta property="og:description" content="进入项目的hooks文件夹（.git/hooks）应该看到已经存在的文件列表。 创建一个要使用的确切提交类型的新文件（例如：“ commit-msg”，“ pre-rebase”，“ pre-commit”等）。不要有扩展名。打开新文件并粘贴代码(如下图所示Python代码)保存存档。 并将pre-commit文件设置为可执行！ 现在，git钩子将自动触发。 #!/usr/bin/python #-*- mode: python -*- &#34;&#34;&#34;Git pre-commit hook: reject large files, save as &#39;pre-commit&#39; (no .py) and place in .git/hooks&#34;&#34;&#34; #!/usr/bin/python3 import sys import os import re from subprocess import Popen, PIPE from io import StringIO def git_filesize_hook(megabytes_cutoff=5, verbose=False): &#34;&#34;&#34;Git pre-commit hook: Return error if the maximum file size in the HEAD revision exceeds &lt;megabytes_cutoff&gt;, succes (0) otherwise. You can bypass this hook by specifying &#39;--no-verify&#39; as an option in &#39;git commit&#39;." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/c4278d2033c9d29056cb3c3e6859a09c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-01-17T14:41:20+08:00" />
<meta property="article:modified_time" content="2020-01-17T14:41:20+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">git pre-commit 钩子禁止commit大文件</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <ol><li>进入项目的hooks文件夹（.git/hooks）</li><li>应该看到已经存在的文件列表。 创建一个要使用的确切提交类型的新文件（例如：“ commit-msg”，“ pre-rebase”，“ pre-commit”等）。不要有扩展名。</li><li>打开新文件并粘贴代码(如下图所示Python代码)</li><li>保存存档。 并将pre-commit文件设置为可执行！ 现在，git钩子将自动触发。</li></ol> 
<pre class="has"><code>#!/usr/bin/python
#-*- mode: python -*-

"""Git pre-commit hook: reject large files, save as 'pre-commit' (no .py) 
and place in .git/hooks"""


#!/usr/bin/python3
import sys
import os
import re
from subprocess import Popen, PIPE
from io import StringIO

def git_filesize_hook(megabytes_cutoff=5, verbose=False):
    """Git pre-commit hook: Return error if the maximum file size in the HEAD
    revision exceeds &lt;megabytes_cutoff&gt;, succes (0) otherwise. You can bypass 
    this hook by specifying '--no-verify' as an option in 'git commit'."""
    if verbose: print (os.getcwd())

    cmd = "git diff --name-only --cached"
    kwargs = dict(args=cmd, shell=True, stdout=PIPE, cwd=os.getcwd())
    if sys.platform.startswith("win"):
        del kwargs["cwd"]
        cmd = "pushd \"%s\" &amp;&amp; " % os.getcwd() + cmd + " &amp;&amp; popd"
        kwargs["args"] = cmd
        
    git = Popen(**kwargs)
    output = git.stdout.readlines()
    def try_getsize(f):
        """in case the file is removed with git rm"""
        try:
            return os.path.getsize(f)
        except (EnvironmentError, OSError):
            return 0 
    files = {f.rstrip(): try_getsize(f.strip()) for f in output}
    bytes_cut_off = megabytes_cutoff * 2 ** 20

    too_big = [f for f, size in files.items() if size &gt; bytes_cut_off] 
    if too_big:
        msg = ("ERROR: your commit contains %s files that exceed size "
               "limit of %d Mbytes:\n%s")
        msg = msg % (len(too_big), bytes_cut_off/(1024*1024), "\n".join(sorted(too_big)))
        msg += "\n\nUse the '--no-verify' option to by-pass this hook"
        return msg
    return 0

if __name__ == "__main__":
    size = 10
    sys.exit(git_filesize_hook(size, True))
</code></pre> 
<p>默认大于10M的文件均不能被commit，如果想修改大小阈值，可以设置size变量</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fa6206260c1a5866be3d0ca9dbe7e0ad/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">怎么实现无遮罩屏蔽某些按钮的点击事件</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f59d5391e8caf9e97b9ff645e4826dee/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java 字符串公式及条件判断表达式，计算方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>