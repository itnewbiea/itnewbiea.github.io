<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>STM32学习笔记(五) —— 按键翻转LED - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="STM32学习笔记(五) —— 按键翻转LED" />
<meta property="og:description" content="STM32学习笔记(五) —— 按键翻转LED 前面我们分析过GPIO的各个寄存器，探讨了如何使用GPIO点亮LED，这里再验证一下GPIO的输入功能。
1.硬件连接
我们这里将按键连接到了PA0引脚，按键外接了上拉电阻，默认状态下PA0引脚处于高电平，当按键按下，PA0引脚就与GND短接，变为低电平，所以我们可以通过读取PA0引脚的电平状态来判断按键是否被按下。
2.软件编程
这里使用STM32CubeMX来配置PA0引脚的初始化：
生成代码后，可以看见程序中已经添加了PA0引脚初始化部分
在while循环中添加如下代码：
注意按键要进行软件消抖（按键按下与断开时都会有干扰产生，可以进行软件延时消抖，一般可以延时10-20ms，具体可以参考代码中的注释）。
while (1) { /* 读取PA0引脚电平 */ if(HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_0) == GPIO_PIN_RESET) { /* 如果是低电平, 表示有按键按下, 进行软件延时消抖 */ HAL_Delay(10); /* 再次读取PA0引脚电平, 如果还是低电平, 就认为有按键按下 */ if(HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_0) == GPIO_PIN_RESET) { /* 等待按键释放 */ while(HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_0) == GPIO_PIN_RESET); /* 翻转一次按键标志 */ ek_key_flag = !ek_key_flag; printf(&#34;key pressed.\r\n&#34;); } } /* 按键每次按下后, ek_key_flag会在0与1之间变换 */ if(ek_key_flag) /* 当ek_key_flag == 1时点亮LED */ HAL_GPIO_WritePin(GPIOC, GPIO_PIN_5, GPIO_PIN_RESET); else /* 当ek_key_flag不为1时熄灭LED */ HAL_GPIO_WritePin(GPIOC, GPIO_PIN_5, GPIO_PIN_SET); /* USER CODE END WHILE */ /* USER CODE BEGIN 3 */ } 将程序下载后可以打开串口调试助手，每当按键按下会打印“key pressed." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/d8788ead6d5ef970a40575674e6b1a08/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-14T23:15:25+08:00" />
<meta property="article:modified_time" content="2023-11-14T23:15:25+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">STM32学习笔记(五) —— 按键翻转LED</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="STM32__LED_0"></a><strong>STM32学习笔记(五) —— 按键翻转LED</strong></h3> 
<p>前面我们分析过GPIO的各个寄存器，探讨了如何使用<a href="https://blog.csdn.net/qq_45691873/article/details/120585628">GPIO点亮LED</a>，这里再验证一下GPIO的输入功能。<br> 1.硬件连接<br> <img src="https://images2.imgbox.com/28/84/6nghA3Ar_o.png" alt="按键"><br> 我们这里将按键连接到了PA0引脚，按键外接了上拉电阻，默认状态下PA0引脚处于高电平，当按键按下，PA0引脚就与GND短接，变为低电平，所以我们可以通过读取PA0引脚的电平状态来判断按键是否被按下。</p> 
<p>2.软件编程<br> 这里使用STM32CubeMX来配置PA0引脚的初始化：<br> <img src="https://images2.imgbox.com/29/7f/OWnWRmBr_o.png" alt="PA0配置为输入模式"><br> <img src="https://images2.imgbox.com/9c/4f/Tq2JNYMQ_o.png" alt="在这里插入图片描述"><br> 生成代码后，可以看见程序中已经添加了PA0引脚初始化部分<br> <img src="https://images2.imgbox.com/bd/74/FvC07yvF_o.png" alt="PA0初始化"></p> 
<p>在while循环中添加如下代码：<br> 注意按键要进行软件消抖（按键按下与断开时都会有干扰产生，可以进行软件延时消抖，一般可以延时10-20ms，具体可以参考代码中的注释）。</p> 
<pre><code class="prism language-c">  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>    
    <span class="token comment">/* 读取PA0引脚电平 */</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">HAL_GPIO_ReadPin</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span> GPIO_PIN_0<span class="token punctuation">)</span> <span class="token operator">==</span> GPIO_PIN_RESET<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/* 如果是低电平, 表示有按键按下, 进行软件延时消抖 */</span>
        <span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/* 再次读取PA0引脚电平, 如果还是低电平, 就认为有按键按下 */</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">HAL_GPIO_ReadPin</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span> GPIO_PIN_0<span class="token punctuation">)</span> <span class="token operator">==</span> GPIO_PIN_RESET<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">/* 等待按键释放 */</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">HAL_GPIO_ReadPin</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span> GPIO_PIN_0<span class="token punctuation">)</span> <span class="token operator">==</span> GPIO_PIN_RESET<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">/* 翻转一次按键标志 */</span>
            ek_key_flag <span class="token operator">=</span> <span class="token operator">!</span>ek_key_flag<span class="token punctuation">;</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"key pressed.\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/* 按键每次按下后, ek_key_flag会在0与1之间变换 */</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ek_key_flag<span class="token punctuation">)</span>
        <span class="token comment">/* 当ek_key_flag == 1时点亮LED */</span>
        <span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>GPIOC<span class="token punctuation">,</span> GPIO_PIN_5<span class="token punctuation">,</span> GPIO_PIN_RESET<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token comment">/* 当ek_key_flag不为1时熄灭LED */</span>
        <span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>GPIOC<span class="token punctuation">,</span> GPIO_PIN_5<span class="token punctuation">,</span> GPIO_PIN_SET<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    <span class="token comment">/* USER CODE END WHILE */</span>

    <span class="token comment">/* USER CODE BEGIN 3 */</span>
  <span class="token punctuation">}</span>
</code></pre> 
<p>将程序下载后可以打开串口调试助手，每当按键按下会打印“key pressed.”信息，并且LED会在亮灭之间翻转。<br> <img src="https://images2.imgbox.com/87/d5/Hgp0qca6_o.png" alt="keypressed"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/278e2494d50f67fdf9da8b4307f33c99/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Pandas学习——物流行业数据分析</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0415d0cc07888549ef253cdacc891ecc/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">DX runtime分析</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>