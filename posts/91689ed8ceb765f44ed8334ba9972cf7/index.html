<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>YoLov5从环境搭建到训练自己的数据，以良性皮肤痣和恶性皮肤痣的分类与血红细胞类型目标检测识别为例（非常详细，包括环境安装配置、源码下载、配置运行环境、代码改写、数据集制作、训练、预测和优化）等 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="YoLov5从环境搭建到训练自己的数据，以良性皮肤痣和恶性皮肤痣的分类与血红细胞类型目标检测识别为例（非常详细，包括环境安装配置、源码下载、配置运行环境、代码改写、数据集制作、训练、预测和优化）等" />
<meta property="og:description" content="一、软硬件的准备与虚拟环境搭建 1、Python环境：直接安装Anaconda 3-2022 （1）百度网盘下载地址(下载文件中附了非常详细的安装教程)：https://pan.baidu.com/s/1KQNOlYU-GMKbkPGcip1Hzw?pwd=5678
（2）直接网上百度下载和安装，非常多教程，这里直接略过
安装好之后，可以打开Anaconda Prompt（install），查看python版本：
（3）将安装的Anaconda加入电脑的系统环境变量里面
3.1 如下图所示：直接搜索系统环境变量，点击 编辑系统环境变量
3.2 点击 右下角环境变量
3.3 进入之后可以看见有xxx用户变量和系统变量两部分，里面都有path变量，选择path变量，点击编辑
3.4 进入之后点击新建，将Anaconda的安装路径和Scripts路径填写进去，最后点击确定就完成了环境变量的添加（注意：每个页面都有确定，请一一点击确定）
2、软件：安装Pycharm 2020.1 x64 软件（这是专业版） （1）百度网盘下载地址(下载文件中附了非常详细的安装教程)：https://pan.baidu.com/s/1KQNOlYU-GMKbkPGcip1Hzw?pwd=5678
（2）直接网上百度下载和安装，非常多教程，这里直接略过
3、查看当前电脑的cuda版本，为后面安装pytorch做准备 打开cmd的shell，输入命令：nvidia-smi，cuda版本为12.1
4、打开Anaconda Prompt(install)，创建虚拟环境，如下图所示： 1、创建虚拟环境
方法一：默认情况下虚拟环境创建在Anaconda安装目录下的envs文件夹中
conda create --name yolov5 #yolov5是虚拟环境名称（自定义） 方法二：如果想将虚拟环境创建在指定位置，使用–prefix参数即可：
conda create --prefix D:\Software\Envs\yolov5 python==3.9 #yolov5是虚拟环境名称（自定义） 2、查看已经创建好的虚拟环境：
conda env list 3、激活虚拟环境并查看下面已安装的库
4、如果想要删除yolov5这个虚拟环境：
conda remove --prefix D:\Software\Envs\yolov5 --all 二、下载yolov5项目的代码 在github官网下载源码 下载网址：https://github.com/ultralytics/yolov5 三、使用安装的pycharm软件打开项目并配置运行环境 1、打开软件，点击左上角的File，再点击Open 2、打开之后，在相应的路径下找到项目，点击ok，项目就被打开了 3、运行环境的配置：再一次点击左上角的File，接着点击Settings 4、进入之后，首先在页面左边找到 【Project：你的项目名】按钮并点击，再点击里面的 Python Interpreter，接着点击右上角的设置符号，里面会出来Add与Show All两个选项，再点击Add，如下图所示： 5、进入之后，选择Existing environment,再进行环境的选择，最后点击确定即可（在这里我选择了前面创建的yolov5环境，注意：选择到环境下面的python.exe路径才可以） 到这里项目的打开和运行环境的设置就完成了！
四、torch、opencv等库的安装 1、在上一个步骤中，我们已经使用pycharm打开了项目并配置了运行环境，接下里在打开的项目中找到requirements." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/91689ed8ceb765f44ed8334ba9972cf7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-06T15:26:25+08:00" />
<meta property="article:modified_time" content="2024-01-06T15:26:25+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">YoLov5从环境搭建到训练自己的数据，以良性皮肤痣和恶性皮肤痣的分类与血红细胞类型目标检测识别为例（非常详细，包括环境安装配置、源码下载、配置运行环境、代码改写、数据集制作、训练、预测和优化）等</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>一、软硬件的准备与虚拟环境搭建</h2> 
<h5><a id="1PythonAnaconda_32022_1"></a>1、Python环境：直接安装Anaconda 3-2022</h5> 
<p>（1）百度网盘下载地址(下载文件中附了非常详细的安装教程)：https://pan.baidu.com/s/1KQNOlYU-GMKbkPGcip1Hzw?pwd=5678<br> （2）直接网上百度下载和安装，非常多教程，这里直接略过<br> 安装好之后，可以打开Anaconda Prompt（install），查看python版本：<br> <img src="https://images2.imgbox.com/dc/e5/DOoiik2W_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/02/56/Tt8Cj7wn_o.png" alt="在这里插入图片描述"><br> （3）将安装的Anaconda加入电脑的系统环境变量里面<br> 3.1 如下图所示：直接搜索系统环境变量，点击 编辑系统环境变量<br> <img src="https://images2.imgbox.com/0f/ee/nADBVypf_o.png" alt="在这里插入图片描述"><br> 3.2 点击 右下角环境变量<br> <img src="https://images2.imgbox.com/ae/b5/sMSz7PM5_o.png" alt="在这里插入图片描述"><br> 3.3 进入之后可以看见有xxx用户变量和系统变量两部分，里面都有path变量，选择path变量，点击编辑<br> <img src="https://images2.imgbox.com/63/c3/aIfft6nv_o.png" alt="在这里插入图片描述"><br> 3.4 进入之后点击新建，将Anaconda的安装路径和Scripts路径填写进去，最后点击确定就完成了环境变量的添加（注意：每个页面都有确定，请一一点击确定）<br> <img src="https://images2.imgbox.com/89/f2/ZWAW3Oy4_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2Pycharm_20201_x64__16"></a>2、软件：安装Pycharm 2020.1 x64 软件（这是专业版）</h5> 
<p>（1）百度网盘下载地址(下载文件中附了非常详细的安装教程)：https://pan.baidu.com/s/1KQNOlYU-GMKbkPGcip1Hzw?pwd=5678<br> （2）直接网上百度下载和安装，非常多教程，这里直接略过<br> <img src="https://images2.imgbox.com/92/11/KHl6zYyL_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="3cudapytorch_20"></a>3、查看当前电脑的cuda版本，为后面安装pytorch做准备</h5> 
<p>打开cmd的shell，输入命令：nvidia-smi，cuda版本为12.1<br> <img src="https://images2.imgbox.com/06/83/FM2gK5DR_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="4Anaconda_Promptinstall_23"></a>4、打开Anaconda Prompt(install)，创建虚拟环境，如下图所示：</h5> 
<p>1、创建虚拟环境<br> 方法一：默认情况下虚拟环境创建在Anaconda安装目录下的envs文件夹中</p> 
<pre><code class="prism language-c">conda create <span class="token operator">--</span>name yolov5   #yolov5是虚拟环境名称（自定义）
</code></pre> 
<p>方法二：如果想将虚拟环境创建在指定位置，使用–prefix参数即可：</p> 
<pre><code class="prism language-c">conda create <span class="token operator">--</span>prefix D<span class="token operator">:</span>\Software\Envs\yolov5 python<span class="token operator">==</span><span class="token number">3.9</span>   #yolov5是虚拟环境名称（自定义）
</code></pre> 
<p><img src="https://images2.imgbox.com/26/44/DeF9N97A_o.png" alt="在这里插入图片描述"><br> 2、查看已经创建好的虚拟环境：</p> 
<pre><code class="prism language-c">conda env list
</code></pre> 
<p><img src="https://images2.imgbox.com/1a/81/vSz9x9v3_o.png" alt="在这里插入图片描述"><br> 3、激活虚拟环境并查看下面已安装的库<br> <img src="https://images2.imgbox.com/f0/59/AAMb4Xfi_o.png" alt="在这里插入图片描述"><br> 4、如果想要删除yolov5这个虚拟环境：</p> 
<pre><code class="prism language-c">conda remove <span class="token operator">--</span>prefix D<span class="token operator">:</span>\Software\Envs\yolov5 <span class="token operator">--</span>all
</code></pre> 
<h2><a id="yolov5_45"></a>二、下载yolov5项目的代码</h2> 
<h5><a id="github_46"></a>在github官网下载源码</h5> 
<pre><code class="prism language-c">下载网址：https<span class="token operator">:</span><span class="token comment">//github.com/ultralytics/yolov5</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/5d/71/Uybzu6AL_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="pycharm_51"></a>三、使用安装的pycharm软件打开项目并配置运行环境</h2> 
<h5><a id="1FileOpen_52"></a>1、打开软件，点击左上角的File，再点击Open</h5> 
<p><img src="https://images2.imgbox.com/2f/62/MiLL0vS8_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2ok_54"></a>2、打开之后，在相应的路径下找到项目，点击ok，项目就被打开了</h5> 
<p><img src="https://images2.imgbox.com/3f/30/qAV0VAiW_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/12/0f/8dg6GZI7_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="3FileSettings_57"></a>3、运行环境的配置：再一次点击左上角的File，接着点击Settings</h5> 
<p><img src="https://images2.imgbox.com/50/30/p5UMIDQn_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="4_Project_Python_InterpreterAddShow_AllAdd_59"></a>4、进入之后，首先在页面左边找到 【Project：你的项目名】按钮并点击，再点击里面的 Python Interpreter，接着点击右上角的设置符号，里面会出来Add与Show All两个选项，再点击Add，如下图所示：</h5> 
<p><img src="https://images2.imgbox.com/2a/09/ga1DMTF9_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/bb/c5/pUtsWWHN_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="5Existing_environmentyolov5pythonexe_62"></a>5、进入之后，选择Existing environment,再进行环境的选择，最后点击确定即可（在这里我选择了前面创建的yolov5环境，注意：选择到环境下面的python.exe路径才可以）</h5> 
<p><img src="https://images2.imgbox.com/8f/e0/RQKigO1i_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/e1/99/BsbirYRP_o.png" alt="在这里插入图片描述"><br> 到这里项目的打开和运行环境的设置就完成了！</p> 
<h2><a id="torchopencv_66"></a>四、torch、opencv等库的安装</h2> 
<h5><a id="1pycharmrequirementstxt_67"></a>1、在上一个步骤中，我们已经使用pycharm打开了项目并配置了运行环境，接下里在打开的项目中找到requirements.txt文件并打开，这里面正是所需要安装的库，如下图所示：</h5> 
<p><img src="https://images2.imgbox.com/58/ed/hb0w0Z0r_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2torchtorchcuda_69"></a>2、首先安装除torch之外的所有包（因为torch需要与cuda对应）：可以使用清华、华为等源地址快速安装</h5> 
<p>清华大学 ：https://pypi.tuna.tsinghua.edu.cn/simple/<br> 阿里云：http://mirrors.aliyun.com/pypi/simple/<br> 中国科学技术大学 ：http://pypi.mirrors.ustc.edu.cn/simple/<br> 华中科技大学：http://pypi.hustunique.com/<br> 豆瓣源：http://pypi.douban.com/simple/<br> 腾讯源：http://mirrors.cloud.tencent.com/pypi/simple<br> 华为镜像源：https://repo.huaweicloud.com/repository/pypi/simple/<br> 比如：pip install -i https://pypi.tuna.tsinghua.edu.cn/simple/ matplotlib==3.3</p> 
<h5><a id="3torch3cuda_78"></a>3、安装torch：通过步骤一中的第3小点知道了本机cuda版本</h5> 
<p>（1）方式一（在线安装）：打开网址：https://pytorch.org/get-started/previous-versions/，查找本机对应的torch，并通过命令在线安装，如下图所示；</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">CUDA <span class="token number">11.8</span></span></span>
pip install torch<span class="token operator">==</span><span class="token number">2.0</span><span class="token number">.0</span><span class="token operator">+</span>cu118 torchvision<span class="token operator">==</span><span class="token number">0.15</span><span class="token number">.1</span><span class="token operator">+</span>cu118 torchaudio<span class="token operator">==</span><span class="token number">2.0</span><span class="token number">.1</span> <span class="token operator">--</span>index<span class="token operator">-</span>url https<span class="token operator">:</span><span class="token comment">//download.pytorch.org/whl/cu118</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e2/c4/uHDSehvs_o.png" alt="在这里插入图片描述"><br> （2）方式二（离线安装）：打开网址：https://download.pytorch.org/whl/torch_stable.html<br> https://download.pytorch.org/whlversions/，查找到对应的torch、torchaudio、torchvision并下载下来，通过命令：pip install 下载地址+文件 进行安装<br> <img src="https://images2.imgbox.com/bb/db/tD2ADqde_o.png" alt="在这里插入图片描述"><br> 安装好之后，可以通过pip list 或者 conda list查看：<br> <img src="https://images2.imgbox.com/21/11/QsotOOSe_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_90"></a>五、良性皮肤痣和恶性皮肤痣数据集的制作（分类）</h2> 
<h5><a id="1_91"></a>1、数据集下载</h5> 
<pre><code class="prism language-c">url：https<span class="token operator">:</span><span class="token comment">//www.cvmart.net/</span>
大家打开网址，进行注册登录，再点击里面的数据集就可以去筛选自己需要的数据进行下载。
</code></pre> 
<p><img src="https://images2.imgbox.com/f3/ca/6sdHe9eo_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2_97"></a>2、简介</h5> 
<p>下载文件解压后，里面有三个文件夹，分别是训练集（train）、测试集（test）和数据（data）;<br> <img src="https://images2.imgbox.com/20/91/vQ6J6m1g_o.png" alt="在这里插入图片描述"><br> 而训练集中又包含两个文件夹，分别是：“malignant” 常用来描述恶性的、有害的或恶意的事物；“benign” 常用来描述良性的、无害的或温和的事物。测试集里面也是一样，只是数据量不同，data里面就是测试集和训练集。<br> <img src="https://images2.imgbox.com/2d/86/DKl0uNA3_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c">其中：
train文件夹中malignant有<span class="token number">1197</span>张图片，benign有<span class="token number">1440</span>张图片；
test文件夹中malignant有<span class="token number">300</span>张图片，benign有<span class="token number">360</span>张图片。
训练集 <span class="token operator">:</span> 测试集 <span class="token operator">=</span> <span class="token number">2637</span> <span class="token operator">:</span> <span class="token number">660</span> <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">:</span> <span class="token number">1</span>
</code></pre> 
<p>malignant恶性图片实例：<br> <img src="https://images2.imgbox.com/59/fa/fg8JAGqk_o.jpg" alt="在这里插入图片描述"><br> benign良性图片实例：<br> <img src="https://images2.imgbox.com/ab/39/jpVJ0E66_o.jpg" alt="在这里插入图片描述"></p> 
<h2><a id="_112"></a>六、改写代码，进行分类训练实战</h2> 
<h5><a id="1_113"></a>1、首先下载官方的分类预训练模型</h5> 
<pre><code class="prism language-c">下载地址：https<span class="token operator">:</span><span class="token comment">//github.com/ultralytics/yolov5/releases/download/v6.2/yolov5s-cls.pt</span>
</code></pre> 
<h5><a id="2classify_117"></a>2、将下载的模型放入项目的classify文件夹里面</h5> 
<p><img src="https://images2.imgbox.com/75/9c/A5whnQxf_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="3classifytrainpy_119"></a>3、打开classify里面的train.py文件，将下载好的预训练模型位置添加</h5> 
<p><img src="https://images2.imgbox.com/11/24/5IXN0XgK_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="4_121"></a>4、再将下载好的训练集与测试集数据位置添加</h5> 
<p>（1）先在classify里面建立一个data文件夹，再将train与test文件夹放在里面<br> <img src="https://images2.imgbox.com/9d/d2/vyEMPp1l_o.png" alt="在这里插入图片描述"><br> （2）在train.py里面添加数据位置<br> <img src="https://images2.imgbox.com/e5/05/MVFzqv8e_o.png" alt="在这里插入图片描述"><br> （3）在train.py里面设置运行的epochs、batch-size等，根据自己电脑或者服务器的配置进行调整即可！</p> 
<pre><code class="prism language-c">在 YOLOv5 模型中，argparse<span class="token punctuation">.</span>ArgumentParser 用于解析命令行参数。下面是一些常用的参数说明和设置示例：
<span class="token operator">--</span>img<span class="token operator">-</span>size：指定输入图像的尺寸。例如，<span class="token operator">--</span>img<span class="token operator">-</span>size <span class="token number">640</span> 表示将输入图像的宽度和高度调整为 <span class="token number">640</span> 像素。
<span class="token operator">--</span>batch<span class="token operator">-</span>size：指定训练时每个批次中的图像数量。例如，<span class="token operator">--</span>batch<span class="token operator">-</span>size <span class="token number">16</span> 表示每个批次中包含 <span class="token number">16</span> 张图像。
<span class="token operator">--</span>epochs：指定训练的迭代轮数。例如，<span class="token operator">--</span>epochs <span class="token number">100</span> 表示进行 <span class="token number">100</span> 轮迭代训练。
<span class="token operator">--</span>data：指定数据集的配置文件路径。例如，<span class="token operator">--</span>data data<span class="token punctuation">.</span>yaml 表示使用名为 data<span class="token punctuation">.</span>yaml 的配置文件。
<span class="token operator">--</span>cfg：指定模型的配置文件路径。例如，<span class="token operator">--</span>cfg models<span class="token operator">/</span>yolov5s<span class="token punctuation">.</span>yaml 表示使用名为 yolov5s<span class="token punctuation">.</span>yaml 的模型配置文件。
<span class="token operator">--</span>weights：指定预训练模型的权重文件路径。例如，<span class="token operator">--</span>weights weights<span class="token operator">/</span>yolov5s<span class="token punctuation">.</span>pt 表示使用名为 yolov5s<span class="token punctuation">.</span>pt 的权重文件。
<span class="token operator">--</span>device：指定使用的设备，如 <span class="token operator">--</span>device cpu 表示使用 CPU 进行训练，<span class="token operator">--</span>device <span class="token number">0</span> 表示使用 GPU <span class="token number">0</span> 进行训练。
<span class="token operator">--</span>name：指定训练任务的名称。例如，<span class="token operator">--</span>name my_model 表示训练任务的名称为 my_model。
<span class="token operator">--</span>resume：指定是否从之前的训练中恢复。例如，<span class="token operator">--</span>resume 表示从之前的训练中恢复，<span class="token operator">--</span>resume weights<span class="token operator">/</span>last<span class="token punctuation">.</span>pt 表示从 last<span class="token punctuation">.</span>pt 权重文件中恢复训练。

这些参数可以根据具体的训练需求进行设置。可以通过在命令行中使用 <span class="token operator">--</span>help 参数来查看更多参数选项和说明。例如，python train<span class="token punctuation">.</span>py <span class="token operator">--</span>help 可以显示出所有可用的参数选项和说明。
</code></pre> 
<p>本人这里设置为：<br> <img src="https://images2.imgbox.com/62/13/AckXGpHG_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="5trainpy_143"></a>5、运行train.py文件，训练模型</h5> 
<p>（1）运行过程中可能会报错：<br> 我这里就报错了：缺少下面这个库，安装即可。如果遇见类似错误，根据提醒信息进行修改就可以！<br> <img src="https://images2.imgbox.com/63/64/RhbTs65e_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/2c/87/8GG7y55A_o.png" alt="在这里插入图片描述"><br> （2）运行过程和结果：</p> 
<pre><code class="prism language-c">下图中的【<span class="token punctuation">.</span><span class="token punctuation">.</span>\runs\train<span class="token operator">-</span>cls\exp5】路径就是存放训练出的权重路径；
Epoch（迭代轮数）：一个 epoch 表示将训练集中的所有样本都用于训练的一次迭代。在每个 epoch 中，模型会依次使用训练集中的每个样本进行训练。
GPU_mem（显存占用）：指的是在训练过程中 GPU 使用的显存量。显存占用通常会随着模型的复杂度和批量大小的增加而增加。
train_loss（训练损失）：在每个 epoch 结束时，使用训练集计算的损失值。训练损失用于衡量模型在训练集上的拟合程度。
test_loss（测试损失）：在每个 epoch 结束时，使用测试集计算的损失值。测试损失用于衡量模型在测试集上的拟合程度。通常用于评估模型的泛化能力。
top1_acc（Top<span class="token operator">-</span><span class="token number">1</span> 准确率）：在每个 epoch 结束时，使用测试集计算的准确率。Top<span class="token operator">-</span><span class="token number">1</span> 准确率表示模型在预测时，与真实标签完全匹配的样本所占的比例。
top5_acc（Top<span class="token operator">-</span><span class="token number">5</span> 准确率）：在每个 epoch 结束时，使用测试集计算的准确率。Top<span class="token operator">-</span><span class="token number">5</span> 准确率表示模型在预测时，真实标签在模型预测的前五个最高概率中的样本所占的比例。
这些指标可以用来评估模型的性能和训练过程的进展。通常，我们希望训练损失和测试损失都能够逐渐减小，而准确率则逐渐提高。
</code></pre> 
<p><img src="https://images2.imgbox.com/fe/ab/8iCiQzf6_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f1/18/WDXC29I9_o.png" alt="在这里插入图片描述"><br> 【…\runs\train-cls\exp5】：<br> <img src="https://images2.imgbox.com/cf/a4/KalX2VvO_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c">weights：存放模型权重<span class="token punctuation">;</span>
在训练深度学习模型时，通常会保存模型的权重文件，以便在需要时进行加载和使用。YOLOv5模型中，best<span class="token punctuation">.</span>pt和last<span class="token punctuation">.</span>pt是两个常见的权重文件。
best<span class="token punctuation">.</span>pt：best<span class="token punctuation">.</span>pt是在训练过程中根据验证集表现选择的最佳模型权重文件。它是根据模型在验证集上的性能指标（如精度、损失等）来决定的。通常情况下，best<span class="token punctuation">.</span>pt对应于在验证集上获得最佳性能的模型。
last<span class="token punctuation">.</span>pt：last<span class="token punctuation">.</span>pt是训练过程中最后一次保存的模型权重文件。它保存了模型在训练过程中的最新状态，无论其在验证集上的性能如何。last<span class="token punctuation">.</span>pt可以用作继续训练的起点或进行推理和预测。
区别：
best<span class="token punctuation">.</span>pt是基于验证集性能选择的最佳模型权重文件，而last<span class="token punctuation">.</span>pt是训练过程中最后一次保存的模型权重文件。
best<span class="token punctuation">.</span>pt对应于在验证集上获得最佳性能的模型，而last<span class="token punctuation">.</span>pt保存了模型在训练过程中的最新状态。
在模型训练完毕后，可以使用best<span class="token punctuation">.</span>pt进行性能评估和推理，而last<span class="token punctuation">.</span>pt可以用作继续训练的起点。
选择使用哪个权重文件取决于具体的需求。如果需要获得在验证集上最佳性能的模型，可以使用best<span class="token punctuation">.</span>pt。如果需要继续训练模型或进行推理和预测，可以使用last<span class="token punctuation">.</span>pt。
</code></pre> 
<h5><a id="6classifypredictpy_174"></a>6、打开classify文件夹里面的predict.py文件，进行预测</h5> 
<p>（1）同样与train.py文件操作大致相同，分别修改模型路径和预测图片路径，如下图：<br> <img src="https://images2.imgbox.com/c3/33/vnN3fsAW_o.png" alt="在这里插入图片描述"><br> （2）运行predict.py文件进行预测：<br> 运行结果：将运行的结果保存在了【…\runs\predict-cls\exp5】里面<br> <img src="https://images2.imgbox.com/ba/f7/mhYN4DIO_o.png" alt="在这里插入图片描述"><br> 预测结果：预测数据本身为benign（良性），预测后结果如下图：<br> 预测为benign的准确率为0.94，为malignant的准确率为0.06<br> <img src="https://images2.imgbox.com/38/51/KqTvnLKo_o.jpg" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/83/b0/2KrZHzw1_o.png" alt="在这里插入图片描述"><br> 预测数据本身为malignant（恶性），预测后结果如下图：<br> 预测为benign的准确率为0.04，为malignant的准确率为0.96<br> <img src="https://images2.imgbox.com/25/0d/1GGcTMzf_o.jpg" alt="在这里插入图片描述"><br> 以上就是yolov5分类检测的操作，从这里我们就可以看见yolov5的分类检测功能也很强大！</p> 
<h2><a id="_188"></a>七、血红细胞数据集的制作（目标检测）</h2> 
<h5><a id="1_189"></a>1、数据集的下载</h5> 
<pre><code class="prism language-c">同样进入以下地址：
url：https<span class="token operator">:</span><span class="token comment">//www.cvmart.net/</span>
大家打开网址，进行注册登录，再点击里面的数据集就可以去筛选自己需要的数据进行下载。
</code></pre> 
<p><img src="https://images2.imgbox.com/a0/16/B6b0rxUD_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c">官方介绍：该数据集包含 <span class="token number">12</span><span class="token punctuation">,</span><span class="token number">500</span> 张带有细胞类型标签 <span class="token punctuation">(</span>CSV<span class="token punctuation">)</span> 的增强血细胞图像 <span class="token punctuation">(</span>JPEG<span class="token punctuation">)</span>。<span class="token number">4</span> 种不同细胞类型中的每一种都有大约 <span class="token number">3</span><span class="token punctuation">,</span><span class="token number">000</span> 张图像，这些图像被分组到 <span class="token number">4</span> 个不同的文件夹中（根据细胞类型）。细胞类型是嗜酸性粒细胞、淋巴细胞、单核细胞和中性粒细胞。该数据集附带一个额外的数据集，其中包含原始 <span class="token number">410</span> 幅图像（预增强）以及两个额外的子类型标签（WBC 与 WBC），以及这 <span class="token number">410</span> 幅图像中每个单元格的边界框（JPEG <span class="token operator">+</span> XML 元数据）。更具体地说，“dataset<span class="token operator">-</span>master”文件夹包含 <span class="token number">410</span> 张带有子类型标签和边界框（JPEG <span class="token operator">+</span> XML）的血细胞图像，而“dataset2<span class="token operator">-</span>master”文件夹包含 <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">500</span> 个增强图像以及 <span class="token number">4</span> 个额外的子类型标签（JPEG <span class="token operator">+</span> CSV）。
下载解压后的数据分为两个文件夹：dataset<span class="token operator">-</span>master与dataset2<span class="token operator">-</span>master；
其中dataset<span class="token operator">-</span>master文件夹是已经做好标签的文件数据，可以直接使用，而dataset2<span class="token operator">-</span>master文件夹是原始数据，需要自己进行制作数据集；在这里我选择自己制作数据集。
</code></pre> 
<p>dataset2-master文件夹内的数据形式：<br> <img src="https://images2.imgbox.com/43/3a/R4fysbzU_o.png" alt="在这里插入图片描述"><br> 而每一个文件夹里面又分为四类：<br> <img src="https://images2.imgbox.com/a8/d7/5jz1U6Ln_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c">NEUTROPHIL：中性粒细胞；MONOCYTE：单核细胞；LYMPHOCYTE：淋巴细胞；EOSINOPHIL：嗜酸性粒细胞。
TRAIN文件夹中分别NEUTROPHIL：<span class="token number">2499</span>张；MONOCYTE：<span class="token number">2478</span>张；LYMPHOCYTE：<span class="token number">2483</span>张；EOSINOPHIL：<span class="token number">2497</span>张。
TEST_SIMPLE文件夹中分别NEUTROPHIL：<span class="token number">48</span>张；MONOCYTE：<span class="token number">4</span>张；LYMPHOCYTE：<span class="token number">6</span>张；EOSINOPHIL：<span class="token number">13</span>张。
TEST文件夹中分别NEUTROPHIL：<span class="token number">624</span>张；MONOCYTE：<span class="token number">620</span>张；LYMPHOCYTE：<span class="token number">620</span>张；EOSINOPHIL：<span class="token number">623</span>张。
</code></pre> 
<h3><a id="train500NEUTROPHIL125MONOCYTE125LYMPHOCYTE125EOSINOPHIL125cells_211"></a>由于制作数据集时间消耗比较长，我这里直接从train里面选择500张数据进行标注用作训练集，分别从NEUTROPHIL中随机选取125张，MONOCYTE中随机选取125张，LYMPHOCYTE中随机选取125张，EOSINOPHIL中随机选取125张，放在新建的cells文件夹中。</h3> 
<p>但在选取前先对每一类细胞的图片重命名，防止混淆，因为单纯表面上区分，有些难以区别出来，因此<br> 如下所示：</p> 
<pre><code class="prism language-c">import os
import shutil
# 指定文件夹路径
folder_path <span class="token operator">=</span> r<span class="token string">"C:/Users/22846/Downloads/dataset2-master/dataset2-master/images/TRAIN/"</span>
# 获取文件夹中的所有文件
files <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">listdir</span><span class="token punctuation">(</span>folder_path<span class="token punctuation">)</span>
# 遍历文件夹中的文件
<span class="token keyword">for</span> file in files<span class="token operator">:</span>
    pics <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">listdir</span><span class="token punctuation">(</span>folder_path<span class="token operator">+</span>file<span class="token punctuation">)</span>
    #对每一个文件夹内的图片进行遍历重命名
    i <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">for</span> p in pics<span class="token operator">:</span>
         # 判断文件是否为图片文件
        <span class="token keyword">if</span> p<span class="token punctuation">.</span><span class="token function">endswith</span><span class="token punctuation">(</span><span class="token string">".jpg"</span><span class="token punctuation">)</span> or p<span class="token punctuation">.</span><span class="token function">endswith</span><span class="token punctuation">(</span><span class="token string">".png"</span><span class="token punctuation">)</span> or p<span class="token punctuation">.</span><span class="token function">endswith</span><span class="token punctuation">(</span><span class="token string">".jpeg"</span><span class="token punctuation">)</span><span class="token operator">:</span>
            # 构建新的文件名
            new_name <span class="token operator">=</span> file<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token function">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">+</span><span class="token char">'.'</span><span class="token operator">+</span>p<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token char">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            # 构建文件的完整路径
            old_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>folder_path<span class="token operator">+</span>file<span class="token punctuation">,</span> p<span class="token punctuation">)</span>
            new_file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>folder_path<span class="token operator">+</span>file<span class="token punctuation">,</span> new_name<span class="token punctuation">)</span>
            i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
            # 重命名文件
            os<span class="token punctuation">.</span><span class="token function">rename</span><span class="token punctuation">(</span>old_path<span class="token punctuation">,</span> new_file_path<span class="token punctuation">)</span>
            <span class="token function">print</span><span class="token punctuation">(</span>f<span class="token string">"已将文件 {old_path} 重命名为 {new_file_path}"</span><span class="token punctuation">)</span>
</code></pre> 
<p>结果如下：<br> <img src="https://images2.imgbox.com/cd/d8/NSNh5cgz_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/96/c1/aSa8rLpF_o.png" alt="在这里插入图片描述"><br> 随机选取各类图片一共500张放入cells文件夹里面：<br> <img src="https://images2.imgbox.com/86/62/2NNxMzbF_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2labelimg_244"></a>2、首先安装labelimg</h5> 
<pre><code class="prism language-c">pip install labelimg 
or
conda install labelimg
</code></pre> 
<p><img src="https://images2.imgbox.com/f4/f9/4GkcNIqt_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="3labelimg__251"></a>3、labelimg 简介</h5> 
<pre><code class="prism language-c">LabelImg是一款开源的图像标注工具，用于创建和编辑图像数据集的标注。它支持多种常见的标注格式，如Pascal VOC、YOLO等。

使用LabelImg，用户可以加载图像，并在图像上绘制边界框或者进行点标注，以标记图像中的目标物体或者感兴趣区域。该工具提供了简单易用的界面和交互操作，使得标注过程更加高效和准确。

LabelImg支持在Windows、Linux和macOS等操作系统上运行，并且提供了多种语言的界面，方便用户根据自己的需要进行选择。

除了标注功能，LabelImg还提供了一些辅助功能，如自动保存标注结果、快捷键操作、标注结果的导出等，使得用户能够更好地管理和利用标注数据。

总之，LabelImg是一款功能强大、易于使用的图像标注工具，对于进行目标检测、图像分割等任务的数据集准备非常有帮助。
</code></pre> 
<h5><a id="4LabelImgLabelImg_263"></a>4、在窗口输入LabelImg，就会弹出LabelImg的操作界面</h5> 
<p><img src="https://images2.imgbox.com/b1/d1/Qao1HSXa_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d2/ed/TDTZBvBs_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="5LabelImg_266"></a>5、LabelImg的操作界面的使用</h5> 
<pre><code class="prism language-c"><span class="token number">1</span>、导入图像：点击界面上方的“Open Dir”按钮，选择要标注的图像文件，然后图像将显示在主窗口中。
<span class="token number">2</span>、创建标注框：在主窗口中，你可以使用鼠标左键点击并拖动来创建一个边界框，将其框住图像中的目标物体。你可以调整边界框的大小和位置，以确保它准确地包围目标。
<span class="token number">3</span>、标注物体类别：在主窗口的左下角，你可以选择目标物体的类别。点击下拉菜单，选择适当的类别。
<span class="token number">4</span>、保存标注结果：点击界面上方的“change Save dir”按钮，将标注结果保存到文件目录中。LabelImg会自动将标注结果以XML或txt格式保存。
<span class="token number">5</span>、继续标注：如果你需要标注多个目标物体，可以重复步骤<span class="token number">4</span>到步骤<span class="token number">6</span>，直到所有目标都被标注。
<span class="token number">6</span>、导出标注结果：如果你需要将标注结果导出为其他格式（如Pascal VOC或YOLO），可以点击界面上方的“Export”按钮，选择要导出的格式，并指定导出路径。
<span class="token number">7</span>、进行下一张图像的标注：点击界面上方的“Next Image”按钮，加载下一张图像，继续进行标注。
以上是LabelImg的基本使用步骤。在实际使用中，你可能还会使用一些其他功能，如快捷键操作、调整标注框的大小和位置、删除标注等。你可以在LabelImg的官方文档中找到更详细的操作指南。
</code></pre> 
<p><img src="https://images2.imgbox.com/90/49/tq2UkXB9_o.png" alt="在这里插入图片描述"><br> 我选择保存在这个文件夹里面：<br> <img src="https://images2.imgbox.com/e7/72/b0gdrJp7_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c">那接下里就继续制作数据集！！！！：
其中：
NEUTROPHIL：中性粒细胞标注为N；MONOCYTE：单核细胞标注为M；
LYMPHOCYTE：淋巴细胞标注为L；EOSINOPHIL：嗜酸性粒细胞标注为E。
</code></pre> 
<p>数据集制作完成：<br> <img src="https://images2.imgbox.com/94/94/vDBjlNOW_o.png" alt="在这里插入图片描述"><br> 其中标注文件中多一个classes.txt，这里面记录的是标签：<br> <img src="https://images2.imgbox.com/f1/01/cmwPOUCs_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_290"></a>八、改写代码，进行目标检测实战训练</h2> 
<h5><a id="1cellsNcellsimageslabelstraintestval_811__291"></a>1、先将cells与Ncells文件夹名称分别改为images与labels，目的是显得更加清晰明了；接着将数据集按照一定的比例进行划分为训练集，测试集，验证集（train、test、val），下述的代码中我按照了 8:1:1 的比例去划分，若想根据自己的需要去划分数据集，修改下述代码中的：</h5> 
<p>在项目中新建DataSplit.py文件并放入以下代码，根据自己的需求改写路径和比例（如下图所示）</p> 
<pre><code class="prism language-c">import os
import random
from shutil import copyfile

def <span class="token function">split_dataset</span><span class="token punctuation">(</span>image_folder<span class="token punctuation">,</span> txt_folder<span class="token punctuation">,</span> output_folder<span class="token punctuation">,</span> split_ratio<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Ensure output folders exist</span></span>
    <span class="token keyword">for</span> dataset in <span class="token punctuation">[</span><span class="token char">'train'</span><span class="token punctuation">,</span> <span class="token char">'val'</span><span class="token punctuation">,</span> <span class="token char">'test'</span><span class="token punctuation">]</span><span class="token operator">:</span>
        <span class="token keyword">if</span> not os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>output_folder<span class="token punctuation">,</span> dataset<span class="token punctuation">,</span> <span class="token char">'images'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">:</span>
            os<span class="token punctuation">.</span><span class="token function">makedirs</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>output_folder<span class="token punctuation">,</span> dataset<span class="token punctuation">,</span> <span class="token char">'images'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> not os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>output_folder<span class="token punctuation">,</span> dataset<span class="token punctuation">,</span> <span class="token char">'txt'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">:</span>
            os<span class="token punctuation">.</span><span class="token function">makedirs</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>output_folder<span class="token punctuation">,</span> dataset<span class="token punctuation">,</span> <span class="token char">'txt'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Get list of image filesa</span></span>
    image_files <span class="token operator">=</span> <span class="token punctuation">[</span>f <span class="token keyword">for</span> f in os<span class="token punctuation">.</span><span class="token function">listdir</span><span class="token punctuation">(</span>image_folder<span class="token punctuation">)</span> <span class="token keyword">if</span> f<span class="token punctuation">.</span><span class="token function">endswith</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token char">'.jpg'</span><span class="token punctuation">,</span> <span class="token char">'.jpeg'</span><span class="token punctuation">,</span> <span class="token char">'.png'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    random<span class="token punctuation">.</span><span class="token function">shuffle</span><span class="token punctuation">(</span>image_files<span class="token punctuation">)</span>
    num_images <span class="token operator">=</span> <span class="token function">len</span><span class="token punctuation">(</span>image_files<span class="token punctuation">)</span>
    num_train <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>split_ratio<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> num_images<span class="token punctuation">)</span>
    num_val <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>split_ratio<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> num_images<span class="token punctuation">)</span>
    train_images <span class="token operator">=</span> image_files<span class="token punctuation">[</span><span class="token operator">:</span>num_train<span class="token punctuation">]</span>
    val_images <span class="token operator">=</span> image_files<span class="token punctuation">[</span>num_train<span class="token operator">:</span>num_train <span class="token operator">+</span> num_val<span class="token punctuation">]</span>
    test_images <span class="token operator">=</span> image_files<span class="token punctuation">[</span>num_train <span class="token operator">+</span> num_val<span class="token operator">:</span><span class="token punctuation">]</span>
    <span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Copy images to respective folders</span></span>
    <span class="token keyword">for</span> dataset<span class="token punctuation">,</span> images_list in <span class="token function">zip</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token char">'train'</span><span class="token punctuation">,</span> <span class="token char">'val'</span><span class="token punctuation">,</span> <span class="token char">'test'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>train_images<span class="token punctuation">,</span> val_images<span class="token punctuation">,</span> test_images<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token keyword">for</span> image_file in images_list<span class="token operator">:</span>
            image_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>image_folder<span class="token punctuation">,</span> image_file<span class="token punctuation">)</span>
            <span class="token function">copyfile</span><span class="token punctuation">(</span>image_path<span class="token punctuation">,</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>output_folder<span class="token punctuation">,</span> dataset<span class="token punctuation">,</span> <span class="token char">'images'</span><span class="token punctuation">,</span> image_file<span class="token punctuation">)</span><span class="token punctuation">)</span>
            txt_file <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">splitext</span><span class="token punctuation">(</span>image_file<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token char">'.txt'</span>
            txt_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>txt_folder<span class="token punctuation">,</span> txt_file<span class="token punctuation">)</span>
            <span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Copy corresponding txt file <span class="token keyword">if</span> exists</span></span>
            <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>txt_path<span class="token punctuation">)</span><span class="token operator">:</span>
                <span class="token function">copyfile</span><span class="token punctuation">(</span>txt_path<span class="token punctuation">,</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>output_folder<span class="token punctuation">,</span> dataset<span class="token punctuation">,</span> <span class="token char">'txt'</span><span class="token punctuation">,</span> txt_file<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token operator">:</span>
    image_folder_path <span class="token operator">=</span> <span class="token string">"C:/XXXXXXXXX/cell/images"</span>
    txt_folder_path <span class="token operator">=</span> <span class="token string">"C:/XXXXXXXXX/cell/labels"</span>
    output_dataset_path <span class="token operator">=</span> <span class="token string">"C:/XXXXXXXXX/Ncell"</span>
    <span class="token function">split_dataset</span><span class="token punctuation">(</span>image_folder_path<span class="token punctuation">,</span> txt_folder_path<span class="token punctuation">,</span> output_dataset_path<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"数据集划分完成！！！"</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-c">其中：
split_ratio<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span>为划分比例传入的参数，根据自己的实际需求改写即可
image_folder_path          为images图片的文件夹的路径
txt_folder_path            为labels的txt文件夹的路径
output_dataset_path        为你保存的数据集的文件夹的路径，代码会在改路径下自动生成子文件夹，分别进行测试集，训练集，验证集的存储。
</code></pre> 
<p>结果如下：<br> <img src="https://images2.imgbox.com/d8/b7/ZoOUxOji_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/3a/77/OC8U3z2Y_o.png" alt="在这里插入图片描述"><br> 同时将test、train、val里面的txt文件名改为labels！</p> 
<h5><a id="2mydatadataImageNetyamldatacellsyaml_342"></a>2、在项目里新建mydata文件夹，将划分的文件放进去；打开项目中的data文件夹，复制里面的ImageNet.yaml,再粘贴进data文件夹里面并改名为cells.yaml。分别如下图所示：</h5> 
<p><img src="https://images2.imgbox.com/82/cb/w7KwtGgG_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/e9/b5/suJVdIku_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="3cellsyaml_345"></a>3、添加训练数据路径：改写cells.yaml内的代码</h5> 
<p>原代码：里面已经表明训练集、测试集、验证集与标签的添加位置，我们只需要更改即可</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Train<span class="token operator">/</span>val<span class="token operator">/</span>test sets as <span class="token number">1</span><span class="token punctuation">)</span> dir<span class="token operator">:</span> path<span class="token operator">/</span>to<span class="token operator">/</span>imgs<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> file<span class="token operator">:</span> path<span class="token operator">/</span>to<span class="token operator">/</span>imgs<span class="token punctuation">.</span>txt<span class="token punctuation">,</span> or <span class="token number">3</span><span class="token punctuation">)</span> list<span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token operator">/</span>to<span class="token operator">/</span>imgs1<span class="token punctuation">,</span> path<span class="token operator">/</span>to<span class="token operator">/</span>imgs2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span></span></span>
path<span class="token operator">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>datasets<span class="token operator">/</span>imagenet  # dataset root dir
train<span class="token operator">:</span> train  # train <span class="token function">images</span> <span class="token punctuation">(</span>relative to <span class="token char">'path'</span><span class="token punctuation">)</span> <span class="token number">1281167</span> images
val<span class="token operator">:</span> val  # val <span class="token function">images</span> <span class="token punctuation">(</span>relative to <span class="token char">'path'</span><span class="token punctuation">)</span> <span class="token number">50000</span> images
test<span class="token operator">:</span>  # test <span class="token function">images</span> <span class="token punctuation">(</span>optional<span class="token punctuation">)</span>

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Classes</span></span>
names<span class="token operator">:</span>
  <span class="token number">0</span><span class="token operator">:</span> tench
  <span class="token number">1</span><span class="token operator">:</span> goldfish
  <span class="token number">2</span><span class="token operator">:</span> great white shark
  <span class="token number">3</span><span class="token operator">:</span> tiger shark
  <span class="token number">4</span><span class="token operator">:</span> hammerhead shark
  <span class="token number">5</span><span class="token operator">:</span> electric ray
  <span class="token number">6</span><span class="token operator">:</span> stingray
  <span class="token number">7</span><span class="token operator">:</span> cock
  <span class="token number">8</span><span class="token operator">:</span> hen
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Download script<span class="token operator">/</span><span class="token function">URL</span> <span class="token punctuation">(</span>optional<span class="token punctuation">)</span></span></span>
download<span class="token operator">:</span> data<span class="token operator">/</span>scripts<span class="token operator">/</span>get_imagenet<span class="token punctuation">.</span>sh
</code></pre> 
<p>改写后：</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Train<span class="token operator">/</span>val<span class="token operator">/</span>test sets as <span class="token number">1</span><span class="token punctuation">)</span> dir<span class="token operator">:</span> path<span class="token operator">/</span>to<span class="token operator">/</span>imgs<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> file<span class="token operator">:</span> path<span class="token operator">/</span>to<span class="token operator">/</span>imgs<span class="token punctuation">.</span>txt<span class="token punctuation">,</span> or <span class="token number">3</span><span class="token punctuation">)</span> list<span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token operator">/</span>to<span class="token operator">/</span>imgs1<span class="token punctuation">,</span> path<span class="token operator">/</span>to<span class="token operator">/</span>imgs2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span></span></span>
path<span class="token operator">:</span> E<span class="token operator">:</span><span class="token operator">/</span>yolov5<span class="token operator">-</span>master<span class="token operator">/</span>mydata  # dataset root dir
train<span class="token operator">:</span> train  # train <span class="token function">images</span> <span class="token punctuation">(</span>relative to <span class="token char">'path'</span><span class="token punctuation">)</span> <span class="token number">1281167</span> images
val<span class="token operator">:</span> val  # val <span class="token function">images</span> <span class="token punctuation">(</span>relative to <span class="token char">'path'</span><span class="token punctuation">)</span> <span class="token number">50000</span> images
test<span class="token operator">:</span> test # test <span class="token function">images</span> <span class="token punctuation">(</span>optional<span class="token punctuation">)</span>

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Classes</span></span>
names<span class="token operator">:</span>
  <span class="token number">0</span><span class="token operator">:</span> E
  <span class="token number">1</span><span class="token operator">:</span> L
  <span class="token number">2</span><span class="token operator">:</span> M
  <span class="token number">3</span><span class="token operator">:</span> N

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Download script<span class="token operator">/</span><span class="token function">URL</span> <span class="token punctuation">(</span>optional<span class="token punctuation">)</span></span></span>
download<span class="token operator">:</span> data<span class="token operator">/</span>scripts<span class="token operator">/</span>get_imagenet<span class="token punctuation">.</span>sh
</code></pre> 
<h5><a id="4trainpy_388"></a>4、改写train.py代码，训练数据</h5> 
<p><img src="https://images2.imgbox.com/c7/17/342VzoAY_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f8/51/Ximc4OvC_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c">（<span class="token number">1</span>）首先引入官方的目标检测预训练模型，在我们下载项目文件的时候，里面就包含了这个预训练模型：yolov5s<span class="token punctuation">.</span>pt<span class="token punctuation">,</span>你也可以去官网中进行下载其它的权重模型。如上图左侧标记所示；
（<span class="token number">2</span>）更改data路径：data<span class="token operator">/</span>cells<span class="token punctuation">.</span>yaml；
（<span class="token number">3</span>）更改epochs为：<span class="token number">200</span>；
（<span class="token number">4</span>）更改batch<span class="token operator">-</span>size为：<span class="token number">64</span>；
如下图所示：
</code></pre> 
<p><img src="https://images2.imgbox.com/0d/ba/w6Bv04pu_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="5trainpy_399"></a>5、开始执行train.py,结果如下：</h5> 
<p>我在执行过程中报了一个错误：<br> <img src="https://images2.imgbox.com/80/ac/VENnVqOO_o.png" alt="在这里插入图片描述"><br> 这是因为：yolov5在训练时需要下载字体Arial.ttf，你可以复制下载网址：https://ultralytics.com/assets/Arial.ttf，在网页打开直接就下载了，再把下载的文件放在下载的目录中，如下图：<br> <img src="https://images2.imgbox.com/62/6f/sPNRsP7n_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/56/fe/7i2yotNi_o.png" alt="在这里插入图片描述"><br> 再次运行就可以了！</p> 
<h6><a id="_407"></a>运行结果如下所示：</h6> 
<p><img src="https://images2.imgbox.com/4b/f2/xEjXZyAF_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c">在目标检测任务中，常用的评估指标包括Precision（P）、Recall（R）、mAP50和mAP50<span class="token operator">-</span><span class="token number">95</span>。
Precision（精确率）表示检测出的正样本中有多少是真正的正样本。它的计算公式是：P <span class="token operator">=</span> TP <span class="token operator">/</span> <span class="token punctuation">(</span>TP <span class="token operator">+</span> FP<span class="token punctuation">)</span>，其中TP是真正例（正确检测的正样本数），FP是假正例（错误检测的正样本数）。Precision越高，表示检测结果中的正样本越准确。
Recall（召回率）表示真实的正样本中有多少被正确地检测出来。它的计算公式是：R <span class="token operator">=</span> TP <span class="token operator">/</span> <span class="token punctuation">(</span>TP <span class="token operator">+</span> FN<span class="token punctuation">)</span>，其中TP是真正例，FN是假负例（未能检测到的正样本数）。Recall越高，表示模型能够更好地检测出真实的正样本。
mAP50（平均精确率，IoU阈值为<span class="token number">0.5</span>）表示在不同类别上的平均精确率。它的计算方法是先计算每个类别的精确率，然后对所有类别的精确率取平均值。mAP50衡量了模型在不同类别上的整体性能，当IoU阈值为<span class="token number">0.5</span>时，表示检测框与真实框的重叠程度达到<span class="token number">50</span><span class="token operator">%</span>以上时才被视为正确检测。
mAP50<span class="token operator">-</span><span class="token number">95</span>（平均精确率，IoU阈值从<span class="token number">0.5</span>到<span class="token number">0.95</span>）是在不同IoU阈值范围内的平均精确率。它计算了从<span class="token number">0.5</span>到<span class="token number">0.95</span>不同IoU阈值下的精确率，并对其取平均值。mAP50<span class="token operator">-</span><span class="token number">95</span>更全面地评估了模型在不同IoU阈值下的检测性能。
这些评估指标可以帮助我们了解目标检测模型的准确性和召回率，并对模型的性能进行综合评估。
</code></pre> 
<p>运行的结果保存在：…runs\train\exp6目录下<br> <img src="https://images2.imgbox.com/78/4b/xaERGDfv_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c">里面包含生成的权重文件：weights，精确率与召回率的图像等，如下图所示：
</code></pre> 
<p><img src="https://images2.imgbox.com/e9/c3/W09f4Hvf_o.png" alt="在这里插入图片描述"><br> （1）"labels.jpg"通常是指包含训练数据集中所有类别标签的图像文件。</p> 
<pre><code class="prism language-c">    第一个图是训练集得数据量，每个类别有多少个；
    第二个图是框的尺寸和数量；
    第三个图是中心点相对于整幅图的位置；
    第四个图是图中目标相对于整幅图的高宽比例；
</code></pre> 
<p><img src="https://images2.imgbox.com/47/41/tmgdqsxW_o.jpg" alt="在这里插入图片描述"><br> （2）labels_correlogram.jpg是一张颜色矩阵图，它展示了目标检测算法在训练过程中预测标签之间的相关性。</p> 
<pre><code class="prism language-c">矩阵的行列分别代表了模型训练时使用的标签（classes），而每个单元格则代表了对应标签的预测结果之间的相关性。
矩阵中的颜色越深，表示对应标签之间的相关性越强；颜色越浅，表示相关性越弱。对角线上的颜色表示每个标签的自身相关性，通常都是最深的。
通过这张图，我们可以看出哪些标签之间具有较强的相关性，从而有助于优化模型的训练和预测效果。例如，如果我们发现某些标签之间的相关性过强，可以考虑将它们合并成一个标签，从而简化模型并提高效率。
最上面的图（<span class="token number">0</span>，<span class="token number">0</span>）表明中心点横坐标x的分布情况；
（<span class="token number">1</span>，<span class="token number">1</span>）图表明中心点纵坐标y的分布情况；
（<span class="token number">2</span>，<span class="token number">2</span>）图表明框的宽的分布情况；
（<span class="token number">3</span>，<span class="token number">3</span>）图表明框的宽的分布情况
</code></pre> 
<p><img src="https://images2.imgbox.com/0e/48/uEVbAX6s_o.jpg" alt="在这里插入图片描述"><br> （3）P曲线：P_curve.png：准确率precision与置信度confidence的关系图。</p> 
<pre><code class="prism language-c">【置信度confidence：用来判断边界框内的物体是正样本还是负样本，大于置信度阈值的判定为正样本，小于置信度阈值的判定为负样本即背景。】
</code></pre> 
<p><img src="https://images2.imgbox.com/98/95/wGEHSzYp_o.png" alt="在这里插入图片描述"><br> （4）R_curve.png（信度阈值 - 召回率曲线图）：Recall-Confidence Curve (RCC)图是目标检测中用于评估算法性能的一种方法。它是在不同置信度阈值下，召回率的变化情况的可视化表示。</p> 
<pre><code class="prism language-c">通常情况下，我们希望算法能够在高召回率的同时保持较高的精度。
当RCC图中的曲线在较高的置信度水平下具有较高的召回率时，说明算法在检测目标时能够较为准确地预测目标的存在，并且在过滤掉低置信度的预测框后，依然可以保持较高的召回率。这说明算法在目标检测任务中具有较好的性能。
需要注意的是，在RCC图中，曲线的斜率越陡峭，说明在过滤掉低置信度的预测框后，能够获得较大的召回率提升，从而提高模型的检测性能。
在该图表中，曲线越靠近右上角，则表示模型的性能越好。当曲线接近图表的右上角时，意味着模型在保持高召回率的同时，也能够保持较高的精确度。因此，R_curve<span class="token punctuation">.</span>png可以用于评估模型的整体表现和找到一个合适的阈值，来平衡模型的召回率和精确度。
</code></pre> 
<p><img src="https://images2.imgbox.com/48/c7/9RxmBEFf_o.png" alt="在这里插入图片描述"><br> （5）PR_curve.png —— 精确率和召回率的关系图：PR Curve是Precision-Recall Curve的缩写，表示的是在不同阈值下，精确率与召回率之间的关系曲线。其中精确率（Precision）表示预测为正例的样本中真正为正例的比例，召回率（Recall）表示真正为正例的样本中被预测为正例的比例。</p> 
<pre><code class="prism language-c">在PR Curve中，横坐标为召回率，纵坐标为精确率。一般而言，当召回率较高时，精确率较低；当精确率较高时，召回率较低。而PR Curve则体现了这种“取舍”关系。当PR Curve越靠近右上角时，表示模型在预测时能够同时保证高的精确率和高的召回率，即预测结果较为准确。相反，当PR Curve越靠近左下角时，表示模型在预测时难以同时保证高的精确率和高的召回率，即预测结果较为不准确。
通常，PR Curve与ROC Curve（受试者工作特征曲线）一同使用，以更全面地评估分类模型的性能。
</code></pre> 
<p><img src="https://images2.imgbox.com/48/dc/nwRL7n0E_o.png" alt="在这里插入图片描述"><br> （6）result.png：</p> 
<pre><code class="prism language-c">定位损失box_loss：预测框与标定框之间的误差（CIoU），越小定位得越准；
置信度损失obj_loss：计算网络的置信度，越小判定为目标的能力越准；
分类损失cls_loss：计算锚框与对应的标定分类是否正确，越小分类得越准；
mAP@<span class="token number">0.5</span><span class="token operator">:</span><span class="token number">0.95</span>（mAP@<span class="token punctuation">[</span><span class="token number">0.5</span><span class="token operator">:</span><span class="token number">0.95</span><span class="token punctuation">]</span>）<span class="token operator">:</span>
表示在不同IoU阈值（从<span class="token number">0.5</span>到<span class="token number">0.95</span>，步长<span class="token number">0.05</span>）（<span class="token number">0.5</span>、<span class="token number">0.55</span>、<span class="token number">0.6</span>、<span class="token number">0.65</span>、<span class="token number">0.7</span>、<span class="token number">0.75</span>、<span class="token number">0.8</span>、<span class="token number">0.85</span>、<span class="token number">0.9</span>、<span class="token number">0.95</span>）上的平均mAP；
mAP@<span class="token number">0.5</span>：表示阈值大于<span class="token number">0.5</span>的平均mAP
</code></pre> 
<h6><a id="0963___0938_470"></a>通过上图中的结果发现：该准确率平均达到0.963, 精确率平均达到0.938,已经时一个不错的效果了！</h6> 
<h5><a id="6detectpy_472"></a>6、改写detect.py代码，进行预测，如下图所示：</h5> 
<p><img src="https://images2.imgbox.com/9f/f9/X9Mn842g_o.png" alt="在这里插入图片描述"><br> 选择一张图片预测：该图片为EOSINOPHIL：嗜酸性粒细胞<br> <img src="https://images2.imgbox.com/3d/3e/sEUKR0ul_o.png" alt="在这里插入图片描述"><br> 预测结果：<br> <img src="https://images2.imgbox.com/a5/e1/gDq3TGYm_o.png" alt="在这里插入图片描述"><br> 再在验证集val选择一张图片预测：该图片为NEUTROPHIL：中性粒细胞<br> <img src="https://images2.imgbox.com/da/aa/ZFeUpxFh_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c3/60/oFMpnt6L_o.png" alt="在这里插入图片描述"><br> 预测结果：<br> <img src="https://images2.imgbox.com/02/1a/EiRhNQ6E_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_483"></a>九、简单总结</h2> 
<h5><a id="1yolov5_484"></a>1、以上就是多使用yolov5模型进行一个分类与目标检测的介绍和实践，大家可以参考与提出问题，看见了就会回答，一起讨论！项目代码和数据也上传了，大家可以下载！</h5> 
<h5><a id="2chatgpt_485"></a>2、再这个过程中大家肯定会遇见一些错误，但是不要害怕，可以去根据提示进行改正或者上网查找解决方法，还有就是询问chatgpt大模型！</h5> 
<h5><a id="3094___094_486"></a>3、不管是分类训练，还是目标检测，准确率平均达到0.94及其以上, 精确率也平均达到0.94左右,已经时一个不错的效果了！，但是大家如果还需要提高精确度，比如增加数据来，我这里的数据量不是太多，数据增强等，可以参考以下方法：</h5> 
<pre><code class="prism language-c">要提高YOLOv5模型的精确度和准确度，可以尝试以下方法：

增加训练数据量：增加训练数据可以提供更多的样本和场景，有助于模型学习更多的特征和模式。

数据增强：使用数据增强技术，如随机缩放、翻转、旋转、裁剪等，可以扩充训练数据集，增加模型的鲁棒性和泛化能力。

调整模型架构：可以根据任务需求调整YOLOv5的网络架构，如增加卷积层、调整通道数、调整网络深度等，以提升模型的表达能力。

调整训练参数：可以尝试不同的学习率、批量大小、优化器、学习率衰减策略等训练参数，以找到最优的训练配置。

使用预训练模型：可以使用在大规模数据集上预训练的模型作为初始权重，然后在目标数据集上进行微调，以加快收敛速度和提高模型性能。

多尺度训练和推理：使用多尺度训练和推理可以提升模型对不同尺寸目标的检测能力，可以在训练时随机选择不同的输入尺寸，并在推理时使用多个尺度的图像进行预测。

使用更大的输入图像尺寸：增加输入图像的尺寸可以提高模型对小目标的检测能力，但同时也会增加计算和内存开销。

引入注意力机制：可以在YOLOv5中引入注意力机制，如SENet、CBAM等，以增强模型对重要特征的关注和响应能力。

集成学习：通过模型集成方法，如投票、平均等，结合多个训练好的YOLOv5模型的预测结果，可以提高模型的稳定性和性能。

以上是一些常用的方法，可以根据具体的任务和数据集进行尝试和调整，以获得更好的精确度和准确度。

</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6e876532bd96350a0908a8f631265b53/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C# Unity将地形(Terrain)导出成obj文件</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b8500ebe9023af34e9719f35cfd7ce54/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python项目分享 基于Django的问答社区管理系统</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>